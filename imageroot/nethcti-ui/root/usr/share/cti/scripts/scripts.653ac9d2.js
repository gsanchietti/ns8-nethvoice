function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var n,i,s=[],o=!0,r=!1;try{for(a=a.call(e);!(o=(n=a.next()).done)&&(s.push(n.value),!t||s.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{o||null==a.return||a.return()}finally{if(r)throw i}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,r=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){r=!0,s=e},f:function(){try{o||null==a.return||a.return()}finally{if(r)throw s}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var ctiDetectWakeup={code:"let lastTime = (new Date()).getTime();  let checkInterval = 2000;  setInterval(() => {    let currentTime = (new Date()).getTime();    if (currentTime > (lastTime + checkInterval * 2)) {      postMessage('wakeup');    }    lastTime = currentTime;  }, checkInterval);"},NethCTIVersion="3.28.8";angular.module("nethctiUiApp",["ngResource","ngRoute","ngSanitize","ngTable","pascalprecht.translate","timer","toaster","angular-chrono","ui.sortable","angular-web-notification","ui.select","ngDragDrop"]).config(["$routeProvider","$sceProvider",function(e,t){t.enabled(!1),e.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl",controllerAs:"login"}).when("/phonebook",{templateUrl:"views/phonebook.html",controller:"PhonebookCtrl",controllerAs:"phonebook"}).when("/history",{templateUrl:"views/history.html",controller:"HistoryCtrl",controllerAs:"history"}).when("/queues",{templateUrl:"views/queues.html",controller:"QueuesCtrl",controllerAs:"queues"}).when("/qmanager",{templateUrl:"views/qmanager.html",controller:"QManagerCtrl",controllerAs:"qmanager"}).when("/customercard/:num",{templateUrl:"views/customercard.html",controller:"CustomercardCtrl",controllerAs:"customercard"}).when("/settings",{templateUrl:"views/settings.html",controller:"SettingsCtrl",controllerAs:"settings"}).when("/parkings",{templateUrl:"views/parkings.html",controller:"ParkingsCtrl",controllerAs:"parkings"}).when("/lines",{templateUrl:"views/lines.html",controller:"LinesCtrl",controllerAs:"lines"}).when("/streaming",{templateUrl:"views/streaming.html",controller:"StreamingCtrl",controllerAs:"streaming"}).when("/offhour",{templateUrl:"views/offhour.html",controller:"OffhourCtrl",controllerAs:"offhour"}).when("/videoconf",{templateUrl:"views/videoconf.html",controller:"VideoconfCtrl",controllerAs:"videoconf"}).otherwise({redirectTo:"/"})}]).config(["$translateProvider",function(e){e.useSanitizeValueStrategy(null),e.useStaticFilesLoader({prefix:"scripts/i18n/locale-",suffix:".json"}),e.fallbackLanguage("en")}]).config(["$compileProvider",function(e){e.aHrefSanitizationWhitelist(/^\s*(https?|mailto|data):/)}]);var appConfig={PRESENCE_MAP:{dnd:{label:"Do not Disturb",description:"Busy",color:"black"},online:{label:"Online",description:"Available",color:"green"},voicemail:{label:"Voicemail",description:"Offline",color:"orange"},cellphone:{label:"Cellphone",description:"Away",color:"purple"},callforward:{label:"Callforward",description:"Away",color:"yellow"}},STATUS_MAP:{online:{color:"green",description:"Free",icon:"call"},busy:{color:"red",description:"Busy",icon:"call"},busy_ringing:{color:"red",description:"Busy",icon:"call"},ringing:{color:"blue",description:"Incoming",icon:"call"},onhold:{color:"orange",description:"On hold",icon:"pause"},offline:{color:"grey",description:"Offline",icon:"remove"},"":{color:"grey",description:"Status not available",icon:"help"}},MAIN_STATUS_MAP:{online:{color:"green",description:"Available",icon:"user"},dnd:{color:"black",description:"Do not disturb",icon:"user"},voicemail:{color:"orange",description:"Voicemail",icon:"user"},cellphone:{color:"purple",description:"Cellphone",icon:"user"},callforward:{color:"yellow",description:"Callforward",icon:"user"},busy:{color:"red",description:"Busy",icon:"call"},ringing:{color:"blue",description:"Incoming",icon:"call"},offline:{color:"grey",description:"Offline",icon:"remove"}},MAIN_STATUS_LIST:{ONLINE:"online",DND:"dnd",VOICEMAIL:"voicemail",CELLPHONE:"cellphone",CALLFORWARD:"callforward",BUSY:"busy",RINGING:"ringing",OFFLINE:"offline"},PHONEBOOK_RESULT_LIMIT:20,LOSTCALLS_RESULT_LIMIT:10,LASTCALLS_RESULT_LIMIT:10,PROFILE_IMAGE_SIZE:96,PHONEBOOK_ICON_MAP:{speeddial:"yellow star",public:"green world",private:"blue lock",centralized:"teal cloud",cti:"brown address book",info:"purple info"},QUEUES_PAUSE_STATE:{"Lunch break":"coffee",Emergency:"red warning",Backend:"pin"}};angular.module("nethctiUiApp").controller("MainCtrl",["$scope","$window","$filter","toaster","PhoneService","OperatorService","WebsocketService","LocalStorageService",function(e,t,a,n,i,s,o,r){e.appConfig=appConfig,e.operatorsSites={local:{groups:[],users:[],description:"Local",active:!0}},e.viewLoad=!0,e.toasterTime="",e.toasterTimeout=2e3,e.filter={type:r.get("oppanelFilter")||"name"},e.tab="";var l=!1,c=1460,d=function(){angular.element(document).ready(function(){$(".ui.cards .ui.dropdown").dropdown()})};function u(){angular.element(document).ready(function(){!e.opPanel.show||t.innerWidth<c||(l?$(".ui.sticky").sticky("refresh"):p())})}function p(){angular.element(document).ready(function(){!e.opPanel.show||t.innerWidth<c||$(".ui.sticky").sticky({context:"#opSegment",offset:108,onStick:function(){var e=document.querySelector("#leftBar"),t=document.querySelector("#toolbarServices"),a=document.querySelector("#topBar"),n=t.offsetHeight+a.offsetHeight;e.style.marginTop!=n+"px"&&(e.style.marginTop=n+10+"px"),l=!0}})})}e.setTab=function(t){e.tab=t,r.set("prefOpPanelGroup",t),d(),u()},e.cleanOpGroupName=function(e){return"grp_"+e.replace(/[^a-zA-Z0-9]/g,"").toLowerCase().trim()},e.parseGroup=function(t){var a=e.cleanOpGroupName(t);return e.currentUser.profile.macro_permissions.presence_panel.permissions[a]&&e.currentUser.profile.macro_permissions.presence_panel.permissions[a].value};e.changeFilter=function(){r.set("oppanelFilter",e.filter.type)},e.getLocalUserGroups=function(){e.viewLoad=!0,s.userGroups().then(function(t){for(var a in e.operatorsSites.local.groups=[],t.data)t.data[a].name=a,e.operatorsSites.local.groups.push(t.data[a]);e.getAllLocalUsers()},function(t){e.viewLoad=!1,console.error(t)})},e.getStatusOfUser=function(t){var a=[];for(var n in t)e.allExtensions[t[n].id]&&a.push(e.allExtensions[t[n].id].status);return a.indexOf("busy")>-1?"busy":a.indexOf("busy_ringing")>-1?"busy_ringing":a.indexOf("ringing")>-1?"ringing":a.indexOf("onhold")>-1?"onhold":a.indexOf("online")>-1?"online":"offline"},e.getAllLocalUsers=function(){for(var t in e.operatorsSites.local.users=e.allUsers,e.operatorsSites.local.users)for(var a in e.operatorsSites.local.users[t].status=e.getStatusOfUser(e.operatorsSites.local.users[t].endpoints.extension),e.operatorsSites.local.users[t].endpoints.extension)e.operatorsSites.local.users[t].endpoints.extension[a].status=e.allExtensions[e.operatorsSites.local.users[t].endpoints.extension[a].id]&&e.allExtensions[e.operatorsSites.local.users[t].endpoints.extension[a].id].status||"offline",e.operatorsSites.local.users[t].endpoints.extension[a].conversations=e.allExtensions[e.operatorsSites.local.users[t].endpoints.extension[a].id]&&Object.keys(e.allExtensions[e.operatorsSites.local.users[t].endpoints.extension[a].id].conversations).map(function(n){return e.allExtensions[e.operatorsSites.local.users[t].endpoints.extension[a].id].conversations[n]})||{};e.viewLoad=!1,function(){var t=r.get("prefOpPanelGroup");if(t&&function(e,t){for(var a=0;a<e.length;a++)if(e[a].name===t)return!0;return!1}(e.operatorsSites.local.groups,t))e.tab=t,d();else for(var a in e.operatorsSites.local.groups)if(e.parseGroup(e.operatorsSites.local.groups[a].name)){e.tab=e.operatorsSites.local.groups[a].name,d();break}p()}()},e.filterEndpoints=function(e){for(var t in e)if(e[t]&&e[t].conversations&&e[t].conversations.length>0)return[e[t]]},e.hasActiveConversations=function(t){return e.filterEndpoints(t.endpoints.extension)},e.oppanelHangup=function(t){var a=e.filterEndpoints(t.endpoints.extension)[0];i.hangup({convid:a.conversations[0].id,endpointId:a.id}).then(function(e){},function(e){console.error(e)})},e.recallBusy=function(t){i.recallOnBusy({caller:e.currentUser.endpoints.mainextension[0].id,called:t.endpoints.mainextension[0].id}).then(function(t){e.toasterTime=t.data.waitingExtensions,n.pop({title:a("translate")("Call reserved! You are the number")+"  "+e.toasterTime+"  "+a("translate")("in waiting list")+"!"})},function(e){console.error(e)})},e.oppanelPickup=function(t){var a=e.filterEndpoints(t.endpoints.extension)[0];i.pickup({convid:a.conversations[0].id,endpointId:t.endpoints.mainextension[0].id,destId:e.currentUser.default_device.id}).then(function(e){},function(e){console.error(e)})},e.oppanelSpy=function(t){var a=e.filterEndpoints(t.endpoints.extension)[0];e.currentCall.isSpy=!0,e.currentCall.actionDisplayName=t.name,e.currentCall.ringingAudio.play(),e.currentCall.ringingAudio.loop=!0,i.startSpy({convid:a.conversations[0].id,endpointId:a.id,destId:e.currentUser.default_device.id}).then(function(t){e.currentCall.ringingAudio.pause()},function(e){console.error(e)})},e.oppanelIntrude=function(t){var a=e.filterEndpoints(t.endpoints.extension)[0];e.currentCall.isIntrude=!0,e.currentCall.actionDisplayName=t.name,e.currentCall.ringingAudio.play(),e.currentCall.ringingAudio.loop=!0,i.intrude({convid:a.conversations[0].id,endpointId:a.id,destId:e.currentUser.default_device.id}).then(function(t){e.currentCall.ringingAudio.pause()},function(e){console.error(e)})},e.oppanelRecord=function(t){var a=e.filterEndpoints(t.endpoints.extension)[0];i.toggleRecord("true"==a.conversations[0].recording,"false"!==a.conversations[0].recording,{convid:a.conversations[0].id,endpointId:a.id}).then(function(e){},function(e){console.error(e)})},e.openChat=function(e){jsxc.gui.window.open(jsxc.jidToBid(e))};var m=function(t){t.presence&&t.presence.username&&(e.operatorsSites.local.users[t.presence.username].presence=t.presence.status,e.$apply())};o.on("userPresenceUpdate",m);var g=function(t){if(e.operatorsSites.local.users[t.username]&&e.operatorsSites.local.users[t.username].endpoints.extension){for(var a in e.operatorsSites.local.users[t.username].endpoints.extension)e.operatorsSites.local.users[t.username].endpoints.extension[a].id==t.exten&&(e.operatorsSites.local.users[t.username].endpoints.extension[a].status=t.status,e.operatorsSites.local.users[t.username].endpoints.extension[a].conversations=Object.keys(t.conversations).map(function(e){return t.conversations[e]}));e.operatorsSites.local.users[t.username].status=e.getStatusOfUser(e.operatorsSites.local.users[t.username].endpoints.extension),e.$apply()}};o.on("extenUpdate",g);function f(t){e.mobileop=t<767}function v(t){t<c?(e.wideop=!1,f(t),e.$$phase||e.$apply(),angular.element(document).ready(function(){$(".ui.sticky").sticky("destroy"),document.querySelector("#leftContainer").setAttribute("style",""),document.querySelector("#leftBar").setAttribute("style",""),l=!1})):(e.wideop=!0,f(t),e.$$phase||e.$apply(),u())}o.on("userMainPresenceUpdate",function(t){e.operatorsSites.local.users[t.mainPresence.username]&&(e.operatorsSites.local.users[t.mainPresence.username].mainPresence=t.mainPresence.status,setTimeout(function(){e.$apply()},100))}),e.getLocalUserGroups(),e.$on("updateOperatorsPannel",function(t,a){e.getLocalUserGroups()}),e.isNotOffline=function(){return e.allExtensions&&e.currentUser.default_device&&e.currentUser.default_device.id&&e.allExtensions[e.currentUser.default_device.id].status&&"offline"!==e.allExtensions[e.currentUser.default_device.id].status},v(t.innerWidth),e.$on("windowResize",function(e,t){v(t)}),e.$on("socketAutheOK",function(t,a){e.getLocalUserGroups()}),e.$on("serverReloaded",function(t,a){e.getLocalUserGroups()}),e.$on("$destroy",function(){o.off("extenUpdate",g),o.off("userPresenceUpdate",m)})}]),angular.module("nethctiUiApp").controller("LoginCtrl",["$rootScope","$scope","$location","RestService","LocalStorageService","LoginService","LogService",function(e,t,a,n,i,s,o){t.onLoginStarted=!1,t.onLoginFailed=!1,t.showHostname=!1,t.isShibboleth=!1,t.onLoginFailedServerError=!1,t.onLoginServerUnavailable=!1,t.onLoginFailedUserNotConfigured=!1,t.loginFailedUserNoConfigUrl="customizable/login-user-noconfig.html";var r=i.get("credentials")||void 0;t.doLogin=function(){if(o.log("doLogin"),t.onLoginFailedServerError=!1,t.onLoginFailedUserNotConfigured=!1,t.onLoginServerUnavailable=!1,t.login.takeOvering=!1,t.onLoginStarted=!0,t.onLoginFailed=!1,t.showHostname){(e=new URL(customConfig.BASE_API_URL)).hostname=t.login.hostname,customConfig.BASE_API_URL=e.href,(n=new URL(customConfig.BASE_WSS_URL)).hostname=t.login.hostname,customConfig.BASE_WSS_URL=n.href,(r=new URL(customConfig.JANUS_URL)).hostname=t.login.hostname,customConfig.JANUS_URL=r.href}else{var e=new URL(customConfig.BASE_API_URL);customConfig.BASE_API_URL=e.href;var n=new URL(customConfig.BASE_WSS_URL);customConfig.BASE_WSS_URL=n.href;var r=new URL(customConfig.JANUS_URL);customConfig.JANUS_URL=r.href}!1===customConfig.AUTHENTICATION_ENABLED&&(t.login.password=""+(new Date).getTime()),t.onLoginServerUnavailable=!1,s.login(t.login.username,t.login.password,t.login.hostname).then(function(e){if("/"===a.url()){var n=i.get("lastRoute")||"/";a.path(n)}t.$emit("loginCompleted")},function(e){"user-not-configured"===e?(t.onLoginFailedUserNotConfigured=!0,t.onLoginFailedUserNotConfiguredMsg=customConfig.LOGIN_USER_NOT_CONFIGURED_MSG):"invalid credentials"===e?t.onLoginFailed=!0:"server error"===e?t.onLoginFailedServerError=!0:"service unavailable"===e&&(t.onLoginServerUnavailable=!0),t.onLoginStarted=!1})},"undefined"!=typeof GLOBAL_MOBILE_TYPE&&"mobile"==GLOBAL_MOBILE_TYPE?(t.showHostname=!0,t.view.isMobilePlatform=!0):(t.showHostname=!1,t.view.isMobilePlatform=!1),""!==t.customConfig.SHIB_LOGIN_URL&&-1!==location.href.indexOf(t.customConfig.SHIB_LOGIN_URL)&&!1===customConfig.AUTHENTICATION_ENABLED&&(t.isShibboleth=!0,t.login.username="shibboleth",t.doLogin()),r&&r.username&&r.password&&!1===t.isShibboleth&&(t.login.username=r.username,t.login.password=atob(r.password),t.login.hostname=r.hostname,t.doLogin())}]),angular.module("nethctiUiApp").controller("InitCtrl",["$rootScope","$scope","$window","$compile","$translate","$location","$filter","chronoService","JanusService","RestService","UserService","QueueService","LoginService","PhonebookService","NgTableParams","LocalStorageService","LogService","WebsocketService","PhoneService","ConferenceService","OperatorService","HistoryService","SettingsService","UtilService","NotificationService","VisibilityService","QManagerService",function(e,t,a,n,i,s,o,r,l,c,d,u,p,m,g,f,v,h,b,C,y,w,x,k,S,T,q){function A(e){t.responsive={isMobile:e<680,isRightBarTouch:e<971}}t.customConfig=customConfig,t.appConfig=appConfig,t.loginUrl="views/login.html",t.topBarUrl="views/templates/topbar.html",t.newPbContactUrl="views/templates/newpbcontact.html",t.rightBarUrl="views/templates/rightbar.html",t.screenShareUrl="views/templates/screenshare.html",t.leftBarUrl="views/templates/leftbar.html",t.footerBarUrl="views/templates/footerbar.html",t.callPopupUrl="views/templates/callpopup.html",t.offhourRecPopupUrl="views/templates/offhourrec.html",t.queuesInfoUrl="views/templates/queues/queuesinfo.html",t.qmanagerLostcallsUrl="views/templates/qmanager/lostcalls.html",t.settingsPhonesUrl="views/templates/settings/phones.html",t.rightSidebarToggle=!1,t.leftSidebarToggle=!1,t.callPrefix="",t.jCheckId,t.inactiveTimeoutStatus=!1,t.file64,t.view={changeRoute:!1,loadSpeedDials:!0,loadLastCalls:!0,noCallsAvailable:!1,noCallsAvailableEver:!1,isMobilePlatform:!1,isChatLoaded:!1,isChatInitiated:!1,isChatStarted:!1,isChatAvailable:!1,isChatListenerInit:!1,initRecordCall:!1,wkaroundRecOffhour:!1,alertMediaDevices:!1,mediadevices:{webcam:!1,microphone:!1,speakers:!1,webcamPermission:!1,microphonePermission:!1},toolbarDivider:"",hidePhonebook:"",hideHistory:"",hidePresencePanel:"",hideQueues:"",noService:!1,pinShow:!1},t.settingsDevicesWarningMessage={show:!1,title:"",message:""},t.screenSharing={active:!1},t.opPanel={data:void 0,incomingTable:{},waitingTable:{},show:!1,channelOpToDrag:void 0,chOpToDragFromQueue:void 0,dragFromWaitingCalls:!1,numWaitingCalls:0,numInCalls:0,showInCalls:!1,showWaitCalls:!1},t.login={isLogged:!1,username:"",password:"",socketError:!1,takeOvering:!1},A(a.innerWidth),t.$on("windowResize",function(e,t){A(t)}),t.availablePresence=[],t.currentUser={},t.search={field:""},t.allUsers=[],t.allExtensions=[],t.allAvatars={},t.lastCalls=[],t.notifications={voicemail:{count:0,data:[]},last_call:{count:0,data:[]},clientUpdate:{count:0,data:[]}},t.janus={isConfigured:!1,isAvailable:!1,reconnectInterval:null},t.viewsIcons={operators:"blue user icon",parkings:"yellow product hunt icon",lines:"orange tasks icon"},t.webphone={warnPopup:{closedByUser:!1,showLoader:!0,showInitInProgress:!1,showRegFailed:!1,showed:!1},isRegistered:!1,idIntervalFaviconWarn:void 0},t.sleep={wakingUp:!1},t.leftMenuRoute=f.get("menuRoute"),t.iconMenu=function(){return t.viewIcon.parkings},t.defaultCall=function(){return{jsep:null,incoming:!1,outcoming:!1,accepted:!1,available:!1,isMute:!1,isPause:!1,isRecord:!1,recorded:!1,displayname:"",actionDisplayName:"",isClose:!1,keypadShow:!1,screenSharingShow:!1,transferShow:!1,inTransfer:!1,inSwitching:!1,startTime:0,prefix:"",callingAudio:new Audio("sounds/calling.8fc1d1ea.mp3"),ringingAudio:new Audio("sounds/ringing.0ecde800.mp3"),isSpy:!1,isIntrude:!1,isPBX:!1,isVideoAvailable:!1,isVideo:!1,isVideoEnabled:!1,isVideoMax:!1}},t.currentCall=t.defaultCall(),t.currentConference,t.clientServerTimeDiff,t.selectedColor=f.get("colorsGradient")||"",t.setGradients=function(e){if(e){switch(e.length){case 2:t.topBarGradient={background:"linear-gradient(to right,"+e[0]+", "+e[1]+")"},t.borderTextGradient={"border-bottom":"2px solid "+e[1],color:e[1]+" !important"},t.textGradient={color:e[1]+" !important"};break;case 3:t.topBarGradient={background:"linear-gradient(to right,"+e[0]+", "+e[1]+", "+e[2]+")"},t.borderTextGradient={"border-bottom":"2px solid "+e[2],color:e[2]+" !important"},t.textGradient={color:e[2]+" !important"};break;case 4:t.topBarGradient={background:"linear-gradient(to right,"+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.borderTextGradient={"border-bottom":"2px solid "+e[3],color:e[2]+" !important"},t.textGradient={color:e[3]+" !important"};break;case 5:t.topBarGradient={background:"linear-gradient(to right,"+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+")"},t.borderTextGradient={"border-bottom":"2px solid "+e[4],color:e[4]+" !important"},t.textGradient={color:e[4]+" !important"};break;default:t.topBarGradient=null,t.borderTextGradient=null,t.textGradient=null}t.$$phase||t.$apply()}else t.topBarGradient=null,t.borderTextGradient=null,t.textGradient=null},t.setGradients(t.selectedColor),t.$on("applyGradient",function(e,a){t.setGradients(a)}),$(window).click(function(e){if(t.currentCall.accepted){if(U(e,"#callContainer"))return;t.currentCall.keypadShow=!1,t.$$phase||t.$apply()}});var U=function(e,t){if(t&&e&&e.originalEvent){if(e.originalEvent.path&&e.originalEvent.path.length>0)return null!==e.originalEvent.path[0].closest(t);if(e.originalEvent.originalTarget)return null!==e.originalEvent.originalTarget.closest(t)}return!0};document.onkeydown=function(e){if(t.currentCall.accepted&&("K"===e.key&&e.ctrlKey&&e.shiftKey&&(t.currentCall.keypadShow=!0,t.$$phase||t.$apply()),e.key&&t.currentCall.keypadShow))switch(e.key){case"0":t.DTMF("0");break;case"1":t.DTMF("1");break;case"2":t.DTMF("2");break;case"3":t.DTMF("3");break;case"4":t.DTMF("4");break;case"5":t.DTMF("5");break;case"6":t.DTMF("6");break;case"7":t.DTMF("7");break;case"8":t.DTMF("8");break;case"9":t.DTMF("9");break;case"*":t.DTMF("*");break;case"#":t.DTMF("#");break;case"c":t.closePad()}},t.closePad=function(){t.currentCall.keypadShow=!1,t.$$phase||t.$apply()},t.reloading=!1,r.addTimer("myTimer",{resetOnStop:!0}),r.start();var D=_.throttle(function(){t.$broadcast("windowResize",a.innerWidth)},1e3);angular.element(a).bind("resize",D),t.startSearchGlobal=function(){/^[*+#]*[0-9]+([*#]+)?$/.test(t.search.field)?t.call.accepted?t.transfer(t.search.field):t.call(t.search.field):(s.path("/phonebook"),t.$broadcast("globalSearch"))},t.searchOnly=function(){s.path("/phonebook"),t.$broadcast("globalSearch")},t.recognizeNumber=function(){/^[+]*[0-9#*\s]+$/.test(t.search.field)?t.currentCall.available=!0:t.currentCall.available=!1},t.goTo=function(e){f.set("lastRoute",e),s.path(e),""!=e&&"lines"!=e&&"parkings"!=e||(f.set("menuRoute",e),t.leftMenuRoute=e)},t.onLoadTopBar=function(){angular.element("#devicesAvailableList").ready(function(){$("#topBar .ui.dropdown").dropdown()})},t.qrCondition=function(){return 1===t.currentUser.endpoints.extension.length&&"mobile"===t.currentUser.endpoints.extension[0].type},t.onLoadRightBar=function(){$("#rightBar .ui.dropdown").dropdown()},t.onLoadFooterBar=function(){t.getUserInfo()},t.onLoadCallPopup=function(){},t.onLoadOffhourRecPopup=function(){},t.resolveActiveTab=function(e,t){var a=s.path().split("/")[t];return""===e?"lines"===a||"parkings"===a||""===a:a===e},t.showDevicesListAvailable=function(){$("#devicesAvailableList").dropdown("show")},""!==t.customConfig.SHIB_LOGIN_URL&&-1!==location.href.indexOf(t.customConfig.SHIB_LOGIN_URL)&&!1===customConfig.AUTHENTICATION_ENABLED&&(t.isShibboleth=!0),t.setToggleBar=function(e){t.rightSidebarToggle&&e?(t.rightSidebarToggle=!1,$("#jsxc_roster").hide(),$("#show-chat").hide()):e||(t.rightSidebarToggle=!t.rightSidebarToggle,$("#jsxc_roster").hide(),t.rightSidebarToggle?$("#show-chat").show():$("#show-chat").hide())},t.setOpToggleBar=function(e){t.leftSidebarToggle&&e?t.leftSidebarToggle=!1:e||(t.leftSidebarToggle=!t.leftSidebarToggle)},t.openChat=function(){$("#jsxc_roster").css("display","block")},t.closeChat=function(){$("#jsxc_roster").css("display","none")},t.setLanguage=function(){var e="";e=(e=navigator.language||navigator.userLanguage).replace("-","_").split("_")[0],i.use(e)},t.getBrowserLanguage=function(){var e=navigator.language||navigator.userLanguage;return e=e.replace("-","_").split("_")[0]},t.getAvailablePresence=function(){d.getAvailablePresence().then(function(e){for(var a in t.availablePresence=e.data,t.$broadcast("recvAvailablePresence"),t.availablePresence)if(t.availablePresence[a]===t.currentUser.presence){var n=!0;break}n||void 0==t.currentUser.presence||setTimeout(function(){t.setPresence("online")},100)},function(e){console.error(e)})},t.settingsProfiles=function(){t.goTo("settings"),t.clickedSettings()},t.settingsQrCode=function(){t.goTo("settings"),t.checkMobilePresence()},t.getAllExtensions=function(){b.getAllExtension().then(function(e){t.allExtensions=e.data,t.setFirstDevice(),t.getAllUsers(),t.currentUser.default_device&&t.allExtensions[t.currentUser.default_device.id]&&"offline"===t.allExtensions[t.currentUser.default_device.id].status&&t.isWebrtc(t.currentUser.default_device.id),t.currentUser.default_device&&t.allExtensions[t.currentUser.default_device.id]&&(t.presenceNumber=parseInt(t.allExtensions[t.currentUser.default_device.id].cf)),t.currentUser.default_device&&t.getConversationsOf(t.currentUser.default_device.id),t.checkDeviceStatus(),t.checkDevice(),t.checkAutomaticallyRegister(),t.checkDisconnectWebrtc(),t.checkPhoneSupportForLines(),t.$broadcast("updateOperatorsPannel")},function(e){console.error(e)})},t.setFirstDevice=function(){if(t.currentUser.endpoints.extension.length>1&&t.currentUser.default_device&&"mobile"===t.currentUser.default_device.type){var e,a=_createForOfIteratorHelper(t.currentUser.endpoints.extension);try{for(a.s();!(e=a.n()).done;){var n=e.value;if("mobile"!==n.type){t.setDevice(n);break}}}catch(e){a.e(e)}finally{a.f()}}},t.checkDevice=function(){if(t.currentUser.endpoints.extension.length>0&&t.currentUser.default_device&&"webrtc"!==t.currentUser.default_device.type&&"physical"!==t.currentUser.default_device.type){var e,a=_createForOfIteratorHelper(t.currentUser.endpoints.extension);try{for(a.s();!(e=a.n()).done;){var n=e.value;if("mobile"!==n.type){t.setDevice(n);break}}}catch(e){a.e(e)}finally{a.f()}}},t.checkDisconnectWebrtc=function(){var e,a=_createForOfIteratorHelper(t.currentUser.endpoints.extension);try{for(a.s();!(e=a.n()).done;){if("webrtc"!==e.value.type&&t.currentUser.default_device&&"webrtc"!==t.currentUser.default_device.type&&!0===t.webphone.isRegistered){t.janusUnregister(),t.janusDestroy(),t.webphone.isRegistered=!1;break}}}catch(e){a.e(e)}finally{a.f()}0===t.currentUser.endpoints.extension.length&&!0===t.webphone.isRegistered&&(t.janusUnregister(),t.janusDestroy(),t.webphone.isRegistered=!1)},t.janusDestroy=function(){try{l.destroy()}catch(e){console.error(e),t.janus.isConfigured=!1}},t.checkAutomaticallyRegister=function(){var e,a=_createForOfIteratorHelper(t.currentUser.endpoints.extension);try{for(a.s();!(e=a.n()).done;){if("webrtc"===e.value.type&&"webrtc"===t.currentUser.default_device.type&&0==t.webphone.isRegistered){t.janus.isAvailable=!0,t.initializeJanusService();break}}}catch(e){a.e(e)}finally{a.f()}},t.getAllQueues=function(){u.allQueues().then(function(e){t.allQueues=e.data,t.checkQAutoPausePresenceAll(),t.checkQueueLoginWarnOnDnd()},function(e){console.error(e)})},t.checkMobilePresence=function(){t.settingsClicked=!0},t.clickedSettings=function(){t.settingsClicked=!1},t.checkQAutoPausePresenceAll=function(){try{t.currentUser.settings.queue_auto_pause_onpresence&&-1!==t.currentUser.settings.queue_autopause_presencelist.indexOf(t.currentUser.presence)&&t.queuePauseAll("")}catch(e){console.error(e)}},t.isAtLeaseInQueueUnpause=function(){var e=t.currentUser.endpoints.mainextension[0].id;for(var a in t.allQueues)for(var n in t.allQueues[a].members)if(n===e&&t.allQueues[4001].members[2001].loggedIn&&!t.allQueues[4001].members[2001].paused)return!0;return!1},t.checkQueueLoginWarnOnDnd=function(){t.currentUser.settings.queue_auto_pause_onpresence||"dnd"!==t.currentUser.presence||$("#warn-queue-login-ondnd").modal("is active")||!t.isAtLeaseInQueueUnpause()||$("#warn-queue-login-ondnd").modal("show")},t.queuePauseAll=function(e){var a,n,i=[],s=t.currentUser.endpoints.mainextension[0].id;for(var o in t.allQueues){var r=t.allQueues[o];for(var l in r.members){if(l===s)r.members[l].paused||i.push(t.queuePause(l,o,e))}}a=i,Promise.all(a).then(function(e){n&&n()})},t.queuePause=function(e,a,n,i){t.allQueues[a].members[e].paused?i&&i():u.pause({endpointId:e,queueId:a,reason:n}).then(function(e){i&&i()},function(e){console.error(e)})},t.checkPhoneSupportForLines=function(){var e,a=_createForOfIteratorHelper(t.currentUser.endpoints.extension.entries());try{var n=function(){var a=_slicedToArray(e.value,2),n=a[0],i=a[1];if("physical"!==i.type)return"continue";t.allExtensions[i.id]&&t.allExtensions[i.id].mac?!0===t.currentUser.profile.macro_permissions.settings.permissions.phone_buttons.value?x.getPhoneDataByMac(t.allExtensions[i.id].mac).then(function(e){e&&e.model?x.getPhoneModelData(e.model).then(function(e){if(t.currentUser.endpoints.extension[n].model=e.display_name,e&&e.variables&&e.variables.cap_linekey_count){var a=e.variables.cap_linekey_count;t.currentUser.endpoints.extension[n].numLineKeys=a}else console.warn("no cap_linekey_count for model ".concat(e.model))},function(e){console.log(e),t.showSettingsDevicesWarningMessage(o("translate")("Warning"),o("translate")("Some error occurred while getting phone data from the server. Physical keys cannot be configured")+".")}):console.warn("no model for mac ".concat(t.allExtensions[i.id].mac))},function(e){console.log(e),t.currentUser.endpoints.extension[n].model=t.allExtensions[i.id].sipuseragent,t.showSettingsDevicesWarningMessage(o("translate")("Warning"),o("translate")("Some error occurred while getting phone data from the server. Physical keys cannot be configured")+".")}):t.currentUser.endpoints.extension[n].model=t.allExtensions[i.id].sipuseragent:(console.warn("no mac for exten ".concat(i.id)),t.currentUser.endpoints.extension[n].model=t.allExtensions[i.id].sipuseragent)};for(a.s();!(e=a.n()).done;)n()}catch(e){a.e(e)}finally{a.f()}},t.closeSettingsDevicesWarningMessage=function(){t.settingsDevicesWarningMessage.show=!1,t.settingsDevicesWarningMessage.message="",t.settingsDevicesWarningMessage.title=""},t.showSettingsDevicesWarningMessage=function(e,a){t.settingsDevicesWarningMessage.title=e,t.settingsDevicesWarningMessage.message=a,t.settingsDevicesWarningMessage.show=!0},t.getPinActivationStatus=function(e){b.getPinActivationStatus().then(function(a){t.view.pinShow=e&&a.data.enabled},function(e){console.error(e)})},t.isWebrtc=function(e){for(var a in t.allUsers)for(var n=0;n<t.allUsers[a].endpoints.extension.length;n++)if(t.allUsers[a].endpoints.extension[n].id===e&&"webrtc"===t.allUsers[a].endpoints.extension[n].type)return!0;return!1},t.isWebrtcMobile=function(e){for(var a in t.allUsers)for(var n=0;n<t.allUsers[a].endpoints.extension.length;n++)if(t.allUsers[a].endpoints.extension[n].id===e&&"mobile"===t.allUsers[a].endpoints.extension[n].type)return!0;return!1},t.getAllAvatars=function(){d.getAllAvatars().then(function(e){t.allAvatars=e.data},function(e){console.error(e)})},t.getAllUsers=function(){y.allUsers().then(function(e){t.allUsers=e.data,t.getSpeedDials()},function(e){console.error(e)})},t.getQManQueues=function(){q.getQueues().then(function(t){e.QManagerQueues=t.data},function(e){console.error(e)})},t.extractDeviceType=function(e){for(var a in t.allUsers)for(var n in t.allUsers[a].endpoints.extension)if(t.allUsers[a].endpoints.extension[n].id===e)return{type:t.allUsers[a].endpoints.extension[n].type,exten:t.allUsers[a].endpoints.extension[n].id}},t.showNotifications=function(){$("#notifications").modal("show"),t.retrieveNotifications()},t.showModalPresence=function(e){t.currentPresence=e,$("#presenceSet").modal("show")},t.hidePresenceSetModal=function(){t.currentPresence=null,$("#presenceSet").modal("hide")},t.parseCaller=function(e){return k.parseCaller(e)},t.parseInt=function(e){return parseInt(e)},t.isNumber=function(e){return/^[*+#]?[0-9]+$/.test(e)},t.getObjLength=function(e){return Object.keys(e).length},t.getDirections=function(e,t){var a={text:"",icon:""};switch(e){case"in":a.text=t?"External":"Incoming",a.icon="arrow left";break;case"out":a.text=t?"External":"Outgoing",a.icon="arrow right";break;case"internal":a.text="Internal",a.icon="building"}return a},t.getPrefix=function(){b.getPrefix().then(function(e){t.callPrefix=e.data.prefix},function(e){console.error(e)})},t.retrieveNotifications=function(){w.searchVoicemailNew().then(function(e){t.notifications.voicemail.data=e.data.rows,t.notifications.voicemail.count=e.data.count},function(e){console.error(e)})},t.checkDeviceStatus=function(){if(t.currentUser.endpoints&&t.currentUser.endpoints.extension)for(var e in t.currentUser.endpoints.extension)t.currentUser.endpoints.extension[e].status=t.allExtensions[t.currentUser.endpoints.extension[e].id]&&t.allExtensions[t.currentUser.endpoints.extension[e].id].status},t.isTotallyFree=function(){for(var e in t.currentUser.endpoints.extension)if(Object.keys(t.allExtensions[t.currentUser.endpoints.extension[e].id].conversations).length>0)return!1;return!0},t.initSpeedExtenStatus=function(){var e,a;t.speedExtenStatus={};for(var n=0;n<t.speedDials.length;n++)for(var i in t.allUsers)if(t.speedDials[n].speeddial_num===t.allUsers[i].endpoints.mainextension[0].id){t.speedExtenStatus[t.speedDials[n].speeddial_num]={status:"",assocExtens:{}},e="offline";for(var s=0;s<t.allUsers[i].endpoints.extension.length;s++)a=t.allUsers[i].endpoints.extension[s].id,"offline"!==e&&"online"!==e||"offline"===t.allExtensions[a].status||(e=t.allExtensions[a].status),t.speedExtenStatus[t.speedDials[n].speeddial_num].assocExtens[a]=t.allExtensions[a].status;t.speedExtenStatus[t.speedDials[n].speeddial_num].status=e}console.log(t.speedExtenStatus)},t.updateSpeedExtenStatus=function(e){var a,n,i=e.exten,s=e.status;for(var o in t.speedExtenStatus){for(var r in a=!0,n=!1,t.speedExtenStatus[o].assocExtens)i===r&&(n=!0,t.speedExtenStatus[o].assocExtens[r]=s),"offline"!==t.speedExtenStatus[o].assocExtens[r]&&(a=!1);if(n&&(a||!a&&"offline"!==s)){t.speedExtenStatus[o].status=s,t.$apply();break}}},t.getSpeedDials=function(){t.view.loadSpeedDials=!0,m.retrieveSpeedDials().then(function(e){t.speedDials=e.data,t.view.loadSpeedDials=!1,t.initSpeedExtenStatus()},function(e){console.error(e),t.view.loadSpeedDials=!1,403==e.status&&(t.speedDials=[])})},t.editSpeed=function(e){setTimeout(function(){t.$broadcast("speedDialModify",{contact:e})},100)};var L=new Blob([ctiDetectWakeup.code],{type:"application/javascript"});new Worker(URL.createObjectURL(L)).onmessage=function(e){e&&"wakeup"===e.data&&(t.sleep.wakingUp=!0,console.warn("wake up after possible device stand-by"),console.info("unregister janus"),t.janusUnregister(),l.destroy(),h.reconnect(),setTimeout(function(){t.sleep.wakingUp=!1},1e4))},t.importSpeedDial=function(e){$("#importInput").click(),$("#importInput").change(function(e){if(void 0!=e.target.files[0].name){var a=new FileReader;a.onload=function(e){t.$apply(function(){t.file64=e.target.result,$("#importInput").val(""),$("#importInput").unbind()})},a.readAsDataURL(e.target.files[0]),$("#importSpeeddialConfirm").modal("show")}else t.$apply(function(){t.error.file.status=!0})})},t.importCsvSpeddial=function(){m.importCsvSpeddial(t.file64).then(function(e){t.getSpeedDials()},function(e){console.error(e),t.getSpeedDials()})},t.exportSpeedDial=function(e){var a,n,i=t.speedDials.map(function(e){for(var t in n=[],a={},e)"$$hashKey"!==t&&"id"!==t&&(n.push(t),a[t]=e[t]);return a});k.exportCSVFile(n,i,"speeddial")},t.deleteAllSpeedDial=function(){m.deleteAllSpeedDial().then(function(e){t.getSpeedDials()},function(e){console.error(e),t.getSpeedDials()})},t.deleteSpeedDial=function(){m.delete(t.speeddialToDelete.id).then(function(e){t.getSpeedDials()},function(e){console.error(e),t.getSpeedDials()})},t.delSpeedDialConfirm=function(e){t.speeddialToDelete=e,$("#del-speeddial-contact").modal("show")},t.confirmDeleteAllSpeedDial=function(e){$("#del-all-speeddial").modal("show")},t.getLastCalls=function(){t.view.loadLastCalls=!0,w.search(t.currentUser.username,k.NWeeksAgo(8),k.dateNow(),"",0,t.appConfig.LASTCALLS_RESULT_LIMIT,"time desc","all").then(function(e){t.lastCalls=e.data.rows,t.view.loadLastCalls=!1,angular.element("#last-calls").ready(function(){$(".lastCallsPopup").popup({inline:!0,boundary:"#lastCallsBox",hoverable:!0,jitter:10,scrollContext:"#last-calls"})})},function(e){console.error(e),t.view.loadLastCalls=!1})},$(document).on("connected.jsxc",function(){t.view.isChatLoaded=!0,t.view.isChatInitiated=!0,t.view.isChatStarted=!0;var e=f.get("currentPresence");"offline"!==e&&jsxc.gui.changePresence(e),t.$apply()}),$(document).on("disconnected.jsxc",function(){t.view.isChatLoaded=!1,t.view.isChatInitiated=!1,t.view.isChatStarted=!1,t.view.isChatListenerInit=!1,$("#jsxc_roster").hide(),t.$apply()}),t.checkPermissions=function(){try{"/qmanager"===s.url()&&t.currentUser.profile.macro_permissions.qmanager&&!1===t.currentUser.profile.macro_permissions.qmanager.value?(t.$broadcast("qmanagerStop"),t.goTo("/")):"/qmanager"===s.url()&&t.currentUser.profile.macro_permissions.qmanager&&!0===t.currentUser.profile.macro_permissions.qmanager.value?t.$broadcast("qmanagerReload"):"/parkings"===s.url()&&!1===t.currentUser.profile.macro_permissions.settings.permissions.parkings.value?t.goTo(""):"/lines"===s.url()&&!1===t.currentUser.profile.macro_permissions.presence_panel.permissions.trunks.value?t.goTo(""):"/offhour"===s.url()&&!1===t.currentUser.profile.macro_permissions.off_hour.value?t.goTo(""):"/streaming"===s.url()&&!1===t.currentUser.profile.macro_permissions.streaming.value?t.goTo(""):"/videoconf"===s.url()&&!1===t.currentUser.profile.macro_permissions.settings.permissions.video_conference.value&&t.goTo("")}catch(e){console.error(e)}},t.checkToolbarDivider=function(e){try{var a=!0===e.presence_panel.value?"/":!0===e.queue_agent.value?"/queues":!0===e.phonebook.value?"/phonebook":!0===e.cdr.value?"/history":!0===e.streaming.value?"/streaming":!0===e.off_hour.value?"/offhour":e.qmanager&&!0===e.qmanager.value?"/qmanager":"/noservice";"/noservice"===a?(t.view.noService=!0,a="/"):t.view.noService=!1;var n=4;!1===e.presence_panel.value?(t.view.hidePresencePanel="hideToolbarItem",n-=1,"/"===s.url()&&t.goTo(a)):t.view.hidePresencePanel="",!1===e.queue_agent.value?(t.view.hideQueues="hideToolbarItem",n-=1,"/queues"===s.url()&&t.goTo(a)):t.view.hideQueues="",!1===e.phonebook.value?(t.view.hidePhonebook="hideToolbarItem",n-=1,"/phonebook"===s.url()&&t.goTo(a)):t.view.hidePhonebook="",!1===e.cdr.value?(t.view.hideHistory="hideToolbarItem",n-=1,"/history"===s.url()&&t.goTo(a)):t.view.hideHistory="",t.view.toolbarDivider=1===n?"one":2===n?"two":3===n?"three":"four"}catch(e){console.error(e)}},t.showFaviconWarn=function(){if(!0===t.login.isLogged){var e=!0;t.idIntervalFaviconWarn=setInterval(function(){e?($("link[rel*='icon']").attr("href","favicon-warn.ico"),a.document.title="( ! ) ".concat(customConfig.BRAND_NAME)):($("link[rel*='icon']").attr("href","favicon.ico"),a.document.title=customConfig.BRAND_NAME),e=!e},1e3)}},t.hideFaviconWarn=function(){clearInterval(t.idIntervalFaviconWarn),$("link[rel*='icon']").attr("href","favicon.ico"),a.document.title=customConfig.BRAND_NAME},t.resetWebphonePopupWarning=function(){t.webphone.warnPopup.closedByUser=!1,t.webphone.warnPopup.showLoader=!0,t.webphone.warnPopup.showInitInProgress=!1,t.webphone.warnPopup.showRegFailed=!1,$("#webphoneHeadphonesIcon").popup("is visible")&&$("#webphoneHeadphonesIcon").popup("hide")},t.showDesktopWebphoneWarning=function(){!0===t.login.isLogged&&S.notifyPermanentAlarm("".concat(customConfig.BRAND_NAME," - ").concat(o("translate")("Warning")),"".concat(o("translate")("Web Phone not available"),"!\n").concat(o("translate")("Re-initialization in progress"),"..."),function(){window.focus(),S.hideNotifyPermanentAlarm(),t.$apply()})},t.showDesktopWebphoneWarningRegFailed=function(){S.notifyPermanentAlarm("".concat(customConfig.BRAND_NAME," - ").concat(o("translate")("Warning")),"".concat(o("translate")("Web Phone not available"),"!\n").concat(o("translate")("Registration failed! Please contact the administrator"),"."),function(){window.focus(),S.hideNotifyPermanentAlarm(),t.$apply()})},t.showWebphonePopupWarning=function(){!0!==t.sleep.wakingUp&&(t.webphone.warnPopup.showInitInProgress=!0,t.webphone.warnPopup.showRegFailed=!1,t.webphone.warnPopup.showed||t.webphone.warnPopup.closedByUser||!0!==t.login.isLogged||($("#webphoneHeadphonesIcon").popup("show"),t.webphone.warnPopup.showed=!0,t.showFaviconWarn(),T.isCtiPageInBackground()&&t.showDesktopWebphoneWarning()))},t.showWebphonePopupWarningRegFailed=function(){t.webphone.warnPopup.showInitInProgress=!1,t.webphone.warnPopup.showRegFailed=!0,t.webphone.warnPopup.showLoader=!1,t.webphone.warnPopup.showed||t.webphone.warnPopup.closedByUser||($("#webphoneHeadphonesIcon").popup("show"),t.webphone.warnPopup.showed=!0,t.showFaviconWarn(),T.isCtiPageInBackground()&&t.showDesktopWebphoneWarningRegFailed())},t.closeWebphonePopupWarning=function(){$("#webphoneHeadphonesIcon").popup("hide"),t.hideFaviconWarn(),t.webphone.warnPopup.closedByUser=!1,t.webphone.warnPopup.showed=!1,S.hideNotifyPermanentAlarm()},t.closeWebphonePopupWarningByUser=function(){$("#webphoneHeadphonesIcon").popup("hide"),t.hideFaviconWarn(),t.webphone.warnPopup.closedByUser=!0,t.webphone.warnPopup.showed=!1,S.hideNotifyPermanentAlarm()},t.initWebphonePopupWarning=function(){$("#webphoneHeadphonesIcon").popup({popup:"#webphonePopupWarning",position:"bottom center",on:"manual",exclusive:!0,closable:!0})};t.checkCtiUpdated=function(){S.requestNotifPermission();var e=(new Date).getTime();x.getAppVersion().then(function(a){var n,i,s,o=(new Date).getTime()-e;if(n=(new Date).getTime(),i=a.data&&a.data.server_time?a.data.server_time:0,s=o,t.clientServerTimeDiff=n-s-parseInt(i),a&&a.data&&a.data.pkg_ver&&a.data.pkg_ver.nethcti3&&"string"==typeof a.data.pkg_ver.nethcti3&&""!==a.data.pkg_ver.nethcti3){var r=a.data.pkg_ver.nethcti3.split("-")[1];E(r)}else console.warn("bad value for app version: ".concat(JSON.stringify(a)))},function(e){console.error(e)})},t.reloadNoCache=function(){location.reload(!0)};var P=function(e){t.notifications.clientUpdate.count=1,t.notifications.clientUpdate.data=[{currentVer:NethCTIVersion,newVer:e}],t.$$phase||t.$apply(),t.currentUser.settings.desktop_notifications&&S.showClientUpdateNotification(customConfig.BRAND_NAME+": "+o("translate")("Software Update"),o("translate")("A new software update is available")+".\n"+o("translate")("Click for more information")+".",function(){window.focus(),t.showNotifications()})},E=function(e){e!==NethCTIVersion&&"0.0.0"!==NethCTIVersion?(console.log('check cti client ver: detected new version (actual "'.concat(NethCTIVersion,'" - new "').concat(e,'")')),P(e)):(t.notifications.clientUpdate.count=0,t.notifications.clientUpdate.data=[])};t.getUserInfo=function(e){d.getInfo().then(function(a){t.currentUser=a.data;for(var i=!1,o=0;o<t.currentUser.endpoints.extension.length;o++)"physical"===t.currentUser.endpoints.extension[o].type&&(i=!0);if(t.getPinActivationStatus(i),t.$broadcast("userInfoUpdated"),t.getAllExtensions(),t.getAllQueues(),t.getLastCalls(),t.retrieveNotifications(),t.getAllAvatars(),t.detectMediaDevices(),!0===t.reloading&&(t.reloading=!1,t.checkPermissions()),t.currentUser.profile.macro_permissions.qmanager&&!0===t.currentUser.profile.macro_permissions.qmanager.value&&"/qmanager"!=s.url()&&t.getQManQueues(),t.checkToolbarDivider(a.data.profile.macro_permissions),t.updateOpPanelData(),t.view.isMobilePlatform)for(var r in t.currentUser.endpoints.extension)if("mobile"===t.currentUser.endpoints.extension[r].type){t.setDevice(t.currentUser.endpoints.extension[r]);break}!0===e||!t.currentUser.default_device||"webrtc"!=t.currentUser.default_device.type&&"mobile"!=t.currentUser.default_device.type||(t.janus.isAvailable=!0,t.currentCall.accepted||t.initializeJanusService()),void 0===t.currentUser.default_device&&t.currentUser.endpoints.extension.length>0?t.view.noCallsAvailable=!0:0==t.currentUser.endpoints.extension.length&&(t.view.noCallsAvailable=!0,t.view.noCallsAvailableEver=!0);f.get("currentPresence");t.currentUser.profile.macro_permissions.settings.permissions.chat.value?(t.view.isChatAvailable=!0,t.view.isChatInitiated||t.initChat(),$(document).on("ready.roster.jsxc",function(){0==$("#headerIdChat").children().length&&$("#jsxc_roster").prepend(n('<h4 id="headerIdChat" class="ui blue dividing header chat-header">Chat  <i ng-click="closeChat()" class="window close icon close-chat"></i></h4>')(t)),t.view.isChatListenerInit||(t.view.isChatListenerInit=!0,$("#jsxc_presence li").on("click",function(){var e=$(this).data("pres");void 0!=e&&f.set("currentPresence",e)})),t.view.isChatLoaded||(t.view.isChatLoaded=!0,t.$apply()),"offline"===f.get("currentPresence")&&f.set("currentPresence","online"),t.view.isChatStarted||t.connectChat()})):t.view.isChatAvailable=!1,t.getConfInfo(),t.login.isLogged=!0},function(e){console.error(e)})},t.initChat=function(){if(!t.view.isChatInitiated){t.view.isChatInitiated=!0,jsxc.init({root:t.view.isMobilePlatform?"http://ctiapp-static.nethesis.it/":"/cti/",app_name:"CTI",hideOffline:!0,muteNotification:!0,notification:t.currentUser.settings.chat_notifications,xmpp:{url:t.currentUser.endpoints.jabber&&t.currentUser.endpoints.jabber[0]&&t.currentUser.endpoints.jabber[0].server||window.location.origin+"/http-bind"}});var e=f.get("currentPresence");"online"!==e&&"dnd"!==e||t.connectChat()}},t.connectChat=function(){t.view.isChatStarted=!0;var e=t.currentUser.endpoints.jabber&&t.currentUser.endpoints.jabber[0]&&t.currentUser.endpoints.jabber[0].id;f.set("currentPresence","online"),jsxc.start(e,atob(f.get("credentials").password))},t.setPresence=function(e,a){if(t.presenceNumber=null,d.setPresence({status:e,to:a||void 0}).then(function(a){var n=f.get("currentPresence");t.currentUser.presence=e,"online"!==e&&"dnd"!==e||"offline"===n?"offline"!==n&&(jsxc.xmpp.logout(),f.set("currentPresence","offline")):(jsxc.gui.changePresence(e),f.set("currentPresence",e)),$("#presenceSet").modal("hide")},function(e){console.error(e)}),t.currentUser.settings.queue_auto_pause_onpresence)if(-1!==t.currentUser.settings.queue_autopause_presencelist.indexOf(e))for(var n in t.allQueues)for(var i in t.allQueues[n].members)i!==t.currentUser.endpoints.mainextension[0].id||t.allQueues[n].members[i].paused||t.pauseQAgent(i,n,"");else for(var s in t.allQueues)for(var o in t.allQueues[s].members)o===t.currentUser.endpoints.mainextension[0].id&&t.allQueues[s].members[o].paused&&t.unpauseQAgent(o,s)},t.pauseQAgent=function(e,t,a){u.pause({endpointId:e,queueId:t,reason:a}).then(function(e){},function(e){console.error(e)})},t.unpauseQAgent=function(e,t){u.unpause({endpointId:e,queueId:t}).then(function(e){},function(e){console.error(e)})},t.setDevice=function(e){t.currentUser.default_device=e,t.resetWebphonePopupWarning(),"webrtc"!=t.currentUser.default_device.type&&"mobile"!=t.currentUser.default_device.type||(t.janus.isAvailable=!0,t.initializeJanusService()),t.view.isMobilePlatform||d.setDevice({id:e.id}).then(function(e){},function(e){console.error(e)}),"physical"===e.type&&l.destroy()},t.logout=function(){$("#jsxc_roster").hide(),jsxc.xmpp.logout(),t.view.isChatLoaded=!1,t.view.isChatInitiated=!1,t.view.isChatStarted=!1,(t.currentUser.default_device&&"webrtc"==t.currentUser.default_device.type||t.currentUser.default_device&&"mobile"==t.currentUser.default_device.type)&&l.destroy(),p.logout().then(function(e){t.login.isLogged=!1,t.login.password="",f.remove("credentials"),f.emptyVideoConferenceData(),c.unsetAuthHeader(),h.close(),$(document).trigger("loggedOut"),t.search.field="",t.login.socketError=!1,t.$apply()},function(e){console.error(e),t.login.isLogged=!1,t.login.password="",f.remove("credentials"),t.$apply()})},t.getDispName=function(e){return e&&"<unknown>"!==e.counterpartName&&"string"==typeof e.counterpartName&&e.counterpartName.length>0?e.counterpartName:e&&e.counterpartNum&&"string"==typeof e.counterpartNum&&e.counterpartNum.length>0?e.counterpartNum:o("translate")("Anonymous")},t.getConversationsOf=function(e){var a=t.allExtensions&&t.allExtensions[e]&&t.allExtensions[e].conversations&&t.allExtensions[e].conversations[Object.keys(t.allExtensions[e].conversations)[0]];a&&a.connected?(t.currentCall.accepted=!0,t.currentCall.startTime=a.startTime,t.currentCall.available=!1,t.currentCall.inTransfer=!1,t.currentCall.inSwitching=!1,t.currentCall.displayname=t.getDispName(a),t.currentCall.conversation=a,t.currentCall.isVisible=!0,t.currentCall.device=t.extractDeviceType(e)):a||(t.currentCall=t.defaultCall(),t.recognizeNumber()),a&&!1===a.connected&&"in"===a.direction&&(t.currentCall.accepted=!1,t.currentCall.incoming=!0,t.disableCallAnswer=!1,t.currentCall.displayname=t.getDispName(a))},t.lastCallsAdd=function(e,a,n){s.path("/phonebook"),setTimeout(function(){t.$broadcast("contactAdd",{defaultNum:e,defaultName:a,defaultFavorite:n})},100)},t.addPbContact=function(e,a,n){t.newContactObj={name:(a!==e?a:"")||"",number:e||"",privacy:n?"private":"public",favorite:n,selectedPrefNum:"extension",setInput:""},setTimeout(function(){$("#speedDialSearchForm").children().first().children().first().focus(),$("#speedDialSearchForm").children().first().children().first().val(""),$("#speedDialSearchForm").search({type:"category",maxResults:20,cache:!1,apiSettings:{url:customConfig.BASE_API_URL+"/phonebook/search/{query}",beforeXHR:function(e){var t=f.get("credentials");return e.setRequestHeader("Authorization",t.username+":"+t.token),e},onResponse:function(e){var a={results:{}};if(!e||void 0===!e.count)return a;e.rows.length>10&&e.rows.splice(10,e.rows.length);var n=0;for(var i in t.allUsers)if(-1!==t.allUsers[i].name.toLowerCase().indexOf(t.newContactObj.name.toLowerCase())&&n<10){var s=void 0;s=t.allAvatars[i]?'<img src="'+t.allAvatars[i]+'">':'<img src="img/steve.6204f1d6.jpg">',s+='<span title="'+o("translate")("User")+": "+t.allUsers[i].name+'" class="sp-user-name font-italic ml-7">'+t.allUsers[i].name+"</span>",a.results[s]={name:s,results:[{title:'<i class="call black icon"></i>'+t.allUsers[i].endpoints.mainextension[0].id,description:'<span class="hide">'+t.allUsers[i].name+"</span>"}]},n+=1}return $.each(e.rows,function(e,t){if(!t.name&&!t.company)return!0;var n;(t.extension||t.cellphone||t.workphone||t.homephone)&&(t.name&&t.company&&""!==t.name.trim()&&""!==t.company.trim()?n='<i class="large user middle aligned grey icon"></i>                    <span title="'+o("translate")("From phonebook")+": "+t.name+'" class="sp-user-name">'+t.name+'</span>                    <div class="sp-color-gray sp-user-descr" title="'+t.company+'">'+t.company+"</div>":!t.name||""===t.name.trim()||t.company&&""!==t.company.trim()?!t.company||""===t.company.trim()||t.name&&""!==t.name.trim()||(n='<i class="large building middle aligned grey icon"></i>                    <span title="'+o("translate")("From phonebook")+": "+t.company+'" class="sp-user-name">'+t.company+"</span>"):n='<i class="large user middle aligned grey icon"></i>                    <span title="'+o("translate")("From phonebook")+": "+t.name+'" class="sp-user-name">'+t.name+"</span>",a.results[n]={name:n,results:[]},t.extension&&a.results[n].results.push({title:'<i class="call black icon"></i>'+t.extension,description:'<span class="hide">'+(t.name?t.name:t.company)+"</span>"+o("translate")("Extension")}),t.cellphone&&a.results[n].results.push({title:'<i class="mobile black icon"></i>'+t.cellphone,description:'<span class="hide">'+(t.name?t.name:t.company)+"</span>"+o("translate")("Cellphone")}),t.workphone&&a.results[n].results.push({title:'<i class="call black icon"></i>'+t.workphone,description:'<span class="hide">'+(t.name?t.name:t.company)+"</span>"+o("translate")("Work phone")}),t.homephone&&a.results[n].results.push({title:'<i class="call black icon"></i>'+t.homephone,description:'<span class="hide">'+(t.name?t.name:t.company)+"</span>"+o("translate")("Home phone")}))}),a}},minCharacters:4,showNoResults:!0,onSelect:function(e,a){var n=e.description.split("</span>")[0].split('hide">')[1],i=e.title.split("</i>")[1];t.selectSpeedDial(n,i)}})},100),$("#add-new-pb-contact").modal({closable:!1}).modal("show"),setTimeout(function(){$(".ui.dropdown").dropdown()},100)},t.selectSpeedDial=function(e,a){t.$$phase||t.$apply(function(){t.newContactObj.name=e,t.newContactObj.number=a,t.newContactObj.setInput=e+" ("+a+")"})},t.editSpeedDialContact=function(e){for(var a in t.newContactObj=e,t.newContactObj)t.newContactObj.speeddial_num==t.newContactObj[a]&&"speeddial_num"!==a&&(t.newContactObj.selectedPrefNum=a);$("#edit-existing-modal").modal({closable:!1}).modal("show"),setTimeout(function(){$(".ui.dropdown").dropdown()},100)},t.saveEditSpeed=function(){t.newContactObj.type="speeddial",t.newContactObj.id=t.newContactObj.id.toString(),m.modify(t.newContactObj).then(function(e){t.getSpeedDials(),$("#edit-existing-modal").modal("hide")},function(e){console.error(e)})},t.$on("speedDialModify",function(e,a){t.editSpeedDialContact(a.contact),t.$apply()}),t.hideModalNewPbContact=function(){$("#add-new-pb-contact").modal("hide")},t.hideModalEditSpeedDialContact=function(){$("#edit-existing-modal").modal("hide")},t.newContactAdd=function(e){s.path("/phonebook"),setTimeout(function(){t.$broadcast("generalAdd",{contact:e})},100)},t.saveNewPbContact=function(){t.newContactObj.type="speeddial","speeddial"==t.newContactObj.type&&(t.newContactObj.speeddial_num=t.newContactObj.number),m.create(t.newContactObj).then(function(e){t.getSpeedDials(),$("#add-new-pb-contact").modal("hide")},function(e){console.error(e)})},t.openParamUrl=function(e,n,i,s){var o=f.get("paramUrl");!o||"string"!=typeof o||""===o||t.currentCall.paramUrlOpened&&"withBtn"!==t.currentUser.settings.open_param_url||(o=o.replace(/\$CALLER_NUMBER/g,encodeURI(e)).replace(/\$CALLER_NAME/g,encodeURI(n)).replace(/\$UNIQUEID/g,encodeURI(s)).replace(/\$CALLED/g,encodeURI(i)),a.open(o,"_blank"),t.currentCall.paramUrlOpened=!0)},t.checkParamUrl=function(){var e=f.get("paramUrl"),a=f.get("open_param_url")||"never";t.haveParamUrl=!(!e||"string"!=typeof e||""===e||"withBtn"!==a),t.checkParamUrlOnlyQueues()},t.checkParamUrlOnlyQueues=function(){t.haveParamUrlOnlyQueues=f.get("paramUrlOnlyQueues")||!1},t.$on("paramUrlRadioChanged",function(e,a){t.checkParamUrl()}),t.$on("paramUrlChanged",function(e,a){t.checkParamUrl()}),t.updateGraphicsOpp=function(){angular.element(document).ready(function(){$("#leftBar .ui.dropdown").dropdown({direction:"auto"}),$("#leftBar .menu .item").tab()})},t.queuePauseOpp=function(e,a,n){u.pause({endpointId:e,queueId:a,reason:n}).then(function(e){t.updateGraphicsOpp()},function(e){console.error(e)})},t.queueUnpauseOpp=function(e,a,n){u.unpause({endpointId:e,queueId:a}).then(function(e){t.updateGraphicsOpp(),n&&n()},function(e){console.error(e)})},t.$on("loginCompleted",function(a,n){v.log("loginCompleted evt: websocket initialization..."),t.checkParamUrl(),h.init(),h.on("clientUpdated",function(e){console.log('received "clientUpdated" event: previous ver '.concat(e.previousVer," - new ver ").concat(e.newVer)),P(e.newVer)}),h.on("qmAlarm",function(a){t.currentUser.settings.desktop_notifications&&"warning"==a.status&&e.QManagerQueues[a.queue]&&S.notifyAlarms(e.QManagerQueues[a.queue].name+" ("+a.queue+")",o("translate")(a.alarm),function(){window.focus(),t.goTo("/qmanager"),$("#qmanDashboardTab").click(),S.hideAlert(),t.$apply()})}),h.on("queueMemberUpdate",function(e){t.opPanel&&t.opPanel.data&&t.opPanel.data.inQueue&&e.queue===t.opPanel.data.inQueue&&(t.opPanel.data[t.opPanel.data.inQueue].members[e.member]=e),t.allQueues&&t.allQueues[e.queue]&&t.allQueues[e.queue].members[e.member]&&(t.allQueues[e.queue].members[e.member]=e)}),h.on("queueUpdate",function(e){try{t.opPanel&&t.opPanel.data&&t.opPanel.data.inQueue&&e.queue===t.opPanel.data.inQueue?(t.opPanel.data[e.queue]=e,t.updateOpInCalls()):t.opPanel&&t.opPanel.data&&t.opPanel.data.inQueue&&e.queue===t.opPanel.data.waitingQueue&&(t.opPanel.data[e.queue]=e,t.updateOpWaitingCalls()),t.allQueues&&t.allQueues[e.queue]&&(t.allQueues[e.queue]=e),t.$$phase||t.$apply()}catch(e){console.error(e)}}),h.on("message",function(e){try{if("screenSharingStart"===e.message){t.screenSharing=e;var a,n,i,s=t.currentCall.conversation.counterpartNum;for(i in t.allUsers)for(n=0;n<t.allUsers[i].endpoints.extension.length;n++)if(t.allUsers[i].endpoints.extension[n].id===s){a=i;break}$("#screenshareInDialog").modal({closable:!1,allowMultiple:!1,onDeny:function(){h.emit("message",{message:"screenSharingStop",destUser:a,closedBy:t.currentUser.username})},onApprove:function(){l.acceptScreenSharing(t.screenSharing.roomId,t.screenSharing.destUser,function(){h.emit("message",{message:"screenSharingAccepted",destUser:a})})}}),$("#remoteScreenSharing").modal({closable:!1,centered:!0,detachable:!0,onShow:function(){$("#screencaptureIn").append('<i id="waitingvideoIn" class="massive grey spinner loading icon"></i>'),$("#remoteScreenSharingCloseBtn").click(function(){h.emit("message",{message:"screenSharingStop",destUser:a,closedBy:t.currentUser.username})})},onHide:function(){$("#remoteScreenSharingCloseBtn").off("unbind").off("click"),$("#screencaptureIn").empty()}}).modal("attach events","#screenshareInDialog .button.positive"),t.$apply(),$("#screenshareInDialog").modal("show")}else"screenSharingStop"===e.message?(t.screenSharing.closedBy=e.closedBy,t.stopScreenSharing(),t.$apply(),$("#screenSharingClosedDialog").modal("setting","closable",!1).modal("show")):"screenSharingAccepted"===e.message&&($("#screenShareInfoUser").text(o("translate")("Connected_2")),$("#screenvideo").removeClass("border-green").addClass("border-red"))}catch(e){console.error(e)}}),$(document).on("screenShareHideCallbox",function(){t.currentCall.screenSharingShow=!1,t.screenSharing.active=!1}),t.startScreenSharing=function(){try{t.currentCall.screenSharingShow=!0,$("#screencapture").empty().append('<i id="screenshare-callbox-loader" class="huge grey spinner loading icon"></i>');var e,a,n,i=t.currentCall.conversation.counterpartNum;for(n in t.allUsers)for(a=0;a<t.allUsers[n].endpoints.extension.length;a++)if(t.allUsers[n].endpoints.extension[a].id===i){e=n;break}t.screenSharing.destUser=e,l.startScreenSharing(t.currentUser.username,function(a,n){try{if(a)return void console.error(a);h.emit("message",{message:"screenSharingStart",destUser:e,roomId:n,callUser:t.currentUser.username}),t.screenSharing.destUser=e,t.screenSharing.roomId=n,t.screenSharing.active=!0,t.currentCall.screenSharingShow=!0}catch(e){console.error(e)}})}catch(e){console.error(e)}},t.stopScreenSharing=function(e){try{if(l.stopScreenSharing(),!0===e){var a,n,i,s=t.currentCall.conversation.counterpartNum;for(i in t.allUsers)for(n=0;n<t.allUsers[i].endpoints.extension.length;n++)if(t.allUsers[i].endpoints.extension[n].id===s){a=i;break}h.emit("message",{message:"screenSharingStop",destUser:a,closedBy:t.currentUser.username})}}catch(e){console.error(e)}},h.on("connect",function(e){v.log("Socket on: "+customConfig.BASE_WSS_URL+" is connected !"),t.login.socketError=!1;var a=f.get("credentials")||void 0;a.token?h.emit("login",{accessKeyId:a.username,token:a.token,uaType:t.view.isMobilePlatform?"mobile":"desktop"}):p.login(a.username,atob(a.password)).then(function(e){var n=f.get("lastRoute")||"/";s.path(n),h.emit("login",{accessKeyId:a.username,token:e,uaType:t.view.isMobilePlatform?"mobile":"desktop"})},function(e){console.error(e),"invalid credentials"===e&&(t.onLoginFailed=!0,t.login.isLogged=!1),t.onLoginStarted=!1})}),h.on("takeOver",function(e){t.login.takeOvering=!0,l.isRegistered()?l.destroy():(t.logout(),h.emit("takeOverAck"))}),h.on("disconnect",function(e){v.log("Socket on: "+customConfig.BASE_WSS_URL+" is disconnected ! - reason: ",e),t.login.socketError=!0,t.$apply(),f.removeProp("credentials","token"),c.unsetAuthHeader(),t.$broadcast("wsDisconnected")}),h.on("authe_ok",function(e){t.onLoginStarted=!1,t.onLoginFailed=!1,t.checkCtiUpdated(),t.getUserInfo(),t.getPrefix(),t.recognizeNumber(),t.getAvailablePresence(),t.$broadcast("socketAutheOK"),t.$apply()}),h.on("serverReloaded",function(e){t.reloading=!0,t.getUserInfo(!0),t.getAvailablePresence(),t.setFirstDevice(),t.checkDisconnectWebrtc(),t.$broadcast("serverReloaded")}),h.on("401",function(e){v.log("Socket on: "+customConfig.BASE_WSS_URL+" is unauthorized!"),f.remove("credentials"),c.unsetAuthHeader(),s.path("/"),t.login.isLogged=!1,t.$apply()}),h.on("userPresenceUpdate",function(e){e.presence&&t.currentUser.username===e.presence.username&&(t.currentUser.presence=e.presence.status),t.$apply()}),h.on("newVoiceMessageCounter",function(e){e.voicemail==t.currentUser.endpoints.mainextension[0].id&&(t.notifications.voicemail.count=parseInt(e.counter),t.$apply())}),h.on("userProfileAvatarUpdate",function(e){t.allAvatars[e.username]=e.avatar,t.$apply()}),h.on("callWebrtc",function(e){t.call(e)}),h.on("answerWebrtc",function(e){t.answer(e)}),h.on("meetmeConfUpdate",function(e){t.updateConference(e)}),h.on("meetmeConfEnd",function(e){t.initConference()}),h.on("extenRinging",function(e){e.callerHasConf&&!t.currentCall.isOwner&&(t.currentConference.callerHasConf=!0)}),h.on("extenHangup",function(e){t.checkConferenceStatus({joined:!1,addingMember:!0===t.currentConference.callInConference}),t.currentConference.isOwner||t.checkConferenceStatus({exists:!1}),t.currentCall.accepted=!1,"physical"===t.currentUser.default_device.type&&t.currentConference.exists&&t.currentConference.callInConference&&(t.makeCall(t.currentConference.numberToCall),t.currentConference.callInConference=!1),t.getLastCalls()}),h.on("extenUpdate",function(e){for(var a in t.updateSpeedExtenStatus(e),t.allExtensions[e.exten]=e,t.checkDeviceStatus(),t.currentUser.endpoints.extension)if(e.exten===t.currentUser.endpoints.extension[a].id){t.currentUser.endpoints.extension[a].description=e.sipuseragent;break}if(e.username==t.currentUser.username){var n=e.conversations[Object.keys(e.conversations)[0]],i=0;for(var s in t.currentUser.profile.macro_permissions.customer_card.permissions)!0===t.currentUser.profile.macro_permissions.customer_card.permissions[s].value&&(i+=1);if(n)switch(e.status){case"ringing":if(e.exten===t.currentUser.default_device.id||t.view.isMobilePlatform){var r;t.currentCall.accepted=!1,t.currentCall.incoming=!0,t.disableCallAnswer=!1,t.currentCall.outcoming=!1,t.view.isMobilePlatform&&"mobile"!==t.extractDeviceType(e.exten).type&&(t.currentCall.incoming=!1),t.currentCall.displayname=t.getDispName(n),t.currentCall.conversation=n,t.view.isMobilePlatform||!0!==t.currentUser.settings.call_ringtone&&void 0!==t.currentUser.settings.call_ringtone||(t.currentCall.ringingAudio.play(),t.currentCall.ringingAudio.loop=!0),t.currentUser.profile.macro_permissions.customer_card.value&&i>0&&t.currentUser.settings&&"incoming"==t.currentUser.settings.open_ccard&&!t.allExtensions[n.counterpartNum]&&t.goTo("customercard/"+(n.counterpartNum||"")),r=t.currentCall.isSpy?o("translate")("SPY")+(t.currentCall.actionDisplayName?"->":"")+t.currentCall.actionDisplayName:t.currentCall.isIntrude?o("translate")("INTRUDE")+(t.currentCall.actionDisplayName?"->":"")+t.currentCall.actionDisplayName:t.currentCall.displayname,t.currentUser.settings.desktop_notifications&&S.notify(r,n?n.counterpartNum:"",t.allAvatars[t.allExtensions[n.counterpartNum]&&t.allExtensions[n.counterpartNum].username],function(){window.focus(),S.hide()});var l=f.get("paramUrlOnlyQueues")||!1;!0===l&&"onRinging"===t.currentUser.settings.open_param_url&&!0===n.throughQueue?t.openParamUrl(n.counterpartNum,n.counterpartName,n.owner,n.uniqueId):!1!==l||"onRinging"!==t.currentUser.settings.open_param_url||!0!==n.throughTrunk&&!0!==n.throughQueue||t.openParamUrl(n.counterpartNum,n.counterpartName,n.owner,n.uniqueId)}break;case"busy":t.currentCall.outcoming="out"==n.direction,t.currentCall.incoming="in"==n.direction,t.currentCall.startTime=n.startTime,t.currentCall.device=t.extractDeviceType(e.exten),n&&n.direction&&"out"==n.direction&&!n.connected?(t.currentCall.isPBX=!1,t.currentCall.isVisible=!0,t.currentCall.conversation=n,"webrtc"===t.currentUser.default_device.type&&!1===t.currentUser.isSpy&&(t.currentCall.callingAudio.play(),t.currentCall.callingAudio.loop=!0)):n&&n.connected?(t.currentCall.incoming&&t.currentUser.profile.macro_permissions.customer_card.value&&i>0&&t.currentUser.settings&&"connected"==t.currentUser.settings.open_ccard&&!t.allExtensions[n.counterpartNum]&&t.goTo("customercard/"+(n.counterpartNum||"")),t.currentCall.accepted=!0,t.currentCall.isPBX=!1,t.currentCall.available=!1,t.currentCall.inTransfer=!1,t.currentCall.inSwitching=!1,t.currentCall.displayname=t.getDispName(n),t.currentCall.conversation=n,S.hide(),t.currentCall.ringingAudio.pause(),t.currentCall.callingAudio.pause(),t.view.isMobilePlatform&&"mobile"==t.currentCall.device.type||!t.view.isMobilePlatform&&"webrtc"==t.currentCall.device.type||"physical"==t.currentCall.device.type&&!t.view.isMobilePlatform?(t.currentCall.isVisible=!0,t.currentCall.callingAudio.pause()):t.currentCall.isVisible=!1):n&&!n.connected&&(t.currentCall.conversation=n);var c=f.get("paramUrlOnlyQueues")||!1;!0===c&&"onConnected"===t.currentUser.settings.open_param_url&&n&&n.connected&&"in"==n.direction&&!0===n.throughQueue?t.openParamUrl(n.counterpartNum,n.counterpartName,n.owner,n.uniqueId):!1===c&&"onConnected"===t.currentUser.settings.open_param_url&&n&&n.connected&&"in"==n.direction&&(!0===n.throughTrunk||!0===n.throughQueue)&&t.openParamUrl(n.counterpartNum,n.counterpartName,n.owner,n.uniqueId);break;case"online":"On spy"!==t.currentCall.displayname&&"On intrude"!==t.currentCall.displayname&&(t.currentCall.displayname=n&&n.counterpartName||n&&n.counterpartNum||"PBX"),t.currentCall.isPBX=!0,n&&n.owner&&"out"===n.direction&&!1===n.connected&&!1===n.inConference&&!1===n.throughQueue&&(t.currentCall.outcoming=!0,t.currentCall.device=t.extractDeviceType(n.owner),t.currentCall.conversation=n);break;case"onhold":t.currentCall.conversation=n,t.currentCall.displayname=t.getDispName(n)}else"online"==e.status&&t.isTotallyFree()?(t.view.initRecordCall&&"none"===$("#offhourRM").css("display")&&$("#offhourRM").modal("show"),t.currentCall.ringingAudio.pause(),t.currentCall.callingAudio.pause(),t.currentCall=t.defaultCall(),S.hide(),t.view.initRecordCall&&t.view.onRecording&&t.currentUser.default_device.id==e.exten&&(t.view.initRecordCall=!1,t.view.onRecording=!1,$(".ui.radio.checkbox").checkbox(),$("#msgDescriptionRM-field").removeClass("error"),$("#offhourRM").modal({closable:!1}).modal("show"))):"busy"==e.status&&(t.view.initRecordCall&&(t.view.onRecording=!0),t.currentCall.ringingAudio.pause(),t.currentCall.callingAudio.pause(),t.currentCall.isIntrude||t.currentCall.isSpy||t.currentCall.incoming||(t.currentCall.isPBX=!0,t.currentCall.displayname="PBX"));t.recognizeNumber(),t.$apply()}})}),t.makeCall=function(e){if(e=e.replace(/^[+]/,"00").replace(/[^\d*#]/g,""),t.currentUser.default_device)if(t.view.noCallsAvailable=!1,t.currentCall.accepted&&!1===t.currentConference.joining)t.transfer(e,!1);else if("physical"==t.currentUser.default_device.type){var a=t.currentUser.default_device.id;b.call({number:e,endpointId:a,endpointType:"extension"}).then(function(e){},function(e){console.error(e)})}else{e=-1==Object.keys(t.allExtensions).indexOf(e)?t.callPrefix+""+e:e;var n=t.getEchoCancellationOpt();l.call("sip:"+e+"@"+customConfig.BASE_HOST_URL,n)}else t.view.noCallsAvailable=!0},t.getEchoCancellationOpt=function(){return!(t.currentUser&&t.currentUser.settings&&t.currentUser.settings.audio_echo_cancellation)||!t.currentUser.settings.audio_echo_cancellation},t.call=function(e,a){t.currentConference.exists&&t.currentCall.conversation&&t.currentCall.conversation.inConference?(t.currentConference.numberToCall=e,$("#call-inconference").modal("show")):(!t.currentCall.incoming&&!t.currentCall.outcoming||t.currentCall.accepted)&&(t.checkConferenceStatus({addingMember:!0}),t.makeCall(e)),t.allExtensions&&t.currentUser.default_device&&t.currentUser.default_device.id&&t.allExtensions[t.currentUser.default_device.id].status&&"busy"===t.allExtensions[t.currentUser.default_device.id].status&&t.showTransfer()},t.answer=function(){if(t.disableCallAnswer=!0,"physical"==t.currentUser.default_device.type){var e=t.currentUser.default_device.id;b.answer({endpointId:e,endpointType:"extension"}).then(function(e){},function(e){console.error(e)})}else{var a=t.getEchoCancellationOpt();l.answer(t.currentCall.jsep,a)}t.view.initRecordCall&&(t.view.wkaroundRecOffhour=!0)},t.hangup=function(){if(!0===t.screenSharing.active&&t.stopScreenSharing(!0),t.currentCall.device&&"physical"==t.currentCall.device.type){var e=t.currentCall.device.exten;b.hangup({convid:t.currentCall.conversation.id,endpointId:e,endpointType:"extension"}).then(function(e){t.checkConferenceStatus({userIsOnline:!1}),t.view.initRecordCall&&$("#offhourRM").modal("show")},function(e){console.error(e)})}else l.hangup();t.view.wkaroundRecOffhour=!1},t.decline=function(){t.currentUser.endpoints.extension.forEach(function(e,a){Object.keys(t.allExtensions[e.id].conversations).length>0&&b.hangup({convid:Object.keys(t.allExtensions[e.id].conversations)[0],endpointId:e.id}).then(function(e){},function(e){console.error(e)})}),t.view.initRecordCall&&"webrtc"===t.currentUser.default_device.type&&l.decline()},t.isEmpty=function(e){for(var t in e)return!1;return!0},t.objSize=function(e){var t,a=0;for(t in e)e.hasOwnProperty(t)&&a++;return a},t.updateConference=function(e){t.checkConferenceStatus({isOwner:e.id===t.currentUser.default_device.id}),e.users[t.currentUser.default_device.id]||t.checkConferenceStatus({leaving:!1,joining:!1,joined:!1}),clearTimeout(t.timeoutJoinLeaveDisabled),t.timeoutJoinLeaveDisabled=setTimeout(function(){t.currentConference.joinLeaveDisabled=!1},2e3),e.users[t.currentUser.default_device.id]&&(t.checkConferenceStatus({exists:!0,joined:!0,leaving:!1,joining:!1,addingMember:!1}),clearTimeout(t.timeoutJoinLeaveDisabled),t.timeoutJoinLeaveDisabled=setTimeout(function(){t.currentConference.joinLeaveDisabled=!1},2e3)),t.currentConference.data=e,t.currentCall.device&&t.currentConference.data&&t.currentConference.data.users[t.currentCall.device.exten]&&t.currentConference.data.users[t.currentCall.device.exten].muted?t.checkConferenceStatus({isMutedSelf:!0}):t.checkConferenceStatus({isMutedSelf:!1}),t.currentConference.data.users[t.currentConference.data.id]?t.checkConferenceStatus({userIsOnline:!0}):t.checkConferenceStatus({userIsOnline:!1}),t.checkConferenceStatus({onStarting:!1}),setTimeout(function(){t.$apply()},100)},t.getConfInfo=function(){t.currentUser.default_device&&t.currentUser.default_device.id&&C.confInfo(t.currentUser.default_device.id).then(function(e){e.data.id&&(t.checkConferenceStatus({exists:!0}),t.updateConference(e.data))},function(e){console.error(e)})},t.checkConferenceStatus=function(e){for(var a in e)t.currentConference[a]=e[a]},t.addToConference=function(){var e=t.currentUser.default_device.id;t.checkConferenceStatus({onStarting:!0}),C.startConf({convid:t.currentCall.conversation.id,ownerEndpointId:e,addEndpointId:t.currentCall.conversation.counterpartNum}).then(function(e){if(!t.currentConference.exists){var a=Date.now();f.set("startConfTime",a),t.currentConference.startTime=a}t.checkConferenceStatus({exists:!0,isOwner:!0})},function(e){console.error(e)})},t.closeConfirmConf=function(){$("#del-conference").modal("show")},t.singInConference=function(){t.currentConference.joinLeaveDisabled=!0,!1===t.currentConference.joining&&(t.checkConferenceStatus({joining:!0}),C.joinMyConf({endpointId:t.currentUser.default_device.id}).then(function(e){},function(e){console.error(e)}))},t.singOutConference=function(){t.checkConferenceStatus({leaving:!0}),t.currentConference.joinLeaveDisabled=!0,t.hangup()},t.initConference=function(e){t.currentConference={exists:!1,isOwner:!1,joined:!1,addingMember:!1,joining:!1,isMinized:!1,isClose:!1,startTime:f.get("startConfTime"),data:{},userIsOnline:!1,isMutedSelf:!1,isMute:!1,onStarting:!1,userToCall:""}},t.initConference(),t.doMuteUserConf=function(e,a,n,i){C.muteUserConf({confId:e,userId:a}).then(function(e){"multiple"===n&&(t.checkConferenceStatus({isMute:!0}),t.currentConference.data.users[i].muted=!0)},function(e){console.error(e)})},t.doUnmuteUserConf=function(e,a,n,i){C.unmuteUserConf({confId:e,userId:a}).then(function(e){"multiple"==n&&(t.checkConferenceStatus({isMute:!1}),t.currentConference.data.users[i].muted=!1)},function(e){console.error(e)})},t.toggleMuteConf=function(e,a){if(!1!==t.currentConference.joined)for(var n in t.currentConference.data.users)1==e?t.doMuteUserConf(t.currentConference.data.id,t.currentConference.data.users[n].id,a,n):t.doUnmuteUserConf(t.currentConference.data.id,t.currentConference.data.users[n].id,a,n)},t.muteUser=function(e,a,n,i,s){C.muteUserConf({confId:e,userId:a,direction:i}).then(function(e){t.currentConference.data.users[n].muted=!0,"all"===i&&(t.currentConference.data.users[n].mutedListenSpeak=!0),s&&t.checkConferenceStatus({isMutedSelf:!0})},function(e){console.error(e)})},t.unmuteUser=function(e,a,n,i,s){C.unmuteUserConf({confId:e,userId:a,onlyListen:i}).then(function(e){!0!==i&&(t.currentConference.data.users[n].muted=!1),t.currentConference.data.users[n].mutedListenSpeak=!1,s&&t.checkConferenceStatus({isMutedSelf:!1})},function(e){console.error(e)})},t.toggleMuteUserConf=function(e,a,n,i,s){if(n)n=n;else n=e;!0===a?t.muteUser(t.currentConference.data.id,e,n,i):t.unmuteUser(t.currentConference.data.id,e,n,s)},t.toggleMuteSelfConf=function(e){l.toggleMute(),t.currentCall.isMute=!t.currentCall.isMute},t.removeUserConf=function(e){C.hangupUserConf({confId:t.currentConference.data.id,extenId:e}).then(function(e){},function(e){console.error(e)})},t.hideConfModal=function(){$("#del-conference").modal("hide")},t.endConference=function(){C.endConf({confId:t.currentConference.data.id}).then(function(e){t.initConference()},function(e){console.error(e)})},t.addConfUser=function(){t.currentConference.isNewUser=!t.currentConference.isNewUser;var e=[];for(var a in t.allUsers)e.push({id:t.allUsers[a].endpoints.mainextension[0].id,title:t.allUsers[a].name+" - "+t.allUsers[a].endpoints.mainextension[0].id});t.dstList=e,setTimeout(function(){$(".item-conf").popup(),$("#confNewUserInput").children().first().children().first().focus(),$("#confNewUserInput").children().first().children().first().val(""),$("#confNewUserInput").search({type:"category",maxResults:20,cache:!1,apiSettings:{url:customConfig.BASE_API_URL+"/phonebook/search/{query}",beforeXHR:function(e){var t=f.get("credentials");return e.setRequestHeader("Authorization",t.username+":"+t.token),e},onResponse:function(e){var a={results:{}};if(!e||void 0===!e.count)return a;e.rows.length>10&&e.rows.splice(10,e.rows.length);var n=0;for(var i in t.allUsers)if(-1!==t.allUsers[i].name.toLowerCase().indexOf(t.currentConference.userToCallDislpay.toLowerCase())&&n<10){var s=void 0;s=t.allAvatars[i]?'<img src="'+t.allAvatars[i]+'">':'<img src="img/steve.6204f1d6.jpg">',s+='<span title="'+o("translate")("User")+": "+t.allUsers[i].name+'" class="sp-user-name font-italic ml-7">'+t.allUsers[i].name+"</span>",a.results[s]={name:s,results:[{title:'<i class="call black icon"></i>'+t.allUsers[i].endpoints.mainextension[0].id,description:'<span class="hide">'+t.allUsers[i].name+"</span>"}]},n+=1}return $.each(e.rows,function(e,t){if(!t.name&&!t.company)return!0;var n;(t.extension||t.cellphone||t.workphone||t.homephone)&&(t.name&&t.company&&""!==t.name.trim()&&""!==t.company.trim()?n='<i class="large user middle aligned grey icon"></i>                    <span title="'+o("translate")("From phonebook")+": "+t.name+'" class="sp-user-name">'+t.name+'</span>                    <div class="sp-color-gray sp-user-descr" title="'+t.company+'">'+t.company+"</div>":!t.name||""===t.name.trim()||t.company&&""!==t.company.trim()?!t.company||""===t.company.trim()||t.name&&""!==t.name.trim()||(n='<i class="large building middle aligned grey icon"></i>                    <span title="'+o("translate")("From phonebook")+": "+t.company+'" class="sp-user-name">'+t.company+"</span>"):n='<i class="large user middle aligned grey icon"></i>                    <span title="'+o("translate")("From phonebook")+": "+t.name+'" class="sp-user-name">'+t.name+"</span>",a.results[n]={name:n,results:[]},t.extension&&a.results[n].results.push({title:'<i class="call black icon"></i>'+t.extension,description:'<span class="hide">'+(t.name?t.name:t.company)+"</span>"+o("translate")("Extension")}),t.cellphone&&a.results[n].results.push({title:'<i class="mobile black icon"></i>'+t.cellphone,description:'<span class="hide">'+(t.name?t.name:t.company)+"</span>"+o("translate")("Cellphone")}),t.workphone&&a.results[n].results.push({title:'<i class="call black icon"></i>'+t.workphone,description:'<span class="hide">'+(t.name?t.name:t.company)+"</span>"+o("translate")("Work phone")}),t.homephone&&a.results[n].results.push({title:'<i class="call black icon"></i>'+t.homephone,description:'<span class="hide">'+(t.name?t.name:t.company)+"</span>"+o("translate")("Home phone")}))}),a}},minCharacters:4,showNoResults:!0,onSelect:function(e,a){var n=e.description.split("</span>")[0].split('hide">')[1],i=e.title.split("</i>")[1];t.currentConference.userToCallDislpay=n,t.currentConference.userToCall=i.replace(/\s/g,""),t.currentConference.destToCallTitle=n+" ("+i+")",setTimeout(function(){t.$apply()},0)}})},100)},t.conferenceDestInputChanged=function(){isNaN(t.currentConference.userToCallDislpay.replace(/\s/g,""))?t.currentConference.userToCall=void 0:t.currentConference.userToCall=t.currentConference.userToCallDislpay.replace(/\s/g,""),t.currentConference.destToCallTitle=void 0},t.callContinue=function(e){t.currentConference.callInConference=!0,t.currentCall.accepted=!1,t.hangup()},t.showTransfer=function(){t.currentCall.destToTransfer=void 0,t.currentCall.transferShow=!t.currentCall.transferShow,t.currentCall.keypadShow=!1;var e=[];for(var a in t.allUsers)e.push({id:t.allUsers[a].endpoints.mainextension[0].id,title:t.allUsers[a].name+" - "+t.allUsers[a].endpoints.mainextension[0].id});t.dstList=e,setTimeout(function(){$(".item").popup(),$("#transferInput").children().first().children().first().focus(),$("#transferInput").children().first().children().first().val(""),$("#transferInput").search({type:"category",maxResults:20,cache:!1,apiSettings:{url:customConfig.BASE_API_URL+"/phonebook/search/{query}",beforeXHR:function(e){var t=f.get("credentials");return e.setRequestHeader("Authorization",t.username+":"+t.token),e},onResponse:function(e){var a={results:{}};if(!e||void 0===!e.count)return a;e.rows.length>10&&e.rows.splice(10,e.rows.length);var n=0;for(var i in t.allUsers)if(-1!==t.allUsers[i].name.toLowerCase().indexOf(t.currentCall.destToTransferName.toLowerCase())&&n<10){var s=void 0;s=t.allAvatars[i]?'<img src="'+t.allAvatars[i]+'">':'<img src="img/steve.6204f1d6.jpg">',s+='<span title="'+o("translate")("User")+": "+t.allUsers[i].name+'" class="sp-user-name font-italic ml-7">'+t.allUsers[i].name+"</span>",a.results[s]={name:s,results:[{title:'<i class="call black icon"></i>'+t.allUsers[i].endpoints.mainextension[0].id,description:'<span class="hide">'+t.allUsers[i].name+"</span>"}]},n+=1}return $.each(e.rows,function(e,t){if(!t.name&&!t.company)return!0;var n;(t.extension||t.cellphone||t.workphone||t.homephone)&&(t.name&&t.company&&""!==t.name.trim()&&""!==t.company.trim()?n='<i class="large user middle aligned grey icon"></i>                      <span title="'+o("translate")("From phonebook")+": "+t.name+'" class="sp-user-name">'+t.name+'</span>                      <div class="sp-color-gray sp-user-descr" title="'+t.company+'">'+t.company+"</div>":!t.name||""===t.name.trim()||t.company&&""!==t.company.trim()?!t.company||""===t.company.trim()||t.name&&""!==t.name.trim()||(n='<i class="large building middle aligned grey icon"></i>                      <span title="'+o("translate")("From phonebook")+": "+t.company+'" class="sp-user-name">'+t.company+"</span>"):n='<i class="large user middle aligned grey icon"></i>                      <span title="'+o("translate")("From phonebook")+": "+t.name+'" class="sp-user-name">'+t.name+"</span>",a.results[n]={name:n,results:[]},t.extension&&a.results[n].results.push({title:'<i class="call black icon"></i>'+t.extension,description:'<span class="hide">'+(t.name?t.name:t.company)+"</span>"+o("translate")("Extension")}),t.cellphone&&a.results[n].results.push({title:'<i class="mobile black icon"></i>'+t.cellphone,description:'<span class="hide">'+(t.name?t.name:t.company)+"</span>"+o("translate")("Cellphone")}),t.workphone&&a.results[n].results.push({title:'<i class="call black icon"></i>'+t.workphone,description:'<span class="hide">'+(t.name?t.name:t.company)+"</span>"+o("translate")("Work phone")}),t.homephone&&a.results[n].results.push({title:'<i class="call black icon"></i>'+t.homephone,description:'<span class="hide">'+(t.name?t.name:t.company)+"</span>"+o("translate")("Home phone")}))}),a}},minCharacters:4,showNoResults:!0,onSelect:function(e,a){var n=e.description.split("</span>")[0].split('hide">')[1],i=e.title.split("</i>")[1];t.currentCall.destToTransferName=n,t.currentCall.destToTransfer=i,t.currentCall.destToTransferTitle=n+" ("+i+")"}})},100)},t.endpointsTransferShow=function(){$("#switch-to-dropdown").dropdown({direction:"upward"}).dropdown("clear").dropdown("show"),t.currentCall.endpointsTransferShow=!t.currentCall.endpointsTransferShow,t.currentCall.keypadShow=!1},t.atxferSwap=function(e){if(!t.currentCall.attendedSwapping){t.currentCall.attendedSwappingColor=!t.currentCall.attendedSwappingColor,t.currentCall.attendedSwapping=!0;var a=["*","4"],n=new Audio("sounds/calling.8fc1d1ea.mp3");n.loop=!0,n.play(),t.DTMF(a[0],!1),setTimeout(function(){t.DTMF(a[1],!1,function(e){e||(t.currentCall.attendedSwapping=!1),n.pause()})},500)}},t.atxferConference=function(e){if(!t.currentCall.attendedConference){t.currentCall.attendedConference=!0;var a=["*","3"],n=new Audio("sounds/calling.8fc1d1ea.mp3");n.loop=!0,n.play(),t.DTMF(a[0],!1),setTimeout(function(){t.DTMF(a[1],!1,function(e){e||(t.currentCall.attendedConference=!1),n.pause()})},500)}},t.atxferAbort=function(e){if(!t.currentCall.attendedAborting){t.currentCall.attendedAborting=!0;var a=["*","1"],n=new Audio("sounds/calling.8fc1d1ea.mp3");n.loop=!0,n.play(),t.DTMF(a[0],!1),setTimeout(function(){t.DTMF(a[1],!1,function(e){e||(t.currentCall.attendedAborting=!1),n.pause(),t.currentCall.attendedTransfering=!1,t.currentCall.transferShow=!1})},500)}},t.updateDestToTransfer=function(){t.currentCall.destToTransfer=t.currentCall.destToTransferName},t.transferDestInputChanged=function(){isNaN(t.currentCall.destToTransferName.replace(/\s/g,""))?t.currentCall.destToTransfer=void 0:t.currentCall.destToTransfer=t.currentCall.destToTransferName,t.currentCall.destToTransferTitle=void 0},t.transfer=function(e,a,n){if(void 0!==e&&""!==e)if(e=e.replace(/\s/g,""),!0!==isNaN(e)){var i=t.currentCall.device.exten;t.currentCall.inTransfer=!0,t.currentCall.inSwitching=!0,t.currentCall.isPause&&t.togglePause(),"blind"===a?b.blindTransfer({to:e,convid:t.currentCall.conversation.id,endpointId:i}).then(function(e){t.currentCall.transferShow=!1},function(e){console.error(e)}):(t.currentCall.attendedTransfering=!0,b.attendedTransfer({to:e,convid:t.currentCall.conversation.id,endpointId:i}).then(function(e){},function(e){console.error(e)}))}else console.warn("wrong dest number for transfer: "+e);else console.warn("wrong dest number for transfer: "+e)},t.toggleLockVideo=function(){t.currentCall.isVideo?(t.currentCall.isVideo=!1,l.muteVideo(),t.currentCall.isVideoEnabled=!0):(t.currentCall.isVideo=!0,l.unMuteVideo(),t.currentCall.isVideoEnabled=!1)},t.toggleVideo=function(){l.toggleVideo(),t.currentCall.isVideoEnabled=!t.currentCall.isVideoEnabled},t.expandVideo=function(){t.currentCall.isVideoMax?($("#localStream").css("width",""),$("#localStream").css("height",""),$(".remoteStream").css("width",""),$(".remoteStream").css("height","")):($(".remoteStream").css("width",960*screen.width/1440),$(".remoteStream").css("height",720*screen.height/900),$("#localStream").css("width",300*screen.width/1440),$("#localStream").css("height",225*screen.height/900)),t.currentCall.isVideoMax=!t.currentCall.isVideoMax},t.toggleMute=function(){if(t.currentCall.device&&"physical"==t.currentCall.device.type){var e=t.currentCall.device.exten;b.toggleMute(t.currentCall.isMute,{convid:t.currentCall.conversation.id,endpointId:e}).then(function(e){t.currentCall.isMute=!t.currentCall.isMute},function(e){console.error(e)})}else l.toggleMute(),t.currentCall.isMute=!t.currentCall.isMute},t.togglePause=function(){if(t.currentCall.device&&"physical"==t.currentCall.device.type){var e=t.currentCall.device.exten;b.togglePause({endpointId:e}).then(function(e){t.currentCall.isPause=!t.currentCall.isPause},function(e){console.error(e)})}else l.togglePause(t.currentCall.isPause),l.pauseRemoteStream(t.currentCall.isPause),t.currentCall.isPause=!t.currentCall.isPause},t.toggleRecord=function(){var e=t.currentUser.default_device.id;b.toggleRecord(t.currentCall.isRecord,t.currentCall.recorded,{convid:t.currentCall.conversation.id,endpointId:e}).then(function(e){t.currentCall.isRecord=!t.currentCall.isRecord,t.currentCall.recorded=!0},function(e){console.error(e),t.currentCall.isRecord=!1,t.currentCall.recorded=!1})},t.park=function(){var e=t.currentUser.default_device.id;b.park({applicantId:e,convid:t.currentCall.conversation.id,endpointId:e}).then(function(e){},function(e){console.error(e)})},t.DTMF=function(e,a,n){if(t.currentCall.device&&"physical"==t.currentCall.device.type){var i=t.currentCall.device.exten;b.sendDTMF({tone:e,convid:t.currentCall.conversation.id,endpointId:i}).then(function(e){n&&n()},function(e){console.error(e),n&&n(e)})}else l.sendDTMF(e,a),n&&n()},t.janus.mobileCheckJanusInterval=setInterval(function(){!l.isRegistered()&&t.currentUser&&t.currentUser.default_device&&t.currentUser.default_device.id&&t.allExtensions&&t.currentUser.default_device&&t.allExtensions[t.currentUser.default_device.id]&&"offline"===t.allExtensions[t.currentUser.default_device.id].status&&"mobile"===t.currentUser.default_device.type&&t.initializeJanusService()},5e3),t.janusRegister=function(e){try{t.qrCondition()||(console.log("janus start register..."),l.register({username:"sip:"+t.currentUser.default_device.username+"@"+customConfig.BASE_HOST_URL,display_name:t.currentUser.name,secret:t.currentUser.default_device.secret,proxy:"sip:"+customConfig.BASE_HOST_URL+":5060",sips:!1,refresh:e||!1})),t.view.noCallsAvailable=!1}catch(e){console.error(e),t.janus.isConfigured=!1}},t.janusUnregister=function(e){try{l.unregister()}catch(e){console.error(e),t.janus.isConfigured=!1}},t.initializeJanusService=function(){void 0!==$("#localStream").get(0)&&void 0!==$("#remoteStreamAudio").get(0)&&void 0!==$("#remoteStreamVideo").get(0)&&(!0!==l.isJanusInitialized()?l.init(function(e){try{if(e)return console.error("error initializing janus"),void console.error(e);!0!==l.isJanusSipPluginInitialized()?(console.log("initializing janus SIP plugin..."),l.initSipPlugin($("#localStream").get(0),$("#remoteStreamAudio").get(0),$("#remoteStreamVideo").get(0),t.currentUser.username).then(function(e){console.log("janus SIP plugin initialized"),t.janus.isConfigured=!0,t.janusRegister(),t.startJanusCheck()},function(e){console.error("error initializing janus SIP plugin"),t.janus.isConfigured=!1})):console.warn("janus SIP plugin already initialized: skip it")}catch(e){console.error(e)}}):console.warn("janus already initialized: skip it"))},l.onmessage("destroyed",function(){t.login.takeOvering&&(h.emit("takeOverAck"),t.logout())}),l.onmessage("registered",function(){t.janus.isConfigured=!0,t.webphone.isRegistered=!0,t.closeWebphonePopupWarning(),t.resetWebphonePopupWarning(),t.$apply()}),l.onmessage("registration_failed",function(){t.janus.isConfigured=!1,t.webphone.isRegistered=!1,t.showWebphonePopupWarningRegFailed(),clearInterval(t.janus.reconnectInterval),t.janus.reconnectInterval=null,t.janus.reconnecting=!1,t.$apply()}),l.onmessage("gateway_down",function(e){if(t.janus.isConfigured=!1,"webrtc"===t.currentUser.default_device.type&&t.currentUser.default_device&&t.showWebphonePopupWarning(),t.webphone.isRegistered=!1,t.currentCall.callingAudio.pause(),t.currentCall.ringingAudio.pause(),t.currentCall=t.defaultCall(),t.login.isLogged&&!t.login.takeOvering&&"webrtc"===t.currentUser.default_device.type){if(t.janus.reconnecting=!0,!t.janus.reconnectInterval){var a=Math.floor(2e3*Math.random()+3e3);t.janus.reconnectInterval=setInterval(function(){!l.isRegistered()&&t.login.isLogged?(l.destroy(),t.initializeJanusService()):(clearInterval(t.janus.reconnectInterval),t.janus.reconnectInterval=null,t.janus.reconnecting=!1)},a)}}else clearInterval(t.janus.reconnectInterval);t.$apply()}),l.onmessage("calling",function(e,a){v.log("JANUS call calling");var n=new Event("outgoingCall");document.dispatchEvent(n),t.currentConference.isOutgoing=!0,t.currentCall.jsep=a,t.view.isMobilePlatform||(t.currentCall.callingAudio.play(),t.currentCall.callingAudio.loop=!0),t.$apply()}),l.onmessage("incomingcall",function(e,a){v.log("JANUS call incoming");var n=new Event("ringingCall");document.dispatchEvent(n),t.currentCall.jsep=a,t.currentCall.incoming=!0,t.disableCallAnswer=!1,t.currentCall.isSpy&&(t.currentCall.displayname="Spying..."),t.currentCall.isIntrude&&(t.currentCall.displayname="Intruding...");a.sdp.indexOf("m=video ");t.view.isMobilePlatform&&"undefined"!=typeof GLOBAL_MOBILE_TYPE&&"ios"!==GLOBAL_MOBILE_OS?t.currentCall.isVideoAvailable=!0:l.isVideoAvailable(function(e){t.currentCall.isVideoAvailable=e.video&&e.videoCap,t.$apply()})}),l.onmessage("accepted",function(e,a){v.log("JANUS call accepted");var n=new Event("stopRingingCall");document.dispatchEvent(n);var i=new Event("acceptedCall");document.dispatchEvent(i),t.currentCall.ringingAudio.pause(),t.currentCall.callingAudio.pause(),t.currentConference.isOutgoing=!1,t.currentCall.accepted=!0,t.currentCall.available=!1,t.currentCall.inTransfer=!1,t.currentCall.inSwitching=!1,t.currentConference.checkSingIn&&(t.currentConference.checkSingIn=!1),t.currentCall.isSpy&&(t.currentCall.displayname="On spy"),t.currentCall.isIntrude&&(t.currentCall.displayname="On intrude"),t.view.isMobilePlatform&&"undefined"!=typeof GLOBAL_MOBILE_TYPE&&"ios"!==GLOBAL_MOBILE_OS?t.currentCall.isVideoAvailable=!0:l.isVideoAvailable(function(e){t.currentCall.isVideoAvailable=e.video&&e.videoCap,t.$apply()})}),l.onmessage("progress",function(e,a){t.currentConference.isNewUser&&t.currentConference.isCallingFromConf&&(t.currentConference.isNewUser=!1,t.currentConference.isCallingFromConf=!1),v.log("JANUS call progress (early media)"),t.currentCall.ringingAudio.pause(),t.currentCall.callingAudio.pause(),t.currentCall.accepted=!0,t.currentCall.startTime=Date.now(),t.currentCall.available=!1,t.currentCall.inTransfer=!1,t.currentCall.inSwitching=!1,t.$apply()}),l.onmessage("hangup",function(e){v.log("JANUS call hangup"),t.view.initRecordCall&&$("#offhourRM").modal("show"),t.currentConference.exists&&t.currentConference.callInConference&&t.makeCall(t.currentConference.numberToCall),t.currentConference.callInConference=!1,t.checkConferenceStatus({userIsOnline:!1});var a=new Event("stopRingingCall");document.dispatchEvent(a);var n=new Event("hangupCall");document.dispatchEvent(n),t.currentCall.callingAudio.pause(),t.currentCall.ringingAudio.pause(),t.currentCall.accepted=!1,$(".remoteStream").css("width",""),$(".remoteStream").css("height",""),$("#localStream").css("width",""),$("#localStream").css("height",""),t.currentConference.onSingout=!1,t.recognizeNumber(),t.getLastCalls(),t.$apply()}),l.onmessage("error",function(e){console.error("JANUS error",e),t.currentCall.callingAudio.pause(),t.currentCall.ringingAudio.pause(),t.janus.isConfigured=!1,t.webphone.isRegistered=!1,445==e.error_code&&(t.janus.isConfigured=!0),t.$apply()}),t.listenVoicemail=function(e,a){a.inListen?a.inListen=!a.inListen:a.inListen=!0,"inbox"==a.type&&t.notifications.voicemail.count--,w.listenVoicemail(e).then(function(e){a.type="outbox",a.audiosource=e.data},function(e){console.error(e)})},t.downloadVoicemail=function(e){w.downloadVoicemail(e).then(function(e){var t=document.createElement("a");t.download=e.data,t.href=customConfig.BASE_API_URL+"/static/"+e.data,t.click()},function(e){console.error(e)})},t.deleteVoicemail=function(e){w.deleteVoicemail(e).then(function(e){t.$broadcast("deletedVoicemail")},function(e){console.error(e)})},t.selectEndpoint=function(e){t.transfer(e,"blind",!0)},t.$on("deletedVoicemail",function(e,a){t.retrieveNotifications()}),t.$on("settingsUpdated",function(e,a){t.currentUser.settings=a.settings}),t.$on("contactDeleted",function(e,a){t.getSpeedDials()}),t.setLanguage(),$("body").show(),t.startJanusCheck=function(){void 0===t.jCheckId&&(t.jCheckId=setInterval(t.janusCheck,3e6),console.log("Janus check job started (each 3000s)..."))},t.isWebrtcTotallyFree=function(){for(var e in t.currentUser.endpoints.extension)if("webrtc"===t.currentUser.endpoints.extension[e].type&&Object.keys(t.allExtensions[t.currentUser.endpoints.extension[e].id].conversations).length>0)return!1;return!0},t.janusCheck=function(){console.log("Check Janus status");var e=(new Date).getTime(),a=l.getLastActivity();if(!1===isNaN(a)){var n=e-l.getLastActivity();n>27e5&&t.isWebrtcTotallyFree()?(console.log("janus inactive for "+Math.round(n/1e3)+" sec (> deadline: 2700): force reactivation"),t.janusRegister(!0)):n>27e5&&!t.isWebrtcTotallyFree()?console.log("janus is in conversation: no reactivation"):console.log("janus last activity detected "+Math.round(n/1e3)+" sec ago (< deadline: 2700): no reactivation")}},t.detectMediaDevices=function(){t.currentUser.default_device&&t.currentUser.default_device.type&&DetectRTC.load(function(){t.view.alertMediaDevices=!f.get("closeWarning")&&"webrtc"==t.currentUser.default_device.type&&t.currentUser.endpoints.extension.length>0&&(!DetectRTC.hasMicrophone||!DetectRTC.isWebsiteHasMicrophonePermissions||!DetectRTC.isWebRTCSupported||DetectRTC.hasWebcam&&!DetectRTC.isWebsiteHasWebcamPermissions),t.view.mediadevices.webcam=DetectRTC.hasWebcam,t.view.mediadevices.microphone=DetectRTC.hasMicrophone,t.view.mediadevices.speakers=DetectRTC.hasSpeakers,t.view.mediadevices.webcamPermission=DetectRTC.isWebsiteHasWebcamPermissions,t.view.mediadevices.microphonePermission=DetectRTC.isWebsiteHasMicrophonePermissions,t.$apply()})},t.requestPermissions=function(e){var a={};a[e]=!0,navigator.mediaDevices.getUserMedia(a).then(function(e){var a=e.getTracks();for(var n in a)a[n].stop();t.detectMediaDevices()})},t.closeWarning=function(){f.set("closeWarning",!0),t.view.alertMediaDevices=!1},t.extensionSwitchAvailable=function(){for(var e in t.currentUser.endpoints.extension)if(t.allExtensions[t.currentUser.endpoints.extension[e].id]&&"online"===t.allExtensions[t.currentUser.endpoints.extension[e].id].status)return!0;return!1},t.updateOpInCalls=function(){if(t.opPanel.data[t.opPanel.data.inQueue]&&t.opPanel.data[t.opPanel.data.inQueue].waitingCallers){var e=[];for(var a in t.opPanel.data[t.opPanel.data.inQueue].waitingCallers)e.push(t.opPanel.data[t.opPanel.data.inQueue].waitingCallers[a]);t.opPanel.numInCalls=e.length,t.opPanel.showInCalls=!0;var n=new g({page:1,count:20,sorting:{position:"asc"}},{counts:e.length,data:e});t.opPanel.incomingTable=n}},t.updateOpWaitingCalls=function(){if(t.opPanel.data[t.opPanel.data.waitingQueue]&&t.opPanel.data[t.opPanel.data.waitingQueue].waitingCallers){var e=[];for(var a in t.opPanel.data[t.opPanel.data.waitingQueue].waitingCallers)e.push(t.opPanel.data[t.opPanel.data.waitingQueue].waitingCallers[a]);t.opPanel.numWaitingCalls=e.length,t.opPanel.showWaitCalls=!0;var n=new g({page:1,count:20,sorting:{position:"asc"}},{counts:e.length,data:e});t.opPanel.waitingTable=n,t.$$phase||t.$apply()}},t.$on("$routeChangeStart",function(){t.updateOpPanelData()}),t.queueLogout=function(e,a){t.opPanel.data[t.opPanel.data.inQueue].members[e].paused?t.queueUnpauseOpp(e,a,function(){u.logout({endpointId:e,queueId:a}).then(function(e){},function(e){console.error(e)})}):u.logout({endpointId:e,queueId:a}).then(function(e){},function(e){console.error(e)})},t.queueLogin=function(e,t){u.login({endpointId:e,queueId:t}).then(function(e){},function(e){console.error(e)})},t.updateOpPanelData=function(){try{if(!t.currentUser.profile||!0!==t.currentUser.profile.macro_permissions.operator_panel.value||"/"!==s.url())return t.opPanel.show=!1,void $("#oppanel-right-side").css({width:"100%"});t.opPanel.show=!0,$("#oppanel-right-side").css({width:"75%"}),y.getOpPanelData().then(function(e){t.opPanel.data=e.data,t.updateOpInCalls(),t.updateOpWaitingCalls()},function(e){console.error(e)})}catch(e){console.error(e)}},t.opBlindTransferQueue=function(e,t,a){y.blindTransferQueue({queue:e,waitingCallerId:t,to:a}).then(function(e){},function(e){console.error(e)})},t.opBlindTransfer=function(e,t,a){y.blindTransfer({endpointId:e,convid:t,to:a}).then(function(e){},function(e){console.error(e)})},t.opWaitConv=function(e,t,a){y.opWaitConv({convid:t}).then(function(e){},function(e){console.error(e)})},t.startOpDrag=function(e){"true"===$(e.target).attr("data-waitingcall")?t.opPanel.dragFromWaitingCalls=!0:t.opPanel.dragFromWaitingCalls=!1,t.opPanel.dragFromCallBox=!1,t.opPanel.channelOpToDrag=$(e.target).attr("data-ch"),t.opPanel.chOpToDragFromQueue=!0},t.startOpDragFromBox=function(e){t.opPanel.channelOpToDrag=$(e.target).attr("data-ch"),t.opPanel.chOpToDragFromQueue=!1,t.opPanel.dragFromWaitingCalls=!1,t.opPanel.dragFromCallBox=!0},t.opOnOver=function(e){$("#"+e.target.id).css("border-color","#DB2828"),$("#"+e.target.id).css("border-width","2px"),$("#"+e.target.id).css("border-style","dashed")},t.opOnOverWaiting=function(e){!0===t.opPanel.dragFromCallBox&&($("#"+e.target.id).css("border","1px solid #DB2828"),$("#"+e.target.id).css("border-width","2px"),$("#"+e.target.id).css("border-style","dashed"))},t.opDropOut=function(e){$("#"+e.target.id).css("border","1px solid #D4D4D5")},t.opDropped=function(e){if($("#"+e.target.id).css("border-color","#21BA45"),setTimeout(function(){$("#"+e.target.id).css("border","1px solid #D4D4D5")},500),!0===t.opPanel.chOpToDragFromQueue){var a=!0===t.opPanel.dragFromWaitingCalls?t.opPanel.data.waitingQueue:t.opPanel.data.inQueue;t.opBlindTransferQueue(a,t.opPanel.channelOpToDrag,e.target.getAttribute("data-mainext"))}else"opWaitTable"===e.target.id?t.opWaitConv(t.currentCall.device.exten,t.opPanel.channelOpToDrag,e.target.getAttribute("data-mainext")):t.opBlindTransfer(t.currentUser.default_device.id,t.currentCall.conversation.id,e.target.getAttribute("data-mainext"));t.opPanel.dragFromWaitingCalls=!1},t.opPickupWaitingCall=function(e){y.pickupQueueWaitingCaller({queue:e.queue,waitCallerId:e.id,destId:t.currentUser.default_device.id}).then(function(e){},function(e){console.error(e)})},t.hideNoMicWarnDialog=function(){$("#no-mic-warn-dialog").modal("hide")},t.clickStatus=function(e){setTimeout(function(){var t=angular.element(e.target.parentNode.parentNode.parentNode.querySelector(".action"));t&&t.triggerHandler("click")},100)}}]),angular.module("nethctiUiApp").service("LoginService",["$q","RestService","WebsocketService","LocalStorageService",function(e,t,a,n){this.login=function(a,i,s){return e(function(e,o){t.post("/authentication/login",{username:a,password:i}).then(function(e){},function(r){if(r.headers("WWW-Authenticate")){var l=r.headers("WWW-Authenticate").match(/^Digest\s+(.+)/);if(2==l.length){var c=l[1],d=new jsSHA("SHA-1","TEXT");d.setHMACKey(i,"TEXT"),r.headers("shibcookie")&&!1===customConfig.AUTHENTICATION_ENABLED&&(a=r.headers("shibcookie")),d.update(a+":"+i+":"+c);var u=d.getHMAC("HEX");t.setAuthHeader(a,u),n.set("credentials",{username:a,password:btoa(i),token:u,hostname:s||window.location.hostname}),e(u)}}else"1"===r.headers("code")?o("user-not-configured"):500===r.status?o("server error"):503===r.status?o("service unavailable"):o("invalid credentials")})})},this.appLogin=function(t){return e(function(e,a){t.password=atob(t.password),$.ajax({url:customConfig.BASE_API_URL+"/authentication/login",headers:{"Auth-Exp":"no-exp"},type:"POST",dataType:"JSON",data:{username:t.username,password:t.password},success:function(e){},error:function(n){if(n.getResponseHeader("WWW-Authenticate")){var i=n.getResponseHeader("WWW-Authenticate").match(/^Digest\s+(.+)/);if(2==i.length){var s=i[1],o=new jsSHA("SHA-1","TEXT");o.setHMACKey(t.password,"TEXT"),o.update(t.username+":"+t.password+":"+s);var r=o.getHMAC("HEX");e({token:r})}}else 500===n.status?a({error:"server error"}):503===n.status?a({error:"service unavailable"}):a({error:"invalid credentials"})}})})},this.logout=function(){return e(function(e,a){t.post("/authentication/logout").then(function(a){t.unsetAuthHeader(),e(a)},function(e){a(e)})})}}]),angular.module("nethctiUiApp").service("LogService",["LocalStorageService",function(e){var t;this.log=function(e,a){t&&(a?console.log(e,a):console.log(e))},this.init=function(){""===e.get("DEBUG")&&e.set("DEBUG",!1),t=e.get("DEBUG")},this.init()}]),angular.module("nethctiUiApp").service("WebsocketService",["$q","LocalStorageService","LogService",function(e,t,a){var n,i;this.init=function(){n||(n=new io(customConfig.BASE_WSS_URL,{upgrade:!1,transports:["websocket"],reconnection:!0,reconnectionDelay:2e3}),a.log("ws created"),n.on("connect",function(){a.log("ws connected sid: ".concat(n.id))}),n.on("disconnect",function(e){a.log("ws disconnect - reason: ".concat(e))}),n.io.on("error",function(e){a.log("ws error: ",e)}),n.on("connect_error",function(e){a.log("ws connect_error: ",e)}),n.io.on("reconnect",function(e){a.log("ws reconnect attemp ".concat(e," (sid: ").concat(n.id,")"))}),n.io.on("reconnect_attempt",function(e){a.log("ws reconnect_attempt ".concat(e))}),n.io.on("reconnect_error",function(e){a.log("ws reconnect_error: ",e)}),n.io.on("reconnect_failed",function(){a.log("ws reconnect_failed")}),i=setInterval(function(){var e=Date.now();n.volatile.emit("ping",function(){var t=Date.now()-e;console.debug("ws latency: ".concat(t,"ms"))})},5e3))},this.on=function(e,t){n.on(e,t)},this.off=function(e,t){n.off(e,t)},this.emit=function(e,t){n.emit(e,t)},this.close=function(){n.close(),n=null,clearInterval(i)},this.reconnect=function(){n&&(console.info("websocket reconnection"),n.disconnect(),n.connect())}}]),angular.module("nethctiUiApp").service("RestService",["$q","$http",function(e,t){this.setAuthHeader=function(e,a){t.defaults.headers.common.Authorization=e+":"+a},this.unsetAuthHeader=function(){delete t.defaults.headers.common.Authorization};var a={timeout:customConfig.REST_TIMEOUT||5e3};this.get=function(n){return e(function(e,i){t.get(customConfig.BASE_API_URL+n,a).then(function(t){e(t)},function(e){i(e)})})},this.post=function(n,i){return e(function(e,s){t.post(customConfig.BASE_API_URL+n,i,a).then(function(t){e(t)},function(e){s(e)})})},this.put=function(n,i){return e(function(e,s){t.put(customConfig.BASE_API_URL+n,i,a).then(function(t){e(t)},function(e){s(e)})})},this.patch=function(n,i){return e(function(e,s){t.patch(customConfig.BASE_API_URL+n,i,a).then(function(t){e(t)},function(e){s(e)})})},this.delete=function(n){return e(function(e,i){t.delete(customConfig.BASE_API_URL+n,a).then(function(t){e(t)},function(e){i(e)})})}}]),angular.module("nethctiUiApp").service("UserService",["$q","RestService",function(e,t){this.getInfo=function(){return e(function(e,a){t.get("/user/me").then(function(t){e(t)},function(e){a(e)})})},this.getPresence=function(){return e(function(e,a){t.get("/user/presence").then(function(t){e(t)},function(e){a(e)})})},this.setPresence=function(a){return e(function(e,n){t.post("/user/presence",a).then(function(t){e(t)},function(e){n(e)})})},this.getAvailablePresence=function(a){return e(function(e,a){t.get("/user/presencelist").then(function(t){e(t)},function(e){a(e)})})},this.setDevice=function(a){return e(function(e,n){t.post("/user/default_device",a).then(function(t){e(t)},function(e){n(e)})})},this.getAllAvatars=function(){return e(function(e,a){t.get("/user/all_avatars").then(function(t){e(t)},function(e){a(e)})})},this.getParamUrl=function(){return e(function(e,a){t.get("/user/paramurl").then(function(t){e(t)},function(e){a(e)})})}}]),angular.module("nethctiUiApp").service("JanusService",["$q","$filter",function(e,t){var a,n=null,i=null,s=null,o=null,r=null,l=null,c=null,d=null,u=null,p=null,m=null,g="screensharingtest-"+Janus.randomString(12),f=!1,v=!1,h=null,b=null,C=null,y=null,w=null,x={},k=new Audio("sounds/busytone.d8dc4b34.mp3"),S={registration_failed:[],registered:[],calling:[],incomingcall:[],accepted:[],hangup:[],gateway_down:[],error:[],progress:[],destroyed:[]},_=function(e){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=function(e){navigator.mediaDevices.enumerateDevices().then(e)});var t=[],a="https:"===location.protocol,n=!1;"undefined"!=typeof MediaStreamTrack&&"getSources"in MediaStreamTrack?n=!0:navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(n=!0);var i,s=!1,o=!1,r=!1,l=!1;i=function(){x={audio:s,audioCap:r,video:o,videoCap:l},Janus.log("supportedDevices=",x),e()},n&&(!navigator.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(navigator.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!navigator.enumerateDevices&&navigator.enumerateDevices&&(navigator.enumerateDevices=navigator.enumerateDevices.bind(navigator)),navigator.enumerateDevices?(t=[],navigator.enumerateDevices(function(e){e.forEach(function(e){var n,i={};for(var c in e)i[c]=e[c];"audio"===i.kind&&(i.kind="audioinput"),"video"===i.kind&&(i.kind="videoinput"),t.forEach(function(e){e.id===i.id&&e.kind===i.kind&&(n=!0)}),n||(i.deviceId||(i.deviceId=i.id),i.id||(i.id=i.deviceId),i.label?("videoinput"!==i.kind||l||(l=!0),"audioinput"!==i.kind||r||(r=!0)):(i.label="Please invoke getUserMedia once.",a||(i.label="HTTPs is required to get label of this "+i.kind+" device.")),"audioinput"===i.kind&&(s=!0),"audiooutput"===i.kind&&!0,"videoinput"===i.kind&&(o=!0),t.push(i))}),i&&i()})):i&&i())};this.isConnected=function(){return!(!n||!n.isConnected)&&n.isConnected()},this.getSessionId=function(){if(n&&n.getSessionId)return n.getSessionId()},this.getSipPluginHandleId=function(){if(i&&i.getId)return i.getId()},this.isRegistered=function(){return v},this.stopScreenSharing=function(e){try{s&&s.hangup&&s.detach&&(s.hangup(!0),s.detach(),s=null)}catch(e){console.error(e)}};var T=function(){try{s&&s.hangup&&s.detach&&(s.hangup(!0),s.detach(),s=null)}catch(e){console.error(e)}};this.startScreenSharing=function(e,t){q(e,t,A)};var q=function(e,a,i){try{T(),e&&(d=e),a&&(p=a),n.attach({plugin:"janus.plugin.videoroom",opaqueId:g,success:function(e){s=e,Janus.log("Plugin attached! ("+s.getPlugin()+", id="+s.getId()+")"),i()},error:function(e){Janus.error("  -- Error attaching plugin...",e)},consentDialog:function(e){Janus.debug("Consent dialog should be "+(e?"on":"off")+" now")},webrtcState:function(e){Janus.log("Janus says our WebRTC PeerConnection is "+(e?"up":"down")+" now"),e?p&&p(null,l):console.log("Your screen sharing session just stopped.")},onmessage:function(e,t){try{Janus.debug(" ::: Got a message (publisher) :::"),Janus.debug(e);var a=e.videoroom;if(Janus.debug("Event: "+a),void 0!=a&&null!=a)if("joined"===a){if(u=e.id,Janus.log("Successfully joined room "+e.room+" with ID "+u),"publisher"===r)Janus.debug("Negotiating WebRTC stream for our screen (capture "+o+")"),s.createOffer({media:{video:o,audio:!1},success:function(e){Janus.debug("Got publisher SDP!"),Janus.debug(e);s.send({message:{request:"configure",audio:!1,video:!0},jsep:e})},error:function(e){Janus.error("WebRTC error:",e),T()}});else if(void 0!==e.publishers&&null!==e.publishers){var n=e.publishers;for(var i in Janus.debug("Got a list of available publishers/feeds:"),Janus.debug(n),n){var l=n[i].id,c=n[i].display;Janus.debug("  >> ["+l+"] "+c),L(l,c)}}}else if("destroyed"===a)$("#remoteScreenSharing").modal("hide");else if("event"===a)if("listener"===r&&void 0!==e.publishers&&null!==e.publishers){n=e.publishers;for(var i in Janus.debug("Got a list of available publishers/feeds:"),Janus.debug(n),n){l=n[i].id,c=n[i].display;Janus.debug("  >> ["+l+"] "+c),L(l,c)}}else if(void 0!==e.leaving&&null!==e.leaving){var d=e.leaving;Janus.log("Publisher left: "+d),console.log("The screen sharing session is over, the publisher left")}else void 0!==e.error&&null!==e.error&&console.error(e.error);void 0!==t&&null!==t&&(Janus.debug("Handling SDP as well..."),Janus.debug(t),s.handleRemoteJsep({jsep:t}))}catch(e){console.error(e)}},onlocalstream:function(e){try{Janus.debug(" ::: Got a local stream :::"),Janus.debug(e),0===$("#screenvideo").length&&($("#screenshare-callbox-loader").remove(),$("#screencapture").append('<div id="screenShareInfoUser" class="text-left">'+t("translate")("Waiting for acceptance")+'<div id="screenShareBoxLoader" class="mini ui active inline loader"></div></div>'),$("#screencapture").append('<video class="rounded centered border-green" id="screenvideo" autoplay playsinline muted="muted"/>'),$("#screenShareInfoUser").show()),Janus.attachMediaStream($("#screenvideo").get(0),e),"completed"!==s.webrtcStuff.pc.iceConnectionState&&"connected"!==s.webrtcStuff.pc.iceConnectionState&&console.log("Publishing...")}catch(e){console.error(e)}},onremotestream:function(e){},oncleanup:function(){Janus.log(" ::: Got a cleanup notification :::"),$(document).trigger("screenShareHideCallbox")}})}catch(e){console.error(e)}},A=function(){try{o="screen",U()}catch(e){console.error(e)}},U=function(){try{r="publisher";var e={request:"create",description:d+"-screen-sharing",bitrate:5e5,publishers:1};s.send({message:e,success:function(e){var t=e.videoroom;if(Janus.debug("Event: "+t),void 0!=t&&null!=t){l=e.room,Janus.log("Screen sharing session created: "+l);var a={request:"join",room:l,ptype:"publisher",display:d};s.send({message:a})}},error:function(e){console.error(e)}})}catch(e){console.error(e)}};this.acceptScreenSharing=function(e,t,a){m=a,q(null,null,function(){D(e,t)})};var D=function(e,t){try{c=e,r="listener";var a={request:"join",room:e,ptype:"publisher",display:t};s.send({message:a})}catch(e){console.error(e)}};function L(e,t){try{e;var a=null;n.attach({plugin:"janus.plugin.videoroom",opaqueId:g,success:function(t){a=t,Janus.log("Plugin attached! ("+a.getPlugin()+", id="+a.getId()+")"),Janus.log("  -- This is a subscriber");var n={request:"join",room:c,ptype:"listener",feed:e};a.send({message:n})},error:function(e){Janus.error("  -- Error attaching plugin...",e)},onmessage:function(n,i){Janus.debug(" ::: Got a message (listener) :::"),Janus.debug(n);var s=n.videoroom;Janus.debug("Event: "+s),void 0!=s&&null!=s&&("attached"===s?Janus.log("Successfully attached to feed "+e+" ("+t+") in room "+n.room):console.log("Janus unknown message:",n,i)),void 0!==i&&null!==i&&(Janus.debug("Handling SDP as well..."),Janus.debug(i),a.createAnswer({jsep:i,media:{audioSend:!1,videoSend:!1},success:function(e){try{Janus.debug("Got SDP!"),Janus.debug(e);var t={request:"start",room:c};a.send({message:t,jsep:e})}catch(e){console.error(e)}},error:function(e){Janus.error("WebRTC error:",e)}}))},onlocalstream:function(e){},onremotestream:function(e){0===$("#screenvideoIn").length&&($("#screencaptureIn").append('<video class="rounded centered hide border-red" id="screenvideoIn" autoplay playsinline/>'),$("#screenvideoIn").bind("loadedmetadata",function(){$("#screenvideoIn").removeClass("hide"),$("#waitingvideoIn").remove(),m()})),Janus.attachMediaStream($("#screenvideoIn").get(0),e)},oncleanup:function(){Janus.log(" ::: Got a cleanup notification (remote feed "+e+") :::"),$("#waitingvideoIn").remove(),$("#remoteScreenSharing").modal("hide")}})}catch(e){console.error(e)}}this.isJanusInitialized=function(){return!0===f&&void 0!==n&&null!==n},this.init=function(e){console.log("janus initialization..."),Janus.init({debug:"all",callback:function(){try{if(f)return console.log("janus already initialized"),void e();if(f=!0,!Janus.isWebrtcSupported()){var t="No WebRTC support...";return console.error(t),void e(t)}console.log("janus initialized"),console.log("creating janus session..."),n=new Janus({server:customConfig.JANUS_URL,success:function(){console.log("janus session initialized"),e()},error:function t(a){try{for(var i in console.error("janus session error (session id: ".concat(n.getSessionId(),")")),console.error(a),f=!1,v=!1,Janus.error(a),S.gateway_down)S.gateway_down[i]("Janus error: "+a);e(a)}catch(t){console.error(t)}},destroyed:function(){try{for(var e in console.warn("janus session destroyed"),f=!1,v=!1,S.gateway_down)S.gateway_down[e]("Janus is destroyed"),S.destroyed[e]("Janus is destroyed")}catch(e){console.error(e)}}})}catch(t){console.error(t),e(t)}}})},this.isJanusSipPluginInitialized=function(){try{return void 0!==i&&null!==i}catch(e){console.error(e)}},this.initSipPlugin=function(t,s,o,r){return C=t,y=s,w=o,e(function(e,t){n.attach({plugin:"janus.plugin.sip",opaqueId:r+"_"+(new Date).getTime(),success:function(t){i=t,Janus.log("SIP plugin attached! ("+i.getPlugin()+", handle id = "+i.getId()+")"),_(function(){e()})},error:function(e){console.error("  -- Error attaching plugin..."),console.error(e),t()},consentDialog:function(e){console.log("janus consentDialog (on: ".concat(e,")"))},webrtcState:function(e){console.log("Janus says our WebRTC PeerConnection is "+(e?"up":"down")+" now")},iceState:function(e){console.log("ICE state of PeerConnection of handle ".concat(i.getId(),' has changed to "').concat(e,'"'))},mediaState:function(e,t){console.log("Janus "+(t?"started":"stopped")+" receiving our "+e)},slowLink:function(e,t){e?console.warn("SLOW link: several missing packets from janus (".concat(t,")")):console.warn("SLOW link: janus is not receiving all your packets (".concat(t,")"))},onmessage:function(e,t){Janus.debug(" ::: Got a message :::"),Janus.debug(JSON.stringify(e));var n=e.error;if(null==n||void 0==n){var s=e.result;if(null!==s&&void 0!==s&&void 0!==s.event&&null!==s.event){var o=s.event;for(var r in S[o])S[o][r](e,t);switch(o){case"registration_failed":return void Janus.error("Registration failed: "+s.code+" "+s.reason);case"unregistered":Janus.log("Successfully un-registered as "+s.username+"!"),v=!1;break;case"registered":Janus.log("Successfully registered as "+s.username+"!"),v||(v=!0),a=(new Date).getTime();break;case"registering":Janus.log("janus registering");break;case"calling":Janus.log("Waiting for the peer to answer..."),a=(new Date).getTime();break;case"incomingcall":b=t,Janus.log("Incoming call from "+s.username+"!"),a=(new Date).getTime();break;case"progress":Janus.log("There's early media from "+s.username+", wairing for the call!"),null!==t&&void 0!==t&&P(t),a=(new Date).getTime();break;case"accepted":Janus.log(s.username+" accepted the call!"),null!==t&&void 0!==t&&P(t),a=(new Date).getTime();break;case"hangup":486===s.code&&"hangup"===s.event&&"Busy Here"===s.reason&&k.play(),Janus.log("Call hung up ("+s.code+" "+s.reason+")!"),null!=h&&(h=null),i.hangup(),a=(new Date).getTime(),T()}}}else for(var r in v?i.hangup():Janus.log("User is not registered"),S.error)S.error[r](e,t)},onlocalstream:function(e){Janus.debug(" ::: Got a local stream :::"),Janus.debug(e),Janus.attachMediaStream(C,e);e.getVideoTracks()},onremotestream:function(e){Janus.debug(" ::: Got a remote stream :::"),Janus.debug(e);var t=e.getAudioTracks(),a=e.getVideoTracks();Janus.attachMediaStream(y,new MediaStream(t)),Janus.attachMediaStream(w,new MediaStream(a))},oncleanup:function(){console.log(" ::: janus Got a cleanup notification :::")},detached:function(){console.warn("SIP plugin handle detached from the plugin itself")}})})},this.destroy=function(){try{i&&i.detach&&(i.detach(),i=void 0),n&&n.destroy&&(n.destroy(),n=void 0),f=!1,v=!1}catch(e){console.error(e)}},this.onmessage=function(e,t){S[e].push(t)},this.answer=function(e,t){h=null;var a=!1===t?{audio:{mandatory:{echoCancellation:!1,googEchoCancellation:!1,googAutoGainControl:!1,googAutoGainControl2:!1,googNoiseSuppression:!1,googHighpassFilter:!1,googTypingNoiseDetection:!1}},audioSend:!0,audioRecv:!0,videoSend:!1,videoRecv:!1}:{audio:!0,videoSend:!1,videoRecv:!1};_(function(){i.createAnswer({jsep:b,media:a,success:function(e){Janus.debug("Got SDP! audio=true, video=false"),Janus.debug(e);i.send({message:{request:"accept"},jsep:e})},error:function(e){Janus.error("WebRTC error:",e);i.send({message:{request:"decline",code:480}})}})})},this.register=function(e){i&&(e.request="register",i.send({message:e}))},this.unregister=function(){console.log("janus sip plugin unregistering..."),i&&i.send({message:{request:"unregister"}})},this.call=function(e,t){_(function(){Janus.log("This is a SIP call");var a=!1===t?{audio:{mandatory:{echoCancellation:!1,googEchoCancellation:!1,googAutoGainControl:!1,googAutoGainControl2:!1,googNoiseSuppression:!1,googHighpassFilter:!1,googTypingNoiseDetection:!1}},audioSend:!0,audioRecv:!0,videoSend:!1,videoRecv:!1}:{audioSend:!0,audioRecv:!0,videoSend:!1,videoRecv:!1};i.createOffer({media:a,success:function(t){Janus.debug("Got SDP!"),Janus.debug(t);var a={request:"call",uri:e};i.send({message:a,jsep:t})},error:function(e){Janus.error("WebRTC error...",e),"No capture device found"===e&&$("#no-mic-warn-dialog").modal("show")}})})},this.toggleMute=function(){i.isAudioMuted()?i.unmuteAudio():i.muteAudio()},this.togglePause=function(e){i.send({message:{request:e?"unhold":"hold"}})},this.muteVideo=function(){i.createOffer({media:{audioSend:!0,audioRecv:!0,videoRecv:!0,removeVideo:!0},success:function(e){Janus.debug(e),i.send({message:{request:"update"},jsep:e})},error:function(e){console.error("WebRTC error... "+JSON.stringify(e))}})},this.unMuteVideo=function(){i.createOffer({media:{audioSend:!0,audioRecv:!0,videoRecv:!0,addVideo:!0},success:function(e){Janus.debug(e),i.send({message:{request:"update"},jsep:e})},error:function(e){console.error("WebRTC error... "+JSON.stringify(e))}})},this.toggleVideo=function(){i.isVideoMuted()?this.unMuteVideo():this.muteVideo()},this.isVideoAvailable=function(e){_(function(){e(x)})},this.pauseRemoteStream=function(e){e?(y.play(),w.play()):(y.pause(),w.pause())},this.hangup=function(){i.send({message:{request:"hangup"}}),i.hangup()},this.decline=function(){h=null;i.send({message:{request:"decline"}})},this.sendDTMF=function(e,t){if("chrome"===adapter.browserDetails.browser?i.dtmf({dtmf:{tones:e}}):i.send({message:{request:"dtmf_info",digit:e}}),!0===t){var a="*"===e?"star":e;a="#"===a?"pound":a,new Audio("sounds/dtmf/dtmf-"+a+".mp3").play()}};var P=function(e){i.handleRemoteJsep({jsep:e,error:function(){i.send({message:{request:"hangup"}}),i.hangup()}})};this.getLastActivity=function(){return a},this.getSipCall=function(){return i}}]),angular.module("nethctiUiApp").service("VisibilityService",["$rootScope",function(e){this.isCtiPageInBackground=function(){return document.hidden||!document.hasFocus()}}]),angular.module("nethctiUiApp").controller("PhonebookCtrl",["$scope","PhonebookService","LocalStorageService",function(e,t,a){e.appConfig=appConfig,e.alphabet="abcdefghijklmnopqrstuvwxyz".toUpperCase().split(""),e.phoneBookLoad=!1,e.filter={type:a.get("phonebookFilter")||"person"},e.phoneBookResults=[],e.currentTerm="A",e.firstCurrentPage=0,e.isFirstLast=!0,e.isLastLast=!1,e.lastCurrentPage=void 0,e.currentPage=0,e.totalPages=0,e.getNumber=function(e){return new Array(e)},e.getIconState=function(e){if(e){var t=e.toLowerCase();return"centralized"!==t&&"cti"!==t&&"speeddial"!==t&&"public"!==t&&"private"!==t&&(t="info"),appConfig.PHONEBOOK_ICON_MAP[t]}},e.nextPage=function(){e.currentPage<e.totalPages&&e.startSearch(e.currentTerm,e.isFirstLast?e.firstCurrentPage+1:e.lastCurrentPage+1,e.isFirstLast,!0)},e.prevPage=function(){e.currentPage>0&&e.startSearch(e.currentTerm,e.isLastLast?e.lastCurrentPage-1:e.firstCurrentPage-1,!e.isLastLast,!1)},e.changeFilter=function(){a.set("phonebookFilter",e.filter.type),e.startSearch(e.search.field,0,!0,!0,!0,!1)},e.parseContacts=function(e){for(var t in e)if(e[t].contacts){e[t].contacts=JSON.parse(e[t].contacts);var a=0;for(var n in e[t].contacts)e[t].contacts[n].name&&e[t].contacts[n].name.length>0&&a++;e[t].contacts.realLength=a}return e},e.getContactInfo=function(a,n){a.isLoading=!0,"cti"==a.source?t.retrieveCtiContact(a.id).then(function(t){n.selectedContact=t.data,a.isLoading=!1,e.$$phase||e.$apply()},function(e){console.error(e),a.isLoading=!1}):t.retrieveContact(a.id).then(function(t){n.selectedContact=t.data,a.isLoading=!1,e.$$phase||e.$apply()},function(e){console.error(e),a.isLoading=!1})},e.startSearch=function(a,n,i,s,o,r,l){e.phoneBookLoad=!0,e.currentTerm=a||"A",e.currentPage=n,void 0==l&&(l=e.search.field&&e.search.field.length>0),o?(e.firstCurrentPage=0,e.isFirstLast=!0,e.isLastLast=!1,e.lastCurrentPage=void 0,e.currentPage=0,e.totalPages=0):i?(e.isFirstLast=!0,e.isLastLast=!1,s?e.firstCurrentPage++:0==e.firstCurrentPage?e.firstCurrentPage=e.firstCurrentPage:e.firstCurrentPage--):(e.isFirstLast=!1,e.isLastLast=!0,s&&e.lastCurrentPage<e.totalPages?e.lastCurrentPage++:s&&e.lastCurrentPage==e.totalPages?e.lastCurrentPage=e.lastCurrentPage:e.lastCurrentPage--),r?(e.lastIsDigit=!0,t.searchDigit(e.appConfig.PHONEBOOK_RESULT_LIMIT,e.currentPage*e.appConfig.PHONEBOOK_RESULT_LIMIT,e.filter.type).then(function(t){e.phoneBookResults=t.data.rows,e.phoneBookResults=e.parseContacts(e.phoneBookResults),e.phoneBookResults.total=t.data.count,e.totalPages=Math.floor(e.phoneBookResults.total/e.appConfig.PHONEBOOK_RESULT_LIMIT||0),e.lastCurrentPage=e.lastCurrentPage||e.totalPages,e.phoneBookLoad=!1},function(t){console.error(t),e.phoneBookLoad=!1,e.phoneBookResults=[],403==t.status&&(e.phoneBookResults.total=0)})):(e.lastIsDigit=!1,l?t.search(e.currentTerm,e.appConfig.PHONEBOOK_RESULT_LIMIT,e.currentPage*e.appConfig.PHONEBOOK_RESULT_LIMIT,e.filter.type).then(function(t){e.phoneBookResults=t.data.rows,e.phoneBookResults=e.parseContacts(e.phoneBookResults),e.phoneBookResults.total=t.data.count,e.totalPages=Math.floor(e.phoneBookResults.total/e.appConfig.PHONEBOOK_RESULT_LIMIT||0),e.lastCurrentPage=e.lastCurrentPage||e.totalPages,e.phoneBookLoad=!1},function(t){console.error(t),e.phoneBookLoad=!1,e.phoneBookResults=[],403==t.status&&(e.phoneBookResults.total=0)}):t.searchStartWith(e.currentTerm,e.appConfig.PHONEBOOK_RESULT_LIMIT,e.currentPage*e.appConfig.PHONEBOOK_RESULT_LIMIT,e.filter.type).then(function(t){e.phoneBookResults=t.data.rows,e.phoneBookResults=e.parseContacts(e.phoneBookResults),e.phoneBookResults.total=t.data.count,e.totalPages=Math.floor(e.phoneBookResults.total/e.appConfig.PHONEBOOK_RESULT_LIMIT||0),e.lastCurrentPage=e.lastCurrentPage||e.totalPages,e.phoneBookLoad=!1},function(t){console.error(t),e.phoneBookLoad=!1,e.phoneBookResults=[],403==t.status&&(e.phoneBookResults.total=0)}))},e.newContact=function(t,a,n,i){e.newContactObj={name:a||"",workphone:t||"",privacy:n?"private":"public",favorite:n||!1,selectedPrefNum:"extension",company:i,setFavorite:function(){e.newContactObj.favorite=!e.newContactObj.favorite,e.newContactObj.favorite&&(e.newContactObj.privacy="private")}},$("#new-contact").modal({closable:!1}).modal("show"),setTimeout(function(){$(".ui.dropdown").dropdown()},100)},e.modifyContact=function(t){for(var a in e.newContactObj=t,e.newContactObj.favorite="speeddial"==t.type,e.newContactObj.privacy="speeddial"==t.type?"private":t.type,e.newContactObj)e.newContactObj.speeddial_num==e.newContactObj[a]&&"speeddial_num"!==a&&(e.newContactObj.selectedPrefNum=a);t.owner_id===e.currentUser.username?e.phoneOwner=!0:e.phoneOwner=!1,$("#new-contact").modal({closable:!1}).modal("show"),setTimeout(function(){$(".ui.dropdown").dropdown()},100)},e.saveContact=function(){e.newContactObj.type=e.newContactObj.favorite?"speeddial":e.newContactObj.privacy,"speeddial"==e.newContactObj.type&&(e.newContactObj.speeddial_num=e.newContactObj[e.newContactObj.selectedPrefNum]),e.newContactObj.id?(e.newContactObj.id=e.newContactObj.id.toString(),t.modify(e.newContactObj).then(function(t){e.startSearch(e.search.field,0,!0,!0,!0),e.getSpeedDials(),$("#new-contact").modal("hide")},function(t){console.error(t),e.phoneBookLoad=!1})):t.create(e.newContactObj).then(function(t){e.startSearch(e.search.field,0,!0,!0,!0),e.getSpeedDials(),$("#new-contact").modal("hide")},function(t){console.error(t),e.phoneBookLoad=!1})},e.showDeleteModal=function(t){$("#del-contact").modal("show"),e.contactToDelete=t},e.deleteContact=function(){e.contactToDelete.isLoading=!0,t.delete(e.contactToDelete.id).then(function(t){e.contactToDelete.isLoading=!1,e.startSearch(e.search.field,0,!0,!0,!0),e.$emit("contactDeleted")},function(t){console.error(t),e.phoneBookLoad=!1,e.contactToDelete.isLoading=!1})},e.initGraphics=function(){angular.element(document).ready(function(){$(".ui.dropdown").dropdown()})},e.initGraphics(),e.hideModal=function(){$("#new-contact").modal("hide")},e.hideDeleteModal=function(){$("#del-contact").modal("hide")},e.noDefaultDeviceStatus=function(){return!(!e.currentUser.default_device||!e.allExtensions[e.currentUser.default_device.id]||e.allExtensions[e.currentUser.default_device.id].status)},e.startSearch(e.search.field,0,!0,!0,!0,!1),e.$on("globalSearch",function(t,a){e.startSearch(e.search.field,0,!0,!0,!0,!1)}),e.$on("contactAdd",function(t,a){e.newContact(a.defaultNum,a.defaultName,a.defaultFavorite,a.defaultCompany),e.$apply()}),e.$on("contactModify",function(t,a){e.modifyContact(a.contact),e.$apply()}),e.$on("generalAdd",function(t,a){e.newContact(a.contact,"","",""),e.$apply()}),e.$on("$routeChangeStart",function(){$("#new-contact").remove()})}]),angular.module("nethctiUiApp").controller("HistoryCtrl",["$rootScope","$scope","$filter","NgTableParams","$location","HistoryService","UtilService",function(e,t,a,n,i,s,o){t.loadTableAllPersonal=!1,t.loadTableAllSwitch=!1,t.loadTableAllVoice=!1,t.loadTableAllGroup=!1,t.filterAvailable=[{filter:"lost",icon:"remove",type:"all",description:"lost"},{filter:"in",icon:"arrow left",type:"personal",description:"incoming"},{filter:"out",icon:"arrow right",type:"personal",description:"outgoing"},{filter:"all",icon:"",type:"personal",description:"Allss"},{filter:"in",icon:"external left arrow",type:"switchboard",description:"external incoming"},{filter:"out",icon:"external right arrow",type:"switchboard",description:"external outgoing"},{filter:"internal",icon:"building",type:"switchboard",description:"internal"},{filter:"all",icon:"",type:"switchboard",description:"Allss"},{filter:"in",icon:"arrow left",type:"group",description:"incoming"},{filter:"out",icon:"arrow right",type:"group",description:"outgoing"},{filter:"all",icon:"",type:"group",description:"Allss"}],t.personalFilter=t.filterAvailable[0],t.switchboardFilter=t.filterAvailable[0],t.groupFilter=t.filterAvailable[0];var r=!1;t.initGraphics=function(){angular.element(document).ready(function(){$(".ui.dropdown").dropdown(),$(".menu .item").tab({history:!1})})},t.setPersonalFilter=function(e){t.personalFilter=e,t.currentUser.default_device&&t.currentUser.default_device.id&&t.getAllHistoryPersonal({endpoint:t.currentUser.default_device.id,from:$("#rangestartPersonal").calendar("get date"),to:$("#rangeendPersonal").calendar("get date"),term:t.personalText,personalType:t.personalFilter.filter})},t.setSwitchboardFilter=function(e){t.switchboardFilter=e,t.getAllHistorySwitchboard({term:t.switchboardText,switchboardType:t.switchboardFilter.filter})},t.setGroupFilter=function(e){t.groupFilter=e,t.currentUser.default_device&&t.currentUser.default_device.id&&t.getAllHistoryGroup({endpoint:t.currentUser.default_device.id,from:$("#rangestartGroup").calendar("get date"),to:$("#rangeendGroup").calendar("get date"),term:t.groupText,groupType:t.groupFilter.filter})},t.personalInit=function(){$("#rangestartPersonal").calendar({type:"date",endCalendar:$("#rangeendPersonal"),maxDate:new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate()),formatter:{date:function(e,t){return e?a("translate")("with_date","{date:"+e.getTime()+"}"):""}},text:o.getDateTexts()}),$("#rangeendPersonal").calendar({type:"date",startCalendar:$("#rangestartPersonal"),maxDate:new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate()),formatter:{date:function(e,t){return e?a("translate")("with_date","{date:"+e.getTime()+"}"):""}},text:o.getDateTexts()}),$("#rangestartPersonal").calendar("set date",o.NWeeksAgo(2)),$("#rangeendPersonal").calendar("set date",o.dateNow())},t.switchboardInit=function(){$("#rangestartSwitchboard").calendar({type:"date",endCalendar:$("#rangeendSwitchboard"),maxDate:new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate()),formatter:{date:function(e,t){return e?a("translate")("with_date","{date:"+e.getTime()+"}"):""}},text:o.getDateTexts()}),$("#rangeendSwitchboard").calendar({type:"date",startCalendar:$("#rangestartSwitchboard"),maxDate:new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate()),formatter:{date:function(e,t){return e?a("translate")("with_date","{date:"+e.getTime()+"}"):""}},text:o.getDateTexts()}),$("#rangestartSwitchboard").calendar("set date",o.NWeeksAgo(2)),$("#rangeendSwitchboard").calendar("set date",o.dateNow())},t.voicemailInit=function(){},t.groupInit=function(){$("#rangestartGroup").calendar({type:"date",endCalendar:$("#rangeendGroup"),maxDate:new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate()),formatter:{date:function(e,t){return e?a("translate")("with_date","{date:"+e.getTime()+"}"):""}},text:o.getDateTexts()}),$("#rangeendGroup").calendar({type:"date",startCalendar:$("#rangestartGroup"),maxDate:new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate()),formatter:{date:function(e,t){return e?a("translate")("with_date","{date:"+e.getTime()+"}"):""}},text:o.getDateTexts()}),$("#rangestartGroup").calendar("set date",o.NWeeksAgo(2)),$("#rangeendGroup").calendar("set date",o.dateNow())},t.startSearchPersonal=function(){t.currentUser.default_device&&t.currentUser.default_device.id?t.getAllHistoryPersonal({endpoint:t.currentUser.default_device.id,from:$("#rangestartPersonal").calendar("get date"),to:$("#rangeendPersonal").calendar("get date"),term:t.personalText,personalType:t.personalFilter.filter}):t.tableParamsAllPersonal=new n({page:1,count:20,sorting:{time:"desc"}},{counts:[],getData:function(e,a){t.loadTableAllPersonal=!0,t.show_filter=!1;for(var n in a.sorting()){n+" "+a.sorting()[n]}a.total(0),e.resolve([]),t.loadTableAllPersonal=!1}})},t.startSearchGroup=function(){t.currentUser.default_device&&t.currentUser.default_device.id?t.getAllHistoryGroup({endpoint:t.currentUser.default_device.id,from:$("#rangestartGroup").calendar("get date"),to:$("#rangeendGroup").calendar("get date"),term:t.groupText,groupType:t.groupFilter.filter}):t.tableParamsAllGroup=new n({page:1,count:20,sorting:{time:"desc"}},{counts:[],getData:function(e,a){t.loadTableAllGroup=!0,t.show_filter=!1;for(var n in a.sorting()){n+" "+a.sorting()[n]}a.total(0),e.resolve([]),t.loadTableAllGroup=!1}})},t.clearSearchPersonal=function(){t.personalText="",$("#rangestartPersonal").calendar("clear"),$("#rangeendPersonal").calendar("clear")},t.clearSearchGroup=function(){t.groupText="",$("#rangestartGroup").calendar("clear"),$("#rangeendGroup").calendar("clear")},t.startSearchSwitchboard=function(){t.getAllHistorySwitchboard({term:t.switchboardText,switchboardType:t.switchboardFilter.filter})},t.clearSearchSwitchboard=function(){t.switchboardText="",$("#rangestartSwitchboard").calendar("clear"),$("#rangeendSwitchboard").calendar("clear")},t.clearSearchVoicemail=function(){t.switchboardText="",$("#rangestartVoicemail").calendar("clear"),$("#rangeendVoicemail").calendar("clear")},t.getAllHistoryPersonal=function(e){var a="in"===e.personalType;t.tableParamsAllPersonal=new n({page:1,count:20,sorting:{time:"desc"}},{counts:[],getData:function(n,i){t.loadTableAllPersonal=!0,t.show_filter=!1;var r="";for(var l in i.sorting()){r=l+" "+i.sorting()[l]}s.search(t.currentUser.username,o.getDateFormat($("#rangestartPersonal").calendar("get date")),o.getDateFormat($("#rangeendPersonal").calendar("get date")),e.term,(i.page()-1)*t.appConfig.PHONEBOOK_RESULT_LIMIT,t.appConfig.PHONEBOOK_RESULT_LIMIT,r,e.personalType||"",a).then(function(e){i.total(e.data.count),n.resolve(e.data.rows),t.loadTableAllPersonal=!1},function(e){i.total(0),n.resolve([]),t.loadTableAllPersonal=!1,console.error(e)})}})},t.getAllHistorySwitchboard=function(e){var a="in"===e.switchboardType;t.tableParamsAllSwitchboard=new n({page:1,count:20,sorting:{time:"desc"}},{counts:[],getData:function(n,i){t.loadTableAllSwitch=!0;var r="";for(var l in i.sorting()){r=l+" "+i.sorting()[l]}s.searchSwitchboard(o.getDateFormat($("#rangestartSwitchboard").calendar("get date")),o.getDateFormat($("#rangeendSwitchboard").calendar("get date")),e.term,(i.page()-1)*t.appConfig.PHONEBOOK_RESULT_LIMIT,t.appConfig.PHONEBOOK_RESULT_LIMIT,r,e.switchboardType||"",a).then(function(e){i.total(e.data.count),n.resolve(e.data.rows),t.loadTableAllSwitch=!1},function(e){i.total(0),n.resolve([]),t.loadTableAllSwitch=!1,console.error(e)})}})},t.getAllHistoryGroup=function(e){var a="in"===e.groupType;t.tableParamsAllGroup=new n({page:1,count:20,sorting:{time:"desc"}},{counts:[],getData:function(n,i){t.loadTableAllGroup=!0,t.show_filter=!1;var r="";for(var l in i.sorting()){r=l+" "+i.sorting()[l]}s.searchGroup(o.getDateFormat($("#rangestartGroup").calendar("get date")),o.getDateFormat($("#rangeendGroup").calendar("get date")),e.term,(i.page()-1)*t.appConfig.PHONEBOOK_RESULT_LIMIT,t.appConfig.PHONEBOOK_RESULT_LIMIT,r,e.groupType||"",a).then(function(e){i.total(e.data.count),n.resolve(e.data.rows),t.loadTableAllGroup=!1},function(e){i.total(0),n.resolve([]),t.loadTableAllGroup=!1,console.error(e)})}})},t.getAllVoicemail=function(e){t.tableParamsVoicemail=new n({page:1,count:20,sorting:{date:"asc"}},{counts:[],getData:function(e,a){t.loadTableAllVoice=!0;for(var n in a.sorting()){n+" "+a.sorting()[n]}s.searchVoicemail().then(function(n){n.data&&n.data.count?(a.total(n.data.count),e.resolve(n.data.rows)):(a.total(0),e.resolve([])),t.loadTableAllVoice=!1},function(n){a.total(0),e.resolve([]),t.loadTableAllVoice=!1,console.error(n)})}})},t.listenRecording=function(e,t){t.inListen?t.inListen=!t.inListen:t.inListen=!0,s.listenRecording(e).then(function(e){t.audiosource=e.data},function(e){console.error(e)})},t.downloadRecording=function(e){s.downloadRecording(e).then(function(e){var t=document.createElement("a");t.download=e.data,t.href=customConfig.BASE_API_URL+"/static/"+e.data,t.click()},function(e){console.error(e)})},t.deleteRecording=function(e){s.deleteRecording(e).then(function(e){t.getAllHistoryPersonal()},function(e){console.error(e)})},t.initGraphics(),t.startSearchPersonal(),t.refreshTabs=function(){r&&$("#mainHistoryMenu .item").tab({history:!1}),r=!1},t.refreshCurrentTab=function(){var e=!1===t.currentUser.profile.macro_permissions.cdr.permissions.ad_cdr.value&&$("#switchboardContent").hasClass("active"),a=!1===t.currentUser.profile.macro_permissions.cdr.permissions.group_cdr.value&&$("#groupContent").hasClass("active");(e||a)&&$("#personalItem").click()},t.$on("userInfoUpdated",function(){r&&t.refreshCurrentTab()}),t.$on("deletedVoicemail",function(e,a){t.getAllVoicemail()}),t.$on("socketAutheOK",function(e,a){t.getAllHistoryPersonal({from:"",to:"",term:""})}),t.$on("serverReloaded",function(e,a){t.getAllHistoryPersonal({from:"",to:"",term:""}),r=!0})}]),angular.module("nethctiUiApp").controller("QueuesCtrl",["$rootScope","$scope","LocalStorageService","PhoneService","JanusService","QueueService","WebsocketService","NgTableParams",function(e,t,a,n,i,s,o,r){function l(e,t){return Promise.all(e).then(function(e){t&&t()})}t.queues={},t.tableConnected={},t.tableWait={},t.qTableContainersH={},t.viewLoad=!0,t.showTopAccordion=!1,t.queuesFilter={text:""},t.queuesStatus={inNumQueues:0,inLoggedQueues:0,inPausedQueues:0},t.updateTableContainersH=function(e){t.qTableContainersH=e},t.isUserIntoQueue=function(e){return!!e.members[t.currentUser.endpoints.mainextension[0].id]},t.call=function(e){if("physical"===t.currentUser.default_device.type){var a=t.currentUser.default_device.id;n.call({number:e,endpointId:a,endpointType:"extension"}).then(function(e){},function(e){console.error(e)})}else{var s=t.getEchoCancellationOpt();i.call("sip:"+e+"@"+customConfig.BASE_HOST_URL,s)}},t.queueLoginAll=function(){var e=t.currentUser.endpoints.mainextension[0].id,a=[];for(var n in t.queues){var i=t.queues[n];for(var s in i.members){if(s===e)i.members[s].loggedIn||a.push(t.queueLogin(e,n))}}l(a)},t.queueLogoutAll=function(){var e=t.currentUser.endpoints.mainextension[0].id,a=[];for(var n in t.queues){var i=t.queues[n];for(var s in i.members){if(s===e)i.members[s].loggedIn&&a.push(t.queueLogout(e,n))}}l(a)},t.queueLogin=function(e,a){s.login({endpointId:e,queueId:a}).then(function(n){t.checkQAutoPausePresenceSingle(e,a),t.checkWarnOnDnd()},function(e){console.error(e)})},t.queueLogout=function(e,a){t.queueUnpause(e,a,function(){s.logout({endpointId:e,queueId:a}).then(function(e){},function(e){console.error(e)})})},t.queueUnpause=function(e,a,n){t.queues[a].members[e].paused?s.unpause({endpointId:e,queueId:a}).then(function(e){g(),n&&n()},function(e){console.error(e)}):n&&n()},t.checkQAutoPausePresenceSingle=function(e,a){try{t.currentUser.settings.queue_auto_pause_onpresence&&-1!==t.currentUser.settings.queue_autopause_presencelist.indexOf(t.currentUser.presence)&&t.queuePause(e,a,"")}catch(e){console.error(e)}},t.checkWarnOnDnd=function(){t.currentUser.settings.queue_auto_pause_onpresence||"dnd"!==t.currentUser.presence||$("#warn-queue-login-ondnd").modal("is active")||$("#warn-queue-login-ondnd").modal("show")},t.hideWarnOnDnd=function(){$("#warn-queue-login-ondnd").modal("hide")},t.queueUnpauseAll=function(e){var a=[],n=t.currentUser.endpoints.mainextension[0].id;for(var i in t.queues){var s=t.queues[i];for(var o in s.members){if(o===n)s.members[o].paused&&a.push(t.queueUnpause(o,i))}}l(a,function(){g(),e&&e()})},t.isOnlyStaticAgent=function(){for(var e in t.queues)for(var a in t.queues[e].members)if(a===t.currentUser.endpoints.mainextension[0].id&&"dynamic"===t.queues[e].members[a].type)return!1;return!0},t.isAtLeastInOneQueue=function(){var e=!1;for(var a in t.queues)e=e||t.isInQueue(a);return e},t.isInQueue=function(e){return Object.keys(t.queues[e].members).indexOf(t.currentUser.endpoints.mainextension[0].id)>-1};var c=function(){for(var e in t.queuesStatus.inNumQueues=0,t.queuesStatus.inLoggedQueues=0,t.queuesStatus.inPausedQueues=0,t.queues)t.isInQueue(e)&&t.queues[e].members[t.currentUser.endpoints.mainextension[0].id]&&"dynamic"==t.queues[e].members[t.currentUser.endpoints.mainextension[0].id].type?(t.queuesStatus.inNumQueues++,t.queues[e].members[t.currentUser.endpoints.mainextension[0].id]&&t.queues[e].members[t.currentUser.endpoints.mainextension[0].id].loggedIn&&t.queuesStatus.inLoggedQueues++):t.isInQueue(e)&&t.queues[e].members[t.currentUser.endpoints.mainextension[0].id]&&"static"==t.queues[e].members[t.currentUser.endpoints.mainextension[0].id].type&&t.queuesStatus.inNumQueues++,t.isInQueue(e)&&t.queues[e].members[t.currentUser.endpoints.mainextension[0].id]&&t.queues[e].members[t.currentUser.endpoints.mainextension[0].id].paused&&t.queuesStatus.inPausedQueues++},d=function(e){for(var a in t.queues[e].agents=0,t.queues[e].members){var n=t.queues[e].members[a];n.loggedIn&&!n.paused&&t.queues[e].agents++}},u=function(e,t){for(var a in t)if(Object.keys(e[t[a].id].conversations).length>0?t[a].conversations=[e[t[a].id].conversations[Object.keys(e[t[a].id].conversations)[0]]]:delete t[a].conversations,t[a]&&t[a].conversations&&t[a].conversations.length>0&&t[a].conversations[0].throughQueue&&t[a].conversations[0].connected)return[t[a]]},p=function(e,a){var n=[];for(var i in a.waitingCallers)a.waitingCallers[i].position=parseInt(a.waitingCallers[i].position),n.push(a.waitingCallers[i]);var s=new r({page:1,count:n.length,sorting:{position:"asc"}},{counts:[],data:n});t.tableWait[e]=s},m=function(e){if(t.queues[e]){var a=[];for(var n in t.queues[e].members)if(t.allExtensions[n]&&t.allExtensions[n].username){var i={member:t.queues[e].members[n],conversation:u(t.allExtensions,t.allUsers[t.allExtensions[n].username].endpoints.extension)||void 0};i.conversation&&i.conversation[0].conversations[0].throughQueue&&i.conversation[0].conversations[0].connected&&i.conversation[0].conversations[0].queueId==e&&(i.conversation=i.conversation[0].conversations[0],a.push(i))}var s=new r({page:1,count:20,sorting:{date:"asc"}},{counts:[],data:a});t.tableConnected[e]=s}};t.getStatusOfUser=function(e){var a=[];for(var n in e)t.allExtensions[e[n].id]&&a.push(t.allExtensions[e[n].id].status);return a.indexOf("busy")>-1?"busy":a.indexOf("busy_ringing")>-1?"busy_ringing":a.indexOf("ringing")>-1?"ringing":a.indexOf("onhold")>-1?"onhold":a.indexOf("online")>-1?"online":"offline"},t.hideModalRecallConfirm=function(e){$("#recall-confirm-dialog").modal("hide")};var g=function(){angular.element(document).ready(function(){$(".qgraphic-container .ui.dropdown").dropdown(),$(".qgraphic-container .menu .item").tab()})},f=function(){t.viewLoad=!0,s.allQueues().then(function(e){for(var n in t.queues=e.data,t.viewLoad=!1,t.queues)m(n),p(n,t.queues[n]),d(n);c(),t.qTableContainersH=a.get("containersHeightQueues")||{},g()},function(e){t.viewLoad=!1,console.error(e)})};f();var v=function(e){try{if(function(){for(var a in t.queues)for(var n in t.queues[a].members)if(t.allUsers[e.username]&&t.allUsers[e.username].endpoints&&t.allUsers[e.username].endpoints.mainextension[0]&&t.allUsers[e.username].endpoints.mainextension[0].id&&n===t.allUsers[e.username].endpoints.mainextension[0].id)return void m(a)}(),e.conversations[Object.keys(e.conversations)[0]]&&e.conversations[Object.keys(e.conversations)[0]].throughQueue&&e.conversations[Object.keys(e.conversations)[0]].connected){var a=e.conversations[Object.keys(e.conversations)[0]].queueId||void 0;m(a),t.$apply()}if(t.allUsers[e.username]&&t.allUsers[e.username].endpoints.extension){for(var n in t.allUsers[e.username].endpoints.extension)t.allUsers[e.username].endpoints.extension[n].id==e.exten&&(t.allUsers[e.username].endpoints.extension[n].status=e.status,t.allUsers[e.username].endpoints.extension[n].conversations=Object.keys(e.conversations).map(function(t){return e.conversations[t]}));t.allUsers[e.username].status=t.getStatusOfUser(t.allUsers[e.username].endpoints.extension)}}catch(e){console.error(e.stack)}};o.on("extenUpdate",v);var h=function(e){t.queues[e.queue]&&(t.queues[e.queue].members[e.member]=e,d(e.queue),m(e.queue),c(),t.$apply())};o.on("queueMemberUpdate",h);var b=function(e){t.queues[e.queue]&&(t.queues[e.queue].members=e.members,p(e.queue,e),m(e.queue),t.$apply())};o.on("queueUpdate",b),t.$on("socketAutheOK",function(e,a){t.getQueues()}),t.$on("serverReloaded",function(e,t){f()}),t.$on("$destroy",function(){o.off("queueUpdate",b),o.off("queueMemberUpdate",h),o.off("extenUpdate",v)})}]),angular.module("nethctiUiApp").controller("QManagerCtrl",["$rootScope","$scope","$q","$filter","$location","LocalStorageService","QManagerService","NgTableParams","WebsocketService","PhoneService",function(e,t,a,n,i,s,o,r,l,c){t.queues={},t.tableWait={},t.tableConnected={},t.viewLoad=!0,t.pie,t.pieData=[],t.currentPieView,t.realTimeAgents={},t.summaryAgents={},t.intervalUpdateRealtimeTab,t.intervalUpdateQStats,t.intervalUpdateQSummary,t.intervalUpdateDashboard,t.UPDATE_QSUMMARY_INTERVAL=12e4,t.UPDATE_QSTATS_INTERVAL=3e4,t.UPDATE_QSTATSAGENTS_INTERVAL=3e4,t.UPDATE_DASHBOARD_INTERVAL=12e4,t.data={viewLoad:!0,loadingIcons:{},rtqdropdown:{},rtqdropdownsummary:{},hsQueuesVal:{},hsMonitorQueues:{},monitorInverted:{},noSummaryCalls:!0,queueLastTab:"",qmanagerLastTab:"",monitorRowsValue:10},t.PIE_COLORS={RED:"#cb2121",GREEN:"#1ee67b",GRAY:"#999999"},t.acounters={},t.rcounters={},t.realtimeCharts={calls:{},agents:{}},t.colorArray=["#FF3336","#4E97D3","#57BD54","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#b34d4d","#80b300","#809900","#e6b3b3","#6680b3","#66991a","#ff99e6","#ccff1a","#ff1a66","#e6331a","#33ffcc","#66994d","#b366cc","#4d8000","#b33300","#cc80cc","#66664d","#991aff","#e666ff","#4db3ff","#1ab399","#e666b3","#33991a","#cc9999","#b3b31a","#00e680","#4d8066","#809980","#e6ff80","#1aff33","#999933","#ff3380","#cccc00","#66e64d","#4d80cc","#9900b3","#e64d66","#4db380","#ff4d4d","#99e6e6","#6666ff"],t.recallLimit=5,t.convertHex=function(e,t){e=e.replace("#","");return"rgba("+parseInt(e.substring(0,2),16)+","+parseInt(e.substring(2,4),16)+","+parseInt(e.substring(4,6),16)+","+t/100+")"},t.initQueuesGraphics=function(){$(".menu .item").tab(),setTimeout(function(){$(".ui.qman-dropdown").dropdown({transition:"none"})},100)},t.initRealtimeGraphics=function(){setTimeout(function(){$("#qm-accordion-queues").accordion({collapsible:!0,animate:!1,active:!0===s.get("qmRealtimeAccordionQueues")||""===s.get("qmRealtimeAccordionQueues")?0:1,activate:function(e,a){var n=$(this).accordion("option","active");s.set("qmRealtimeAccordionQueues",!1!==n),t.updateRealtimeCharts()}}),$("#qm-accordion-agents").accordion({collapsible:!0,animate:!1,active:!0===s.get("qmRealtimeAccordionAgents")||""===s.get("qmRealtimeAccordionAgents")?0:1,activate:function(e,t){var a=$(this).accordion("option","active");s.set("qmRealtimeAccordionAgents",!1!==a)}})},100),t.stopQStatsAgentsInterval(),t.intervalUpdateQstatsAgents=setInterval(function(){t.updateFromLast()},t.UPDATE_QSTATSAGENTS_INTERVAL),t.stopIntervalUpdateRealtimeTab(),t.updateRealtimeTab(),t.intervalUpdateRealtimeTab=setInterval(function(){"realtime"===t.data.qmanagerLastTab?t.updateRealtimeTab():t.stopIntervalUpdateRealtimeTab()},5e3)};var d=function(){t.$$phase||t.$apply()};t.stopIntervalUpdateRealtimeTab=function(){clearInterval(t.intervalUpdateRealtimeTab)},t.initSummaryGraphics=function(){setTimeout(function(){$("#qm-accordion-queues-summary").accordion({collapsible:!0,animate:!1,active:!0===s.get("qmSummaryAccordionQueues")||""===s.get("qmSummaryAccordionQueues")?0:1,activate:function(e,t){var a=$(this).accordion("option","active");s.set("qmSummaryAccordionQueues",!1!==a)}}),$("#qm-accordion-agents-summary").accordion({collapsible:!0,animate:!1,active:!0===s.get("qmRealtimeAccordionAgents")||""===s.get("qmRealtimeAccordionAgents")?0:1,activate:function(e,t){var a=$(this).accordion("option","active");s.set("qmRealtimeAccordionAgents",!1!==a)}})},100);var e=s.get("hsQueues");e&&(t.data.hsQueuesVal=e),t.updateSummaryStats(),t.stopUpdatingSummary(),t.intervalUpdateQSummary=setInterval(function(){t.updateSummaryTab()},t.UPDATE_QSUMMARY_INTERVAL)},t.updateQueuesTab=function(e){var a=Object.keys(e.data);""!==t.data.queueLastTab&&-1===a.indexOf(t.data.queueLastTab)&&(s.remove("qmanager-queue-last-tab"),t.data.queueLastTab=""),""===t.data.queueLastTab&&(t.data.queueLastTab=Object.keys(e.data)[0]),t.queues=e.data,t.updateQueueCalls(),t.updateAgentsStatus(),t.viewLoad&&t.initQueueStats(),t.updateAgentsCounters(),t.viewLoad=!1},t.getQueues=function(){o.getQueues().then(function(a){e.QManagerQueues=a.data,t.queues=a.data,"queues"===t.data.qmanagerLastTab?t.updateQueuesTab(a):"realtime"===t.data.qmanagerLastTab?t.updateRealtimeTab():"summary"===t.data.qmanagerLastTab?t.updateSummaryTab():"monitor"===t.data.qmanagerLastTab?t.updateMonitorTab():"dashboard"===t.data.qmanagerLastTab&&t.updateDashboardTab()},function(e){console.error(e)})},t.toggleDropUpQueue=function(e,a){t.data.rtqdropdown[e+a]=!t.data.rtqdropdown[e+a];var n="",i=[];n=s.get("rtqdropdown"),1==t.data.rtqdropdown[e+a]?(n=(n=""!=n?n+","+e+a:e+a).split(","),$.each(n,function(e,t){-1===$.inArray(t,i)&&i.push(t)}),n=(n=i).toString(),s.set("rtqdropdown",n)):(n=(n=(n=(n=n.replace(","+e+a,"")).replace(e+a+",","")).replace(e+a,"")).split(","),$.each(n,function(e,t){-1===$.inArray(t,i)&&i.push(t)}),n=(n=i).toString(),s.set("rtqdropdown",n))},t.toggleDropUpQueueSummary=function(e,a){t.data.rtqdropdownsummary[e+a]=!t.data.rtqdropdownsummary[e+a];var n="",i=[];n=s.get("rtqdropdownsummary"),1==t.data.rtqdropdownsummary[e+a]?(n=(n=""!=n?n+","+e+a:e+a).split(","),$.each(n,function(e,t){-1===$.inArray(t,i)&&i.push(t)}),n=(n=i).toString(),s.set("rtqdropdownsummary",n)):(n=(n=(n=(n=n.replace(","+e+a,"")).replace(e+a+",","")).replace(e+a,"")).split(","),$.each(n,function(e,t){-1===$.inArray(t,i)&&i.push(t)}),n=(n=i).toString(),s.set("rtqdropdownsummary",n))},t.extend=function(e,t){return Object.keys(t).forEach(function(t){e[t]||(e[t]={})}),e},t.getMaxOfArray=function(e){return Math.max.apply(null,e)},t.timeDifference=function(e,t){var a=e-t,n=Math.floor(a/1e3/60/60);a-=1e3*n*60*60;var i=Math.floor(a/1e3/60);a-=1e3*i*60;var s=Math.floor(a),o="";return s=(s=s.toString()).slice(0,-3),s=parseInt(s),n&&(o+=n+"h "),i&&(o+=i+"' "),s&&(o+=s+"'' "),o},t.updateFromLastPause=function(e,a,n){if("realtime"==n){var i=1e3*t.realTimeAgents[e].queues[a].stats.last_unpaused_time,s=t.timeDifference(Date.now(),i);t.realTimeAgents[e].queues[a].stats.from_last_pause=s,setTimeout(function(){t.$apply()},100)}else if("summary"==n){i=1e3*t.summaryAgents[e].queues[a].stats.last_unpaused_time,s=t.timeDifference(Date.now(),i);t.summaryAgents[e].queues[a].stats.from_last_pause=s,setTimeout(function(){t.$apply()},100)}},t.updateFromLastCall=function(e,a,n){if("realtime"==n){var i=1e3*t.realTimeAgents[e].queues[a].stats.last_call_time,s=t.timeDifference(Date.now(),i);t.realTimeAgents[e].queues[a].stats.from_last_call=s,setTimeout(function(){t.$apply()},100)}else if("summary"==n){i=1e3*t.getMaxOfArray(t.lastCallsSummaryStats),s=t.timeDifference(Date.now(),i);t.summaryAgents[e].from_last_call=s,setTimeout(function(){t.$apply()},100)}},t.updateFromLast=function(){for(var e in t.realTimeAgents)for(var a in t.realTimeAgents[e].queues)t.realTimeAgents[e].queues[a].stats&&(t.realTimeAgents[e].queues[a].stats.last_unpaused_time&&t.updateFromLastPause(e,a,"realtime"),t.realTimeAgents[e].queues[a].stats.last_call_time&&t.updateFromLastCall(e,a,"realtime"))},t.updateFromLastSummary=function(){for(var e in t.summaryAgents)for(var a in t.summaryAgents[e].queues)t.summaryAgents[e].queues[a].stats&&(t.summaryAgents[e].queues[a].stats.last_unpaused_time&&t.updateFromLastPause(e,a,"summary"),t.summaryAgents[e].queues[a].stats.last_call_time&&t.updateFromLastCall(e,a,"summary"))},t.getRealTimeAgents=function(){for(var e in t.queues)t.extend(t.realTimeAgents,t.queues[e].members);o.getAgentsStats().then(function(e){for(var a in t.agentsRealTimeStats=e.data,t.realTimeAgents){t.realTimeAgents[a].queues={},t.realTimeAgents[a].answeredcalls=0,t.realTimeAgents[a].lastcall=0;var n=[];for(var i in t.queues)t.queues[i].members[a]&&(t.realTimeAgents[a].queues[i]=t.queues[i].members[a],t.realTimeAgents[a].queues[i].qname=t.queues[i].name,t.realTimeAgents[a].name=t.queues[i].members[a].name,t.realTimeAgents[a].member=t.queues[i].members[a].member);for(var s in t.agentsRealTimeStats[t.realTimeAgents[a].name])t.realTimeAgents[a].queues[s]&&(t.realTimeAgents[a].queues[s].stats=t.agentsRealTimeStats[t.realTimeAgents[a].name][s],t.realTimeAgents[a].queues[s].stats.calls_taken&&(t.realTimeAgents[a].answeredcalls+=t.realTimeAgents[a].queues[s].stats.calls_taken),t.realTimeAgents[a].queues[s].stats.last_call_time&&(n.push(t.realTimeAgents[a].queues[s].stats.last_call_time),t.realTimeAgents[a].lastcall=t.getMaxOfArray(n)),t.realTimeAgents[a].queues[s].stats.last_unpaused_time&&t.updateFromLastPause(a,s,"realtime"),t.realTimeAgents[a].queues[s].stats.last_call_time&&t.updateFromLastCall(a,s,"realtime"))}},function(e){console.error(e)})},t.stopQStatsAgentsInterval=function(){clearInterval(t.intervalUpdateQstatsAgents)},t.getSummaryAgents=function(){for(var e in t.queues)t.extend(t.summaryAgents,t.queues[e].members);o.getAgentsStats().then(function(e){for(var a in t.agentsSummaryStats=e.data,t.summaryAgents){t.summaryAgents[a].queues={},t.summaryAgents[a].answeredcalls=0,t.summaryAgents[a].no_answer_calls=0,t.summaryAgents[a].lastcall=0,t.lastCallsSummaryStats=[];var n=[],i=[];for(var s in t.queues)t.queues[s].members[a]&&(t.summaryAgents[a].queues[s]=t.queues[s].members[a],t.summaryAgents[a].queues[s].qname=t.queues[s].name,t.summaryAgents[a].name=t.queues[s].members[a].name,t.summaryAgents[a].member=t.queues[s].members[a].member);for(var o in t.agentsSummaryStats[t.summaryAgents[a].name])t.summaryAgents[a].queues[o]&&(t.summaryAgents[a].queues[o].stats=t.agentsSummaryStats[t.summaryAgents[a].name][o],t.summaryAgents[a].queues[o].stats.no_answer_calls&&(t.summaryAgents[a].no_answer_calls+=t.summaryAgents[a].queues[o].stats.no_answer_calls),t.summaryAgents[a].queues[o].stats.calls_taken&&(t.summaryAgents[a].answeredcalls+=t.summaryAgents[a].queues[o].stats.calls_taken),t.summaryAgents[a].queues[o].stats.last_logout_time&&(i.push(t.summaryAgents[a].queues[o].stats.last_logout_time),t.summaryAgents[a].lastlogout=t.getMaxOfArray(i)),t.summaryAgents[a].queues[o].stats.last_login_time&&(n.push(t.summaryAgents[a].queues[o].stats.last_login_time),t.summaryAgents[a].lastlogin=t.getMaxOfArray(n)),t.summaryAgents[a].queues[o].stats.last_call_time&&(t.lastCallsSummaryStats.push(t.summaryAgents[a].queues[o].stats.last_call_time),t.updateFromLastCall(a,o,"summary")))}t.updateSummaryBarChart(t.queues,"recalltime",e.data)},function(e){console.error(e)})},t.loginAllQueues=function(e,a){for(var n in t.data.loadingIcons[a]={},t.data.loadingIcons[a].login=!0,e)e[n].loggedIn||"static"==e[n].type?t.data.loadingIcons[a].login=!1:o.addUserQueue({endpointId:a,queueId:n}).then(function(e){t.data.loadingIcons[a].login=!1,t.getQueues()},function(e){t.data.loadingIcons[a].login=!1,console.error(e)})},t.logoutAllQueues=function(e,a){for(var n in t.data.loadingIcons[a]={},t.data.loadingIcons[a].logout=!0,e)e[n].loggedIn&&"static"!=e[n].type?o.removeUserQueue({endpointId:a,queueId:n}).then(function(e){t.data.loadingIcons[a].logout=!1,t.getQueues()},function(e){t.data.loadingIcons[a].logout=!1,console.error(e)}):t.data.loadingIcons[a].logout=!1},t.pauseAllQueues=function(e,a){for(var n in t.data.loadingIcons[a]={},t.data.loadingIcons[a].pause=!0,e)e[n].loggedIn&&!e[n].paused?o.pauseUserQueue({endpointId:a,queueId:n}).then(function(e){t.data.loadingIcons[a].pause=!1,t.getQueues()},function(e){t.data.loadingIcons[a].pause=!1,console.error(e)}):t.data.loadingIcons[a].pause=!1},t.unpauseAllQueues=function(e,a){for(var n in t.data.loadingIcons[a]={},t.data.loadingIcons[a].unpause=!0,e)e[n].loggedIn&&e[n].paused?o.unpauseUserQueue({endpointId:a,queueId:n}).then(function(e){t.data.loadingIcons[a].unpause=!1,t.getQueues()},function(e){t.data.loadingIcons[a].unpause=!1,console.error(e)}):t.data.loadingIcons[a].unpause=!1},t.isDisconnectedQueue=function(e){for(var t in e)if(!e[t].loggedIn)return!0;return!1},t.isConnectedQueue=function(e){for(var t in e)if(e[t].loggedIn&&"dynamic"==e[t].type)return!0;return!1},t.isDynamicInQueue=function(e){for(var t in e)if("dynamic"==e[t].type)return!0;return!1},t.isPausedInQueue=function(e){for(var t in e)if(e[t].paused&&e[t].loggedIn)return!0;return!1},t.isUnpausedInQueue=function(e){for(var t in e)if(!e[t].paused&&e[t].loggedIn)return!0;return!1},t.updateRealtimeCounters=function(){for(var e in t.rcounters.counters=void 0,t.rcounters.counters={},t.queues)t.rcounters.counters[e]={total:0,waiting:0,connected:0,online:0,offline:0,paused:0,busy:0,free:0};for(var e in t.rcounters.tot=0,t.rcounters.waiting=0,t.rcounters.connected=0,t.rcounters.online=0,t.rcounters.offline=0,t.rcounters.paused=0,t.rcounters.busy=0,t.rcounters.free=0,t.queues)for(var a in t.rcounters.waiting+=Object.keys(t.queues[e].waitingCallers).length,t.rcounters.counters[e].waiting=Object.keys(t.queues[e].waitingCallers).length,t.queues[e].members)!0===t.queues[e].members[a].loggedIn?(t.rcounters.online+=1,t.rcounters.counters[e].online+=1):(t.rcounters.offline+=1,t.rcounters.counters[e].offline+=1),!0===t.queues[e].members[a].paused&&(t.rcounters.paused+=1,t.rcounters.counters[e].paused+=1),Object.keys(t.allExtensions[a].conversations).length>0&&!0===t.allExtensions[a].conversations[Object.keys(t.allExtensions[a].conversations)[0]].connected?(t.rcounters.busy+=1,t.rcounters.counters[e].busy+=1):!1===t.queues[e].members[a].paused&&!0===t.queues[e].members[a].loggedIn&&(t.rcounters.free+=1,t.rcounters.counters[e].free+=1);for(var n in t.allExtensions)for(var i in t.allExtensions[n].conversations)!0===t.allExtensions[n].conversations[i].connected&&!0===t.allExtensions[n].conversations[i].throughQueue&&void 0!==t.queues[t.allExtensions[n].conversations[i].queueId]&&(t.rcounters.connected+=1,t.rcounters.counters[t.allExtensions[n].conversations[i].queueId].connected+=1);for(var e in t.rcounters.tot+=t.rcounters.waiting+t.rcounters.connected,t.rcounters.counters)t.rcounters.counters[e].total=t.rcounters.counters[e].waiting+t.rcounters.counters[e].connected},t.updateRealtimeCharts=function(){t.updateRealtimeQueuesCharts(),t.updateRealtimeAgentsCharts()},t.updateRealtimeAgentsCharts=function(){if("/qmanager"===i.url())for(var e in t.queues){void 0!==t.realtimeCharts.agents[e]&&(d3.select("realtime-agents-chart-"+e).remove(),$("#qm-realtime-chart-agents-"+e).empty(),t.realtimeCharts.agents[e]=void 0);for(var a={labels:[n("translate")("Online_"),n("translate")("Offline_"),n("translate")("Paused"),n("translate")("Busy_"),n("translate")("Free_")],series:[{label:n("translate")(""),values:[t.rcounters.counters[e].online,t.rcounters.counters[e].offline,t.rcounters.counters[e].paused,t.rcounters.counters[e].busy,t.rcounters.counters[e].free]}]},s=25*a.series.length,o=[],r=0;r<a.labels.length;r++)for(var l=0;l<a.series.length;l++)o.push(a.series[l].values[r]);var c=["#21BA45","#E8E8E8","#FBBD08","#DB2828","#21BA45"],d=25*o.length+5*a.labels.length,u=d3.scaleLinear().domain([0,d3.max(o)]).range([0,180]),p=d3.scaleLinear().range([d+5,0]),m=d3.axisLeft(p).tickFormat("").scale(p).tickSize(0);t.realtimeCharts.agents[e]=d3.select("#qm-realtime-chart-agents-"+e).append("svg").attr("id","realtime-agents-chart-"+e).attr("class","chart timing-chart").attr("width",340).attr("height",d);var g=t.realtimeCharts.agents[e].selectAll("g").data(o).enter().append("g").attr("transform",function(e,t){return"translate(100,"+(25*t+5*(.5+Math.floor(t/a.series.length)))+")"});g.append("rect").attr("fill",function(e,t){return c[t]}).attr("class","bar").attr("width",u).attr("height",24),g.append("text").attr("x",function(e,t){return u(e)+10}).attr("dx",".8em").style("text-anchor","middle").attr("y",12.5).attr("fill","red").attr("dy",".35em").attr("class","label").text(function(e){return e}),g.append("text").attr("class","label").attr("x",function(e){return-10}).attr("y",s/2).attr("dy",".35em").text(function(e,t){return t%a.series.length==0?a.labels[Math.floor(t/a.series.length)]:""}),t.realtimeCharts.agents[e].append("g").attr("class","y axis").attr("transform","translate(100, -2.5)").call(m),$("#realtime-agents-chart-"+e).length>0&&t.responsivefy(d3.select("#realtime-agents-chart-"+e))}},t.responsivefy=function(e){var a=d3.select(e.node().parentNode),n=parseInt(e.style("width")),i=parseInt(e.style("height")),s=n/i;e.attr("viewBox","0 0 "+n+" "+i).attr("perserveAspectRatio","xMinYMid").call(function(){t.resize(a,e,s)}),d3.select(window).on("resize."+a.attr("id"),function(){t.resize(a,e,s)})},t.resize=function(e,t,a){var n=parseInt(e.style("width"));n&&(t.attr("width",n),t.attr("height",Math.round(n/a)))},t.updateRealtimeQueuesCharts=function(){if("/qmanager"===i.url())for(var e in t.queues){void 0!==t.realtimeCharts.calls[e]&&(d3.select("realtime-calls-chart-"+e).remove(),$("#qm-realtime-chart-calls-"+e).empty(),t.realtimeCharts.calls[e]=void 0);for(var a={labels:[n("translate")("Totals"),n("translate")("Waiting"),n("translate")("Connected")],series:[{label:n("translate")(""),values:[t.rcounters.counters[e].total,t.rcounters.counters[e].waiting,t.rcounters.counters[e].connected]}]},s=25*a.series.length,o=[],r=0;r<a.labels.length;r++)for(var l=0;l<a.series.length;l++)o.push(a.series[l].values[r]);var c=["#E8E8E8","#d01919","#1678c2"],d=25*o.length+5*a.labels.length,u=d3.scaleLinear().domain([0,d3.max(o)]).range([0,180]),p=d3.scaleLinear().range([d+5,0]),m=d3.axisLeft(p).tickFormat("").scale(p).tickSize(0);t.realtimeCharts.calls[e]=d3.select("#qm-realtime-chart-calls-"+e).append("svg").attr("id","realtime-calls-chart-"+e).attr("class","chart timing-chart").attr("width",340).attr("height",d);var g=t.realtimeCharts.calls[e].selectAll("g").data(o).enter().append("g").attr("transform",function(e,t){return"translate(100,"+(25*t+5*(.5+Math.floor(t/a.series.length)))+")"});g.append("rect").attr("fill",function(e,t){return c[t]}).attr("class","bar").attr("width",u).attr("height",24),g.append("text").attr("x",function(e,t){return u(e)+10}).attr("dx",".8em").style("text-anchor","middle").attr("y",12.5).attr("fill","red").attr("dy",".35em").attr("class","label").text(function(e){return e}),g.append("text").attr("class","label").attr("x",function(e){return-10}).attr("y",s/2).attr("dy",".35em").text(function(e,t){return t%a.series.length==0?a.labels[Math.floor(t/a.series.length)]:""}),t.realtimeCharts.calls[e].append("g").attr("class","y axis").attr("transform","translate(100, -2.5)").call(m),$("#realtime-calls-chart-"+e).length>0&&t.responsivefy(d3.select("#realtime-calls-chart-"+e))}},t.updateRealtimeTab=function(){t.updateRealtimeCounters(),t.updateRealtimeCharts(),t.updateAgentsStatus(),t.getRealTimeAgents()},t.updateSummaryTab=function(){t.getSummaryAgents(),t.updateSummaryStats(),t.updateAgentsStatus()},t.changeFilter=function(){s.set("qmanFilter",t.data.filterAgentsStatsType)},t.changeFilterSummary=function(){s.set("summaryAgentsFilter",t.data.filterSummaryAgentsStatsType)},t.updateQueuesTab=function(e){var a=Object.keys(e.data);""!==t.data.queueLastTab&&-1===a.indexOf(t.data.queueLastTab)&&(s.remove("qmanager-queue-last-tab"),t.data.queueLastTab=""),""===t.data.queueLastTab&&(t.data.queueLastTab=Object.keys(e.data)[0]),t.updateQueueCalls(),t.updateAgentsStatus(),t.viewLoad&&t.initQueueStats(),t.updateAgentsCounters(),t.viewLoad=!1},t.blindTransferQueue=function(e){o.blindTransferQueue({queue:t.data.queueLastTab,waitingCallerId:t.channelToDrag,to:e}).then(function(e){t.updateQueueCalls(t.data.queueLastTab)},function(e){console.error(e)})},t.dropped=function(e){$("#"+e.target.id).css("border-color","#21BA45"),setTimeout(function(){$("#"+e.target.id).css("border-width","0px")},500),t.blindTransferQueue(e.target.getAttribute("data-qnum"))},t.dropOver=function(e){$("#"+e.target.id).css("border-color","#DB2828"),$("#"+e.target.id).css("border-width","2px"),$("#"+e.target.id).css("border-style","dashed")},t.dropOverClass=function(e){$("."+e.target.classList[0]).css("border-color","#DB2828"),$("."+e.target.classList[0]).css("border-width","2px"),$("."+e.target.classList[0]).css("border-style","dashed")},t.dropOut=function(e){$("#"+e.target.id).css("border-width","0px")},t.dropOutClass=function(e){$("."+e.target.classList[0]).css("border-width","0px")},t.startDrag=function(e){t.channelToDrag=e.target.id},t.updateAgentsCounters=function(){for(var e in t.queues)for(var a in t.acounters[e]||(t.acounters[e]={}),t.acounters[e].online=0,t.acounters[e].offline=0,t.acounters[e].paused=0,t.acounters[e].connected=0,t.acounters[e].free=0,t.acounters[e].busy=0,t.queues[e].members){if(t.queues[e].members[a].loggedIn?t.acounters[e].online+=1:t.acounters[e].offline+=1,t.queues[e].members[a].paused&&(t.acounters[e].paused+=1),t.allExtensions[a]&&Object.keys(t.allExtensions[a].conversations).length>0)for(var n in t.allExtensions[a].conversations)t.allExtensions[a].conversations[n].throughQueue&&t.allExtensions[a].conversations[n].queueId===e&&t.allExtensions[a].conversations[n].connected?t.acounters[e].connected+=1:t.allExtensions[a].conversations[n].queueId!==e&&t.allExtensions[a].conversations[n].connected&&(t.acounters[e].busy+=1);t.allExtensions[a]&&"online"===t.allExtensions[a].status&&""===t.allExtensions[a].cf&&!1===t.allExtensions[a].dnd&&!0===t.queues[e].members[a].loggedIn&&!1===t.queues[e].members[a].paused&&(t.acounters[e].free+=1)}},t.updateQueueCalls=function(e){for(var a in t.queues)t.updateConnectedCalls(a),t.updateWaitCalls(a,t.queues[a])},t.clickedQueueTab=function(e){t.data.queueLastTab=e,s.set("qmanager-queue-last-tab",e),t.initQueueStats()},t.gotoQueueTab=function(e){t.clickedQueueTab(e),$(".user-queues-list div").removeClass("active")},t.clickedQManagerTab=function(e){t.data.qmanagerLastTab=e,$(window).off("resize"),s.set("qmanager-last-tab",t.data.qmanagerLastTab),t.stopQueueStatsUpdate(),t.stopQStatsAgentsInterval(),t.stopUpdatingSummary(),t.stopDashboardInterval(),t.viewLoad=!0,t.getQueues(),"queues"===e?t.initQueuesGraphics():"realtime"===e?t.initRealtimeGraphics():"summary"===e&&t.initSummaryGraphics()},t.updateWaitCalls=function(e,a){var n=[];for(var i in a.waitingCallers)n.push(a.waitingCallers[i]);var s=new r({page:1,count:20,sorting:{position:"asc"}},{counts:[],data:n});t.tableWait[e]=s},t.updateConnectedCalls=function(e){var a=[];for(var n in t.queues[e].members)if(t.allExtensions[n]&&t.allExtensions[n].username){var i={member:t.queues[e].members[n],conversation:t.ccFilterEndpoints(t.allExtensions,t.allUsers[t.allExtensions[n].username].endpoints.extension)||void 0};i.conversation&&i.conversation[0].conversations[0].throughQueue&&i.conversation[0].conversations[0].connected&&i.conversation[0].conversations[0].queueId==e&&(i.conversation=i.conversation[0].conversations[0],a.push(i))}var s=new r({page:1,count:20,sorting:{date:"asc"}},{counts:[],data:a});t.tableConnected[e]=s},t.ccFilterEndpoints=function(e,t){for(var a in t)if(Object.keys(e[t[a].id].conversations).length>0?t[a].conversations=[e[t[a].id].conversations[Object.keys(e[t[a].id].conversations)[0]]]:delete t[a].conversations,t[a]&&t[a].conversations&&t[a].conversations.length>0&&t[a].conversations[0].throughQueue&&t[a].conversations[0].connected)return[t[a]]},t.updateTimingChart=function(e,a){void 0!==t.timingChart&&(d3.select(".timing-chart").remove(),$(".container-svg-chart").empty(),t.timingChart=void 0);for(var i=27*(e={labels:[n("translate")("Minimum"),n("translate")("Maximum"),n("translate")("Average")],series:[{label:n("translate")("Waiting calls"),values:[e.min_wait,e.max_wait,e.avg_wait]},{label:n("translate")("Connected calls"),values:[e.min_duration,e.max_duration,e.avg_duration]}]}).series.length,s=[],o=0;o<e.labels.length;o++)for(var r=0;r<e.series.length;r++)s.push(e.series[r].values[o]);var l=["#d01919","#1678c2"],c=27*s.length+10*e.labels.length,d=d3.scaleLinear().domain([0,d3.max(s)]).range([0,280]),u=d3.scaleLinear().range([c+10,0]),p=d3.axisLeft(u).tickFormat("").scale(u).tickSize(0);t.timingChart=d3.select("#container-timing-chart-"+a).append("svg").attr("id","timing-chart-"+a).attr("class","chart timing-chart").attr("width",600).attr("height",c);var m=t.timingChart.selectAll("g").data(s).enter().append("g").attr("transform",function(t,a){return"translate(150,"+(27*a+10*(.5+Math.floor(a/e.series.length)))+")"});m.append("rect").attr("fill",function(t,a){return l[a%e.series.length]}).attr("class","bar").attr("width",d).attr("height",26),m.append("text").attr("x",function(e,t){return d(e)+10}).attr("dx",".8em").style("text-anchor","middle").attr("y",13.5).attr("fill","red").attr("dy",".35em").attr("class","label").text(function(e){return e>60?Math.floor(e/60)+"'"+(e%60==0?"":e%60+'"'):e+'"'}),m.append("text").attr("class","label").attr("x",function(e){return-10}).attr("y",i/2).attr("dy",".35em").text(function(t,a){return a%e.series.length==0?e.labels[Math.floor(a/e.series.length)]:""}),t.timingChart.append("g").attr("class","y axis").attr("transform","translate(150, -5)").call(p);var g=t.timingChart.selectAll(".legend").data(e.series).enter().append("g").attr("transform",function(e,t){return"translate(472,"+(22*t- -5)+")"});g.append("rect").attr("width",18).attr("height",18).style("fill",function(e,t){return l[t]}).style("stroke",function(e,t){return l[t]}),g.append("text").attr("class","legend").attr("x",22).attr("y",14).text(function(e){return e.label}),t.responsivefy(d3.select("#timing-chart-"+a))},t.initQueueStats=function(){t.data.pieLoading=!0,o.getQueueStats(t.data.queueLastTab).then(function(e){t.updateTimingChart(e.data,t.data.queueLastTab),t.currentPieView="generic",t.updateCallPieChart(e.data,t.data.queueLastTab),t.data.pieLoading=!1,t.stopQueueStatsUpdate(),t.startQueueStatsUpdate()},function(e){console.error(e)})},t.getCallPieChartData=function(e){var a,i={text:n("translate")("Total calls")+" ("+e.tot+")",fontSize:21,font:"Lato,'Helvetica Neue',Arial,Helvetica,sans-serif"},s={text:n("translate")("Click on segment to see the details"),color:"#999999",fontSize:16,font:"Lato,'Helvetica Neue',Arial,Helvetica,sans-serif"},o={format:"label-percentage2",hideWhenLessThanPercentage:1};return 0===e.tot_processed&&0===e.tot_null&&0===e.tot_failed?(t.currentPieView,a=[{value:1,color:t.PIE_COLORS.GRAY,label:""}],s.text=n("translate")("No call has been received"),o.format="none"):"generic"===t.currentPieView?a=[{label:n("translate")("tot_processed")+" "+e.tot_processed,value:e.tot_processed,color:t.PIE_COLORS.GREEN},{label:n("translate")("tot_null")+" "+e.tot_null,value:e.tot_null,color:t.PIE_COLORS.GRAY},{label:n("translate")("tot_failed")+" "+e.tot_failed,value:e.tot_failed,color:t.PIE_COLORS.RED}]:"processedDetail"===t.currentPieView?(a=[{label:n("translate")("processed_greater_sla")+" "+e.sla+"s "+e.processed_greater_sla,value:e.processed_greater_sla,color:"#269211"},{label:n("translate")("processed_less_sla")+" "+e.sla+"s "+e.processed_less_sla,value:e.processed_less_sla,color:"#4cdc32"}],i.text=n("translate")("Processed calls")+" ("+e.tot_processed+")",s.text=n("translate")("Click on segment to go back")):"failedDetail"===t.currentPieView&&(a=[{label:n("translate")("failed_inqueue_noagents")+" "+e.failed_inqueue_noagents,value:e.failed_inqueue_noagents,color:"#7a0b03"},{label:n("translate")("failed_withkey")+" "+e.failed_withkey,value:e.failed_withkey,color:"#a51207"},{label:n("translate")("failed_timeout")+" "+e.failed_timeout,value:e.failed_timeout,color:"#cb1b0e"},{label:n("translate")("failed_abandon")+" "+e.failed_abandon,value:e.failed_abandon,color:"#fe4132"},{label:n("translate")("failed_full")+" "+e.failed_full,value:e.failed_full,color:"#fd948d"},{label:n("translate")("failed_outqueue_noagents")+" "+e.failed_outqueue_noagents,value:e.failed_outqueue_noagents,color:"#fdcdca"}],i.text=n("translate")("Failed calls")+" ("+e.tot_failed+")",s.text=n("translate")("Click on segment to go back")),{title:i,subtitle:s,content:a,customInner:o}},t.updateCallPieChart=function(e,a){void 0!==t.pie&&(t.pie.destroy(),t.pie=void 0,$("#pie-"+a).empty());var i=t.getCallPieChartData(e);t.pie=new d3pie("pie-"+a,{header:{title:i.title,subtitle:i.subtitle,titleSubtitlePadding:9},data:{sortOrder:"value-desc",content:i.content},size:{canvasWidth:630,canvasHeight:630,pieInnerRadius:"4%",pieOuterRadius:"90%"},labels:{outer:{format:"none",pieDistance:18},inner:i.customInner,mainLabel:{fontSize:18,color:"#ffffff",font:"Lato,'Helvetica Neue',Arial,Helvetica,sans-serif"},percentage:{color:"#ffffff",fontSize:14,font:"Lato,'Helvetica Neue',Arial,Helvetica,sans-serif",decimalPlaces:0},value:{color:"#ffffff",font:"Lato,'Helvetica Neue',Arial,Helvetica,sans-serif",fontSize:18},lines:{enabled:!0,style:"straight"},truncation:{enabled:!0}},effects:{load:{effect:"none"},pullOutSegmentOnClick:{effect:"none"}},misc:{gradient:{enabled:!0,percentage:100}},callbacks:{onClickSegment:function(i){var s=i.data.label.split(" "),o=s.length>2?s[0]+" "+s[1]:s[0];if((0!==e.tot_processed||0!==e.tot_null||0!==e.tot_failed)&&o!==n("translate")("tot_null")){"failedDetail"===t.currentPieView||"processedDetail"===t.currentPieView?t.currentPieView="generic":o===n("translate")("tot_processed")&&"generic"===t.currentPieView?t.currentPieView="processedDetail":o===n("translate")("tot_failed")&&"generic"===t.currentPieView&&(t.currentPieView="failedDetail");var r=t.getCallPieChartData(e);t.pie.updateProp("header.title.text",r.title.text),t.pie.updateProp("header.subtitle.text",r.subtitle.text),t.pie.updateProp("data.content",r.content),t.responsivefy(d3.select("#pie-"+a+" svg"))}}}}),t.responsivefy(d3.select("#pie-"+a+" svg"))},t.updateQueueStats=function(){o.getQueueStats(t.data.queueLastTab).then(function(e){t.updateTimingChart(e.data,t.data.queueLastTab),t.updateCallPieChart(e.data,t.data.queueLastTab)},function(e){console.error(e)})},t.updateQueueColor=function(e,t){var a={},n=s.get("queuesColors");if(n)a=n;else a={};a[e]=t,s.set("queuesColors",a)},t.getEnteredCallChartData=function(e){var a=[],n=0,i=s.get("queuesColors");for(var o in e){if(i&&i[e[o].queue]){var r=i[e[o].queue];t.updateQueueColor(e[o].queue,r)}else{if(t.colorArray[n])r=t.colorArray[n];else r=t.colorArray[0];t.updateQueueColor(e[o].queue,r)}a.push({label:e[o].name+" "+e[o].qstats.tot,value:parseInt(e[o].qstats.tot),color:r}),n++}var l={format:"label-percentage2",hideWhenLessThanPercentage:1},c=!0;for(n=0;n<a.length;n++)if(0!==a[n].value){c=!1;break}return c&&(l.format="none",a=[{value:1,color:t.PIE_COLORS.GRAY,label:""}]),{title:"",subtitle:"",content:a,customInner:l}},t.getCallsPercData=function(e,t){var a=[],i=[],s=[];for(var o in e){var r=parseInt(e[o].qstats[t])/parseInt(e[o].qstats.tot)*100;(0==r||r==1/0||isNaN(r))&&(r=0),r=Math.round(r),s.push(r),a.push(e[o].name),i.push(e[o].qstats[t])}return{labels:a,percents:s,series:[{label:n("translate")(""),values:i}]}},t.getDurationWaitCallsData=function(e,a){var i=[],s=[],o=[],r=[],l=[],c=[],d=[];for(var u in e)i.push(e[u].name),"waiting"===a?(s.push(e[u].qstats.min_wait),o.push(e[u].qstats.avg_wait),r.push(e[u].qstats.max_wait)):"duration"===a?(s.push(e[u].qstats.min_duration),o.push(e[u].qstats.avg_duration),r.push(e[u].qstats.max_duration)):"failedfirst"===a&&(s.push(e[u].qstats.failed_abandon),o.push(e[u].qstats.failed_full),r.push(e[u].qstats.failed_timeout),l.push(e[u].qstats.failed_inqueue_noagents),c.push(e[u].qstats.failed_outqueue_noagents),d.push(e[u].qstats.failed_withkey));if("failedfirst"===a){var p={labels:i,series:[{label:"failed_abandon",values:s},{label:"failed_full",values:o},{label:"failed_timeout",values:r},{label:"failed_inqueue_noagents",values:l},{label:"failed_outqueue_noagents",values:c},{label:"failed_withkey",values:d}]};for(var m in p.series){var g=0;for(var f in p.series[m].values)p.series[m].values[f]>0&&g++;0==g&&delete p.series[m]}var v={series:[]};for(var h in v.labels=p.labels,p.series)v.series.push(p.series[h]);return v.series.length>0?t.data.failedReasons=!0:t.data.failedReasons=!1,v}return p={labels:i,series:[{label:n("translate")(""),values:s},{label:n("translate")(""),values:o},{label:n("translate")(""),values:r}]}};t.updateSummaryBarChart=function(e,a,i){if("processed"===a){d3.select("container-processed-calls-summary").remove(),$("#container-processed-calls-summary").empty();var o=t.getCallsPercData(e,"tot_processed")}else if("failed"===a){d3.select("container-failed-calls-summary").remove(),$("#container-failed-calls-summary").empty();o=t.getCallsPercData(e,"tot_failed")}else if("processedbslevel"===a){d3.select("container-processedbslevel-calls-summary").remove(),$("#container-processedbslevel-calls-summary").empty();o=t.getCallsPercData(e,"processed_less_sla")}else if("invalid"===a){d3.select("container-invalid-calls-summary").remove(),$("#container-invalid-calls-summary").empty();o=t.getCallsPercData(e,"tot_null")}else if("duration"===a){d3.select("container-duration-calls-summary").remove(),$("#container-duration-calls-summary").empty();o=t.getDurationWaitCallsData(e,"duration")}else if("waiting"===a){d3.select("container-waiting-calls-summary").remove(),$("#container-waiting-calls-summary").empty();o=t.getDurationWaitCallsData(e,"waiting")}else if("failedfirst"===a){d3.select("container-failedfirst-calls-summary").remove(),$("#container-failedfirst-calls-summary").empty();o=t.getDurationWaitCallsData(e,"failedfirst")}else if("recalltime"===a){d3.select("containerRecallTimeChartInset").remove(),$("#containerRecallTimeChartInset").empty(),(o=function(e){for(var a=u(e),n={labels:[],series:[]},i=0;i<3;i++)n.series.push({label:"",values:[]});for(var s in a)n.labels.push(t.queues[s].name),n.series[0].values.push(a[s].min_recall_time),n.series[1].values.push(a[s].avg_recall_time),n.series[2].values.push(a[s].max_recall_time);return n}(i)).series.length>0&&(t.recallTimeGraphReady=!0)}for(var r=31*o.series.length,l=[],c=0;c<o.labels.length;c++)for(var d=0;d<o.series.length;d++)l.push(o.series[d].values[c]);var p=31*l.length+5*o.labels.length,m=d3.scaleLinear().domain([0,d3.max(l)]).range([0,295]),g=d3.scaleLinear().range([p+5,0]),f=d3.axisRight(g).tickFormat("").scale(g).tickSize(0),v={},h=0;for(var b in e)v[h]=e[b],h++;if("processed"===a){var C=d3.select("#container-processed-calls-summary");t.summaryCharts=C.append("svg").attr("id","container-processed-calls-summary-svg").attr("class","chart timing-chart").attr("width",470).attr("height",p)}else if("failed"===a){C=d3.select("#container-failed-calls-summary");t.summaryCharts=C.append("svg").attr("id","container-failed-calls-summary-svg").attr("class","chart timing-chart").attr("width",470).attr("height",p)}else if("processedbslevel"===a){C=d3.select("#container-processedbslevel-calls-summary");t.summaryCharts=d3.select("#container-processedbslevel-calls-summary").append("svg").attr("id","container-processedbslevel-calls-summary-svg").attr("class","chart timing-chart").attr("width",470).attr("height",p)}else if("invalid"===a){C=d3.select("#container-invalid-calls-summary");t.summaryCharts=C.append("svg").attr("id","container-invalid-calls-summary-svg").attr("class","chart timing-chart").attr("width",470).attr("height",p)}else if("duration"===a){C=d3.select("#container-duration-calls-summary");t.summaryCharts=C.append("svg").attr("id","container-duration-calls-summary-svg").attr("class","chart timing-chart").attr("width",470).attr("height",p)}else if("recalltime"===a){C=d3.select("#containerRecallTimeChartInset");t.summaryCharts=C.append("svg").attr("id","containerRacallTimeChart-svg").attr("class","chart timing-chart").attr("width",470).attr("height",p)}else if("waiting"===a){C=d3.select("#container-waiting-calls-summary");t.summaryCharts=C.append("svg").attr("id","container-waiting-calls-summary-svg").attr("class","chart timing-chart").attr("width",470).attr("height",p)}else if("failedfirst"===a){C=d3.select("#container-failedfirst-calls-summary");t.summaryCharts=C.append("svg").attr("id","container-failedfirst-calls-summary-svg").attr("class","chart timing-chart").attr("width",470).attr("height",p)}if("waiting"===a||"duration"===a||"failedfirst"===a||"recalltime"===a)var y=C.append("div").attr("class","tooltip-chart").style("opacity",0);var w=t.summaryCharts.selectAll("g").data(l).enter().append("g").attr("transform",function(e,t){return"translate(100,"+(31*t+5*(.5+Math.floor(t/o.series.length)))+")"});if("waiting"!==a&&"duration"!==a&&"failedfirst"!==a||w.on("mousemove",function(e,t){y.text("Abandon").style("opacity",.8).style("left",d3.event.layerX-70+"px").style("top",d3.event.layerY+0+"px")}).on("mouseout",function(){y.style("opacity",0)}),t.cColor=0,w.append("rect").attr("fill",function(e,n){var i=s.get("queuesColors");if("duration"!==a&&"waiting"!==a&&"failedfirst"!==a&&"recalltime"!==a){if(i){l=i[v[n].queue];t.updateQueueColor(v[n].queue,l)}else{if(t.colorArray[v[n].queue])l=t.colorArray[v[n].queue];else l=t.colorArray[0];t.updateQueueColor(v[n].queue,l)}return l}if(t.nColor++,"failedfirst"===a){var r=o.series.length;t.nColor!==r&&0!==n||(t.nColor=0)}else 3!==t.nColor&&0!==n||(t.nColor=0);if(0==t.nColor&&0!=n&&t.cColor++,i){var l=i[v[t.cColor].queue];t.updateQueueColor(v[t.cColor].queue,l)}else{if(t.colorArray[v[t.cColor].queue])var l=t.colorArray[v[t.cColor].queue];else var l=t.colorArray[0];t.updateQueueColor(v[t.cColor].queue,l)}return"failedfirst"===a?l:2==t.nColor?l:1==t.nColor?t.convertHex(l,80):0==t.nColor?t.convertHex(l,60):void 0}).attr("class","bar").attr("width",m).attr("height",30),"waiting"===a||"duration"===a||"recalltime"===a?w.on("mousemove",function(e,t){for(var a=t+1,i={},s=1,o=0;o<a;o++)4===s&&(s=1),1===s?i[o]="Minimum":2===s?i[o]="Average":3===s&&(i[o]="Maximum"),s++;var r=n("translate")(i[t]);y.text(r).style("opacity",.8).style("left",d3.event.layerX-70+"px").style("top",d3.event.layerY+0+"px")}).on("mouseout",function(){y.style("opacity",0)}):"failedfirst"===a&&w.on("mousemove",function(e,t){for(var a=t+1,i=o.series.length,s=i*o.labels.length,r={},l=0,c=1;c<=s;c++)r[c]=l,++l===i&&(l=0);var d=o.series[r[a]].label,u=n("translate")(d);y.text(u).style("opacity",.8).style("left",d3.event.layerX-70+"px").style("top",d3.event.layerY+0+"px")}).on("mouseout",function(){y.style("opacity",0)}),"processed"===a||"processedbslevel"===a||"invalid"===a||"failed"===a){var x=0;w.append("text").attr("x",function(e,t){return m(e)+30}).attr("dx",".8em").style("text-anchor","middle").attr("y",15.5).attr("fill","red").attr("dy",".35em").attr("class","label").text(function(e){var t=e+" - "+o.percents[x]+"%";return x++,t})}else"duration"===a||"waiting"===a||"recalltime"===a?w.append("text").attr("x",function(e,t){return m(e)+15}).attr("dx",".8em").style("text-anchor","middle").attr("y",15.5).attr("fill","red").attr("dy",".35em").attr("class","label").text(function(e){return e>60?Math.floor(e/60)+"' "+(e%60==0?"":e%60+'"'):e+'"'}):w.append("text").attr("x",function(e,t){return m(e)+15}).attr("dx",".8em").style("text-anchor","middle").attr("y",15.5).attr("fill","red").attr("dy",".35em").attr("class","label").text(function(e){return e});w.append("text").attr("class","label").attr("x",function(e){return-10}).attr("y",r/2).attr("dy",".35em").text(function(e,t){return t%o.series.length==0?o.labels[Math.floor(t/o.series.length)]:""}),t.summaryCharts.append("g").attr("class","y axis").attr("transform","translate(100, -2.5)").call(f),"processed"===a&&$("#container-processed-calls-summary-svg").length>0?t.responsivefy(d3.select("#container-processed-calls-summary-svg")):"failed"===a&&$("#container-failed-calls-summary-svg").length>0?t.responsivefy(d3.select("#container-failed-calls-summary-svg")):"processedbslevel"===a&&$("#container-processedbslevel-calls-summary-svg").length>0?t.responsivefy(d3.select("#container-processedbslevel-calls-summary-svg")):"invalid"===a&&$("#container-invalid-calls-summary-svg").length>0?t.responsivefy(d3.select("#container-invalid-calls-summary-svg")):"duration"===a&&$("#container-duration-calls-summary-svg").length>0?t.responsivefy(d3.select("#container-duration-calls-summary-svg")):"recalltime"===a&&$("#containerRacallTimeChart-svg").length>0?t.responsivefy(d3.select("#containerRacallTimeChart-svg")):"waiting"===a&&$("#container-waiting-calls-summary-svg").length>0?t.responsivefy(d3.select("#container-waiting-calls-summary-svg")):"failedfirst"===a&&!o.failedReasons&&$("#container-failedfirst-calls-summary-svg").length>0&&t.responsivefy(d3.select("#container-failedfirst-calls-summary-svg"))},t.setFilterSummaryQueues=function(e){if(!(a=s.get("hsQueues")))var a={};a[e]?a[e]=!1:a[e]=!0,s.set("hsQueues",a),t.updateSummaryStats()},t.updateCallEnteredChart=function(e){void 0!==t.pie&&(t.pie.destroy(),t.pie=void 0,$("#container-enteredcalls-summary-chart").empty());var a=t.getEnteredCallChartData(e);t.pie=new d3pie("container-enteredcalls-summary-chart",{header:{title:a.title,subtitle:a.subtitle,titleSubtitlePadding:9},data:{sortOrder:"value-desc",content:a.content},size:{canvasWidth:445,canvasHeight:445,pieInnerRadius:"4%",pieOuterRadius:"90%"},labels:{outer:{format:"none",pieDistance:18},inner:a.customInner,mainLabel:{fontSize:14,color:"#ffffff",font:"Lato,'Helvetica Neue',Arial,Helvetica,sans-serif"},percentage:{color:"#ffffff",fontSize:14,font:"Lato,'Helvetica Neue',Arial,Helvetica,sans-serif",decimalPlaces:0},value:{color:"#ffffff",font:"Lato,'Helvetica Neue',Arial,Helvetica,sans-serif",fontSize:18},lines:{enabled:!0,style:"straight"},truncation:{enabled:!0}},effects:{load:{effect:"none"},pullOutSegmentOnClick:{effect:"none"},highlightSegmentOnMouseover:!1},misc:{gradient:{enabled:!0,percentage:100,color:"rgba(0, 0, 0, .87)"}}}),t.responsivefy(d3.select("#container-enteredcalls-summary-chart svg"))},t.allFalse=function(e){for(var t in e)if(e[t])return!1;return!0},t.updateSummaryStats=function(){o.getQueues().then(function(e){var a=s.get("hsQueues");if(a)t.data.hsQueuesVal=a;else{for(var n in e.data)t.data.hsQueuesVal[n]=!0;s.set("hsQueues",t.data.hsQueuesVal)}for(var i in t.allFalse(t.data.hsQueuesVal)?t.allQsDisabled=!0:t.allQsDisabled=!1,t.data.hsQueuesVal)!1===t.data.hsQueuesVal[i]&&delete e.data[i];var r=1,l=Object.keys(e.data).length;angular.forEach(e.data,function(a,n){o.getQueueStats(n).then(function(a){e.data[n].qstats=a.data,r===l&&(t.updateCallEnteredChart(e.data),t.updateSummaryBarChart(e.data,"processed"),t.updateSummaryBarChart(e.data,"failed"),t.updateSummaryBarChart(e.data,"processedbslevel"),t.updateSummaryBarChart(e.data,"invalid"),t.updateSummaryBarChart(e.data,"duration"),t.updateSummaryBarChart(e.data,"waiting"),t.updateSummaryBarChart(e.data,"failedfirst")),r++},function(e){console.error(e)})})},function(e){console.error(e)})},t.startQueueStatsUpdate=function(){t.intervalUpdateQStats=setInterval(function(){t.updateQueueStats()},t.UPDATE_QSTATS_INTERVAL)},t.stopQueueStatsUpdate=function(){clearInterval(t.intervalUpdateQStats)},t.$on("qmanagerStop",function(e,a){t.stopQueueStatsUpdate()}),t.$on("qmanagerReload",function(e,a){t.viewLoad=!0,t.init()}),t.$on("socketAutheOK",function(e,a){t.viewLoad=!0,t.init()}),t.$on("wsDisconnected",function(e,a){t.stopQueueStatsUpdate()}),t.filterEndpoints=function(e){for(var t in e)if(e[t]&&e[t].conversations&&e[t].conversations.length>0)return[e[t]]},t.filterQueues=function(e){var a={};for(var n in t.queues)t.queues[n].members[e]&&(a[n]=t.queues[n]);return a},t.getStatusOfUser=function(e){var a=[];for(var n in e)t.allExtensions[e[n].id]&&a.push(t.allExtensions[e[n].id].status);return a.indexOf("busy")>-1?"busy":a.indexOf("busy_ringing")>-1?"busy_ringing":a.indexOf("ringing")>-1?"ringing":a.indexOf("onhold")>-1?"onhold":a.indexOf("online")>-1?"online":"offline"},t.addMember=function(e,a){var n={endpointId:e,queueId:a};o.addUserQueue(n).then(function(e){t.getQueues()},function(e){console.error(e)})},t.removeMember=function(e,a){var n={endpointId:e,queueId:a};o.removeUserQueue(n).then(function(e){t.getQueues()},function(e){console.error(e)})},t.pauseMember=function(e,a){var n={endpointId:e,queueId:a};o.pauseUserQueue(n).then(function(e){t.getQueues()},function(e){console.error(e)})},t.unpauseMember=function(e,a){var n={endpointId:e,queueId:a};o.unpauseUserQueue(n).then(function(e){t.getQueues()},function(e){console.error(e)})},t.openMemberChat=function(e){jsxc.gui.window.open(jsxc.jidToBid(e))},t.startSpy=function(e){var a=t.filterEndpoints(e.endpoints.extension)[0];t.currentCall.isSpy=!0,t.currentCall.actionDisplayName=e.name,c.startSpy({convid:a.conversations[0].id,endpointId:a.id,destId:t.currentUser.default_device.id}).then(function(e){},function(e){console.error(e)})},t.startIntrude=function(e){var a=t.filterEndpoints(e.endpoints.extension)[0];t.currentCall.isIntrude=!0,t.currentCall.actionDisplayName=e.name,c.intrude({convid:a.conversations[0].id,endpointId:a.id,destId:t.currentUser.default_device.id}).then(function(e){},function(e){console.error(e)})},t.updateAgentsStatus=function(){for(var e in t.allUsers)for(var a in t.allUsers[e].status=t.getStatusOfUser(t.allUsers[e].endpoints.extension),t.allUsers[e].endpoints.extension)t.allUsers[e].endpoints.extension[a].status=t.allExtensions[t.allUsers[e].endpoints.extension[a].id]&&t.allExtensions[t.allUsers[e].endpoints.extension[a].id].status||"offline",t.allUsers[e].endpoints.extension[a].conversations=t.allExtensions[t.allUsers[e].endpoints.extension[a].id]&&Object.keys(t.allExtensions[t.allUsers[e].endpoints.extension[a].id].conversations).map(function(n){return t.allExtensions[t.allUsers[e].endpoints.extension[a].id].conversations[n]})||{}},t.invertQueueMonitorColor=function(e){"invert(1)"==$("#queueMonitorTContainer-"+e).css("filter")?($("#queueMonitorTContainer-"+e).css("filter","none"),t.data.monitorInverted[e]=!1,$("#queueMonitorTContainer-"+e+" .icon-monitor-queue-header").css("color","#0094ea"),$("#queueMonitorTContainer-"+e+" .icon-monitor-queue-header").css("transform","none")):($("#queueMonitorTContainer-"+e).css("filter","invert(100%)"),t.data.monitorInverted[e]=!0,$("#queueMonitorTContainer-"+e+" .icon-monitor-queue-header").css("color","#ce6b15"),$("#queueMonitorTContainer-"+e+" .icon-monitor-queue-header").css("transform","rotate( 180deg )"))},t.updateMonitorTab=function(){var e=s.get("monitorRowsValue");e&&(t.data.monitorRowsValue=e);var a=s.get("hsMonitorQueues");a&&(t.data.hsMonitorQueues=a),t.allFalse(t.data.hsMonitorQueues)?t.allMonitorQsDisabled=!0:t.allMonitorQsDisabled=!1,angular.element(document).ready(function(){$("#monitorDropdown").dropdown("set selected",t.data.monitorRowsValue)})},t.setFilterMonitorQueues=function(e){if(!(a=s.get("hsMonitorQueues")))var a={};a[e]?(a[e]=!1,t.data.monitorInverted[e]=!1):a[e]=!0,s.set("hsMonitorQueues",a),t.updateMonitorTab()},t.updateMonitorCalls=function(e,a){var n=[];for(var i in t.queues[e]=a,a.waitingCallers)n.push(a.waitingCallers[i]);t.queues[e].waitingCallersArray=n},t.setMonitorRowsNumber=function(e){s.set("monitorRowsValue",e)},t.getNumber=function(e){for(var t=[],a=0;a<e;a++)t.push(a);return t},t.dashboardData={alarms:{loading:!0,list:{}},const:{queuefewop:{description:"The ratio between the number of calls waiting and the number of agents has exceeded the alarm threshold"},queueholdtime:{description:"The average waiting time has exceeded the alarm threshold"},queueload:{description:"There are many calls waiting and the average waiting time has exceeded the alarm threshold"},queuemaxwait:{description:"There are many calls waiting and the first call is on hold for a long time"}},orderStatusAsc:s.get("orderStatusAsc")?s.get("orderStatusAsc"):{},agentsAnswered:{},agentsLost:{},agentsPauseOnLogon:{},agentsRecallTime:{},queuesRecallTime:{},totalAll:0,totalAnswered:0,totalFailed:0,totalInvalid:0,answeredAverage:0,graphsStartHour:null,stackedAreaFirst:!0},t.agentsRecallTimeOrder=!0,t.queuesRecallTimeOrder=!0,t.isAlarm=function(){for(var e in t.dashboardData.alarms.list)for(var a in t.dashboardData.alarms.list[e])if(t.queues[e]&&"warning"==t.dashboardData.alarms.list[e][a].status)return!0},t.renderAlarms=function(e,a){"api"==a?t.dashboardData.alarms=e:"ws"==a&&(t.dashboardData.alarms.list[e.queue]||(t.dashboardData.alarms.list[e.queue]={}),t.dashboardData.alarms.list[e.queue][e.alarm]=e,t.$apply()),t.dashboardData.alarms.loading&&(t.dashboardData.alarms.loading=!1)},t.getAlarms=function(){o.getAlarms().then(function(e){t.renderAlarms(e.data,"api")},function(e){console.error(e)})},t.sortDashboard=function(e,t,a){var n=[],i={};for(var s in e)if(e.hasOwnProperty(s)){var o=[e[s].name,e[s].queue];t?o.push(e[s].values[t]):o.push(e[s].value),e[s].note&&o.push(e[s].note),n.push(o)}n.sort(function(e,t){return"asc"==a?e[2]-t[2]:"desc"==a?t[2]-e[2]:void 0});for(var r=0;r<n.length;r++)i[r]={name:n[r][0],queue:n[r][1],value:n[r][2]},n[r][3]&&(i[r].note=n[r][3]);return i},t.setOrderStatusAsc=function(e){t.dashboardData.orderStatusAsc[e]?t.dashboardData.orderStatusAsc[e]=!t.dashboardData.orderStatusAsc[e]:t.dashboardData.orderStatusAsc[e]=!0,s.set("orderStatusAsc",t.dashboardData.orderStatusAsc);t.dashboardData[e]=t.sortDashboard(t.dashboardData[e],null,t.dashboardData.orderStatusAsc[e]?"asc":"desc")},t.agentsDashboardRanks=function(e,t){return a(function(a){var n=0,i={};for(var s in e)for(var o in e[s]){if(!isNaN(o)){i[n]={name:s,queue:o,values:{}};for(var r=0;r<t.length;r++){var l=t[r];i[n].values[l]=e[s][o][l]||0}}n++}a(i)})},t.loadAgentsRanksFirst=function(e){t.agentsDashboardRanks(e,["calls_taken","no_answer_calls","pause_percent"]).then(function(a){t.dashboardData.agentsAnswered=t.sortDashboard(a,"calls_taken",t.dashboardData.orderStatusAsc.agentsAnswered?"asc":"desc"),t.dashboardData.agentsLost=t.sortDashboard(a,"no_answer_calls",t.dashboardData.orderStatusAsc.agentsLost?"asc":"desc"),t.dashboardData.agentsPauseOnLogon=t.sortDashboard(a,"pause_percent",t.dashboardData.orderStatusAsc.agentsPauseOnLogon?"asc":"desc"),t.loadAgentsRanksSecond(e)})},t.loadAgentsRanksSecond=function(e){t.agentsDashboardRanks(e,["time_in_logon","time_in_pause","conversation_percent"]).then(function(e){t.dashboardData.agentsLoginTime=t.sortDashboard(e,"time_in_logon",t.dashboardData.orderStatusAsc.agentsLoginTime?"asc":"desc"),t.dashboardData.agentsPauseTime=t.sortDashboard(e,"time_in_pause",t.dashboardData.orderStatusAsc.agentsPauseTime?"asc":"desc"),t.dashboardData.inCallPercentage=t.sortDashboard(e,"conversation_percent",t.dashboardData.orderStatusAsc.inCallPercentage?"asc":"desc")})};var u=function(e){var a={};for(var n in t.queues)a[n]={min_recall_time:[],max_recall_time:[],avg_recall_time:[]};for(var i in e)for(var n in a)Object.hasOwnProperty.call(e[i],n)&&(e[i][n].min_recall_time&&a[n].min_recall_time.push(e[i][n].min_recall_time),e[i][n].max_recall_time&&a[n].max_recall_time.push(e[i][n].max_recall_time),e[i][n].avg_recall_time&&a[n].avg_recall_time.push(e[i][n].avg_recall_time));for(var n in a)a[n].min_recall_time.length>0&&a[n].max_recall_time.length>0&&a[n].avg_recall_time.length>0?a[n]={min_recall_time:Math.min.apply(Math,_toConsumableArray(a[n].min_recall_time)),max_recall_time:Math.max.apply(Math,_toConsumableArray(a[n].max_recall_time)),avg_recall_time:Math.round(a[n].avg_recall_time.reduce(function(e,t){return e+t})/a[n].avg_recall_time.length)}:delete a[n];return a};t.orderRecallTimeAgents=function(e){var a=[],n={},i=0;for(var s in t.dashboardData.agentsRecallTime){for(var o in a[i]={agent:s},t.dashboardData.agentsRecallTime[s])a[i][o]=t.dashboardData.agentsRecallTime[s][o];i++}"asc"==e?a.sort(function(e,t){return e.allQueues.avg_recall_time>t.allQueues.avg_recall_time?1:t.allQueues.avg_recall_time>e.allQueues.avg_recall_time?-1:0}):"desc"==e&&a.sort(function(e,t){return e.allQueues.avg_recall_time>t.allQueues.avg_recall_time?-1:t.allQueues.avg_recall_time>e.allQueues.avg_recall_time?1:0}),a.forEach(function(e){n[e.agent]=e,delete n[e.agent].agent}),t.agentsRecallTimeOrder=!t.agentsRecallTimeOrder,t.dashboardData.agentsRecallTime=n,d()},t.orderRecallTimeQueues=function(e){var a=[],n={},i=0;for(var s in t.dashboardData.queuesRecallTime){for(var o in a[i]={queue:s},t.dashboardData.queuesRecallTime[s])a[i][o]=t.dashboardData.queuesRecallTime[s][o];i++}"asc"==e?a.sort(function(e,t){return e.avg_recall_time>t.avg_recall_time?1:t.avg_recall_time>e.avg_recall_time?-1:0}):"desc"==e&&a.sort(function(e,t){return e.avg_recall_time>t.avg_recall_time?-1:t.avg_recall_time>e.avg_recall_time?1:0}),a.forEach(function(e){n["queue_".concat(e.queue)]=e}),t.queuesRecallTimeOrder=!t.queuesRecallTimeOrder,t.dashboardData.queuesRecallTime=n,d()},t.queuesDashboardRank=function(e){return a(function(a){var n=0,i={};for(var s in t.queues){if(!isNaN(s)){i[n]={name:t.queues[s].name,queue:s,values:{}};for(var o=0;o<e.length;o++){var r=e[o];i[n].values[r]=t.queues[s].qstats[r]||0}}n++}a(i)})},t.loadQueuesRanksFirst=function(){t.queuesDashboardRank(["tot_processed","tot_failed","tot","tot_null"]).then(function(e){t.dashboardData.queuesAnswered=t.sortDashboard(e,"tot_processed","desc"),t.dashboardData.queuesTotalCalls=t.sortDashboard(e,"tot","desc"),t.dashboardData.queuesFailedCalls=t.sortDashboard(e,"tot_failed","desc"),t.dashboardData.queuesInvalidCalls=t.sortDashboard(e,"tot_null","desc"),function(){for(var e in t.dashboardData.queuesTotalCalls)t.dashboardData.totalAll+=t.dashboardData.queuesTotalCalls[e].value;for(var e in t.dashboardData.queuesAnswered)t.dashboardData.totalAnswered+=t.dashboardData.queuesAnswered[e].value;for(var e in t.dashboardData.queuesFailedCalls)t.dashboardData.totalFailed+=t.dashboardData.queuesFailedCalls[e].value;for(var e in t.dashboardData.queuesInvalidCalls)t.dashboardData.totalInvalid+=t.dashboardData.queuesInvalidCalls[e].value}(),t.loadQueuesRanksSecond()})},t.loadQueuesRanksSecond=function(){t.queuesDashboardRank(["failed_abandon","failed_full","failed_inqueue_noagents","failed_outqueue_noagents","failed_timeout","failed_withkey"]).then(function(e){var a=0,n={};for(var i in e)for(var s in e[i].values)n[a]={name:e[i].name,queue:e[i].queue,note:s,values:{value:e[i].values[s]}},a++;t.dashboardData.queuesFailures=t.sortDashboard(n,"value","desc")})};var p=function(e,a){if(t.dashboardData.stackedAreaFirst){var n=_.throttle(function(){d3.select(a+">svg").remove(),m(e,a)},500);$(window).on("resize",n),t.dashboardData.stackedAreaFirst=!1}},m=function(e,a){var i=britecharts.stackedArea(),s=britecharts.tooltip(),o=e.data,r=d3.select(a),l=!!r.node()&&r.node().getBoundingClientRect().width;i.isAnimated(!1).tooltipThreshold(100).colorSchema(t.colorArray).xAxisFormat(i.axisTimeCombinations.CUSTOM).xAxisCustomFormat("%H:%M").width(l).grid("horizontal").areaCurve("monotoneX").keyLabel("name").dateLabel("fullDate").valueLabel("value").on("customMouseOver",s.show).on("customMouseMove",s.update).on("customMouseOut",s.hide),s.shouldShowDateInTitle(!1).topicLabel("values").title(n("translate")("Queues")+" ("+n("translate")("last 30 minutes")+")").dateFormat(s.axisTimeCombinations.CUSTOM).dateCustomFormat("%H:%M"),r.datum(o).call(i),d3.select(a+" .metadata-group .vertical-marker-container").datum([]).call(s),p(e,a)},g=function(e,a){var i,s=britecharts.line(),o=britecharts.tooltip(),r=d3.select(a),l=!!r.node()&&r.node().getBoundingClientRect().width;s.isAnimated(!1).tooltipThreshold(100).colorSchema(t.colorArray).xAxisFormat(s.axisTimeCombinations.CUSTOM).xAxisCustomFormat("%H:%M").grid("horizontal").lineCurve("monotoneX").width(l).margin({left:100,right:50,top:80,bottom:95}).dateLabel("fullDate").valueLabel("value").on("customMouseOver",o.show).on("customMouseMove",o.update).on("customMouseOut",o.hide),o.shouldShowDateInTitle(!1).title(n("translate")("Queues")+" ("+n("translate")("last 30 minutes")+")").dateFormat(o.axisTimeCombinations.CUSTOM).dateCustomFormat("%H:%M"),r.datum(e).call(s),(i=d3.select(a+" .metadata-group .vertical-marker-container")).datum([]).call(o),function(e,t,a,n,i){var s=_.throttle(function(){var s=!!t.node()&&t.node().getBoundingClientRect().width;e.width(s),t.call(e),a&&n&&(a.call(n),i&&d3.select(i+" .masking-rectangle").remove())},200);$(window).on("resize",s)}(s,r,i,o,a)};t.createDashboardGraphics=function(e){angular.element(document).ready(function(){d3.selectAll("svg").remove(),function(e){for(var a in e.total)if(e.total[a].value>0){t.dashboardData.graphsStartHour=new Date(e.total[a].fullDate).getTime()-36e5;break}for(var n in e)for(var a in e[n])new Date(e[n][a].fullDate).getTime()<t.dashboardData.graphsStartHour&&delete e[n][a]}(function(e){var t={};for(var a in e)for(var n in e[a]){t[n]||(t[n]=[]);for(var i=0;i<e[a][n].length;i++)t[n][i]||(t[n][i]={}),t[n][i].name=n,t[n][i].fullDate=e[a][n][i].fullDate,t[n][i].date=e[a][n][i].date,t[n][i].value||(t[n][i].value=0),t[n][i].value+=e[a][n][i].value}return t}(e));var a=function(e){var a={stacked:{data:[]},lineTotal:{dataByTopic:[]},lineFailed:{dataByTopic:[]},stackedBarComparison:{data:[]}},i={};for(var s in e){t.dashboardData.totalHoursNumber=0;for(var o=0,r=0;r<e[s].answered.length;r++)new Date(e[s].answered[r].fullDate)>t.dashboardData.graphsStartHour&&(e[s].answered[r].name=t.queues[s].name,a.stacked.data.push(e[s].answered[r]),2==++o&&(t.dashboardData.totalHoursNumber++,o=0));for(var l={topic:s,topicName:t.queues[s].name,dates:[]},c=0;c<e[s].total.length;c++)new Date(e[s].total[c].fullDate)>t.dashboardData.graphsStartHour&&l.dates.push(e[s].total[c]);a.lineTotal.dataByTopic.push(l);for(var d={topic:s,topicName:t.queues[s].name,dates:[]},u=0;u<e[s].failed.length;u++)new Date(e[s].failed[u].fullDate)>t.dashboardData.graphsStartHour&&d.dates.push(e[s].failed[u]);a.lineFailed.dataByTopic.push(d);for(var p=0;p<e[s].total.length;p++){var m=new Date(e[s].total[p].fullDate),g=m.getHours(),f=m.getMinutes(),v="".concat(g<10?"0"+g:g,":").concat(0==f?"00":f);i[v]||(i[v]={date:m,answered:0,failed:0,invalid:0}),i[v].answered+=e[s].answered[p].value||0,i[v].failed+=e[s].failed[p].value||0,i[v].invalid+=e[s].invalid[p].value||0}}for(var h in i)new Date(i[h].date)>t.dashboardData.graphsStartHour&&(a.stackedBarComparison.data.push({date:h,stack:n("translate")("answered"),views:i[h].answered,valueLabel:100*i[h].answered/(i[h].answered+i[h].failed+i[h].invalid)}),a.stackedBarComparison.data.push({date:h,stack:n("translate")("failed"),views:i[h].failed,valueLabel:100*i[h].failed/(i[h].answered+i[h].failed+i[h].invalid)}),a.stackedBarComparison.data.push({date:h,stack:n("translate")("invalid"),views:i[h].invalid,valueLabel:100*i[h].invalid/(i[h].answered+i[h].failed+i[h].invalid)}));return a}(e);t.dashboardData.totalHoursNumber=0==t.dashboardData.totalHoursNumber?1:t.dashboardData.totalHoursNumber;for(var i,s,o,r,l,c,d,u=!0,p=0;p<a.stacked.data.length;p++)if(a.stacked.data[p].value>0){u=!1;break}u&&(t.dashboardData.totalHoursNumber=1),t.dashboardData.answeredAverage=(t.dashboardData.totalAnswered/t.dashboardData.totalHoursNumber).toFixed(1),m(a.stacked,"#js-stacked-area-chart-tooltip-container"),g(a.lineTotal,"#qmanDashLineChart1"),g(a.lineFailed,"#qmanDashLineChart2"),i=a.stackedBarComparison,s="#qmanStackedBar",o=britecharts.stackedBar(),r=britecharts.tooltip(),l=i.data,c=d3.select(s),d=!!c.node()&&c.node().getBoundingClientRect().width,o.colorSchema(["#5f94d8","#B469DD","#F05A64"]).width(d).grid("horizontal").stackLabel("stack").nameLabel("date").valueLabel("views").betweenBarsPadding(.2).on("customMouseOver",r.show).on("customMouseMove",r.update).on("customMouseOut",r.hide),c.datum(l).call(o),r.topicLabel("values").dateLabel("date").nameLabel("stack").valueLabel("valueLabel").title(n("translate")("Calls")+" ("+n("translate")("last 30 minutes")+")").valueFormatter(function(e){return e?e.toFixed(2).toString()+"%":"0%"}).shouldShowDateInTitle(!1),d3.select(s+" .metadata-group").datum([]).call(r)})},t.initDashboardGraphics=function(){o.getQueuesHistory().then(function(e){t.createDashboardGraphics(e.data)},function(e){console.error(e)})},t.getUsersStats=function(){o.getAgentsStats().then(function(e){!function(e){for(var a in e=angular.copy(e))e[a].allQueues&&(!e[a].allQueues||e[a].allQueues.avg_recall_time||e[a].allQueues.min_recall_time||e[a].allQueues.max_recall_time)||delete e[a];t.dashboardData.agentsRecallTime=e,t.dashboardData.queuesRecallTime=u(e),t.orderRecallTimeAgents("asc"),t.orderRecallTimeQueues("asc")}(e.data),t.loadAgentsRanksFirst(e.data)},function(e){console.error(e)})},t.getQueuesStats=function(){var e=1,a=Object.keys(t.queues).length;angular.forEach(t.queues,function(n,i){o.getQueueStats(i).then(function(n){t.queues[i].qstats=n.data,e===a&&(t.initDashboardGraphics(),t.loadQueuesRanksFirst(["tot_processed","tot_null","tot_failed"])),e++},function(e){console.error(e)})})},t.stopDashboardInterval=function(){clearInterval(t.intervalUpdateDashboard)},t.initDashboard=function(){t.dashboardData.agentsAnswered={},t.dashboardData.agentsLost={},t.dashboardData.agentsPauseOnLogon={},t.dashboardData.totalAll=0,t.dashboardData.totalAnswered=0,t.dashboardData.totalFailed=0,t.dashboardData.totalInvalid=0,t.dashboardData.answeredAverage=0,t.dashboardData.agentsRecallTime={},t.dashboardData.queuesRecallTime={},t.getUsersStats(),t.getQueuesStats(),t.stopDashboardInterval(),t.intervalUpdateDashboard=setInterval(function(){document.hasFocus()&&t.initDashboard()},t.UPDATE_DASHBOARD_INTERVAL)},t.updateDashboardTab=function(){t.getAlarms(),t.initDashboard()};var f=function(e){t.renderAlarms(e,"ws")};l.on("qmAlarm",f),t.stopUpdatingSummary=function(){clearInterval(t.intervalUpdateQSummary)},t.initGraphics=function(){angular.element(document).ready(function(){$(".macro-view-container .ui.dropdown").dropdown()})},t.initGraphics();var v=function(e){t.queues[e.queue]&&(t.queues[e.queue]=e,"queues"===t.data.qmanagerLastTab?(t.updateWaitCalls(e.queue,e),t.updateConnectedCalls(e.queue)):"monitor"===t.data.qmanagerLastTab&&t.updateMonitorCalls(e.queue,e),t.$apply())};l.on("queueUpdate",v);var h=function(e){if(t.allExtensions[e.exten]=e,t.allUsers[e.username]&&t.allUsers[e.username].endpoints.extension){for(var a in t.allUsers[e.username].endpoints.extension)t.allUsers[e.username].endpoints.extension[a].id==e.exten&&(t.allUsers[e.username].endpoints.extension[a].status=e.status,t.allUsers[e.username].endpoints.extension[a].conversations=Object.keys(e.conversations).map(function(t){return e.conversations[t]}));t.allUsers[e.username].status=t.getStatusOfUser(t.allUsers[e.username].endpoints.extension)}if("queues"===t.data.qmanagerLastTab){if(e.conversations[Object.keys(e.conversations)[0]]&&void 0!==e.conversations[Object.keys(e.conversations)[0]].queueId&&!0===e.conversations[Object.keys(e.conversations)[0]].throughQueue&&!0===e.conversations[Object.keys(e.conversations)[0]].connected){var n=e.conversations[Object.keys(e.conversations)[0]].queueId||void 0;t.updateConnectedCalls(n)}t.updateAgentsCounters()}t.$apply()};l.on("extenUpdate",h);var b=function(e){t.queues[e.queue]&&(t.queues[e.queue].members[e.member]=e,"queues"===t.data.qmanagerLastTab&&(t.updateConnectedCalls(e.queue),t.updateAgentsCounters()),t.$apply())};l.on("queueMemberUpdate",b);var C=function(e){e.presence&&e.presence.username&&(t.allUsers[e.presence.username].presence=e.presence.status,t.$apply())};l.on("userPresenceUpdate",C),t.init=function(){t.data.qmanagerLastTab=s.get("qmanager-last-tab")||"dashboard",t.data.queueLastTab=s.get("qmanager-queue-last-tab"),t.data.filterAgentsStatsType=s.get("qmanFilter")||"member",t.data.filterSummaryAgentsStatsType=s.get("summaryAgentsFilter")||"name";var e=s.get("rtqdropdown").split(",");for(var a in e)t.data.rtqdropdown[e[a]]=!0;var n=s.get("rtqdropdownsummary").split(",");for(var a in n)t.data.rtqdropdownsummary[n[a]]=!0;angular.element(document).ready(function(){t.getQueues(),"queues"===t.data.qmanagerLastTab?t.initQueuesGraphics():"realtime"===t.data.qmanagerLastTab?t.initRealtimeGraphics():"summary"===t.data.qmanagerLastTab&&t.initSummaryGraphics(),t.data.viewLoad=!1})},t.init(),t.$on("$routeChangeStart",function(){t.stopQueueStatsUpdate(),t.stopQStatsAgentsInterval(),t.stopDashboardInterval(),t.stopUpdatingSummary(),t.stopIntervalUpdateRealtimeTab()}),t.$on("$destroy",function(){l.off("qmAlarm",f),l.off("queueUpdate",v),l.off("extenUpdate",h),l.off("queueMemberUpdate",b),l.off("userPresenceUpdate",C),$(window).off("resize")})}]),angular.module("nethctiUiApp").controller("QManagerLostCallsCtrl",["$scope","$filter","$interval","LocalStorageService","QManagerService","UtilService","NgTableParams","QueueService","LogService",function(e,t,a,n,i,s,o,r,l){var c;e.lostcalls={lostCallsLastUpdateDate:null,detailsCid:null,searchUsers:{},lostCallsTab:n.get("lostCallsTab")||"notmanaged"},e.lcQmUpdate=n.get("lcQmUpdate"),e.lcQmUpdate=e.lcQmUpdate<20?20:e.lcQmUpdate,e.lcHInterval=n.get("lcHInterval")||12,e.selectedRecallQueues=n.get("QMSelectedRecallQueues")||{},e.selectedCall,e.notManagedTP,e.managedTP,e.totalTP,e.notManagedLoader=!1,e.managedLoader=!1,e.totalLoader=!1,e.detailsTP,e.modalShow=!1,e.showLoader,e.isAnyTableInit,e.updateLCTab=function(t){switch(e.lostcalls.lostCallsTab=t,n.set("lostCallsTab",t),t){case"managed":e.managedTP?f():v();break;case"total":e.totalTP?f():v();break;default:e.notManagedTP?f():v()}};var d=function(e){return Object.keys(e)},u=function(){return n.get("lcHInterval")||12},p=function(){e.lostcalls.lostCallsLastUpdateDate=new Date},m=function(){$("#lCQManager table tbody tr td .ui.dropdown").dropdown({message:{noResults:t("translate")("No results found")+"."}})},g=function(){switch(e.lostCallsTab){case"managed":e.managedTP.page(1);break;case"total":e.totalTP.page(1);break;default:e.notManagedTP.page(1)}};e.exportCSVLostCalls=function(a){var n=angular.copy(a);for(var i in n)n[i].time=t("translate")("with_date_long_noUTC",{date:1e3*n[i].time}).replace(/,/g,""),n[i].queuename=e.queues[n[i].queuename].name+" ("+n[i].queuename+") ",n[i].event=t("translate")(n[i].event),delete n[i].action;s.exportCSVFile([t("translate")("Caller"),t("translate")("Name"),t("translate")("Company"),t("translate")("Time"),t("translate")("Status"),t("translate")("Queue"),t("translate")("Result")],n,t("translate")("lostcallsqm"))},e.getDataToExportCSV=function(){i.getQMLCalls(u(),d(e.selectedRecallQueues),"all").then(function(t){e.exportCSVLostCalls(t.data.rows)},function(e){console.error(e)})},e.sendCallInMessage=function(a){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.selectedCall,i=a+"@"+(e.currentUser.endpoints.jabber&&e.currentUser.endpoints.jabber[0]&&e.currentUser.endpoints.jabber[0].id).split("@")[1],s=t("translate")("Call")+": "+n.name+" "+n.company+"\n"+t("translate")("Number")+": "+n.cid;jsxc.gui.window.open(i),jsxc.gui.window.postMessage({bid:i,direction:jsxc.Message.OUT,msg:s})};e.checkLoggedUsers=function(t,a){for(var i in e.queues[t].members){var s=e.allExtensions[e.queues[t].members[i].member].username,o=e.currentUser.endpoints.jabber&&e.currentUser.endpoints.jabber[0]&&e.currentUser.endpoints.jabber[0].id,r=n.get("jsxc:"+o+":buddy:"+s+"@"+o.split("@")[1]);r&&0!==r.status?e.queues[t].members[i].chatLogged=!0:e.queues[t].members[i].chatLogged=!1}!function(t){e.selectedCall=t}(a)},e.hideNMDetails=function(){$("#details-dialog").modal("hide"),e.modalShow=!1},e.getNMDetails=function(t,a){e.detailsTP=new o({page:1,count:100,sorting:{time:"asc"}},{counts:[],getData:function(n,s){e.modalShow=!0,i.getQMRecallDetails(t,u(),a).then(function(a){s.total(a.data.length),n.resolve(a.data),e.lostcalls.detailsCid=t},function(e){console.error(e)})}})};var f=function(){if(e.isEmpty(e.selectedRecallQueues))e.managedTP=null,e.totalTP=null,e.notManagedTP=null,e.isAnyTableInit=null;else switch(e.lostcalls.lostCallsTab){case"managed":e.managedTP.reload().then(function(){m()});break;case"total":e.totalTP.reload().then(function(){m()});break;default:e.notManagedTP.reload().then(function(){m()})}},v=function(){if(!e.isEmpty(e.selectedRecallQueues)){switch(e.showLoader=!0,e.lostcalls.lostCallsTab){case"managed":e.managedTP=new o({page:1,count:e.appConfig.LOSTCALLS_RESULT_LIMIT,sorting:{time:"asc"}},{counts:[],getData:function(t,a){e.showLoader&&(e.managedLoader=!0),e.showLoader=!1,i.getQMLCalls(u(),d(e.selectedRecallQueues),"done",e.appConfig.LOSTCALLS_RESULT_LIMIT,(a.page()-1)*e.appConfig.LOSTCALLS_RESULT_LIMIT).then(function(n){a.total(n.data.count),t.resolve(n.data.rows),e.managedLoader=!1,p()},function(n){a.total(0),t.resolve([]),e.managedLoader=!1,console.error(n)})}});break;case"total":e.totalTP=new o({page:1,count:e.appConfig.LOSTCALLS_RESULT_LIMIT,sorting:{time:"asc"}},{counts:[],getData:function(t,a){e.showLoader&&(e.totalLoader=!0),e.showLoader=!1,i.getQMLCalls(u(),d(e.selectedRecallQueues),"all",e.appConfig.LOSTCALLS_RESULT_LIMIT,(a.page()-1)*e.appConfig.LOSTCALLS_RESULT_LIMIT).then(function(n){a.total(n.data.count),t.resolve(n.data.rows),e.totalLoader=!1,p()},function(n){a.total(0),t.resolve([]),e.totalLoader=!1,console.error(n)})}});break;default:e.notManagedTP=new o({page:1,count:e.appConfig.LOSTCALLS_RESULT_LIMIT,sorting:{time:"asc"}},{counts:[],getData:function(t,a){e.showLoader&&(e.notManagedLoader=!0),e.showLoader=!1,i.getQMLCalls(u(),d(e.selectedRecallQueues),"lost",e.appConfig.LOSTCALLS_RESULT_LIMIT,(a.page()-1)*e.appConfig.LOSTCALLS_RESULT_LIMIT).then(function(n){a.total(n.data.count),t.resolve(n.data.rows),e.notManagedLoader=!1,p()},function(n){a.total(0),t.resolve([]),e.notManagedLoader=!1,console.error(n)})}})}e.isAnyTableInit=!0}},h=function(){e.idLCUpdateInterval=a(function(){f()},1e3*e.lcQmUpdate),l.log("lost queue calls update interval started with interval "+1e3*e.lcQmUpdate)},b=function(){a.cancel(e.idLCUpdateInterval)};angular.element(document).ready(function(){$("#qaccordion").accordion({collapsible:!0,animate:!1,active:!1,activate:function(t,a){c||$("#lc-range2").ready(function(){$("#lc-range1").range({min:20,max:60,start:e.lcQmUpdate,step:5,onChange:function(t,a){e.lcQmUpdate=t,n.set("lcQmUpdate",t),e.$$phase||e.$apply(),b(),h()}}),$("#lc-range2").range({min:1,max:12,start:e.lcHInterval,step:1,onChange:function(t,a){e.lcHInterval=t,n.set("lcHInterval",t),e.$$phase||e.$apply()}})}),c=!0}})});i.getQueues().then(function(a){e.queues=a.data,null===localStorage.getItem("QMSelectedRecallQueues")&&function(){for(var t in e.selectedRecallQueues={},e.queues)e.selectedRecallQueues[t]=!0}(),v(),h(),angular.element(document).ready(function(){$("#searchSelect").dropdown("set selected",Object.keys(e.selectedRecallQueues)).dropdown({forceSelection:!1,message:{noResults:t("translate")("No results found")+"."},onChange:function(t){e.selectedRecallQueues={};for(var a=0;a<t.length;a++)e.selectedRecallQueues[t[a]]=!0;n.set("QMSelectedRecallQueues",e.selectedRecallQueues),e.isAnyTableInit?(g(),f()):v()}})})},function(e){console.error(e)}),e.$on("$destroy",function(){b(),$("#details-dialog").remove()}),e.$on("ngRepeatFinished",function(t){e.modalShow?$("#details-dialog").modal({closable:!1}).modal("show"):m()})}]),angular.module("nethctiUiApp").controller("PhonesCtrl",["$rootScope","$scope","$filter","LocalStorageService","NgTableParams","UserService","CustomercardService","SettingsService","UtilService","WebsocketService",function(e,t,a,n,i,s,o,r,l,c){t.btnCustomization={},t.customBtnTable,t.customAdditionalBtnTable,t.showAdditionalButtons=!1,t.btnType={},t.addBtnType={},t.btnValue={},t.addBtnValue={},t.btnValueSpeeddial={},t.addBtnValueSpeeddial={},t.btnValueLabel={},t.addBtnValueLabel={},t.currentCustomBtnPhone,t.currentBtnBrand,t.currentBtnModel,t.provisioningEngine,t.currentLineKey,t.addCurrentLineKey,t.currentLineNum,t.isValidForm;t.getProvisioningEngine=function(){r.getProvisioningEngine().then(function(e){e.data&&"tancredi"===e.data&&(t.provisioningEngine=e.data)},function(e){console.error(e),t.showSettingsDevicesWarningMessage(a("translate")("Warning"),a("translate")("Some error occurred while getting phone data from the server. Physical keys cannot be configured")+".")})},t.getProvisioningEngine();var d=function(e){try{return t.allExtensions[e].mac?t.allExtensions[e].mac.toUpperCase():void 0}catch(e){console.error(e)}};t.phoneRestart=function(e){try{var n=d(e);n?r.phoneRestart(n).then(function(t){console.log("phone ".concat(e," restarted"))},function(e){console.error(e),t.showSettingsDevicesWarningMessage(a("translate")("Warning"),a("translate")("Some error on phone reboot")+".")}):console.log("restarting exten ".concat(e,": no mac found"))}catch(e){console.error(e)}},t.btnValueChanged=function(e,t){try{"speeddial"===e?$("#setting-phone-speeddial-value-"+t).parent().removeClass("field error"):$("#setting-phone-value-"+t).parent().removeClass("field error")}catch(e){console.error(e)}},t.addBtnValueChanged=function(e,t){try{"speeddial"===e?$("#add-setting-phone-speeddial-value-"+t).parent().removeClass("field error"):$("#add-setting-phone-value-"+t).parent().removeClass("field error")}catch(e){console.error(e)}},t.saveBtnsConfig=function(e){try{for(var a in t.isValidForm=!0,t.btnType)"blf"===t.btnType[a]&&""===t.btnValue[a]?(t.isValidForm=!1,$("#setting-phone-value-"+a).focus().parent().addClass("field error")):"speed_dial"===t.btnType[a]&&""===t.btnValueSpeeddial[a]&&(t.isValidForm=!1,$("#setting-phone-speeddial-value-"+a).focus().parent().addClass("field error"));if(!1===t.isValidForm)return;for(var n in t.isValidForm=!0,t.addBtnType)"blf"===t.addBtnType[n]&&""===t.addBtnValue[n]?(t.isValidForm=!1,$("#add-setting-phone-value-"+n).focus().parent().addClass("field error")):"speed_dial"===t.addBtnType[n]&&""===t.addBtnValueSpeeddial[n]&&(t.isValidForm=!1,$("#add-setting-phone-speeddial-value-"+n).focus().parent().addClass("field error"));if(!1===t.isValidForm)return;var i=d(e);if(i){var s=function(){try{var e={variables:{}};for(var a in t.btnType){if(e.variables[a]="empty"===t.btnType[a]?"":t.btnType[a],"speed_dial"!==t.btnType[a]){for(var n in e.variables[a.replace("type","value")]=t.btnValue[a],t.allUsers)if(t.allUsers[n].name===t.btnValue[a]){e.variables[a.replace("type","value")]=t.allUsers[n].endpoints.mainextension[0].id;break}}else e.variables[a.replace("type","value")]=t.btnValueSpeeddial[a];e.variables[a.replace("type","label")]=t.btnValueLabel[a]||""}for(var i in t.addBtnType){if(e.variables[i]="empty"===t.addBtnType[i]?"":t.addBtnType[i],"speed_dial"!==t.addBtnType[i]){for(var s in e.variables[i.replace("type","value")]=t.addBtnValue[i],t.allUsers)if(t.allUsers[s].name===t.addBtnValue[i]){e.variables[i.replace("type","value")]=t.allUsers[s].endpoints.mainextension[0].id;break}}else e.variables[i.replace("type","value")]=t.addBtnValueSpeeddial[i];e.variables[i.replace("type","label")]=t.addBtnValueLabel[i]||""}return e}catch(e){console.error(e)}}();r.saveBtnsConfig(i,s).then(function(t){r.reloadPhysicalPhone(e).then(function(e){$(".ui.modal.set-physical-buttons-confirm").modal("show")},function(e){console.error(e),$(".ui.modal.set-physical-buttons-confirm-error").modal("show")})},function(e){console.error(e),$(".ui.modal.set-physical-buttons-confirm-error").modal("show")})}else console.error("saving btns config into the server: mac of exten ".concat(e," not found"))}catch(e){console.error(e)}},t.btnTypeChanged=function(e){try{t.btnValue[e]="",t.btnValueSpeeddial[e]="",t.btnValueLabel[e]="","blf"!==t.btnType[e]&&"speed_dial"!==t.btnType[e]||setTimeout(function(){"blf"===t.btnType[e]?$("#setting-phone-value-"+e).focus():"speed_dial"===t.btnType[e]&&$("#setting-phone-speeddial-value-"+e).focus()},0)}catch(e){console.error(e)}},t.addBtnTypeChanged=function(e){try{t.addBtnValue[e]="",t.addBtnValueSpeeddial[e]="",t.addBtnValueLabel[e]="","blf"!==t.addBtnType[e]&&"speed_dial"!==t.addBtnType[e]||setTimeout(function(){"blf"===t.addBtnType[e]?$("#add-setting-phone-value-"+e).focus():"speed_dial"===t.addBtnType[e]&&$("#add-setting-phone-speeddial-value-"+e).focus()},0)}catch(e){console.error(e)}},t.copyBtnConfig=function(e){try{var a=d(e);a?r.getBtnsConfig(a).then(function(a){try{for(var n,i=0;i<t.currentUser.endpoints.extension.length;i++)if(t.currentUser.endpoints.extension[i].id===e){n=t.currentUser.endpoints.extension[i].numLineKeys;break}t.createDataForHtml(a,n)}catch(e){console.error(e)}},function(e){console.error("getting btns config (for copying) from server"),console.error(e)}):console.error("getting btns config (for copying) from server: mac of exten ".concat(e," not found"))}catch(e){console.error(e)}},t.checkShowCopyBtnFrom=function(e){try{for(var a in t.currentUser.endpoints.extension)if("physical"===t.currentUser.endpoints.extension[a].type&&t.currentUser.endpoints.extension[a].id!==t.currentCustomBtnPhone&&"offline"!==t.currentUser.endpoints.extension[a].status)return!0;return!1}catch(a){return console.error(a),!1}},t.emptyAllBtnsConfig=function(){try{for(var e in t.btnType)t.btnType[e]="empty",t.btnValue[e]="",t.btnValueLabel[e]="";t.emptyAllAddBtnsConfig(),setTimeout(function(){$(".ui.dropdown.setting").dropdown()},0)}catch(e){console.error(e)}},t.emptyAllAddBtnsConfig=function(){try{for(var e in t.addBtnType)t.addBtnType[e]="empty",t.addBtnValue[e]="",t.addBtnValueLabel[e]="";setTimeout(function(){$(".ui.dropdown.setting").dropdown()},0)}catch(e){console.error(e)}},t.$on("$routeChangeStart",function(){$(".ui.modal.set-physical-buttons").remove(),$(".ui.modal.set-physical-buttons-confirm").remove(),$(".ui.modal.set-physical-buttons-confirm-error").remove()}),t.createDataForHtml=function(e,n){try{void 0===e.data.variables.cap_expkey_count||"number"!=typeof e.data.variables.cap_expkey_count&&"string"!=typeof e.data.variables.cap_expkey_count||""===e.data.variables.cap_expkey_count||(t.capExpKeyCount=parseInt(e.data.variables.cap_expkey_count)),void 0===e.data.variables.cap_expmodule_count||"number"!=typeof e.data.variables.cap_expmodule_count&&"string"!=typeof e.data.variables.cap_expmodule_count||""===e.data.variables.cap_expmodule_count||(t.capExpModuleCount=parseInt(e.data.variables.cap_expmodule_count)),n=t.currentLineNum<n?t.currentLineNum:n,t.btnCustomization={variables:{}};for(var i=1;i<=n;i++)t.btnCustomization.variables["linekey_type_"+i]="",t.btnCustomization.variables["linekey_value_"+i]="",t.btnCustomization.variables["linekey_label_"+i]="";if(e.data.variables)for(var s in e.data.variables)0===s.indexOf("linekey_type_")&&(t.btnCustomization.variables[s]=e.data.variables[s],t.btnCustomization.variables[s.replace("type","value")]=e.data.variables[s.replace("type","value")],t.btnCustomization.variables[s.replace("type","label")]=e.data.variables[s.replace("type","label")]);t.btnCustomization=function(e){try{e=e.variables;var n,i=[];for(var s in e)if(-1!==s.indexOf("linekey_type_")){var o=e["linekey_value_"+s.split("linekey_type_")[1]]||"";if("blf"===e[s])for(var r in t.allUsers)if(t.allUsers[r].endpoints.mainextension[0].id===o){o=t.allUsers[r].name;break}n={id:s,name:a("translate")("Line")+" "+s.split("linekey_type_")[1],type:e[s],value:o,label:e["linekey_label_"+s.split("linekey_type_")[1]]||""},i.push(n)}return i}catch(e){console.error(e)}}(t.btnCustomization);for(var o=0;o<n;o++)""===t.btnCustomization[o].type?t.btnType[t.btnCustomization[o].id]="empty":t.btnType[t.btnCustomization[o].id]=t.btnCustomization[o].type,"speed_dial"!==t.btnCustomization[o].type?t.btnValue[t.btnCustomization[o].id]=t.btnCustomization[o].value:t.btnValueSpeeddial[t.btnCustomization[o].id]=t.btnCustomization[o].value,t.btnValueLabel[t.btnCustomization[o].id]=t.btnCustomization[o].label;t.addBtnCustomization={variables:{}};for(var r=1;r<=t.capExpKeyCount*t.capExpModuleCount;r++)t.addBtnCustomization.variables["expkey_type_"+r]="",t.addBtnCustomization.variables["expkey_value_"+r]="",t.addBtnCustomization.variables["expkey_label_"+r]="";if(e.data.variables)for(var l in e.data.variables)0===l.indexOf("expkey_type_")&&(t.addBtnCustomization.variables[l]=e.data.variables[l],t.addBtnCustomization.variables[l.replace("type","value")]=e.data.variables[l.replace("type","value")],t.addBtnCustomization.variables[l.replace("type","label")]=e.data.variables[l.replace("type","label")]);t.addBtnCustomization=function(e){try{e=e.variables;var n,i=[];for(var s in e)if(-1!==s.indexOf("expkey_type_")){var o=e["expkey_value_"+s.split("expkey_type_")[1]]||"";if("blf"===e[s])for(var r in t.allUsers)if(t.allUsers[r].endpoints.mainextension[0].id===o){o=t.allUsers[r].name;break}n={id:s,name:a("translate")("Line")+" "+s.split("expkey_type_")[1],type:e[s],value:o,label:e["expkey_label_"+s.split("expkey_type_")[1]]||""},i.push(n)}return i}catch(e){console.error(e)}}(t.addBtnCustomization);for(var c=0;c<t.capExpKeyCount*t.capExpModuleCount;c++)""===t.addBtnCustomization[c].type?t.addBtnType[t.addBtnCustomization[c].id]="empty":t.addBtnType[t.addBtnCustomization[c].id]=t.addBtnCustomization[c].type,"speed_dial"!==t.addBtnCustomization[c].type?t.addBtnValue[t.addBtnCustomization[c].id]=t.addBtnCustomization[c].value:t.addBtnValueSpeeddial[t.addBtnCustomization[c].id]=t.addBtnCustomization[c].value,t.addBtnValueLabel[t.addBtnCustomization[c].id]=t.addBtnCustomization[c].label;setTimeout(function(){$(".ui.dropdown.setting").dropdown(),t.$apply()},0)}catch(e){console.error(e)}},t.getPhoneModel=function(e){if(t.currentUser&&t.currentUser.endpoints&&t.currentUser.endpoints.extension)for(var a,n=0;n<t.currentUser.endpoints.extension.length;n++)if((a=t.currentUser.endpoints.extension[n]).id===e)return a.model;return""},t.showDialogSetBtns=function(e){try{t.currentCustomBtnPhone=e;var s=d(e);s?r.getBtnsConfig(s).then(function(s){try{var o,r=_createForOfIteratorHelper(t.currentUser.endpoints.extension.entries());try{for(r.s();!(o=r.n()).done;){var l=_slicedToArray(o.value,2),c=(l[0],l[1]);if(c.id===e){t.currentLineNum=parseInt(c.numLineKeys);break}}}catch(e){r.e(e)}finally{r.f()}t.currentBtnBrand=s.data.display_name,t.currentBtnModel=s.data.model,t.btnCustomization={variables:{}},t.btnType={},t.btnValue={},t.btnValueLabel={},t.createDataForHtml(s,t.currentLineNum),t.capExpKeyCount*t.capExpModuleCount>0&&(t.showAdditionalButtons=!0,t.customAdditionalBtnTable=new i({page:1,count:5},{counts:[],getData:function(e,i){i.total(t.capExpKeyCount*t.capExpModuleCount),t.addBtnCustomizationPaginate=t.addBtnCustomization.slice((i.page()-1)*i.count(),i.page()*i.count()),e.resolve(t.addBtnCustomizationPaginate),setTimeout(function(){var e=[];for(var i in t.allUsers)e.push({title:t.allUsers[i].name});$(".ui.search.add-setting-phone-user-list").search({source:e,showNoResults:!1,onSelect:function(e,a){for(var n in t.allUsers)if(t.allUsers[n].name===e.title){t.addBtnValue[t.addCurrentLineKey]=t.allUsers[n].name;break}t.addBtnValueLabel[t.addCurrentLineKey]=e.title,t.$apply()}}),$(".ui.search.add-setting-phone-speeddial-list").search({type:"category",maxResults:2,apiSettings:{url:customConfig.BASE_API_URL+"/phonebook/search/{query}",beforeXHR:function(e){var t=n.get("credentials");return e.setRequestHeader("Authorization",t.username+":"+t.token),e},onResponse:function(e){var t={results:{}};if(e&&0!==!e.count)return e.rows.length>6&&e.rows.splice(6,e.rows.length),$.each(e.rows,function(e,n){var i;(n.extension||n.cellphone||n.workphone||n.homephone)&&(n.name&&n.company&&""!==n.name.trim()&&""!==n.company.trim()?i='<i class="large user middle aligned grey icon"></i>                                      <span title="'+n.name+'" class="sp-user-name">'+n.name+'</span>                                      <div class="sp-color-gray sp-user-descr" title="'+n.company+'">'+n.company+"</div>":!n.name||""===n.name.trim()||n.company&&""!==n.company.trim()?!n.company||""===n.company.trim()||n.name&&""!==n.name.trim()||(i='<i class="large building middle aligned grey icon"></i>                                      <span title="'+n.company+'" class="sp-user-name">'+n.company+"</span>"):i='<i class="large user middle aligned grey icon"></i>                                      <span title="'+n.name+'" class="sp-user-name">'+n.name+"</span>",t.results[i]={name:i,results:[]},n.extension&&t.results[i].results.push({title:'<i class="call black icon"></i>'+n.extension,description:a("translate")("Extension")}),n.cellphone&&t.results[i].results.push({title:'<i class="mobile black icon"></i>'+n.cellphone,description:a("translate")("Cellphone")}),n.workphone&&t.results[i].results.push({title:'<i class="call black icon"></i>'+n.workphone,description:a("translate")("Work phone")}),n.homephone&&t.results[i].results.push({title:'<i class="call black icon"></i>'+n.homephone,description:a("translate")("Home phone")}))}),t}},minCharacters:4,showNoResults:!0,onSelect:function(e,a){for(var n in t.addBtnValueSpeeddial[t.addCurrentLineKey]=e.title.split("</i>")[1],a)for(var i=0;i<a[n].results.length;i++)if(a[n].results[i].id===e.id){var s=a[n].name.split('sp-user-name">')[1].split("</span>")[0];t.addBtnValueLabel[t.addCurrentLineKey]=s.trim()}t.$apply()}}),e=void 0,$(".ui.dropdown.setting").dropdown({showOnFocus:!1}),t.$apply()},0)}})),t.customBtnTable=new i({page:1,count:5},{counts:[],getData:function(e,i){i.total(t.btnCustomization.length),t.btnCustomizationPaginate=t.btnCustomization.slice((i.page()-1)*i.count(),i.page()*i.count()),e.resolve(t.btnCustomizationPaginate),setTimeout(function(){var e=[];for(var i in t.allUsers)e.push({title:t.allUsers[i].name});$(".ui.search.setting-phone-user-list").search({source:e,showNoResults:!1,onSelect:function(e,a){for(var n in t.allUsers)if(t.allUsers[n].name===e.title){t.btnValue[t.currentLineKey]=t.allUsers[n].name;break}t.btnValueLabel[t.currentLineKey]=e.title,t.$apply()}}),$(".ui.search.setting-phone-speeddial-list").search({type:"category",maxResults:2,apiSettings:{url:customConfig.BASE_API_URL+"/phonebook/search/{query}",beforeXHR:function(e){var t=n.get("credentials");return e.setRequestHeader("Authorization",t.username+":"+t.token),e},onResponse:function(e){var t={results:{}};if(e&&0!==!e.count)return e.rows.length>6&&e.rows.splice(6,e.rows.length),$.each(e.rows,function(e,n){var i;(n.extension||n.cellphone||n.workphone||n.homephone)&&(n.name&&n.company&&""!==n.name.trim()&&""!==n.company.trim()?i='<i class="large user middle aligned grey icon"></i>                                      <span title="'+n.name+'" class="sp-user-name">'+n.name+'</span>                                      <div class="sp-color-gray sp-user-descr" title="'+n.company+'">'+n.company+"</div>":!n.name||""===n.name.trim()||n.company&&""!==n.company.trim()?!n.company||""===n.company.trim()||n.name&&""!==n.name.trim()||(i='<i class="large building middle aligned grey icon"></i>                                      <span title="'+n.company+'" class="sp-user-name">'+n.company+"</span>"):i='<i class="large user middle aligned grey icon"></i>                                      <span title="'+n.name+'" class="sp-user-name">'+n.name+"</span>",t.results[i]={name:i,results:[]},n.extension&&t.results[i].results.push({title:'<i class="call black icon"></i>'+n.extension,description:a("translate")("Extension")}),n.cellphone&&t.results[i].results.push({title:'<i class="mobile black icon"></i>'+n.cellphone,description:a("translate")("Cellphone")}),n.workphone&&t.results[i].results.push({title:'<i class="call black icon"></i>'+n.workphone,description:a("translate")("Work phone")}),n.homephone&&t.results[i].results.push({title:'<i class="call black icon"></i>'+n.homephone,description:a("translate")("Home phone")}))}),t}},minCharacters:4,showNoResults:!0,onSelect:function(e,a){for(var n in t.btnValueSpeeddial[t.currentLineKey]=e.title.split("</i>")[1],a)for(var i=0;i<a[n].results.length;i++)if(a[n].results[i].id===e.id){var s=a[n].name.split('sp-user-name">')[1].split("</span>")[0];t.btnValueLabel[t.currentLineKey]=s.trim()}t.$apply()}}),e=void 0,$(".ui.dropdown.setting").dropdown({showOnFocus:!1}),t.$apply()},0)}}),setTimeout(function(){$(".ui.modal.set-physical-buttons").modal({onApprove:function(){if(!1===t.isValidForm)return!1}}).modal("show"),$(".menu .item").tab(),$("#info-additional-buttons").popup({inline:!0,position:"left center"})},0)}catch(c){console.error(c)}},function(e){console.error("getting btns config from the server"),console.error(e),t.showSettingsDevicesWarningMessage(a("translate")("Warning"),a("translate")("Some error occurred while getting phone data from the server. Physical keys cannot be configured")+".")}):console.error("getting btns config from the server: mac of exten ".concat(e," not found"))}catch(e){console.error(e)}},t.valueFocused=function(e){try{t.currentLineKey=e}catch(e){console.error(e)}},t.addValueFocused=function(e){try{t.addCurrentLineKey=e}catch(e){console.error(e)}}}]),angular.module("nethctiUiApp").service("LocalStorageService",["$window",function(e){var t=this;this.set=function(t,a){e.localStorage&&e.localStorage.setItem(t,JSON.stringify(a))},this.get=function(t,a){if(e.localStorage.getItem(t)&&"undefined"!==e.localStorage.getItem(t)&&void 0!==e.localStorage.getItem(t)){var n=e.localStorage.getItem(t)||"";return a?n:JSON.parse(n)}return""},this.remove=function(t){e.localStorage&&e.localStorage.removeItem(t)},this.removeProp=function(t,a){var n=JSON.parse(e.localStorage.getItem(t));n&&(delete n[a]&&n[a],e.localStorage.setItem(t,JSON.stringify(n)))},this.emptyVideoConferenceData=function(){t.remove("vcRoomUrl"),t.remove("vcRoomInvitedParticipants")}}]),angular.module("nethctiUiApp").service("PhonebookService",["$q","RestService",function(e,t){this.search=function(a,n,i,s){return e(function(e,o){t.get("/phonebook/search/"+a+"?offset="+i+"&limit="+n+"&view="+s).then(function(t){e(t)},function(e){o(e)})})},this.searchDigit=function(a,n,i){return e(function(e,s){t.get("/phonebook/searchstartswith_digit/all?offset="+n+"&limit="+a+"&view="+i).then(function(t){e(t)},function(e){s(e)})})},this.retrieveSpeedDials=function(){return e(function(e,a){t.get("/phonebook/speeddials").then(function(t){e(t)},function(e){a(e)})})},this.retrieveCtiContact=function(a){return e(function(e,n){t.get("/phonebook/cticontact/"+a).then(function(t){e(t)},function(e){n(e)})})},this.retrieveContact=function(a){return e(function(e,n){t.get("/phonebook/contact/"+a).then(function(t){e(t)},function(e){n(e)})})},this.searchStartWith=function(a,n,i,s){return e(function(e,o){t.get("/phonebook/searchstartswith/"+a+"?offset="+i+"&limit="+n+"&view="+s).then(function(t){e(t)},function(e){o(e)})})},this.create=function(a){return e(function(e,n){t.post("/phonebook/create",a).then(function(t){e(t)},function(e){n(e)})})},this.delete=function(a){return e(function(e,n){t.post("/phonebook/delete_cticontact",{id:a.toString()}).then(function(t){e(t)},function(e){n(e)})})},this.modify=function(a){return e(function(e,n){t.post("/phonebook/modify_cticontact",a).then(function(t){e(t)},function(e){n(e)})})},this.importCsvSpeddial=function(a){return e(function(e,n){t.post("/phonebook/import_csv_speeddial",{file64:a}).then(function(t){e(t)},function(e){n(e)})})},this.deleteAllSpeedDial=function(a){return e(function(e,a){t.delete("/phonebook/speeddials").then(function(t){e(t)},function(e){a(e)})})}}]),angular.module("nethctiUiApp").service("PhoneService",["$q","RestService",function(e,t){this.getPinActivationStatus=function(){return e(function(e,a){t.get("/astproxy/pinstatus").then(function(t){e(t)},function(e){a(e)})})},this.getPrefix=function(){return e(function(e,a){t.get("/astproxy/prefix").then(function(t){e(t)},function(e){a(e)})})},this.getAllExtension=function(){return e(function(e,a){t.get("/astproxy/extensions").then(function(t){e(t)},function(e){a(e)})})},this.getMyConversations=function(a){return e(function(e,n){t.get("/astproxy/extension/"+a).then(function(t){e(t)},function(e){n(e)})})},this.getCallMode=function(){return e(function(e,a){t.get("/configmanager/userconf").then(function(t){e(t)},function(e){a(e)})})},this.setCallMode=function(a){return e(function(e,n){t.post("/configmanager/click2call",a).then(function(t){e(t)},function(e){n(e)})})},this.testCallAutoMode=function(a){return e(function(e,n){t.post("/astproxy/call_echo",a).then(function(t){e(t)},function(e){n(e)})})},this.isSupportedCallAutoMode=function(a){return e(function(e,n){t.get("/astproxy/is_autoc2c_supported/"+a).then(function(t){e(t)},function(e){n(e)})})},this.call=function(a){return e(function(e,n){t.post("/astproxy/call",a).then(function(t){e(t)},function(e){n(e)})})},this.answer=function(a){return e(function(e,n){t.post("/astproxy/answer",a).then(function(t){e(t)},function(e){n(e)})})},this.hangup=function(a){return e(function(e,n){t.post("/astproxy/hangup",a).then(function(t){e(t)},function(e){n(e)})})},this.recallOnBusy=function(a){return e(function(e,n){t.post("/astproxy/recall_on_busy",a).then(function(t){e(t)},function(e){n(e)})})},this.attendedTransfer=function(a){return e(function(e,n){t.post("/astproxy/atxfer",a).then(function(t){e(t)},function(e){n(e)})})},this.blindTransfer=function(a){return e(function(e,n){t.post("/astproxy/blindtransfer",a).then(function(t){e(t)},function(e){n(e)})})},this.toggleMute=function(a,n){return e(function(e,i){a?t.post("/astproxy/unmute",n).then(function(t){e(t)},function(e){i(e)}):t.post("/astproxy/mute",n).then(function(t){e(t)},function(e){i(e)})})},this.togglePause=function(a){return e(function(e,n){t.post("/astproxy/toggle_hold",a).then(function(t){e(t)},function(e){n(e)})})},this.toggleRecord=function(a,n,i){return e(function(e,s){a?t.post("/astproxy/mute_record",i).then(function(t){e(t)},function(e){s(e)}):n?t.post("/astproxy/unmute_record",i).then(function(t){e(t)},function(e){s(e)}):t.post("/astproxy/start_record",i).then(function(t){e(t)},function(e){s(e)})})},this.park=function(a){return e(function(e,n){t.post("/astproxy/park",a).then(function(t){e(t)},function(e){n(e)})})},this.sendDTMF=function(a){return e(function(e,n){t.post("/astproxy/dtmf",a).then(function(t){e(t)},function(e){n(e)})})},this.pickup=function(a){return e(function(e,n){t.post("/astproxy/pickup_conv",a).then(function(t){e(t)},function(e){n(e)})})},this.startSpy=function(a){return e(function(e,n){t.post("/astproxy/start_spy",a).then(function(t){e(t)},function(e){n(e)})})},this.intrude=function(a){return e(function(e,n){t.post("/astproxy/intrude",a).then(function(t){e(t)},function(e){n(e)})})}}]),angular.module("nethctiUiApp").service("UtilService",["$filter",function(e){this.monthName=function(e){return["January","February","March","April","May","June","July","August","September","October","November","December"][e-1]},this.dateNow=function(){var e=new Date(Date.now());return e.getFullYear()+"/"+("0"+(e.getMonth()+1)).slice(-2)+"/"+("0"+e.getDate()).slice(-2)},this.NWeeksAgo=function(e){var t=604800*e*1e3,a=(new Date).getTime()-t,n=new Date(a);return n.getFullYear()+"/"+("0"+(n.getMonth()+1)).slice(-2)+"/"+("0"+n.getDate()).slice(-2)},this.getDateFormat=function(e){return e?(e=new Date(e)).getFullYear()+"/"+("0"+(e.getMonth()+1)).slice(-2)+"/"+("0"+e.getDate()).slice(-2):null},this.getDateTexts=function(){return{days:[e("translate")("SS"),e("translate")("M"),e("translate")("TT"),e("translate")("W"),e("translate")("T"),e("translate")("F"),e("translate")("S")],months:[e("translate")("January"),e("translate")("February"),e("translate")("March"),e("translate")("April"),e("translate")("May"),e("translate")("June"),e("translate")("July"),e("translate")("August"),e("translate")("September"),e("translate")("October"),e("translate")("November"),e("translate")("December")],monthsShort:[e("translate")("Jan"),e("translate")("Feb"),e("translate")("Mar"),e("translate")("Apr"),e("translate")("May_s"),e("translate")("Jun"),e("translate")("Jul"),e("translate")("Aug"),e("translate")("Sep"),e("translate")("Oct"),e("translate")("Nov"),e("translate")("Dec")],today:e("translate")("Today"),now:e("translate")("Now")}},this.parseCaller=function(e){return e.split("<")[0].replace(/"/g,"")},this.resizeBase64Img=function(e,t,a){var n=document.createElement("canvas");n.width=t,n.height=a;var i=n.getContext("2d"),s=$.Deferred();return $("<img/>").attr("src",e).on("load",function(){i.scale(t/this.width,a/this.height),i.drawImage(this,0,0),s.resolve(n.toDataURL())}),s.promise()},this.exportCSVFile=function(e,t,a){e&&t.unshift(e);var n=JSON.stringify(t),i=this.convertToCSV(n),s=a+".csv"||"export.csv",o=new Blob([i],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(o,s);else{var r=document.createElement("a");if(void 0!==r.download){var l=URL.createObjectURL(o);r.setAttribute("href",l),r.setAttribute("download",s),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)}}},this.convertToCSV=function(e){for(var t="object"!==_typeof(e)?JSON.parse(e):e,a="",n=0;n<t.length;n++){var i="";for(var s in t[n])""!==i&&(i+=","),i+=null===t[n][s]?"":t[n][s];a+=i+"\r\n"}return a}}]),angular.module("nethctiUiApp").filter("capitalize",function(){return function(e){return e&&e.charAt(0).toUpperCase()+e.slice(1)}}),angular.module("nethctiUiApp").filter("secondsToReadable",["$filter",function(e){return function(t){if(null==t)return"";var a,n,i,s;if(s=t,i=Math.floor(s/60),s%=60,n=Math.floor(i/60),i%=60,a=Math.floor(n/24),n%=24,0==a)var o=(n>0?n+"h ":"")+(i>0?i+"' ":"")+s+'"';else o=a+e("translate")("d")+" "+n+"h "+i+"'";return o}}]),angular.module("nethctiUiApp").service("HistoryService",["$q","RestService","UtilService",function(e,t,a){this.search=function(n,i,s,o,r,l,c,d,u){var p="/historycall/interval/user/"+n;return i&&(i=i.replace(/\//g,""),p+="/"+i,s||(p+="/"+a.dateNow().replace(/\//g,""))),s&&(s=s.replace(/\//g,""),p+="/"+s),o&&(p+="/"+o),d="all"!==d&&0!=d.length?"&direction="+d:"",e(function(e,a){t.get(p+"?offset="+r+"&limit="+l+"&sort="+c+d+"&removeLostCalls="+u).then(function(t){e(t)},function(e){a(e)})})},this.searchSwitchboard=function(n,i,s,o,r,l,c,d){var u="/histcallswitch/interval";return n&&(n=n.replace(/\//g,""),u+="/"+n,i||(u+="/"+a.dateNow().replace(/\//g,""))),i&&(i=i.replace(/\//g,""),u+="/"+i),s&&(u+="/"+s),c="all"!==c&&0!=c.length?"&type="+c:"",e(function(e,a){t.get(u+"?offset="+o+"&limit="+r+"&sort="+l+c+"&removeLostCalls="+d).then(function(t){e(t)},function(e){a(e)})})},this.searchGroup=function(n,i,s,o,r,l,c,d){var u="/histcallsgroups/interval";return n&&(n=n.replace(/\//g,""),u+="/"+n,i||(u+="/"+a.dateNow().replace(/\//g,""))),i&&(i=i.replace(/\//g,""),u+="/"+i),s&&(u+="/"+s),c="all"!==c&&0!=c.length?"&type="+c:"",e(function(e,a){t.get(u+"?offset="+o+"&limit="+r+"&sort="+l+c+"&removeLostCalls="+d).then(function(t){e(t)},function(e){a(e)})})},this.listenRecording=function(a){return e(function(e,n){t.get("/historycall/listen_callrec/"+a).then(function(t){e(t)},function(e){n(e)})})},this.downloadRecording=function(a){return e(function(e,n){t.get("/historycall/down_callrec/"+a).then(function(t){e(t)},function(e){n(e)})})},this.deleteRecording=function(a){return e(function(e,n){t.post("/historycall/delete_callrec",{id:a}).then(function(t){e(t)},function(e){n(e)})})},this.listenVoicemail=function(a){return e(function(e,n){t.get("/voicemail/listen/"+a).then(function(t){e(t)},function(e){n(e)})})},this.downloadVoicemail=function(a){return e(function(e,n){t.get("/voicemail/download/"+a).then(function(t){e(t)},function(e){n(e)})})},this.deleteVoicemail=function(a){return e(function(e,n){t.post("/voicemail/delete",{id:a.toString()}).then(function(t){e(t)},function(e){n(e)})})},this.searchVoicemail=function(){return e(function(e,a){t.get("/voicemail/list/all").then(function(t){e(t)},function(e){a(e)})})},this.searchVoicemailNew=function(){return e(function(e,a){t.get("/voicemail/list/inbox").then(function(t){e(t)},function(e){a(e)})})}}]),angular.module("nethctiUiApp").service("QManagerService",["$q","RestService",function(e,t){this.getQueues=function(){return e(function(e,a){t.get("/astproxy/qmanager_queues").then(function(t){e(t)},function(e){a(e)})})},this.getQueueStats=function(a){return e(function(e,n){t.get("/astproxy/qmanager_qstats/"+a).then(function(t){e(t)},function(e){n(e)})})},this.addUserQueue=function(a){return e(function(e,n){t.post("/astproxy/queuemember_add",a).then(function(t){e(t)},function(e){n(e)})})},this.removeUserQueue=function(a){return e(function(e,n){t.post("/astproxy/queuemember_remove",a).then(function(t){e(t)},function(e){n(e)})})},this.pauseUserQueue=function(a){return e(function(e,n){t.post("/astproxy/queuemember_pause",a).then(function(t){e(t)},function(e){n(e)})})},this.unpauseUserQueue=function(a){return e(function(e,n){t.post("/astproxy/queuemember_unpause",a).then(function(t){e(t)},function(e){n(e)})})},this.blindTransferQueue=function(a){return e(function(e,n){t.post("/astproxy/blindtransfer_queue",a).then(function(t){e(t)},function(e){n(e)})})},this.getAgentsStats=function(){return e(function(e,a){t.get("/astproxy/qmanager_astats").then(function(t){e(t)},function(e){a(e)})})},this.getAlarms=function(){return e(function(e,a){t.get("/astproxy/qalarms").then(function(t){e(t)},function(e){a(e)})})},this.getQueuesHistory=function(){return e(function(e,a){t.get("/astproxy/qmanager_qcalls_hist").then(function(t){e(t)},function(e){a(e)})})},this.getQMLCalls=function(a,n,i,s,o){return e(function(e,r){var l="";void 0!==s&&void 0!==o&&(l="?limit="+s+"&offset="+o),t.get("/astproxy/qmanager_queue_recall/"+a+"/"+n+"/"+i+l).then(function(t){e(t)},function(e){r(e)})})},this.getQMRecallDetails=function(a,n,i){return e(function(e,s){t.get("/astproxy/qmanager_qrecall_info/"+n+"/"+a+"/"+i).then(function(t){e(t)},function(e){s(e)})})}}]),angular.module("nethctiUiApp").filter("trustUrl",["$sce",function(e){return function(t){return e.trustAsResourceUrl(t)}}]),angular.module("nethctiUiApp").filter("utc",function(){return function(e){var t=new Date(e);return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds())}}),angular.module("nethctiUiApp").filter("timeparse",["$filter",function(e){return function(t){var a,n,i,s,o=new Date(1e3*t);o=new Date(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate(),o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds()),s=Math.floor((Date.now()-o)/1e3),i=Math.floor(s/60),s%=60,n=Math.floor(i/60),i%=60,a=Math.floor(n/24),n%=24;var r="";return a>0?r=a+e("translate")("d")+" "+e("translate")("ago"):n>0?r=n+"h "+e("translate")("ago"):i>0?r=i+"m "+e("translate")("ago"):s>0&&(r=s+"s "+e("translate")("ago")),r}}]),angular.module("nethctiUiApp").service("OperatorService",["$q","RestService",function(e,t){this.allUsers=function(a){return e(function(e,a){t.get("/user/endpoints/all").then(function(t){e(t)},function(e){a(e)})})},this.blindTransferQueue=function(a){return e(function(e,n){t.post("/astproxy/blindtransfer_queue",a).then(function(t){e(t)},function(e){n(e)})})},this.blindTransfer=function(a){return e(function(e,n){t.post("/astproxy/blindtransfer",a).then(function(t){e(t)},function(e){n(e)})})},this.opWaitConv=function(a){return e(function(e,n){t.post("/astproxy/op_wait_conv",a).then(function(t){e(t)},function(e){n(e)})})},this.pickupQueueWaitingCaller=function(a){return e(function(e,n){t.post("/astproxy/pickup_qwaitcaller",a).then(function(t){e(t)},function(e){n(e)})})},this.userGroups=function(a){return e(function(e,a){t.get("/astproxy/opgroups").then(function(t){e(t)},function(e){a(e)})})},this.getOpPanelData=function(a){return e(function(e,a){t.get("/astproxy/opdata").then(function(t){e(t)},function(e){a(e)})})}}]),angular.module("nethctiUiApp").filter("cleanName",function(){return function(e){return e.split("(")[0]}}),angular.module("nethctiUiApp").filter("customFilter",function(){return function(e,t,a){if(!e)return e;if(!a)return e;var n=(""+a).toLowerCase(),i={};return angular.forEach(e,function(e,a){-1!==(""+e[t]).toLowerCase().indexOf(n)&&(i[a]=e)}),i}}),angular.module("nethctiUiApp").filter("customOrder",function(){return function(e,t,a){var n=[];return angular.forEach(e,function(e){n.push(e)}),n.sort(function(e,a){return!e[t]&&0!==e[t]||!a[t]&&0!==a[t]?-1:e[t].toString().toLowerCase()>a[t].toString().toLowerCase()?1:-1}),a&&n.reverse(),n}}),angular.module("nethctiUiApp").filter("customOrderOperators",function(){return function(e,t,a){var n=[];return angular.forEach(e,function(e){n.push(e)}),"exten"==t?n.sort(function(e,t){return!e.endpoints.mainextension[0].id&&0!==e.endpoints.mainextension[0].id||!t.endpoints.mainextension[0].id&&0!==t.endpoints.mainextension[0].id?-1:e.endpoints.mainextension[0].id.toString().toLowerCase()>t.endpoints.mainextension[0].id.toString().toLowerCase()?1:-1}):n.sort(function(e,a){return!e[t]&&0!==e[t]||!a[t]&&0!==a[t]?-1:e[t].toString().toLowerCase()>a[t].toString().toLowerCase()?1:-1}),a&&n.reverse(),n}}),angular.module("nethctiUiApp").filter("contains",function(){return function(e,t){return e.indexOf(t)>=0}}),angular.module("nethctiUiApp").service("QueueService",["$q","RestService",function(e,t){this.allQueues=function(a){return e(function(e,a){t.get("/astproxy/queues").then(function(t){e(t)},function(e){a(e)})})},this.recallCheck=function(a){return e(function(e,n){t.get("/astproxy/qrecall_check/"+a).then(function(t){e(t)},function(e){n(e)})})},this.getRecallDetails=function(a,n,i){return e(function(e,s){t.get("/astproxy/qrecall_info/"+n+"/"+a+"/"+i).then(function(t){e(t)},function(e){s(e)})})},this.getQLostCalls=function(a,n,i,s,o){return e(function(e,r){t.get("/astproxy/queue_recall/"+a+"/"+n+"/"+i+"?limit="+s+"&offset="+o).then(function(t){e(t)},function(e){r(e)})})},this.loginlogout=function(a){return e(function(e,n){t.post("/astproxy/inout_dyn_queues",a).then(function(t){e(t)},function(e){n(e)})})},this.login=function(a){return e(function(e,n){t.post("/astproxy/queuemember_add",a).then(function(t){e(t)},function(e){n(e)})})},this.logout=function(a){return e(function(e,n){t.post("/astproxy/queuemember_remove",a).then(function(t){e(t)},function(e){n(e)})})},this.pause=function(a){return e(function(e,n){t.post("/astproxy/queuemember_pause",a).then(function(t){e(t)},function(e){n(e)})})},this.unpause=function(a){return e(function(e,n){t.post("/astproxy/queuemember_unpause",a).then(function(t){e(t)},function(e){n(e)})})},this.getAgentStats=function(){return e(function(e,a){t.get("/astproxy/queue_astats").then(function(t){e(t)},function(e){a(e)})})}}]),angular.module("nethctiUiApp").filter("isempty",function(){return function(e,t){if(t){var a=[];for(var n in e)a.push(0==Object.keys(e[n]).length);return a.every(Boolean)}return 0==Object.keys(e).length}}),angular.module("nethctiUiApp").filter("length",function(){return function(e){return Object.keys(e).length}}),angular.module("nethctiUiApp").controller("CustomercardCtrl",["$rootScope","$scope","$routeParams","CustomercardService",function(e,t,a,n){t.searchNum=a.num,t.cards=[],t.viewLoad=!0,t.getCustomerCards=function(){n.getCustomerCards(t.searchNum).then(function(e){t.cards=Object.keys(e.data).map(function(t){return e.data[t].key=t,e.data[t]}),t.cards.sort(function(e,a){return t.currentUser.settings&&t.currentUser.settings.ccard_order&&t.currentUser.settings.ccard_order.indexOf(e.key)-t.currentUser.settings.ccard_order.indexOf(a.key)}),t.viewLoad=!1},function(e){console.error(e),t.viewLoad=!1})},t.getCustomerCards(),t.initGraphics=function(){angular.element(document).ready(function(){$(".ui.dropdown").dropdown()})},t.initGraphics(),t.$on("socketAutheOK",function(e,a){t.getCustomerCards()}),t.$on("serverReloaded",function(e,a){t.getCustomerCards()})}]),angular.module("nethctiUiApp").service("CustomercardService",["$q","RestService",function(e,t){this.getCustomerCards=function(a){return e(function(e,n){t.get("/custcard/getbynum/"+a+"/html").then(function(t){e(t)},function(e){n(e)})})},this.getCustomerCardsList=function(a){return e(function(e,a){t.get("/custcard/list").then(function(t){e(t)},function(e){a(e)})})}}]),angular.module("nethctiUiApp").filter("base64Conv",function(){return function(e){return atob(e)}}),angular.module("nethctiUiApp").controller("SettingsCtrl",["$rootScope","$scope","LocalStorageService","UserService","CustomercardService","SettingsService","UtilService","LoginService","ThemeService","$timeout",function(e,t,a,n,i,s,o,r,l,c){t.DEFAULT_AVATAR="img/steve.6204f1d6.jpg",t.appConfig=appConfig,t.userSettings=t.currentUser.settings||{},t.availableCards=[],t.viewLoad=!0,t.emptySettings=!1,t.lostCallsUpdateInterval=a.get("lostCallsUpdateInterval"),t.lostCallsUpdateInterval=t.lostCallsUpdateInterval<20?20:t.lostCallsUpdateInterval,t.avatar_image=t.userSettings.avatar||t.DEFAULT_AVATAR,t.settingsTab="profile",t.savingPin={},t.devicesPin={},t.showPin={},t.qPauseAvailPresence=[],t.qPauseSelectedPresence=[],t.colors=[],t.colorsLimit=20,t.settingsClicked,t.loadMoreColors=function(){t.colorsLimit+=20},t.getCustomerCards=function(){i.getCustomerCardsList().then(function(e){$.isEmptyObject(e.data)?(t.viewLoad=!1,t.emptySettings=!0,t.availableCards=[]):(t.availableCards=Object.keys(e.data).map(function(t){return e.data[t].key=t,e.data[t]}),t.availableCards.sort(function(e,a){return t.userSettings&&t.userSettings.ccard_order&&t.userSettings.ccard_order.indexOf(e.key)-t.userSettings.ccard_order.indexOf(a.key)}),t.viewLoad=!1,t.emptySettings=!1)},function(e){console.error(e),t.availableCards=[],t.viewLoad=!1,t.emptySettings=!0})},t.toggleAudioEchoCancellation=function(){t.userSettings.audio_echo_cancellation=!t.userSettings.audio_echo_cancellation,t.updateSettings()},t.getParamUrl=function(){a.remove("paramUrl"),t.paramUrl=void 0,t.paramUrlOnlyQueues=void 0,n.getParamUrl().then(function(e){e&&e.data&&"string"==typeof e.data.url&&""!==e.data.url?(a.set("paramUrl",e.data.url),a.set("paramUrlOnlyQueues",e.data.only_queues),t.paramUrl=e.data.url,t.paramUrlOnlyQueues=e.data.only_queues):(a.remove("paramUrl"),a.remove("paramUrlOnlyQueues"),t.paramUrl=void 0,t.paramUrlOnlyQueues=void 0),t.$emit("paramUrlChanged",t.paramUrl)},function(e){console.error(e),t.paramUrl=void 0,t.paramUrlOnlyQueues=void 0,a.remove("paramUrl"),a.remove("paramUrlOnlyQueues")})},t.updateCustomerCardsOrder=function(){t.userSettings.ccard_order=t.availableCards.map(function(e){return e.key}),t.updateSettings()},t.setCustomerCardView=function(e){t.userSettings.open_ccard=e,t.updateSettings()},t.toggleDesktopNotifications=function(){t.userSettings.desktop_notifications=!t.userSettings.desktop_notifications,t.updateSettings()},t.toggleChatNotifications=function(){t.userSettings.chat_notifications=!t.userSettings.chat_notifications,t.updateSettings(),jsxc.init({notification:void 0===t.userSettings.chat_notifications||t.userSettings.chat_notifications})},t.toggleAutoQueueLogout=function(){t.userSettings.queue_auto_logout=!t.userSettings.queue_auto_logout,t.updateSettings()},t.toggleAutoQueueLogin=function(){t.userSettings.queue_auto_login=!t.userSettings.queue_auto_login,t.updateSettings()},t.toggleAutoDndOnLogout=function(){t.userSettings.auto_dndon_logout=!t.userSettings.auto_dndon_logout,t.updateSettings()},t.toggleAutoDndOffLogin=function(){t.userSettings.auto_dndoff_login=!t.userSettings.auto_dndoff_login,t.updateSettings()},t.toggleCallRingtone=function(){t.userSettings.call_ringtone=!t.userSettings.call_ringtone,t.updateSettings()},t.uploadImage=function(){$(".ui.action.avatar").find("input:file").click()};t.setColor=function(e){a.set("colorsGradient",e),t.$parent.selectedColor=e,t.$emit("applyGradient",e)},t.resetThemeColor=function(){a.remove("colorsGradient"),t.$parent.selectedColor="",t.setGradients()},t.isColorSet=function(e){return JSON.stringify(t.selectedColor)==JSON.stringify(e.colors)};t.setSettingsTab=function(e){t.settingsTab=e,"profile"==e?t.initProfileGraphics():"queues"==e?t.initQueuesGraphics():"incomingcalls"==e?t.initIncomingCallsGraphics():"theme"==e&&(t.colors=l.getColors())};t.showConfirmQrCode=function(){$("#QRConfirmModal").modal({closable:!1,onApprove:function(){d()}}).modal("show")};var d=function(){var e=a.get("credentials"),n=t.profiling.publichost||t.profiling.hostname||window.location.hostname,i=document.querySelector("#qrCodeCanvas").getContext("2d");i.clearRect(0,0,i.width,i.height),t.qrLoading=!0,t.$$phase||t.$apply(),$("#QRConfirmModal").modal("hide"),$("#QRCodeModal").modal({closable:!1,onVisible:function(){r.appLogin(e).then(function(a){var i=e.username+";"+a.token+";"+n;QRCode.toCanvas(document.querySelector("#qrCodeCanvas"),i,{height:400,width:400},function(e){e&&console.error(e)}),t.qrLoading=!1},function(e){console.log(e)})}}).modal("show")};t.showMessage=function(e){$(e).show(),setTimeout(function(){$(e).hide()},7e3)},t.initProfileGraphics=function(){void 0===t.userSettings.desktop_notifications&&(t.userSettings.desktop_notifications=!0),void 0===t.userSettings.chat_notifications&&(t.userSettings.chat_notifications=!0),void 0===t.userSettings.call_ringtone&&(t.userSettings.call_ringtone=!0),void 0===t.userSettings.auto_dndon_logout&&(t.userSettings.auto_dndon_logout=!1),void 0===t.userSettings.auto_dndoff_login&&(t.userSettings.auto_dndoff_login=!1),angular.element(".special.cards .image").ready(function(){$(".special.cards .image").dimmer({on:"hover"})}),angular.element("input:file",".ui.action.input").ready(function(){$("input:file",".ui.action.input").on("change",function(e){var a=e.target.files[0].name;$("input:text",$(e.target).parent()).val(a);for(var n=e.target.files,i=0;i<n.length;i++){var s=n[i],r=new FileReader;r.onload=function(e){t.$apply(function(){o.resizeBase64Img(e.target.result,t.appConfig.PROFILE_IMAGE_SIZE,t.appConfig.PROFILE_IMAGE_SIZE).then(function(e){t.userSettings.avatar=e,t.updateSettings(function(){t.avatar_image=e})})})},r.readAsDataURL(s)}})})},t.toggleQAutoPauseOnPresence=function(){t.userSettings.queue_auto_pause_onpresence=!t.userSettings.queue_auto_pause_onpresence,t.updateSettings()},t.$on("recvAvailablePresence",function(e,a){t.initQMultiSelect()}),t.initQMultiSelect=function(){t.qPauseAvailPresence=[],t.qPauseAvailPresence=_toConsumableArray(t.availablePresence);var e=t.qPauseAvailPresence.indexOf("online");t.qPauseAvailPresence.splice(e,1),$("#qMultiSelect").dropdown({onChange:function(e,a,n){t.qPauseSelectedPresence=e,t.userSettings.queue_autopause_presencelist=JSON.stringify(t.qPauseSelectedPresence),t.updateSettings()}}),t.qPauseSelectedPresence=t.userSettings.queue_autopause_presencelist,setTimeout(function(){"string"==typeof t.userSettings.queue_autopause_presencelist&&(t.qPauseSelectedPresence=JSON.parse(t.userSettings.queue_autopause_presencelist)),$("#qMultiSelect").dropdown("set selected",t.qPauseSelectedPresence)},0)},t.initQueuesGraphics=function(){void 0===t.userSettings.queue_auto_logout&&(t.userSettings.queue_auto_logout=!1),void 0===t.userSettings.queue_auto_login&&(t.userSettings.queue_auto_login=!1),angular.element("#queuesTabContainer").ready(function(){$("#q-auto-update-slider").range({min:20,max:60,start:t.lostCallsUpdateInterval,step:5,onChange:function(e,n){a.set("lostCallsUpdateInterval",e),t.lostCallsUpdateInterval=e,t.$$phase||t.$apply()}}),$("#q-lost-call-hours-slider").range({min:1,max:12,start:a.get("lostCallsHoursInterval")||12,step:1,onChange:function(e,n){t.lostCallsHoursInterval=e,a.set("lostCallsHoursInterval",e),t.$$phase||t.$apply()}})}),t.initQMultiSelect()},t.initIncomingCallsGraphics=function(){void 0===t.userSettings.open_param_url&&(t.userSettings.open_param_url="never"),angular.element('input[name="paramUrlRadio"]').ready(function(){$('input[name="paramUrlRadio"]').change(function(){t.userSettings.open_param_url=$(this).val(),a.set("open_param_url",t.userSettings.open_param_url),t.updateSettings(),t.$emit("paramUrlRadioChanged",t.userSettings.open_param_url)})})},t.initGraphics=function(){t.initProfileGraphics(),t.initQueuesGraphics(),t.initIncomingCallsGraphics(),$(".ui.dropdown").dropdown({showOnFocus:!1}),$(".menu .item").tab()},t.hasWebrtc=function(){for(var e=0;e<t.currentUser.endpoints.extension.length;e++)if("webrtc"===t.currentUser.endpoints.extension[e].type)return!0;return!1},t.hasPhysicalPhone=function(){for(var e=0;e<t.currentUser.endpoints.extension.length;e++)if(console.log(t.currentUser.endpoints.extension[e].type),"physical"===t.currentUser.endpoints.extension[e].type)return!0;return!1},t.getDevices=function(){s.getDevices().then(function(e){t.devicesPin=e.data},function(e){console.error(e)})},t.savePin=function(e){s.setPin({extension:t.savingPin.id,pin:t.savingPin.pin,enabled:t.savingPin.enabled}).then(function(){t.getDevices(),"save"===e?t.showMessage("#savedMessage"):t.showMessage("#onOfMessage")},function(e){t.showMessage("#saveErrorMessage"),console.error(e)})},t.onOfPinConfirm=function(e,a,n){angular.copy(e,t.savingPin),t.savingPin.pin=a,t.savingPin.enabled=!n,$("#costumerDevicesTabContainer .message").hide(),$("#pin-onof-message").modal("show")},t.savePinConfirm=function(e,a,n){angular.copy(e,t.savingPin),t.savingPin.pin=a,t.savingPin.enabled=!0,$("#costumerDevicesTabContainer .message").hide(),$("#pin-save-message").modal("show")},t.hidePinModal=function(){$("#pin-save-message").modal("hide")},t.hideOnOfModal=function(){$("#pin-onof-message").modal("hide")},t.updateSettings=function(e){s.setUserSettings(t.userSettings).then(function(a){e&&e(a),t.$emit("settingsUpdated",{settings:a.config.data})},function(a){t.viewLoad=!1,console.error(a),e&&e(a)})},t.removeAvatar=function(){s.removeAvatar().then(function(e){t.avatar_image=t.DEFAULT_AVATAR},function(e){t.viewLoad=!1,console.error(e)})},t.createRandomPin=function(e){t.devicesPin[e].pin=Math.floor(1e3+9e3*Math.random())+"",t.showPin[e]=!0},t.$on("serverReloaded",function(e,a){t.getCustomerCards(),t.getParamUrl()}),t.$on("$routeChangeStart",function(){e.settingsTabGlobal="",$("#QRCodeModal").remove(),$("#QRConfirmModal").remove()}),t.checkTab=function(){1==t.settingsClicked?(t.settingsTab="devices",c(function(){t.showConfirmQrCode()},500)):t.settingsTab="profile","queues"==e.settingsTabGlobal?t.settingsTab="queues":t.settingsTab="profile"},angular.element(document).ready(function(){t.initGraphics(),t.checkTab()}),t.getDevices(),t.getCustomerCards(),t.getParamUrl(),s.getProfiling().then(function(e){t.profiling=e},function(e){console.log(e)})}]),angular.module("nethctiUiApp").service("SettingsService",["$q","$filter","RestService",function(e,t,a){this.setUserSettings=function(t){return e(function(e,n){a.post("/user/settings",t).then(function(t){e(t)},function(e){n(e)})})},this.removeAvatar=function(t){return e(function(e,n){a.delete("/user/setting/avatar",t).then(function(t){e(t)},function(e){n(e)})})},this.getDevices=function(){return e(function(e,t){a.get("/astproxy/pin").then(function(t){e(t)},function(e){t(e)})})},this.setPin=function(t){return e(function(e,n){a.post("/astproxy/pin",t).then(function(t){e(t)},function(e){n(e)})})},this.getBtnsConfig=function(t){return e(function(e,n){a.get("/tancredi/api/v1/phones/"+t.toUpperCase()+"?inherit=1").then(function(t){e(t)},function(e){n(e)})})},this.saveBtnsConfig=function(t,n){return e(function(e,i){a.patch("/tancredi/api/v1/phones/"+t,n).then(function(t){e(t)},function(e){i(e)})})},this.reloadPhysicalPhone=function(t){return e(function(e,n){a.post("/astproxy/phone_reload",{exten:t}).then(function(t){e(t)},function(e){n(e)})})},this.getProvisioningEngine=function(){return e(function(e,t){a.get("/freepbx/rest/provisioning/engine").then(function(t){e(t)},function(e){t(e)})})},this.getAppVersion=function(){return e(function(e,t){a.get("/profiling/all").then(function(t){e(t)},function(e){t(e)})})},this.getPhoneModelBrand=function(e){try{return-1!==e.toLowerCase().indexOf("yealink")||-1!==e.toLowerCase().indexOf("fanvil")||-1!==e.toLowerCase().indexOf("sangoma")?e.split(" ").slice(0,2).join(" "):-1!==e.toLowerCase().indexOf("snom")||-1!==e.toLowerCase().indexOf("gigaset")||-1!==e.toLowerCase().indexOf("linphone")||-1!==e.toLowerCase().indexOf("maxwell")?e.split("/")[0]:e}catch(e){return console.error(e),t("translate")("Uknown phone")}},this.getPhoneDataByMac=function(t){return e(function(e,n){a.get("/tancredi/api/v1/phones/"+t.toUpperCase()).then(function(t){e(t.data)},function(e){n(e)})})},this.getPhoneModelData=function(t){return e(function(e,n){a.get("/tancredi/api/v1/models/"+t).then(function(t){e(t.data)},function(e){n(e)})})},this.phoneRestart=function(t){var n={};return n[t]={},e(function(e,t){a.post("/freepbx/rest/phones/reboot",n).then(function(t){e(t)},function(e){t(e)})})},this.getProfiling=function(){return e(function(e,t){a.get("/profiling/all").then(function(t){e(t.data)},function(e){t(e)})})}}]),angular.module("nethctiUiApp").service("NotificationService",function(){var e,t,a=0,n=null,i=null;this.notify=function(e,t,i,s){0==a&&webNotification.showNotification(e,{body:t,icon:i||"img/steve.6204f1d6.jpg",onClick:function(){s()}},function(e,t){e?console.error(e):(a=!0,n=t)})},this.notifyAlarms=function(e,t,a){webNotification.showNotification(e,{body:t,icon:"favicon.ico",onClick:function(){a()}},function(e,t){e||(i=t,setTimeout(function(){t()},5e3))})},this.hideAlert=function(){i&&i()},this.hide=function(){n&&(n(),a=!1)},this.notifyPermanentAlarm=function(t,a,n){(e=new Notification(t,{body:a,requireInteraction:!0})).onclick=function(e){n()},e.onclose=function(t){e=void 0}},this.showClientUpdateNotification=function(e,a,n){(t=new Notification(e,{body:a,requireInteraction:!0})).onclick=function(e){n()},t.onclose=function(e){t=void 0}},this.hideNotifyPermanentAlarm=function(){e&&(e.close(),e=void 0)},this.requestNotifPermission=function(){window.Notification&&Notification.requestPermission().then(function(e){console.log("notification permission requested: ".concat(Notification.permission))})}}),angular.module("nethctiUiApp").controller("ParkingsCtrl",["$rootScope","$scope","ParkingsService","WebsocketService",function(e,t,a,n){t.parkings=[],t.viewLoad=!0,t.getParkings=function(){!1!==t.currentUser.profile.macro_permissions.settings.permissions.parkings.value?a.getAllParkings().then(function(e){t.parkings=e.data,t.viewLoad=!1},function(e){t.viewLoad=!1,console.error(e)}):t.goTo("")},t.pickParking=function(e){a.getParking({parking:e,destId:t.currentUser.default_device.id}).then(function(e){},function(e){console.error(e)})},t.$on("timer-tick",function(e,t){var a=e.targetScope.countdownattr,n=e.targetScope.countdown,i=Math.round(100*n/a),s="red";i<33?s="red":i>=33&&i<66?s="yellow":i>=66&&(s="green"),e.targetScope.progressColor=s});var i=function(e){t.parkings[e.parking]=e,t.$$phase||t.$apply()};n.on("parkingUpdate",i),t.initGraphics=function(){angular.element(document).ready(function(){$(".ui.dropdown").dropdown()})},t.initGraphics(),t.getParkings(),t.$on("socketAutheOK",function(e,a){t.getParkings()}),t.$on("serverReloaded",function(e,a){t.getParkings()}),t.$on("$destroy",function(){n.off("parkingUpdate",i)})}]),angular.module("nethctiUiApp").service("ParkingsService",["$q","RestService",function(e,t){this.getAllParkings=function(){return e(function(e,a){t.get("/astproxy/parkings").then(function(t){e(t)},function(e){a(e)})})},this.getParking=function(a){return e(function(e,n){t.post("/astproxy/pickup_parking",a).then(function(t){e(t)},function(e){n(e)})})}}]),angular.module("nethctiUiApp").controller("LinesCtrl",["$rootScope","$scope","LinesService","WebsocketService","LocalStorageService",function(e,t,a,n,i){t.lines=[],t.viewLoad=!0,t.getLines=function(){!1!==t.currentUser.profile.macro_permissions.presence_panel.permissions.trunks.value?a.getAllLines().then(function(e){for(var a in t.lines=e,t.viewLoad=!1,t.lines.data)for(var n in t.lines.data[a].conversations){var i=1e3*t.lines.data[a].conversations[n].duration,s=(new Date).getTime();t.lines.data[a].conversations[n].startTimestamp=s-i}},function(e){t.viewLoad=!1,console.error(e)}):t.goTo("")},t.logConversationLength=function(e){return Object.keys(e).length},t.setLineCardOpened=function(e){"true"==i.get(e)?i.set(e,"false"):i.set(e,"true")},t.getLineCardOpened=function(e){return"true"==i.get(e)},t.getNumber=function(e,t){return new Array(e-t)},t.getLines(),t.initGraphics=function(){angular.element(document).ready(function(){$(".ui.dropdown").dropdown()})},t.initGraphics();var s=function(e){var a=e.exten,n=e.maxChannels,i=Object.keys(e.conversations).length;for(var s in e.conversations){var o=(new Date).getTime(),r=1e3*e.conversations[s].duration;e.conversations[s].startTimestamp=o-r}t.lines.data[a]=e,0==i&&(i=n),$("#"+a+"-progress").progress({showActivity:!1,value:i,total:n,className:{success:"error"}}),t.$apply()};n.on("trunkUpdate",s),t.$on("$destroy",function(){n.off("trunkUpdate",s)})}]),angular.module("nethctiUiApp").service("LinesService",["$q","RestService",function(e,t){this.getAllLines=function(){return e(function(e,a){t.get("/astproxy/trunks").then(function(t){e(t)},function(e){a(e)})})}}]),angular.module("nethctiUiApp").controller("StreamingCtrl",["$rootScope","$scope","StreamingService","WebsocketService",function(e,t,a,n){t.sources={},t.viewLoad=!0,t.getVideoSources=function(){!1!==t.currentUser.profile.macro_permissions.streaming.value?a.getVideoSources().then(function(e){for(var a in t.sources=e.data,t.viewLoad=!1,t.sources)t.subscribe(a)},function(e){console.error(e),t.viewLoad=!1}):t.goTo("")},t.unlockSource=function(e){a.openVideoSource({id:e.id}).then(function(e){},function(e){console.error(e)})},t.speakSource=function(e){t.call(e.extension)},t.subscribe=function(e){a.subscribe({id:e}).then(function(e){},function(e){console.error(e)})},t.unsubscribe=function(e){a.unsubscribe({id:e}).then(function(e){},function(e){console.error(e)})},t.initGraphics=function(){angular.element(document).ready(function(){$(".ui.dropdown").dropdown()})},t.initGraphics(),t.getVideoSources();var i=function(e){t.sources[e.streaming.source].url=e.streaming.image,t.$apply()};n.on("streamingSourceUpdate",i),t.$on("socketAutheOK",function(e,a){t.getVideoSources()}),t.$on("serverReloaded",function(e,a){t.getVideoSources()});var s=function(){if(document.hidden)for(var e in t.sources)t.unsubscribe(e);else for(var a in t.sources)t.subscribe(a)};document.addEventListener("visibilitychange",s,!1),t.$on("$destroy",function(){for(var e in n.off("streamingSourceUpdate",i),document.removeEventListener("visibilitychange",s),t.sources)t.unsubscribe(e)})}]),angular.module("nethctiUiApp").service("StreamingService",["$q","RestService",function(e,t){this.getVideoSources=function(){return e(function(e,a){t.get("/streaming/sources").then(function(t){e(t)},function(e){a(e)})})},this.openVideoSource=function(a){return e(function(e,n){t.post("/streaming/open",a).then(function(t){e(t)},function(e){n(e)})})},this.subscribe=function(a){return e(function(e,n){t.post("/streaming/subscribe",a).then(function(t){e(t)},function(e){n(e)})})},this.unsubscribe=function(a){return e(function(e,n){t.post("/streaming/unsubscribe",a).then(function(t){e(t)},function(e){n(e)})})}}]),angular.module("nethctiUiApp").filter("cropText",function(){return function(e){return window.screen.width<480?e.charAt(0):e}}),angular.module("nethctiUiApp").controller("OffhourCtrl",["$rootScope","$scope","$filter","OffhourService","WebsocketService","LocalStorageService","UtilService",function(e,t,a,n,i,s,o){t.offhour={viewLoad:!0,audioMsgBit:"",audioToUpload:"",audioIconPlaying:"",errorMessage:"",isError:!1,routeUsed:!1},t.onOfObj={},t.createOffhourObj={},t.newAnnounce={},t.modifyAnnounce={},t.uploadObj={},t.deleteMsg={},t.offhourRoutes=[],t.editOffhour=[],t.listAnnouncement=[],t.submitOffhour=[],t.getRoutes=function(){n.getAllRoutes().then(function(e){t.offhourRoutes=e.data,t.offhour.viewLoad=!1},function(e){t.offhour.viewLoad=!1,console.error(e)})},t.getAnnouncementList=function(){n.getAnnouncements().then(function(e){t.listAnnouncement=e.data},function(e){console.error(e)})},t.getRoutes(),t.getAnnouncementList(),t.isOffhour=function(e){return"disable"!=e},t.createOffhour=function(e){n.setOffhour(e).then(function(e){$("#offHourMondal").modal("hide"),t.getRoutes()},function(e){console.error(e)})},t.getOffHourCardOpened=function(e,t){var a=e+"-"+t;return"true"==s.get("offhour-"+a)},t.setOffHourCardOpened=function(e,t){var a=e+"-"+t,n=s.get("offhour-"+a);"true"==n?s.set("offhour-"+a,"false"):s.set("offhour-"+a,"true")},t.offhourCheckbox=function(e,t){if($("#"+(e+"-"+t)+"-checkbox").prop("checked"))return!0},t.getOffhourValue=function(e){if("dropdown-offhour"!=e)return $("#"+e).dropdown("get value");switch($("#"+e).dropdown("get value")){case"redirect":return!0;case"audiomsg_voicemail":return!1;case"audiomsg":return 1;default:return}},t.setDropdownOffhour=function(e,t){$("#"+t).dropdown("set value",e)},t.momentDate=function(e){return moment(e).format("DD MMM YYYY")},t.momentTime=function(e){return moment(e).format("HH:mm:ss")},t.fileUploadOpen=function(e){t.offhour.manageMsgModal="upload",$("#publicRadio-input").prop("checked",!1),$("#privateRadio-input").prop("checked",!1),$("#msgDescriptionRM").val(""),$(".ui.radio.checkbox").checkbox(),$("#msgDescriptionRM-field").removeClass("error"),setTimeout(function(){$("#"+e).click()},100)},t.setAnnounceMan=function(e){s.set("offhour-tab",e),"true"==e?t.getAnnouncementList():"false"==e&&t.getRoutes()},t.openAnnounceMan=function(){$("#offHourMondal").modal("hide"),setTimeout(function(){$("#announceMan").click()},100)},t.getChecked=function(){return 1==$("#checkboxModal").prop("checked")},t.formatDate=function(e){var t=new Date(e),a=""+(t.getMonth()+1),n=""+t.getDate(),i=t.getFullYear();return a.length<2&&(a="0"+a),n.length<2&&(n="0"+n),i+a+n},t.formatTime=function(e){var t=new Date(e),a=""+t.getMinutes(),n=""+t.getHours();return a.length<2&&(a="0"+a),n.length<2&&(n="0"+n),n+a+"00"},t.setEnabledOffhour=function(e,a,n){var i={calledIdNum:e,callerIdNum:a,enabled:n};t.createOffhour(i)},t.hideModal=function(e){$("#"+e).modal("hide"),"offHourMondal"==e&&$("#dropdown-offhour-announcement").dropdown("clear")},t.hideModalMsg=function(){$("#offhourRM").modal("hide"),$("#uploadFileField").removeClass("error"),t.offhour.isError=!1,t.view.initRecordCall=!1,t.offhour.errorMessage="",t.newAnnounce.description="",$("#offhourRM").modal("hide"),$("#publicRadio-input").prop("checked",!1),$("#privateRadio-input").prop("checked",!1),$("#msgDescriptionRM").val(""),$("#uploadMsgText").val(""),$("#uploadMsgFile").val(void 0)},t.getLocalStorage=function(e){return s.get(e)},t.removeMsg=function(e){t.deleteMsg.id=""+e,$("#acceptModal").modal({closable:!1}).modal("show"),$.each(t.offhourRoutes,function(a,n){void 0!=n.offhour&&void 0!=n.offhour.audiomsg&&n.offhour.audiomsg.announcement_id==e&&(t.offhour.routeUsed=!0)})},t.removeMsgPositive=function(){n.deleteMsg(t.deleteMsg).then(function(e){t.getAnnouncementList(),t.hideModalDel()},function(e){console.error(e)})},t.downloadRecording=function(e){n.downloadMsg(e).then(function(e){var t=document.createElement("a");t.download=e.data,t.href=customConfig.BASE_API_URL+"/static/"+e.data,t.setAttribute("type","hidden"),document.body.appendChild(t),t.click()},function(e){console.error(e)})},t.modifyMsgShow=function(e){for(var a in t.offhour.manageMsgModal="modify",$("#msgDescriptionRM-field").removeClass("error"),t.listAnnouncement)t.listAnnouncement[a].id==e&&(t.modifyAnnounce.description=t.listAnnouncement[a].description,t.modifyAnnounce.id=""+t.listAnnouncement[a].id,t.newAnnounce.description=t.modifyAnnounce.description,"public"==t.listAnnouncement[a].privacy?$("#publicRadio-input").prop("checked",!0):$("#privateRadio-input").prop("checked",!0),$(".ui.radio.checkbox").checkbox(),$("#offhourRM").modal({closable:!1}).modal("show"))},t.hideModalDel=function(){$("#acceptModal").modal("hide"),t.deleteMsg={},t.offhour.routeUsed=!1},t.modifyMsg=function(){$("#publicRadio").hasClass("checked")?t.modifyAnnounce.privacy="public":t.modifyAnnounce.privacy="private",t.modifyAnnounce.description=t.newAnnounce.description,n.modifyMsg(t.modifyAnnounce).then(function(e){t.modifyAnnounce={},t.newAnnounce={},t.offhour.manageMsgModal="",t.hideModalMsg(),t.getAnnouncementList()},function(e){console.error(e)})},t.recordMsg=function(){$("#publicRadio-input").prop("checked",!1),$("#privateRadio-input").prop("checked",!1),$("#msgDescriptionRM").val(""),t.offhour.manageMsgModal="record",t.currentCall.isVisible=!0,t.view.initRecordCall=!0,n.setRecordMsg().then(function(e){t.newAnnounce.tempFilename=e.data.tempFilename},function(e){console.error(e),t.view.initRecordCall=!1})},t.uploadMsg=function(){if(""!=$("#uploadMsgFile").val()){for(var e in $("#publicRadio").hasClass("checked")?t.uploadObj.privacy="public":t.uploadObj.privacy="private",t.listAnnouncement)if(t.listAnnouncement[e].description==t.newAnnounce.description)var a=!0;!0!==a?(t.uploadObj.audio_content=t.offhour.audioToUpload,t.uploadObj.description=t.newAnnounce.description,n.uploadAudioMsg(t.uploadObj).then(function(e){$("#uploadMsgFile").val(void 0),t.uploadObj={},t.newAnnounce={},t.offhour.manageMsgModal="",t.hideModalMsg(),t.getAnnouncementList()},function(e){console.error(e)})):($("#msgDescriptionRM-field").addClass("error"),t.offhour.isError=!0,t.offhour.errorMessage="fileDescription",a=!1)}else t.offhour.isError=!0,t.offhour.errorMessage="noFile",$("#uploadFileField").addClass("error")},t.listenMsg=function(e){n.listenMsg(e).then(function(a){t.offhour.audioMsgBit=a.data,t.listenMsgStop(),$("#audioPlayer").attr("src","data:audio/ogg;base64,"+t.offhour.audioMsgBit),$("#audioPlayer").get(0).play(),$("#playMsg-"+e).attr("style","display:none !important"),$("#stopMsg-"+e).attr("style","display:inline-block !important"),$("#audioPlayer").bind("ended",function(){t.listenMsgStop(),$("#audioPlayer").unbind(),t.$apply()})},function(e){console.error(e)})},t.listenMsgStop=function(){$("#audioPlayer").get(0).pause(),$("#audioPlayer").get(0).currentTime=0,$(".play-buttons").attr("style","display:inline-block !important"),$(".stop-buttons").attr("style","display:none !important")},t.saveAnnounce=function(e){if("modify"==e)t.modifyMsg();else if("upload"==e)t.uploadMsg();else{for(var a in $("#publicRadio").hasClass("checked")?t.newAnnounce.privacy="public":t.newAnnounce.privacy="private",t.listAnnouncement)if(t.listAnnouncement[a].description==t.newAnnounce.description)var i=!0;!0!==i?($("#msgDescriptionRM-field").removeClass("error"),t.offhour.isError=!1,t.offhour.errorMessageTitle="",n.enableMsg(t.newAnnounce).then(function(e){t.newAnnounce={},t.hideModalMsg(),t.getAnnouncementList()},function(e){console.error(e)})):($("#msgDescriptionRM-field").addClass("error"),t.offhour.isError=!0,t.offhour.errorMessage="duplicateDesc",i=!1)}t.view.initRecordCall=!1},t.openEditModal=function(e,n){var i=e+"/"+n;t.createOffhourObj={},t.editOffhour=[],t.editOffhour=t.offhourRoutes[i],void 0!=t.editOffhour.offhour&&("audiomsg_voicemail"==t.editOffhour.offhour.action&&(t.createOffhourObj.voicemail_id=t.editOffhour.offhour.voicemail.voicemail_id),"redirect"==t.editOffhour.offhour.action&&(t.createOffhourObj.redirect_to=t.editOffhour.offhour.redirect.redirect_to)),t.getAnnouncementList(),$("#dropdown-offhour").dropdown(),$("#dropdown-offhour-announcement").dropdown(),$("#fromDateCalendar").unbind(),$("#toDateCalendar").unbind(),$("#offHourMondal").modal({onShow:function(){void 0!=t.editOffhour.offhour?($("#dropdown-offhour").dropdown("set selected",t.editOffhour.offhour.action),"redirect"!==t.editOffhour.offhour.action&&$("#dropdown-offhour-announcement").dropdown("set selected",t.editOffhour.offhour.audiomsg.announcement_id),void 0!=t.editOffhour.offhour.period?($("#fromDateCalendar").calendar({type:"datetime",formatter:{date:function(e,t){return e?a("translate")("with_date","{date:"+e.getTime()+"}"):""}},ampm:!1,text:o.getDateTexts()}),$("#toDateCalendar").calendar({type:"datetime",formatter:{date:function(e,t){return e?a("translate")("with_date","{date:"+e.getTime()+"}"):""}},ampm:!1,text:o.getDateTexts()}),$("#fromDateCalendar").calendar("set date",new Date(t.editOffhour.offhour.period.datebegin)),$("#toDateCalendar").calendar("set date",new Date(t.editOffhour.offhour.period.dateend))):($("#fromDateCalendar").calendar("clear"),$("#toDateCalendar").calendar("clear")),"always"===t.editOffhour.offhour.enabled||void 0===t.editOffhour.offhour.period||""===t.editOffhour.offhour.period?t.submitOffhour.always=!0:t.submitOffhour.always=!1):($("#dropdown-offhour").dropdown("clear"),$("#dropdown-offhour-announcement").dropdown("clear"),$("#fromDateCalendar").calendar("clear"),$("#toDateCalendar").calendar("clear"),t.submitOffhour.always=!1)},closable:!1}).modal("show")},t.onOff=function(e,a,n,i,s,o,r,l,c,d){if("never"===n)if(void 0===d)t.setEnabledOffhour(e,a,"always");else{if(t.onOfObj.calledIdNum=e,t.onOfObj.callerIdNum=a,t.onOfObj.enabled="period",t.onOfObj.start_date=i,t.onOfObj.end_date=s,"redirect"===o){t.onOfObj.action=o,t.onOfObj.redirect_to=r;var u=t.onOfObj}else if("audiomsg"===o){t.onOfObj.action=o,t.onOfObj.announcement_id=""+l;u=t.onOfObj}else if("audiomsg_voicemail"===o){t.onOfObj.action=o,t.onOfObj.announcement_id=""+l,t.onOfObj.voicemail_id=c;u=t.onOfObj}t.createOffhour(u),t.onOfObj={}}else t.setEnabledOffhour(e,a,"never")},t.saveOffhour=function(e,a){if(t.createOffhourObj.calledIdNum=e,t.createOffhourObj.callerIdNum=a,1==t.submitOffhour.always?t.createOffhourObj.enabled="always":t.createOffhourObj.enabled="period","period"==t.createOffhourObj.enabled){t.submitOffhour.fromDate=$("#fromDateCalendar").calendar("get date");var n=new Date(t.submitOffhour.fromDate).toISOString();t.createOffhourObj.start_date=n,t.submitOffhour.toDate=$("#toDateCalendar").calendar("get date");var i=new Date(t.submitOffhour.toDate).toISOString();t.createOffhourObj.end_date=i}var s=t.getOffhourValue("dropdown-offhour");t.createOffhourObj.action=!0===s?"redirect":!1===s?"audiomsg_voicemail":"audiomsg","redirect"!=t.createOffhourObj.action&&(t.createOffhourObj.announcement_id=""+t.getOffhourValue("dropdown-offhour-announcement"),""===t.createOffhourObj.announcement_id)||t.createOffhour(t.createOffhourObj)},angular.element(document).ready(function(){$(".offhour-tab .item").tab(),$(".offhour-checkbox").checkbox({debug:!0}),$("#fileLoading").hide(),$("#uploadMsgFile").change(function(e){if(void 0!=e.target.files[0].name){$("#offhourRM").modal({closable:!1}).modal("show");var a=e.target.files[0].name,n=e.target.files[0].type;e.target.files[0].size/1e6>10&&(t.offhour.isError=!0,t.offhour.errorMessage="fileSize"),$("#uploadFileField").addClass("error"),t.offhour.isError=!0,t.offhour.errorMessage="fileExtension",$("#uploadMsgText").val("");var i=n.split("/");if("audio"==i[0]||"mp3"==i[1]&&"wav"==i[1]){if(void 0!==a&&""!==a){$("#uploadMsgText").val(a),$("#uploadFileField").removeClass("error"),t.offhour.isError=!1,t.offhour.errorMessage="";for(var s=e.target.files,o=0;o<s.length;o++){var r=s[o],l=new FileReader;$("#uploadInputContainer").addClass("left icon loading"),$("#fileLoading").show(),l.onload=function(e){t.$apply(function(){$("#fileLoading").hide(),$("#uploadInputContainer").removeClass("left icon loading"),t.offhour.audioToUpload=e.target.result,setTimeout(function(){t.$apply()},100)})},l.readAsDataURL(r)}}}else $("#uploadFileField").addClass("error"),t.offhour.isError=!0,t.offhour.errorMessage="fileExtension",t.$apply()}}),"true"==s.get("offhour-tab")&&t.openAnnounceMan()}),t.initGraphics=function(){angular.element(document).ready(function(){$(".ui.dropdown").dropdown()})},t.initGraphics(),t.$on("$routeChangeStart",function(){$(".offhourModals").remove()})}]),angular.module("nethctiUiApp").controller("VideoconfCtrl",["$rootScope","$scope","$window","$filter","$translate","VideoconfService","LocalStorageService",function(e,t,a,n,i,s,o){t.data={vcRoomUrl:void 0,vcRoomUrlDisplay:void 0,popupTimer:void 0,showNotConfigured:!1,showGenericError:!1,participants:{},invitedParticipants:{},globLangInvite:"en",invitationSupportedLang:[{name:n("translate")("English"),value:"en",abbrev:"EN"},{name:n("translate")("Italian"),value:"it",abbrev:"IT"},{name:n("translate")("Spanish"),value:"es",abbrev:"ES"}],invitationEmailData:{subject:{it:"Invito alla videoconferenza da parte di ".concat(t.currentUser.name),en:"Videoconference invitation from ".concat(t.currentUser.name),es:"Invitación a videoconferencia de ".concat(t.currentUser.name)},body:{it:"".concat(t.currentUser.name," ti ha invitato a partecipare ad una videoconferenza.\n\nPartecipa:"),en:"".concat(t.currentUser.name," has invited you to join a videoconference.\n\nParticipate:"),es:"".concat(t.currentUser.name," lo ha invitado a unirse a una videoconferencia.\n\nParticipa:")}},addParticipantsError:!1,addParticipantsSuccess:!1,CLOSE_ADD_PARTICIPANTS_DIALOG_TIMEOUT:1e3,showInvitationResult:!1},t.deleteURL=function(){o.remove("vcRoomUrl"),t.data.vcRoomUrl=void 0,t.data.vcRoomUrlDisplay=void 0},t.isValidURL=function(e){try{return new URL(e),!0}catch(e){return!1}},t.showNewRoomConfirmation=function(){$("#vc-modal-confirm-new-room").modal("show")},t.newRoom=function(){!1!==t.currentUser.profile.macro_permissions.settings.permissions.video_conference.value?(t.resetInvitedParticipantsList(),t.resetParticipantsList(),s.newRoom().then(function(e){if(e&&e.data&&"string"==typeof e.data.url&&""!==e.data.url&&t.isValidURL(e.data.url)){o.set("vcRoomUrl",e.data.url);var a=""!==t.data.vcRoomUrl;t.data.vcRoomUrl=e.data.url,t.data.vcRoomUrlDisplay=t.getVCUrlDisplay(t.data.vcRoomUrl),t.data.vcRoomTitle=t.getVCUrlTitle(t.data.vcRoomUrl),t.data.showNotConfigured=!1,t.data.showGenericError=!1,a&&t.blinkRoomId()}else(e&&null===e.data||!t.isValidURL(e.data.url))&&(t.data.showNotConfigured=!0,t.data.showGenericError=!1,t.deleteURL())},function(e){console.error(e),t.data.showGenericError=!0,t.data.showNotConfigured=!1,t.deleteURL()})):t.goTo("")},t.clearURL=function(){t.data.vcRoomUrl=void 0,t.data.vcRoomUrlDisplay=void 0,t.data.vcRoomUrlTitle=void 0,o.remove("vcRoomUrl")},t.startRoom=function(){a.open(t.data.vcRoomUrl,"_blank")},t.roomTitleChanged=function(){var e=t.data.vcRoomTitle;e='"'+e+'"',e=escape(e),t.data.vcRoomUrl=t.data.vcRoomUrl.split("callDisplayName")[0]+"callDisplayName="+e,o.set("vcRoomUrl",t.data.vcRoomUrl)},t.storeInvitedParticipants=function(){o.set("vcRoomInvitedParticipants",JSON.stringify(t.data.invitedParticipants))},t.inviteAgain=function(e){t.data["reinviteError_"+t.idFromEmail(e.email)]=!1,t.data["reinviteSuccess_"+t.idFromEmail(e.email)]=!1,t.data["reinviteLoader_"+t.idFromEmail(e.email)]=!0;var a={list:{}};for(var n in a.list[e.email]=e.lang,a.email={subject:t.data.invitationEmailData.subject,body:{}},t.data.invitationEmailData.body)a.email.body[n]=t.data.invitationEmailData.body[n]+" "+t.data.vcRoomUrl;s.sendInvitationEmails(a).then(function(a){try{e.email&&t.data.invitedParticipants[e.email]&&a.data[e.email]&&(t.data.invitedParticipants[e.email].success=a.data[e.email].success,t.storeInvitedParticipants()),t.data["reinviteLoader_"+t.idFromEmail(e.email)]=!1,a.data[e.email].success?(t.data["reinviteError_"+t.idFromEmail(e.email)]=!1,t.data["reinviteSuccess_"+t.idFromEmail(e.email)]=!0,setTimeout(function(){t.data["reinviteSuccess_"+t.idFromEmail(e.email)]=!1,t.$apply()},2e3)):(t.data["reinviteSuccess_"+t.idFromEmail(e.email)]=!1,t.data["reinviteError_"+t.idFromEmail(e.email)]=!0)}catch(a){t.data["reinviteLoader_"+t.idFromEmail(e.email)]=!1,t.data["reinviteSuccess_"+t.idFromEmail(e.email)]=!1,t.data["reinviteError_"+t.idFromEmail(e.email)]=!0,console.error(a)}},function(a){t.data["reinviteLoader_"+t.idFromEmail(e.email)]=!1,t.data["reinviteSuccess_"+t.idFromEmail(e.email)]=!1,t.data["reinviteError_"+t.idFromEmail(e.email)]=!0,console.error(a)})},t.updateStatusInvitedParticipants=function(){for(var e in t.data.invitedParticipants)t.data.invitedParticipants[e].success?(t.data["reinviteSuccess_"+t.idFromEmail(e)]=!1,t.data["reinviteError_"+t.idFromEmail(e)]=!1):(t.data["reinviteSuccess_"+t.idFromEmail(e)]=!1,t.data["reinviteError_"+t.idFromEmail(e)]=!0)},t.sendInvitationEmails=function(){var e={list:{}};for(var a in t.data.participants)e.list[a]=t.data.participants[a].lang;for(var n in e.email={subject:t.data.invitationEmailData.subject,body:{}},t.data.invitationEmailData.body)e.email.body[n]=t.data.invitationEmailData.body[n]+" "+t.data.vcRoomUrl;s.sendInvitationEmails(e).then(function(e){try{var a=!1,n=!0;if(e&&e.data)for(var i in e.data)t.data.invitedParticipants[i]={name:t.data.participants[i].name,email:t.data.participants[i].email,success:e.data[i].success,lang:t.data.participants[i].lang},!1===e.data[i].success&&(a=!0,n=!1);t.updateStatusInvitedParticipants(),t.storeInvitedParticipants(),t.resetParticipantsList(),a&&t.showAddParticipantsError(),n&&t.showAddParticipantsSuccess()}catch(e){t.resetParticipantsList(),t.showAddParticipantsError(),console.error(e)}},function(e){t.showAddParticipantsError(),t.resetParticipantsList(),console.error(e)})},t.resetParticipantsList=function(){t.data.participants={}},t.resetInvitedParticipantsList=function(){t.data.invitedParticipants={},o.remove("vcRoomInvitedParticipants")},t.blinkRoomId=function(){var e=0,t=!1,a=setInterval(function(){t?$("#vcCopyUrlPopup").css("background","white"):$("#vcCopyUrlPopup").css("background","yellow"),t=!t,6===(e+=1)&&clearInterval(a)},300)},t.showAddParticipantsError=function(){t.data.showInvitationResult=!0,t.data.addParticipantsError=!0,t.data.addParticipantsSuccess=!1,setTimeout(function(){t.closeAddParticipantsDialog()},t.data.CLOSE_ADD_PARTICIPANTS_DIALOG_TIMEOUT)},t.showAddParticipantsSuccess=function(){t.data.showInvitationResult=!0,t.data.addParticipantsError=!1,t.data.addParticipantsSuccess=!0,setTimeout(function(){t.closeAddParticipantsDialog()},t.data.CLOSE_ADD_PARTICIPANTS_DIALOG_TIMEOUT)},t.closeAddParticipantsDialog=function(){t.data.addParticipantsError=!1,t.data.addParticipantsSuccess=!1,t.data.showInvitationResult=!1,$("#vc-modal-add-participants").modal("hide")},t.addParticipants=function(){t.data.showInvitationResult=!1,t.data.insertedParticipant="",$("#vc-modal-add-participants").modal({closable:!1,onApprove:function(e){return!1}}).modal("show")},t.delayPopup=function(e){t.data.popupTimer=setTimeout(function(){$(e).popup("hide")},3200)},t.copyVCUrl=function(e){var a=document.createElement("textarea");a.value=e?n("translate")("To join the videoconference, click on this link")+": "+t.data.vcRoomUrl:t.data.vcRoomUrl,a.setAttribute("readonly",""),a.style.position="absolute",a.style.left="-9999px",document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),clearTimeout(t.data.popupTimer),$("#vcCopyUrlPopup").popup("show"),t.delayPopup($("#vcCopyUrlPopup"))},t.copyVCUrlConfirmation=function(e){var a=document.createElement("textarea");a.value=e?n("translate")("To join the videoconference, click on this link")+": "+t.data.vcRoomUrl:t.data.vcRoomUrl,a.setAttribute("readonly",""),a.style.position="absolute",a.style.left="-9999px",document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),clearTimeout(t.data.popupTimer),$("#vcCopyUrlPopupConfirmation").popup({inline:!0}).popup("show"),t.delayPopup($("#vcCopyUrlPopupConfirmation"))},t.getEmailBodyInvite=function(){return t.currentUser.name+" "+n("translate")("has invited you to join a Jitsi video meeting")+"\n\n"+n("translate")("Click here to participate")+': <hfvalue><a href="'+t.data.vcRoomUrl+'">'+t.data.vcRoomUrl+"</a></hfvalue>"},t.isValidEmailAddr=function(e){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},t.initGui=function(){$("#vcCopyUrlPopup").popup({inline:!0,on:"manual"}),$("#vc-participants-search").search({type:"category",maxResults:8,cache:!1,apiSettings:{url:customConfig.BASE_API_URL+"/phonebook/searchemail/{query}",beforeXHR:function(e){var t=o.get("credentials");return e.setRequestHeader("Authorization",t.username+":"+t.token),e},onResponse:function(e){var a={results:{}};return e&&void 0!==!e.count?(t.isValidEmailAddr(t.data.insertedParticipant)&&e.rows.push({workemail:t.data.insertedParticipant.toLowerCase(),name:n("translate")("Inserted by you")}),$.each(e.rows,function(e,t){if(!t.name&&!t.company)return!0;var i;t.name&&t.company&&""!==t.name.trim()&&""!==t.company.trim()?i='<i class="large user middle aligned grey icon"></i>                <span title="'+n("translate")("Name")+": "+t.name+'" class="sp-user-name">'+t.name+'</span>                <div class="sp-color-gray sp-user-descr" title="'+n("translate")("Company")+": "+t.company+'">'+t.company+"</div>":!t.name||""===t.name.trim()||t.company&&""!==t.company.trim()?!t.company||""===t.company.trim()||t.name&&""!==t.name.trim()||(i='<i class="large building middle aligned grey icon"></i>                <span title="'+n("translate")("Company")+": "+t.company+'" class="sp-user-name">'+t.company+"</span>"):i='<i class="large user middle aligned grey icon"></i>                <span title="'+n("translate")("Name")+": "+t.name+'" class="sp-user-name">'+t.name+"</span>",a.results[i]={name:i,results:[]},t.workemail&&a.results[i].results.push({title:'<i class="mail black icon"></i>'+t.workemail,description:'<span class="hide">'+(t.name?t.name:t.company)+"</span>"+n("translate")("Work email")}),t.homeemail&&a.results[i].results.push({title:'<i class="mail black icon"></i>'+t.homeemail,description:'<span class="hide">'+(t.name?t.name:t.company)+"</span>"+n("translate")("Personal email")})}),a):a}},minCharacters:4,showNoResults:!0,onSelect:function(e,a){var n=e.description.split("</span>")[0].split('hide">')[1],i=e.title.split("</i>")[1].toLowerCase();t.data.participants[i]={name:n,email:i,lang:t.data.globLangInvite},t.$apply(),t.updateLangsAllParticipants()}}),setTimeout(function(){$("#vcDropdownGlobLang").dropdown({onChange:function(e,a,n){t.data.globLangInvite=e,t.resetLangAllParticipants(),t.updateLangsAllParticipants()}}).dropdown("set selected",t.data.globLangInvite)},0)},t.resetLangAllParticipants=function(e){for(var a in t.data.participants)t.data.participants[a].lang=t.data.globLangInvite},t.idFromEmail=function(e){return e.replace("@","").replace(/\./g,"")},t.updateLangsAllParticipants=function(){for(var e in t.data.participants)$("#vcCustomDropdownLang-"+t.idFromEmail(t.data.participants[e].email)).dropdown("set selected",t.data.participants[e].lang).dropdown({onChange:function(e,a,n){var i=n.attr("data-email");t.data.participants[i].lang=e}})},t.removeParticipant=function(e){delete t.data.participants[e]},t.getVCUrlDisplay=function(e){try{if("string"==typeof e&&e.length>0){var t=new URL(e);return t.pathname.substring(1,t.pathname.length)}return""}catch(e){return console.warn(e),""}},t.getVCUrlTitle=function(e){try{if("string"==typeof e&&e.length>0){var t=new URL(e);return t=t.hash.split("callDisplayName")[1],0===(t=unescape(t.substring(1,t.length))).indexOf('"')&&(t=t.substring(1,t.length)),t.indexOf('"')===t.length-1&&(t=t.substring(0,t.length-1)),t}return""}catch(e){return console.warn(e),""}},t.init=function(){t.data.vcRoomUrl=o.get("vcRoomUrl"),t.data.vcRoomUrlDisplay=t.getVCUrlDisplay(t.data.vcRoomUrl),t.data.vcRoomTitle=t.getVCUrlTitle(t.data.vcRoomUrl);try{t.data.invitedParticipants=JSON.parse(o.get("vcRoomInvitedParticipants")),t.updateStatusInvitedParticipants()}catch(e){}""===t.data.vcRoomUrl&&t.newRoom(),t.data.globLangInvite=t.getBrowserLanguage()},t.keyLength=function(e){return Object.keys(e).length},t.initGui(),t.init()}]),angular.module("nethctiUiApp").controller("QueuesInfoCtrl",["$rootScope","$scope","LocalStorageService","LogService","PhoneService","JanusService","QueueService","WebsocketService","NgTableParams","$filter",function(e,t,a,n,i,s,o,r,l,c){t.appConfig=appConfig,t.recallDetailsCid,t.summaryAgent={},t.lostCallsLastUpdateDate,t.summaryAgentLastUpdateDate,t.idLostCallsUpdateInterval,t.intervalUpdateAgentStatistics,t.isAnyTableInit,t.showLoader,t.selectedCall,t.notManagedTP,t.managedTP,t.totalTP,t.notManagedLoader=!1,t.managedLoader=!1,t.totalLoader=!1,t.detailsTP,t.lCAOpened=a.get("qLostCallAccordionOpened")||!1,t.queuesLastTab=a.get("queues-last-tab")||"lostQueueCalls",t.lostCallsQTab=a.get("lostCallsQTab")||"notmanaged",t.lostCallsUpdateInterval=a.get("lostCallsUpdateInterval")||20,t.selectedRecallQueues=a.get("selectedRecallQueues")||{},t.UPDATE_AGENT_SUMMARY_INTERVAL=3e4;var d=function(){return a.get("lcHInterval")||12},u=function(e){return Object.keys(e)},p=function(){$("#searchSelect").dropdown("set selected",Object.keys(t.selectedRecallQueues)).dropdown({forceSelection:!1,message:{noResults:c("translate")("No results found")+"."},onChange:function(e){t.selectedRecallQueues={};for(var n=0;n<e.length;n++)t.selectedRecallQueues[e[n]]=!0;a.set("selectedRecallQueues",t.selectedRecallQueues),t.isAnyTableInit?(g(),f()):v()}})},m=function(){t.lostCallsLastUpdateDate=new Date},g=function(){switch(t.lostCallsQTab){case"managed":t.managedTP.page(1);break;case"total":t.totalTP.page(1);break;default:t.notManagedTP.page(1)}},f=function(){if(t.isEmpty(t.selectedRecallQueues))t.managedTP=null,t.totalTP=null,t.notManagedTP=null,t.isAnyTableInit=null;else{switch(t.lostCallsQTab){case"managed":t.managedTP.reload();break;case"total":t.totalTP.reload();break;default:t.notManagedTP.reload()}m()}},v=function(){if(!t.isEmpty(t.selectedRecallQueues)){switch(t.showLoader=!0,t.lostCallsQTab){case"managed":t.managedTP=new l({page:1,count:t.appConfig.LOSTCALLS_RESULT_LIMIT,sorting:{time:"asc"}},{counts:[],getData:function(e,a){t.showLoader&&(t.managedLoader=!0),t.showLoader=!1,o.getQLostCalls(d(),u(t.selectedRecallQueues),"done",t.appConfig.LOSTCALLS_RESULT_LIMIT,(a.page()-1)*t.appConfig.LOSTCALLS_RESULT_LIMIT).then(function(n){a.total(n.data.count),e.resolve(n.data.rows),t.managedLoader=!1,m()},function(n){a.total(0),e.resolve([]),t.managedLoader=!1,console.error(n)})}});break;case"total":t.totalTP=new l({page:1,count:t.appConfig.LOSTCALLS_RESULT_LIMIT,sorting:{time:"asc"}},{counts:[],getData:function(e,a){t.showLoader&&(t.totalLoader=!0),t.showLoader=!1,o.getQLostCalls(d(),u(t.selectedRecallQueues),"all",t.appConfig.LOSTCALLS_RESULT_LIMIT,(a.page()-1)*t.appConfig.LOSTCALLS_RESULT_LIMIT).then(function(n){a.total(n.data.count),e.resolve(n.data.rows),t.totalLoader=!1,m()},function(n){a.total(0),e.resolve([]),t.totalLoader=!1,console.error(n)})}});break;default:t.notManagedTP=new l({page:1,count:t.appConfig.LOSTCALLS_RESULT_LIMIT,sorting:{time:"asc"}},{counts:[],getData:function(e,a){t.showLoader&&(t.notManagedLoader=!0),t.showLoader=!1,o.getQLostCalls(d(),u(t.selectedRecallQueues),"lost",t.appConfig.LOSTCALLS_RESULT_LIMIT,(a.page()-1)*t.appConfig.LOSTCALLS_RESULT_LIMIT).then(function(n){a.total(n.data.count),e.resolve(n.data.rows),t.notManagedLoader=!1,m()},function(n){a.total(0),e.resolve([]),t.notManagedLoader=!1,console.error(n)})}})}t.isAnyTableInit=!0}},h=function(){clearInterval(t.idLostCallsUpdateInterval),n.log("lost queue calls update interval stopped")};t.updateLCQTab=function(e){if(t.lostCallsQTab=e,a.set("lostCallsQTab",e),!t.isEmpty(t.selectedRecallQueues))switch(e){case"managed":t.managedTP?f():v();break;case"total":t.totalTP?f():v();break;default:t.notManagedTP?f():v()}},t.recall=function(e){o.recallCheck(e).then(function(a){a.data.inConversation?(t.cidRecallConfirm=e,$("#recall-confirm-dialog").modal("show")):t.call(e)},function(e){console.error(e)})},t.updateAgentsStatus=function(){t.allUsers[t.currentUser.username].status=t.getStatusOfUser(t.allUsers[t.currentUser.username].endpoints.extension)},t.timeDifference=function(e,t){var a=e-t,n=Math.floor(a/1e3/60/60);a-=1e3*n*60*60;var i=Math.floor(a/1e3/60);a-=1e3*i*60;var s=Math.floor(a),o="";return s=(s=s.toString()).slice(0,-3),s=parseInt(s),n&&(o+=n+"h "),i&&(o+=i+"' "),s&&(o+=s+"'' "),o};var b=function(){o.getAgentStats().then(function(e){t.summaryAgent=e.data,t.summaryAgent.queues={},t.summaryAgent.answeredcalls=0,t.summaryAgent.no_answer_calls=0;var a=t.currentUser.endpoints.mainextension[0].id;for(var n in t.queues)t.queues[n].members[a]&&(t.summaryAgent.queues[n]=t.queues[n].members[a],t.summaryAgent.queues[n].qname=t.queues[n].name,t.summaryAgent.name=t.queues[n].members[a].name,t.summaryAgent.member=t.queues[n].members[a].member),t.summaryAgent[n]&&t.summaryAgent[n].last_login_time&&(!t.summaryAgent.lastlogin||t.summaryAgent.lastlogin<t.summaryAgent[n].last_login_time)&&(t.summaryAgent.lastlogin=t.summaryAgent[n].last_login_time),t.summaryAgent[n]&&t.summaryAgent[n].last_logout_time&&(!t.summaryAgent.lastlogout||t.summaryAgent.lastlogout<t.summaryAgent[n].last_logout_time)&&(t.summaryAgent.lastlogout=t.summaryAgent[n].last_logout_time),t.summaryAgent[n]&&t.summaryAgent[n].last_call_time&&(!t.summaryAgent.fromLastCall||t.summaryAgent.fromLastCall<t.summaryAgent[n].last_call_time)&&(t.summaryAgent.fromLastCall=t.summaryAgent[n].last_call_time),t.summaryAgent[n]&&t.summaryAgent[n].calls_taken&&(t.summaryAgent.answeredcalls+=t.summaryAgent[n].calls_taken),t.summaryAgent[n]&&t.summaryAgent[n].no_answer_calls&&(t.summaryAgent.no_answer_calls+=t.summaryAgent[n].no_answer_calls);t.summaryAgent.fromLastCall=t.timeDifference(Date.now(),1e3*t.summaryAgent.fromLastCall),t.summaryAgentLastUpdateDate=new Date,t.updateAgentsStatus()},function(e){console.error(e)})},C=function(){clearInterval(t.intervalUpdateAgentStatistics)},y=function(){null===localStorage.getItem("selectedRecallQueues")&&function(){for(var e in t.selectedRecallQueues={},t.queues)t.selectedRecallQueues[e]=!0}(),p(),v(),t.idLostCallsUpdateInterval=setInterval(function(){f()},1e3*t.lostCallsUpdateInterval)},w=function(){b(),t.intervalUpdateAgentStatistics=setInterval(function(){b()},t.UPDATE_AGENT_SUMMARY_INTERVAL)},x=function(){switch(t.currentUser.profile.macro_permissions.queue_agent&&t.currentUser.profile.macro_permissions.queue_agent.permissions&&!1===t.currentUser.profile.macro_permissions.queue_agent.permissions.lost_queue_call.value&&(t.queuesLastTab="statistics"),t.queuesLastTab){case"statistics":w();break;default:y()}};t.clickQInfoTab=function(e){t.queuesLastTab=e,a.set("queues-last-tab",t.queuesLastTab),C(),h(),x()},t.goToQueuesSettings=function(){e.settingsTabGlobal="queues",t.goTo("/settings")},t.hideModal=function(){$("#recallDetailsDialog").modal("hide")},t.$on("ngRepeatFinished",function(e){$("#recallDetailsDialog").modal({closable:!1}).modal("show")}),t.getRecallDetails=function(e,a){t.tableParamsRecallDetails=new l({page:1,count:20,sorting:{time:"asc"}},{counts:[],getData:function(n,i){o.getRecallDetails(e,d(),a).then(function(a){i.total(a.data.length),n.resolve(a.data),t.recallDetailsCid=e},function(e){console.error(e)})}})},angular.element(document).ready(function(){t.showTopAccordion=!0,t.$apply(),$("#qaccordion").accordion({collapsible:!0,animate:!1,active:!1===t.lCAOpened?1:0,activate:function(e,n){var i=$(this).accordion("option","active");!1===i?(h(),C()):x(),a.set("qLostCallAccordionOpened",!1!==i),t.lCAOpened=!1!==i}}),t.lCAOpened&&x()}),t.$on("userInfoUpdated",function(e,t){b()}),t.$on("serverReloaded",function(e,t){h(),C(),x()}),t.$on("$routeChangeStart",function(){h(),C(),$("#recallDetailsDialog").remove()}),t.$on("wsDisconnected",function(e,t){h(),C()}),$(document).on("loggedOut",function(e,t){h(),C()})}]),angular.module("nethctiUiApp").service("OffhourService",["$q","RestService",function(e,t){this.getAllRoutes=function(){return e(function(e,a){t.get("/offhour/list").then(function(t){e(t)},function(e){a(e)})})},this.setOffhour=function(a){return e(function(e,n){t.post("/offhour/set_offhour",a).then(function(t){e(t)},function(e){n(e)})})},this.getAnnouncements=function(){return e(function(e,a){t.get("/offhour/list_announcement").then(function(t){e(t)},function(e){a(e)})})},this.setRecordMsg=function(){return e(function(e,a){t.post("/offhour/record_announcement").then(function(t){e(t)},function(e){a(e)})})},this.enableMsg=function(a){return e(function(e,n){t.post("/offhour/enable_announcement",a).then(function(t){e(t)},function(e){n(e)})})},this.deleteMsg=function(a){return e(function(e,n){t.post("/offhour/delete_announcement",a).then(function(t){e(t)},function(e){n(e)})})},this.modifyMsg=function(a){return e(function(e,n){t.post("/offhour/modify_announcement",a).then(function(t){e(t)},function(e){n(e)})})},this.uploadAudioMsg=function(a){return e(function(e,n){t.post("/offhour/upload_announcement",a).then(function(t){e(t)},function(e){n(e)})})},this.listenMsg=function(a){return e(function(e,n){t.get("/offhour/listen_announcement/"+a).then(function(t){e(t)},function(e){n(e)})})},this.downloadMsg=function(a){return e(function(e,n){t.get("/offhour/download_announcement/"+a).then(function(t){e(t)},function(e){n(e)})})}}]),angular.module("nethctiUiApp").service("VideoconfService",["$q","RestService",function(e,t){this.newRoom=function(){return e(function(e,a){t.post("/videoconf/newroom").then(function(t){e(t)},function(e){a(e)})})},this.sendInvitationEmails=function(a){return e(function(e,n){t.post("/videoconf/send_emails",a).then(function(t){e(t)},function(e){n(e)})})}}]),angular.module("nethctiUiApp").service("ConferenceService",["$q","RestService",function(e,t){this.confInfo=function(a){return e(function(e,n){t.get("/astproxy/conference/"+a).then(function(t){e(t)},function(e){n(e)})})},this.startConf=function(a){return e(function(e,n){t.post("/astproxy/start_conf",a).then(function(t){e(t)},function(e){n(e)})})},this.endConf=function(a){return e(function(e,n){t.post("/astproxy/end_conf",a).then(function(t){e(t)},function(e){n(e)})})},this.joinMyConf=function(a){return e(function(e,n){t.post("/astproxy/join_myconf",a).then(function(t){e(t)},function(e){n(e)})})},this.muteUserConf=function(a){return e(function(e,n){t.post("/astproxy/mute_userconf",a).then(function(t){e(t)},function(e){n(e)})})},this.unmuteUserConf=function(a){return e(function(e,n){t.post("/astproxy/unmute_userconf",a).then(function(t){e(t)},function(e){n(e)})})},this.hangupUserConf=function(a){return e(function(e,n){t.post("/astproxy/hangup_userconf",a).then(function(t){e(t)},function(e){n(e)})})}}]),angular.module("nethctiUiApp").service("ThemeService",function(){this.getColors=function(){return[{name:"Omolon",colors:["#091E3A","#2F80ED","#2D9EE0"]},{name:"Farhan",colors:["#9400D3","#4B0082"]},{name:"Purple",colors:["#c84e89","#F15F79"]},{name:"Ibtesam",colors:["#00F5A0","#00D9F5"]},{name:"Radioactive Heat",colors:["#F7941E","#72C6EF","#00A651"]},{name:"The Sky And The Sea",colors:["#F7941E","#004E8F"]},{name:"From Ice To Fire",colors:["#72C6EF","#004E8F"]},{name:"Blue & Orange",colors:["#FD8112","#0085CA"]},{name:"Purple Dream",colors:["#bf5ae0","#a811da"]},{name:"Blu",colors:["#00416A","#E4E5E6"]},{name:"Summer Breeze",colors:["#fbed96","#abecd6"]},{name:"Ver",colors:["#FFE000","#799F0C"]},{name:"Ver Black",colors:["#F7F8F8","#ACBB78"]},{name:"Combi",colors:["#00416A","#799F0C","#FFE000"]},{name:"Anwar",colors:["#334d50","#cbcaa5"]},{name:"Bluelagoo",colors:["#0052D4","#4364F7","#6FB1FC"]},{name:"Lunada",colors:["#5433FF","#20BDFF","#A5FECB"]},{name:"Reaqua",colors:["#799F0C","#ACBB78"]},{name:"Mango",colors:["#ffe259","#ffa751"]},{name:"Bupe",colors:["#00416A","#E4E5E6"]},{name:"Rea",colors:["#FFE000","#799F0C"]},{name:"Windy",colors:["#acb6e5","#86fde8"]},{name:"Royal Blue",colors:["#536976","#292E49"]},{name:"Royal Blue + Petrol",colors:["#BBD2C5","#536976","#292E49"]},{name:"Copper",colors:["#B79891","#94716B"]},{name:"Anamnisar",colors:["#9796f0","#fbc7d4"]},{name:"Petrol",colors:["#BBD2C5","#536976"]},{name:"Sky",colors:["#076585","#fff"]},{name:"Sel",colors:["#00467F","#A5CC82"]},{name:"Afternoon",colors:["#000C40","#607D8B"]},{name:"Skyline",colors:["#1488CC","#2B32B2"]},{name:"DIMIGO",colors:["#ec008c","#fc6767"]},{name:"Purple Love",colors:["#cc2b5e","#753a88"]},{name:"Sexy Blue",colors:["#2193b0","#6dd5ed"]},{name:"Blooker20",colors:["#e65c00","#F9D423"]},{name:"Sea Blue",colors:["#2b5876","#4e4376"]},{name:"Nimvelo",colors:["#314755","#26a0da"]},{name:"Hazel",colors:["#77A1D3","#79CBCA","#E684AE"]},{name:"Noon to Dusk",colors:["#ff6e7f","#bfe9ff"]},{name:"YouTube",colors:["#e52d27","#b31217"]},{name:"Cool Brown",colors:["#603813","#b29f94"]},{name:"Harmonic Energy",colors:["#16A085","#F4D03F"]},{name:"Playing with Reds",colors:["#D31027","#EA384D"]},{name:"Sunny Days",colors:["#EDE574","#E1F5C4"]},{name:"Green Beach",colors:["#02AAB0","#00CDAC"]},{name:"Intuitive Purple",colors:["#DA22FF","#9733EE"]},{name:"Emerald Water",colors:["#348F50","#56B4D3"]},{name:"Lemon Twist",colors:["#3CA55C","#B5AC49"]},{name:"Monte Carlo",colors:["#CC95C0","#DBD4B4","#7AA1D2"]},{name:"Horizon",colors:["#003973","#E5E5BE"]},{name:"Rose Water",colors:["#E55D87","#5FC3E4"]},{name:"Frozen",colors:["#403B4A","#E7E9BB"]},{name:"Mango Pulp",colors:["#F09819","#EDDE5D"]},{name:"Bloody Mary",colors:["#FF512F","#DD2476"]},{name:"Aubergine",colors:["#AA076B","#61045F"]},{name:"Aqua Marine",colors:["#1A2980","#26D0CE"]},{name:"Sunrise",colors:["#FF512F","#F09819"]},{name:"Purple Paradise",colors:["#1D2B64","#F8CDDA"]},{name:"Stripe",colors:["#1FA2FF","#12D8FA","#A6FFCB"]},{name:"Sea Weed",colors:["#4CB8C4","#3CD3AD"]},{name:"Pinky",colors:["#DD5E89","#F7BB97"]},{name:"Cherry",colors:["#EB3349","#F45C43"]},{name:"Mojito",colors:["#1D976C","#93F9B9"]},{name:"Juicy Orange",colors:["#FF8008","#FFC837"]},{name:"Mirage",colors:["#16222A","#3A6073"]},{name:"Steel Gray",colors:["#1F1C2C","#928DAB"]},{name:"Kashmir",colors:["#614385","#516395"]},{name:"Electric Violet",colors:["#4776E6","#8E54E9"]},{name:"Venice Blue",colors:["#085078","#85D8CE"]},{name:"Bora Bora",colors:["#2BC0E4","#EAECC6"]},{name:"Moss",colors:["#134E5E","#71B280"]},{name:"Shroom Haze",colors:["#5C258D","#4389A2"]},{name:"Mystic",colors:["#757F9A","#D7DDE8"]},{name:"Midnight City",colors:["#232526","#414345"]},{name:"Sea Blizz",colors:["#1CD8D2","#93EDC7"]},{name:"Opa",colors:["#3D7EAA","#FFE47A"]},{name:"Titanium",colors:["#283048","#859398"]},{name:"Mantle",colors:["#24C6DC","#514A9D"]},{name:"Dracula",colors:["#DC2424","#4A569D"]},{name:"Peach",colors:["#ED4264","#FFEDBC"]},{name:"Moonrise",colors:["#DAE2F8","#D6A4A4"]},{name:"Clouds",colors:["#ECE9E6","#FFFFFF"]},{name:"Stellar",colors:["#7474BF","#348AC7"]},{name:"Bourbon",colors:["#EC6F66","#F3A183"]},{name:"Calm Darya",colors:["#5f2c82","#49a09d"]},{name:"Influenza",colors:["#C04848","#480048"]},{name:"Shrimpy",colors:["#e43a15","#e65245"]},{name:"Army",colors:["#414d0b","#727a17"]},{name:"Miaka",colors:["#FC354C","#0ABFBC"]},{name:"Pinot Noir",colors:["#4b6cb7","#182848"]},{name:"Day Tripper",colors:["#f857a6","#ff5858"]},{name:"Namn",colors:["#a73737","#7a2828"]},{name:"Blurry Beach",colors:["#d53369","#cbad6d"]},{name:"Vasily",colors:["#e9d362","#333333"]},{name:"A Lost Memory",colors:["#DE6262","#FFB88C"]},{name:"Petrichor",colors:["#666600","#999966"]},{name:"Jonquil",colors:["#FFEEEE","#DDEFBB"]},{name:"Sirius Tamed",colors:["#EFEFBB","#D4D3DD"]},{name:"Kyoto",colors:["#c21500","#ffc500"]},{name:"Misty Meadow",colors:["#215f00","#e4e4d9"]},{name:"Aqualicious",colors:["#50C9C3","#96DEDA"]},{name:"Moor",colors:["#616161","#9bc5c3"]},{name:"Almost",colors:["#ddd6f3","#faaca8"]},{name:"Forever Lost",colors:["#5D4157","#A8CABA"]},{name:"Winter",colors:["#E6DADA","#274046"]},{name:"Nelson",colors:["#f2709c","#ff9472"]},{name:"Autumn",colors:["#DAD299","#B0DAB9"]},{name:"Candy",colors:["#D3959B","#BFE6BA"]},{name:"Reef",colors:["#00d2ff","#3a7bd5"]},{name:"The Strain",colors:["#870000","#190A05"]},{name:"Dirty Fog",colors:["#B993D6","#8CA6DB"]},{name:"Earthly",colors:["#649173","#DBD5A4"]},{name:"Virgin",colors:["#C9FFBF","#FFAFBD"]},{name:"Ash",colors:["#606c88","#3f4c6b"]},{name:"Cherryblossoms",colors:["#FBD3E9","#BB377D"]},{name:"Parklife",colors:["#ADD100","#7B920A"]},{name:"Dance To Forget",colors:["#FF4E50","#F9D423"]},{name:"Starfall",colors:["#F0C27B","#4B1248"]},{name:"Red Mist",colors:["#000000","#e74c3c"]},{name:"Teal Love",colors:["#AAFFA9","#11FFBD"]},{name:"Neon Life",colors:["#B3FFAB","#12FFF7"]},{name:"Man of Steel",colors:["#780206","#061161"]},{name:"Amethyst",colors:["#9D50BB","#6E48AA"]},{name:"Cheer Up Emo Kid",colors:["#556270","#FF6B6B"]},{name:"Shore",colors:["#70e1f5","#ffd194"]},{name:"Facebook Messenger",colors:["#00c6ff","#0072ff"]},{name:"SoundCloud",colors:["#fe8c00","#f83600"]},{name:"Behongo",colors:["#52c234","#061700"]},{name:"ServQuick",colors:["#485563","#29323c"]},{name:"Friday",colors:["#83a4d4","#b6fbff"]},{name:"Martini",colors:["#FDFC47","#24FE41"]},{name:"Metallic Toad",colors:["#abbaab","#ffffff"]},{name:"Between The Clouds",colors:["#73C8A9","#373B44"]},{name:"Crazy Orange I",colors:["#D38312","#A83279"]},{name:"Hersheys",colors:["#1e130c","#9a8478"]},{name:"Talking To Mice Elf",colors:["#948E99","#2E1437"]},{name:"Purple Bliss",colors:["#360033","#0b8793"]},{name:"Predawn",colors:["#FFA17F","#00223E"]},{name:"Endless River",colors:["#43cea2","#185a9d"]},{name:"Pastel Orange at the Sun",colors:["#ffb347","#ffcc33"]},{name:"Twitch",colors:["#6441A5","#2a0845"]},{name:"Atlas",colors:["#FEAC5E","#C779D0","#4BC0C8"]},{name:"Instagram",colors:["#833ab4","#fd1d1d","#fcb045"]},{name:"Flickr",colors:["#ff0084","#33001b"]},{name:"Vine",colors:["#00bf8f","#001510"]},{name:"Turquoise flow",colors:["#136a8a","#267871"]},{name:"Portrait",colors:["#8e9eab","#eef2f3"]},{name:"Virgin America",colors:["#7b4397","#dc2430"]},{name:"Koko Caramel",colors:["#D1913C","#FFD194"]},{name:"Fresh Turboscent",colors:["#F1F2B5","#135058"]},{name:"Green to dark",colors:["#6A9113","#141517"]},{name:"Ukraine",colors:["#004FF9","#FFF94C"]},{name:"Curiosity blue",colors:["#525252","#3d72b4"]},{name:"Dark Knight",colors:["#BA8B02","#181818"]},{name:"Piglet",colors:["#ee9ca7","#ffdde1"]},{name:"Lizard",colors:["#304352","#d7d2cc"]},{name:"Sage Persuasion",colors:["#CCCCB2","#757519"]},{name:"Between Night and Day",colors:["#2c3e50","#3498db"]},{name:"Timber",colors:["#fc00ff","#00dbde"]},{name:"Passion",colors:["#e53935","#e35d5b"]},{name:"Clear Sky",colors:["#005C97","#363795"]},{name:"Master Card",colors:["#f46b45","#eea849"]},{name:"Back To Earth",colors:["#00C9FF","#92FE9D"]},{name:"Deep Purple",colors:["#673AB7","#512DA8"]},{name:"Little Leaf",colors:["#76b852","#8DC26F"]},{name:"Netflix",colors:["#8E0E00","#1F1C18"]},{name:"Light Orange",colors:["#FFB75E","#ED8F03"]},{name:"Green and Blue",colors:["#c2e59c","#64b3f4"]},{name:"Poncho",colors:["#403A3E","#BE5869"]},{name:"Back to the Future",colors:["#C02425","#F0CB35"]},{name:"Blush",colors:["#B24592","#F15F79"]},{name:"Inbox",colors:["#457fca","#5691c8"]},{name:"Purplin",colors:["#6a3093","#a044ff"]},{name:"Pale Wood",colors:["#eacda3","#d6ae7b"]},{name:"Haikus",colors:["#fd746c","#ff9068"]},{name:"Pizelex",colors:["#114357","#F29492"]},{name:"Joomla",colors:["#1e3c72","#2a5298"]},{name:"Christmas",colors:["#2F7336","#AA3A38"]},{name:"Minnesota Vikings",colors:["#5614B0","#DBD65C"]},{name:"Miami Dolphins",colors:["#4DA0B0","#D39D38"]},{name:"Forest",colors:["#5A3F37","#2C7744"]},{name:"Nighthawk",colors:["#2980b9","#2c3e50"]},{name:"Superman",colors:["#0099F7","#F11712"]},{name:"Suzy",colors:["#834d9b","#d04ed6"]},{name:"Dark Skies",colors:["#4B79A1","#283E51"]},{name:"Deep Space",colors:["#000000","#434343"]},{name:"Decent",colors:["#4CA1AF","#C4E0E5"]},{name:"Colors Of Sky",colors:["#E0EAFC","#CFDEF3"]},{name:"Purple White",colors:["#BA5370","#F4E2D8"]},{name:"Ali",colors:["#ff4b1f","#1fddff"]},{name:"Alihossein",colors:["#f7ff00","#db36a4"]},{name:"Shahabi",colors:["#a80077","#66ff00"]},{name:"Red Ocean",colors:["#1D4350","#A43931"]},{name:"Tranquil",colors:["#EECDA3","#EF629F"]},{name:"Transfile",colors:["#16BFFD","#CB3066"]},{name:"Sylvia",colors:["#ff4b1f","#ff9068"]},{name:"Sweet Morning",colors:["#FF5F6D","#FFC371"]},{name:"Politics",colors:["#2196f3","#f44336"]},{name:"Bright Vault",colors:["#00d2ff","#928DAB"]},{name:"Solid Vault",colors:["#3a7bd5","#3a6073"]},{name:"Sunset",colors:["#0B486B","#F56217"]},{name:"Grapefruit Sunset",colors:["#e96443","#904e95"]},{name:"Deep Sea Space",colors:["#2C3E50","#4CA1AF"]},{name:"Dusk",colors:["#2C3E50","#FD746C"]},{name:"Minimal Red",colors:["#F00000","#DC281E"]},{name:"Royal",colors:["#141E30","#243B55"]},{name:"Mauve",colors:["#42275a","#734b6d"]},{name:"Frost",colors:["#000428","#004e92"]},{name:"Lush",colors:["#56ab2f","#a8e063"]},{name:"Firewatch",colors:["#cb2d3e","#ef473a"]},{name:"Sherbert",colors:["#f79d00","#64f38c"]},{name:"Blood Red",colors:["#f85032","#e73827"]},{name:"Sun on the Horizon",colors:["#fceabb","#f8b500"]},{name:"IIIT Delhi",colors:["#808080","#3fada8"]},{name:"Jupiter",colors:["#ffd89b","#19547b"]},{name:"50 Shades of Grey",colors:["#bdc3c7","#2c3e50"]},{name:"Dania",colors:["#BE93C5","#7BC6CC"]},{name:"Limeade",colors:["#A1FFCE","#FAFFD1"]},{name:"Disco",colors:["#4ECDC4","#556270"]},{name:"Love Couple",colors:["#3a6186","#89253e"]},{name:"Azure Pop",colors:["#ef32d9","#89fffd"]},{name:"Nepal",colors:["#de6161","#2657eb"]},{name:"Cosmic Fusion",colors:["#ff00cc","#333399"]},{name:"Snapchat",colors:["#fffc00","#ffffff"]},{name:"Ed's Sunset Gradient",colors:["#ff7e5f","#feb47b"]},{name:"Brady Brady Fun Fun",colors:["#00c3ff","#ffff1c"]},{name:"Black Rosé",colors:["#f4c4f3","#fc67fa"]},{name:"80's Purple",colors:["#41295a","#2F0743"]},{name:"Radar",colors:["#A770EF","#CF8BF3","#FDB99B"]},{name:"Ibiza Sunset",colors:["#ee0979","#ff6a00"]},{name:"Dawn",colors:["#F3904F","#3B4371"]},{name:"Mild",colors:["#67B26F","#4ca2cd"]},{name:"Vice City",colors:["#3494E6","#EC6EAD"]},{name:"Jaipur",colors:["#DBE6F6","#C5796D"]},{name:"Jodhpur",colors:["#9CECFB","#65C7F7","#0052D4"]},{name:"Cocoaa Ice",colors:["#c0c0aa","#1cefff"]},{name:"EasyMed",colors:["#DCE35B","#45B649"]},{name:"Rose Colored Lenses",colors:["#E8CBC0","#636FA4"]},{name:"What lies Beyond",colors:["#F0F2F0","#000C40"]},{name:"Roseanna",colors:["#FFAFBD","#ffc3a0"]},{name:"Honey Dew",colors:["#43C6AC","#F8FFAE"]},{name:"Under the Lake",colors:["#093028","#237A57"]},{name:"The Blue Lagoon",colors:["#43C6AC","#191654"]},{name:"Can You Feel The Love Tonight",colors:["#4568DC","#B06AB3"]},{name:"Very Blue",colors:["#0575E6","#021B79"]},{name:"Love and Liberty",colors:["#200122","#6f0000"]},{name:"Orca",colors:["#44A08D","#093637"]},{name:"Venice",colors:["#6190E8","#A7BFE8"]},{name:"Pacific Dream",colors:["#34e89e","#0f3443"]},{name:"Learning and Leading",colors:["#F7971E","#FFD200"]},{name:"Celestial",colors:["#C33764","#1D2671"]},{name:"Purplepine",colors:["#20002c","#cbb4d4"]},{name:"Sha la la",colors:["#D66D75","#E29587"]},{name:"Mini",colors:["#30E8BF","#FF8235"]},{name:"Maldives",colors:["#B2FEFA","#0ED2F7"]},{name:"Cinnamint",colors:["#4AC29A","#BDFFF3"]},{name:"Html",colors:["#E44D26","#F16529"]},{name:"Coal",colors:["#EB5757","#000000"]},{name:"Sunkist",colors:["#F2994A","#F2C94C"]},{name:"Blue Skies",colors:["#56CCF2","#2F80ED"]},{name:"Chitty Chitty Bang Bang",colors:["#007991","#78ffd6"]},{name:"Visions of Grandeur",colors:["#000046","#1CB5E0"]},{name:"Crystal Clear",colors:["#159957","#155799"]},{name:"Mello",colors:["#c0392b","#8e44ad"]},{name:"Compare Now",colors:["#EF3B36","#FFFFFF"]},{name:"Meridian",colors:["#283c86","#45a247"]},{name:"Relay",colors:["#3A1C71","#D76D77","#FFAF7B"]},{name:"Alive",colors:["#CB356B","#BD3F32"]},{name:"Scooter",colors:["#36D1DC","#5B86E5"]},{name:"Terminal",colors:["#000000","#0f9b0f"]},{name:"Telegram",colors:["#1c92d2","#f2fcfe"]},{name:"Crimson Tide",colors:["#642B73","#C6426E"]},{name:"Socialive",colors:["#06beb6","#48b1bf"]},{name:"Subu",colors:["#0cebeb","#20e3b2","#29ffc6"]},{name:"Broken Hearts",colors:["#d9a7c7","#fffcdc"]},{name:"Kimoby Is The New Blue",colors:["#396afc","#2948ff"]},{name:"Dull",colors:["#C9D6FF","#E2E2E2"]},{name:"Purpink",colors:["#7F00FF","#E100FF"]},{name:"Orange Coral",colors:["#ff9966","#ff5e62"]},{name:"Summer",colors:["#22c1c3","#fdbb2d"]},{name:"King Yna",colors:["#1a2a6c","#b21f1f","#fdbb2d"]},{name:"Velvet Sun",colors:["#e1eec3","#f05053"]},{name:"Zinc",colors:["#ADA996","#F2F2F2","#DBDBDB","#EAEAEA"]},{name:"Hydrogen",colors:["#667db6","#0082c8","#0082c8","#667db6"]},{name:"Argon",colors:["#03001e","#7303c0","#ec38bc","#fdeff9"]},{name:"Lithium",colors:["#6D6027","#D3CBB8"]},{name:"Digital Water",colors:["#74ebd5","#ACB6E5"]},{name:"Orange Fun",colors:["#fc4a1a","#f7b733"]},{name:"Rainbow Blue",colors:["#00F260","#0575E6"]},{name:"Pink Flavour",colors:["#800080","#ffc0cb"]},{name:"Sulphur",colors:["#CAC531","#F3F9A7"]},{name:"Selenium",colors:["#3C3B3F","#605C3C"]},{name:"Delicate",colors:["#D3CCE3","#E9E4F0"]},{name:"Ohhappiness",colors:["#00b09b","#96c93d"]},{name:"Lawrencium",colors:["#0f0c29","#302b63","#24243e"]},{name:"Relaxing red",colors:["#fffbd5","#b20a2c"]},{name:"Taran Tado",colors:["#23074d","#cc5333"]},{name:"Bighead",colors:["#c94b4b","#4b134f"]},{name:"Sublime Vivid",colors:["#FC466B","#3F5EFB"]},{name:"Sublime Light",colors:["#FC5C7D","#6A82FB"]},{name:"Pun Yeta",colors:["#108dc7","#ef8e38"]},{name:"Quepal",colors:["#11998e","#38ef7d"]},{name:"Sand to Blue",colors:["#3E5151","#DECBA4"]},{name:"Wedding Day Blues",colors:["#40E0D0","#FF8C00","#FF0080"]},{name:"Shifter",colors:["#bc4e9c","#f80759"]},{name:"Red Sunset",colors:["#355C7D","#6C5B7B","#C06C84"]},{name:"Moon Purple",colors:["#4e54c8","#8f94fb"]},{name:"Pure Lust",colors:["#333333","#dd1818"]},{name:"Slight Ocean View",colors:["#a8c0ff","#3f2b96"]},{name:"eXpresso",colors:["#ad5389","#3c1053"]},{name:"Shifty",colors:["#636363","#a2ab58"]},{name:"Vanusa",colors:["#DA4453","#89216B"]},{name:"Evening Night",colors:["#005AA7","#FFFDE4"]},{name:"Magic",colors:["#59C173","#a17fe0","#5D26C1"]},{name:"Margo",colors:["#FFEFBA","#FFFFFF"]},{name:"Blue Raspberry",colors:["#00B4DB","#0083B0"]},{name:"Citrus Peel",colors:["#FDC830","#F37335"]},{name:"Sin City Red",colors:["#ED213A","#93291E"]},{name:"Rastafari",colors:["#1E9600","#FFF200","#FF0000"]},{name:"Summer Dog",colors:["#a8ff78","#78ffd6"]},{name:"Wiretap",colors:["#8A2387","#E94057","#F27121"]},{name:"Burning Orange",colors:["#FF416C","#FF4B2B"]},{name:"Ultra Voilet",colors:["#654ea3","#eaafc8"]},{name:"By Design",colors:["#009FFF","#ec2F4B"]},{name:"Kyoo Tah",colors:["#544a7d","#ffd452"]},{name:"Kye Meh",colors:["#8360c3","#2ebf91"]},{name:"Kyoo Pal",colors:["#dd3e54","#6be585"]},{name:"Metapolis",colors:["#659999","#f4791f"]},{name:"Flare",colors:["#f12711","#f5af19"]},{name:"Witching Hour",colors:["#c31432","#240b36"]},{name:"Azur Lane",colors:["#7F7FD5","#86A8E7","#91EAE4"]},{name:"Neuromancer",colors:["#f953c6","#b91d73"]},{name:"Harvey",colors:["#1f4037","#99f2c8"]},{name:"Amin",colors:["#8E2DE2","#4A00E0"]},{name:"Memariani",colors:["#aa4b6b","#6b6b83","#3b8d99"]},{name:"Yoda",colors:["#FF0099","#493240"]},{name:"Cool Sky",colors:["#2980B9","#6DD5FA","#FFFFFF"]},{name:"Dark Ocean",colors:["#373B44","#4286f4"]},{name:"Evening Sunshine",colors:["#b92b27","#1565C0"]},{name:"JShine",colors:["#12c2e9","#c471ed","#f64f59"]},{name:"Moonlit Asteroid",colors:["#0F2027","#203A43","#2C5364"]},{name:"MegaTron",colors:["#C6FFDD","#FBD786","#f7797d"]},{name:"Cool Blues",colors:["#2193b0","#6dd5ed"]},{name:"Piggy Pink",colors:["#ee9ca7","#ffdde1"]},{name:"Grade Grey",colors:["#bdc3c7","#2c3e50"]},{name:"Zenta",colors:["#2A2D3E","#FECB6E"]},{name:"Electric Peacock",colors:["#8a2be2","#0000cd","#228b22","#ccff00"]},{name:"Under Blue Green",colors:["#051937","#004d7a","#008793","#00bf72","#a8eb12"]},{name:"Lensod",colors:["#6025F5","#FF5555"]},{name:"Newspaper",colors:["#8a2be2","#ffa500","#f8f8ff"]},{name:"Dark Blue Gradient",colors:["#2774ae","#002E5D","#002E5D"]},{name:"Dark Blu Two",colors:["#004680","#4484BA"]},{name:"Lemon Lime",colors:["#7ec6bc","#ebe717"]},{name:"Beleko",colors:["#ff1e56","#f9c942","#1e90ff"]},{name:"Mango Papaya",colors:["#de8a41","#2ada53"]},{name:"Unicorn Rainbow",colors:["#f7f0ac","#acf7f0","#f0acf7"]},{name:"Flame",colors:["#ff0000","#fdcf58"]},{name:"Blue Red",colors:["#36B1C7","#960B33"]},{name:"Twitter",colors:["#1DA1F2","#009ffc"]},{name:"Blooze",colors:["#6da6be","#4b859e","#6da6be"]},{name:"Blue Slate",colors:["#B5B9FF","#2B2C49"]},{name:"Space Light Green",colors:["#9FA0A8","#5C7852"]},{name:"Flower",colors:["#DCFFBD","#CC86D1"]},{name:"Elate The Euge",colors:["#8BDEDA","#43ADD0","#998EE0","#E17DC2","#EF9393"]},{name:"Peach Sea",colors:["#E6AE8C","#A8CECF"]},{name:"Abbas",colors:["#00fff0","#0083fe"]},{name:"Winter Woods",colors:["#333333","#a2ab58","#A43931"]},{name:"Ameena",colors:["#0c0c6d","#de512b","#98d0c1","#5bb226","#023c0d"]},{name:"Emerald Sea",colors:["#05386b","#5cdb95"]},{name:"Bleem",colors:["#4284DB","#29EAC4"]},{name:"Coffee Gold",colors:["#554023","#c99846"]},{name:"Compass",colors:["#516b8b","#056b3b"]},{name:"Andreuzza's",colors:["#D70652","#FF025E"]},{name:"Moonwalker",colors:["#152331","#000000"]},{name:"Whinehouse",colors:["#f7f7f7","#b9a0a0","#794747","#4e2020","#111111"]},{name:"Hyper Blue",colors:["#59CDE9","#0A2A88"]},{name:"Racker",colors:["#EB0000","#95008A","#3300FC"]},{name:"After the Rain",colors:["#ff75c3","#ffa647","#ffe83f","#9fff5b","#70e2ff","#cd93ff"]}]}}),angular.module("nethctiUiApp").filter("toLocaleString",function(){return function(e){return"-"==e?e:new Date(1e3*e).toLocaleTimeString()}}),angular.module("nethctiUiApp").filter("customFilterMultiple",function(){return function(e,t,a){if(!e)return e;if(!a)return e;var n=(""+a).toLowerCase(),i={},s=t.split(",");for(var o in s)angular.forEach(e,function(e,t){-1!==(""+e[s[o]]).toLowerCase().indexOf(n)&&(i[t]=e)});return i}}),angular.module("nethctiUiApp").filter("customFilterOperators",function(){return function(e,t){if(!e)return e;if(!t)return e;var a=(""+t).toLowerCase(),n={};return angular.forEach(e,function(e,t){var i=(""+e.name).toLowerCase(),s=(""+e.endpoints.mainextension[0].id).toLowerCase();-1!==i.indexOf(a)?n[t]=e:-1!==s.indexOf(a)&&(n[t]=e)}),n}}),angular.module("nethctiUiApp").directive("resizer",["$document","LocalStorageService",function(e,t){return function(a,n,i){function s(i){if(!(o=t.get("containersHeightQueues")))var o={};o[n[0].id]=n[0].clientHeight,t.set("containersHeightQueues",o),a.updateTableContainersH(o),e.unbind("mouseup",s)}n.on("mousedown",function(t){e.on("mouseup",s)})}}]),angular.module("nethctiUiApp").directive("whenScrolled",function(){return function(e,t,a){var n=t[0];t.bind("scroll",function(){n.scrollTop+n.offsetHeight>=n.scrollHeight-100&&e.$apply(a.whenScrolled)})}}),angular.module("nethctiUiApp").directive("onFinishRender",["$timeout",function(e){return{restrict:"A",link:function(t,a,n){!0===t.$last&&e(function(){t.$emit("ngRepeatFinished")})}}}]),angular.module("nethctiUiApp").run(["$templateCache",function(e){"use strict";e.put("views/customercard.html",'<div class="ui segment adjust-segment-container"> <div ng-show="viewLoad" class="ui active centered inline loader"></div> <div ng-show="!viewLoad"> <h3 class="ui blue header title-header"> <i class="blue browser icon"></i> <div class="content"> {{\'Customer cards\' | translate}} </div> </h3> <div ng-repeat="c in cards"> <h3 class="ui blue dividing header">{{c.descr}}</h3> <div ng-bind-html="c.data | base64Conv" class="ccards-container"> </div> <div ng-if="!$last" class="ui divider"></div> </div> <div ng-show="cards | isempty:true" class="ui message"> <div class="header"> {{\'No customer cards found\' | translate}} </div> </div> </div> </div>'),e.put("views/history.html",'<div class="ui segment adjust-segment-container"> <h3 class="ui red header title-header"> <i class="red history icon"></i> <div class="content"> {{\'History\' | translate}} </div> </h3> \x3c!-- Report link  --\x3e <a type="button" ng-if="currentUser.profile.macro_permissions.cdr.permissions.ad_cdr.value || currentUser.profile.macro_permissions.cdr.value || currentUser.profile.macro_permissions.cdr.group_cdr.value" class="ui primary basic button" href="/pbx-report/#/cdr" target="_blank"> <i class="chart bar icon"></i>{{\'Report\' | translate}} </a> <div id="mainHistoryMenu" class="ui pointing secondary {{responsive.isMobile ? \'three item\' : \'\'}} menu"> \x3c!-- personal calls item --\x3e <a id="personalItem" ng-click="startSearchPersonal()" class="item red active" data-tab="personal"> <i class="call icon icon-main-menu"></i> <span class="hide-icon-menu">{{\'Personal calls\' | translate}}</span> </a> \x3c!-- switchboard calls item --\x3e <a ng-init="refreshTabs()" ng-if="currentUser.profile.macro_permissions.cdr.permissions.ad_cdr.value" ng-click="startSearchSwitchboard()" class="item red" data-tab="switchboard"> <i class="fax icon icon-main-menu"></i> <span class="hide-icon-menu">{{\'Switchboard calls\' | translate}}</span> </a> \x3c!-- group calls item --\x3e <a ng-init="refreshTabs()" ng-if="currentUser.profile.macro_permissions.cdr.permissions.group_cdr.value" ng-click="startSearchGroup()" class="item red" data-tab="group"> <i class="building icon icon-main-menu"></i><span class="hide-icon-menu">{{\'Group calls\' | translate}}</span> </a> \x3c!-- voicemail item --\x3e <a ng-click="getAllVoicemail()" class="item red" data-tab="voicemail"> <i class="mail icon icon-main-menu"></i> <span class="hide-icon-menu custom-icon-height">{{\'Voicemail\' | translate}}</span> </a> </div> \x3c!-- personal calls content --\x3e <div ng-init="personalInit()" class="ui tab active" data-tab="personal"> <form ng-submit="startSearchPersonal()"> <div class="ui form"> <div class="inline fields"> <div class="field small-margin-bottom large-margin-top"> <div class="ui icon input"> <input ng-model="personalText" type="text" placeholder="{{\'Search\' | translate}}..."> </div> </div> <div class="field small-margin-bottom"> <label class="filter-responsive">{{\'From\' | translate}}:</label> <div class="ui calendar" id="rangestartPersonal"> <div class="ui input left icon"> <i class="calendar icon"></i> <input required type="text" placeholder="..."> </div> </div> </div> <div class="field small-margin-bottom"> <label class="filter-responsive">{{\'To\' | translate}}:</label> <div class="ui calendar" id="rangeendPersonal"> <div class="ui input left icon"> <i class="calendar icon"></i> <input required type="text" placeholder="..."> </div> </div> </div> <div class="field small-margin-bottom large-margin-top-adjust"> <button id="historySearchButton" type="submit" class="ui icon button tiny"> <i class="search icon"></i> </button> </div> </div> </div> <button ng-click="clearSearchPersonal()" class="ui black compact labeled icon button clean-filters-button"> <i class="remove icon"></i> {{\'Clear filters\' | translate}} </button> </form> <div class="ui top attached tabular menu"> <a ng-repeat="f in filterAvailable" ng-click="setPersonalFilter(f)" class="item {{f.filter == personalFilter.filter ? \'active\' : \'\'}}" data-tab="personal-{{f.filter}}" ng-if="f.type == \'all\' || f.type == \'personal\'"> <i ng-if="f.icon" class="{{f.icon}} icon icon-main-menu icon-adjust-line"></i> <span class="{{f.filter != \'all\' ? \'hide-icon-menu\' : \'\'}}">{{f.description | capitalize | translate}}</span> </a> </div> <div class="tabular-divider"> </div> <div class="ui bottom attached active tab segment" data-tab="personal-a"> <div class="inline-row hide-label-filter ui small label"> {{personalFilter.description | capitalize | translate}} </div> <div class="float-right inline-row font-medium">{{\'Total\' | translate}}: <b>{{tableParamsAllPersonal.total()}}</b> </div> <div ng-show="loadTableAllPersonal" class="ui active centered inline loader"></div> <div ng-show="!loadTableAllPersonal && tableParamsAllPersonal.data.length == 0" class="ui message"> <div class="header"> {{\'No call found\' | translate}} </div> </div> <table ng-show="!loadTableAllPersonal && tableParamsAllPersonal.data.length > 0" ng-table="tableParamsAllPersonal" class="ui sortable padded selectable table"> <tr ng-repeat="s in $data" class="{{s.disposition != \'ANSWERED\' ? \'negative\' : \'\'}}"> <td data-title="\'Date\' | translate" sortable> <span>{{ \'with_date_long\' | translate:{date:s.time * 1000} }}</span> </td> <td data-title="\'Contact\' | translate" sortable> <a ng-show="allExtensions[currentUser.default_device.id].status === \'online\'" ng-click="s.direction === \'out\' ?\n              (isNumber(s.dst) ? call(s.dst) : undefined)\n              :\n              (isNumber(s.cnum) ? call(s.cnum) : undefined)" class="{{isNumber(s.dst) ? \'pointer\' : \'no-pointer\'}}"> <span data-tooltip="{{isNumber(s.dst) ? currentCall.accepted ? \'Transfer to\' : \'Call\' : \'Not callable\' | translate}}\n                {{s.direction === \'out\' ?\n                (isNumber(s.dst) ? s.dst : \'\')\n                :\n                (isNumber(s.cnum) ? s.cnum : \'\')}}\n                {{s.direction === \'out\' && s.dst_cnam !== \'\' ? (\' / \' + s.dst_cnam) : (s.cnam !== \'\' ? (\' / \' + s.cnam) : \'\')}}\n                {{s.direction === \'out\' && s.dst_ccompany !== \'\' ? (\' / \' + s.dst_ccompany) : (s.ccompany !== \'\' ? (\' / \' + s.ccompany) : \'\')}}"> {{s.direction === \'out\' ? (s.dst_cnam !== "" ? (s.dst_cnam) : (s.dst_ccompany !== "" ? (s.dst_ccompany) : (s.dst || \'-\'))) : (s.cnam !== "" ? (s.cnam) : (s.ccompany !== "" ? (s.ccompany) : (s.cnum || \'-\')))}} </span> </a> \x3c!-- if the device is not connected --\x3e <a ng-if="allExtensions[currentUser.default_device.id].status !== \'online\'" class="disable-clicks"> <span> {{s.direction === \'out\' ? (s.dst_cnam !== "" ? (s.dst_cnam) : (s.dst_ccompany !== "" ? (s.dst_ccompany) : (s.dst || \'-\'))) : (s.cnam !== "" ? (s.cnam) : (s.ccompany !== "" ? (s.ccompany) : (s.cnum || \'-\')))}} </span> </a> </td> <td data-title="\'Duration\' | translate" sortable> {{s.duration | secondsToReadable}} </td> <td data-title="\'Recording\' | translate" sortable> <div ng-if="s.recordingfile" class="ui dropdown reg-console"> <span ng-click="listenRecording(s.uniqueid, s)" data-tooltip="{{\'Listen\' | translate}}" data-position="top center"> <i class="{{s.inListen ? \'red\' : \'\'}} announcement link icon"></i> </span> </div> <span ng-click="downloadRecording(s.uniqueid)" ng-if="s.recordingfile" data-tooltip="{{\'Download\' | translate}}" data-position="top center"> <i class="download link icon"></i> </span> <span ng-click="deleteRecording(s.uniqueid)" ng-if="s.recordingfile" data-tooltip="{{\'Delete\' | translate}}" data-position="top center"> <i class="trash link icon"></i> </span> <span ng-if="!s.recordingfile">-</span> <audio class="audio-controls" ng-if="s.inListen && s.audiosource" ng-src="{{\'data:audio/wav;base64,\' + s.audiosource | trustUrl}}" controls> {{\'Your browser does not support the audio element\' | translate}}. </audio> </td> <td ng-if="personalFilter.filter === \'all\'" data-title="\'Type\' | translate" sortable> <i class="arrow {{getDirections(s.direction).icon}} icon"></i> {{getDirections(s.direction).text | translate}} </td> <td data-title="\'Status\' | translate" sortable> <span> <i class="{{s.disposition == \'ANSWERED\' ? \'green\' : \'red\'}} call icon"></i> </span> </td> <td data-title="\'Actions\' | translate" sortable> <span data-tooltip="{{\'Add to phonebook\' | translate}}"> <i class="pointer counterclockwise add user icon" ng-click="newContactAdd(\n                  s.direction === \'out\' ? s.dst : s.cnum,\n                  s.direction === \'out\' ? s.dst_cnam : s.cnam,\n                  undefined,\n                  s.direction === \'out\' ? s.dst_ccompany : s.ccompany\n                )"></i> </span> </td> </tr> </table> <div ng-show="!loadTableAllPersonal && tableParamsAllPersonal.total() > 20" class="current-page-info">{{\'Page\' | translate}}: <b>{{tableParamsAllPersonal.page()}}</b></div> </div> </div> \x3c!-- switchboard calls content --\x3e <div id="switchboardContent" ng-init="switchboardInit()" class="ui tab" data-tab="switchboard"> <form ng-submit="startSearchSwitchboard()"> <div class="ui form"> <div class="inline fields"> <div class="field small-margin-bottom large-margin-top"> <div class="ui icon input"> <input ng-model="switchboardText" type="text" placeholder="{{\'Search\' | translate}}..."> <i class="search icon"></i> </div> </div> <div class="field small-margin-bottom"> <label class="filter-responsive">{{\'From\' | translate}}:</label> <div class="ui calendar" id="rangestartSwitchboard"> <div class="ui input left icon"> <i class="calendar icon"></i> <input required type="text" placeholder="..."> </div> </div> </div> <div class="field small-margin-bottom"> <label class="filter-responsive">{{\'To\' | translate}}:</label> <div class="ui calendar" id="rangeendSwitchboard"> <div class="ui input left icon"> <i class="calendar icon"></i> <input required type="text" placeholder="..."> </div> </div> </div> <div class="field small-margin-bottom large-margin-top-adjust"> <button type="submit" class="ui icon button tiny"> <i class="search icon"></i> </button> </div> </div> </div> <button ng-click="clearSearchSwitchboard()" class="ui black compact labeled icon button clean-filters-button"> <i class="remove icon"></i> {{\'Clear filters\' | translate}} </button> </form> <div class="ui top attached tabular menu"> <a ng-repeat="f in filterAvailable" ng-click="setSwitchboardFilter(f)" class="item {{f.filter == switchboardFilter.filter ? \'active\' : \'\'}}" data-tab="switchboard-{{f.filter}}" ng-if="f.type == \'all\' || f.type == \'switchboard\'"> <i ng-if="f.icon" class="{{f.icon}} icon icon-main-menu icon-adjust-line"></i> <span class="{{f.filter != \'all\' ? \'hide-icon-menu\' : \'\'}}">{{f.description | capitalize | translate}}</span> </a> </div> <div class="tabular-divider"> </div> <div class="ui bottom attached active tab segment" data-tab="switchboard-a"> <div class="inline-row hide-label-filter ui small label"> {{switchboardFilter.description | capitalize | translate}} </div> <div class="float-right inline-row font-medium">{{\'Total\' | translate}}: <b>{{tableParamsAllSwitchboard.total()}}</b> </div> <div ng-show="loadTableAllSwitch" class="ui active centered inline loader"></div> <div ng-show="!loadTableAllSwitch && tableParamsAllSwitchboard.data.length == 0" class="ui message"> <div class="header"> {{\'No call found\' | translate}} </div> </div> <table ng-show="!loadTableAllSwitch && tableParamsAllSwitchboard.data.length > 0" ng-table="tableParamsAllSwitchboard" class="ui sortable padded selectable table"> <tr ng-repeat="s in $data" class="{{s.disposition != \'ANSWERED\' ? \'negative\' : \'\'}}"> <td data-title="\'Date\' | translate" sortable> <span>{{ \'with_date_long\' | translate:{date:s.time * 1000} }}</span> </td> <td data-title="\'Source\' | translate" sortable> <a ng-click="isNumber(s.src) ? call(s.src) : undefined" class="{{isNumber(s.src) ? \'pointer\' : \'no-pointer\'}}"> <span data-tooltip="{{isNumber(s.src) ? currentCall.accepted ? \'Transfer to\' : \'Call\' : \'Not callable\' | translate}}\n              {{isNumber(s.src) ? s.src : \'\'}}\n              {{s.cnam !== \'\' ? (\' / \' + s.cnam) : \'\'}}\n              {{s.ccompany !== \'\' ? (\' / \' + s.ccompany) : \'\'}}"> {{(s.cnam !== "" ? (s.cnam) : (s.ccompany !== "" ? (s.ccompany) : (s.cnum || \'-\')))}} <span> </span></span></a> </td> <td data-title="\'Destination\' | translate" sortable> <a ng-click="isNumber(s.dst) ? call(s.dst) : undefined" class="{{isNumber(s.dst) ? \'pointer\' : \'no-pointer\'}}"> <span data-tooltip="{{isNumber(s.dst) ? currentCall.accepted ? \'Transfer to\' : \'Call\' : \'Not callable\' | translate}}\n              {{isNumber(s.dst) ? s.dst : \'\'}}\n              {{s.dst_cnam !== \'\' ? (\' / \' + s.dst_cnam) : \'\'}}\n              {{s.dst_ccompany !== \'\' ? (\' / \' + s.dst_ccompany) : \'\'}}"> {{(s.dst_cnam !== "" ? (s.dst_cnam) : (s.dst_ccompany !== "" ? (s.dst_ccompany) : (s.dst || \'-\')))}} </span> </a> </td> <td data-title="\'Duration\' | translate" sortable> {{s.duration | secondsToReadable}} </td> <td data-title="\'Recording\' | translate" sortable> <div ng-if="s.recordingfile" class="ui dropdown reg-console"> <span ng-click="listenRecording(s.uniqueid, s)" data-tooltip="{{\'Listen\' | translate}}" data-position="top center"> <i class="{{s.inListen ? \'red\' : \'\'}} announcement link icon"></i> </span> </div> <span ng-click="downloadRecording(s.uniqueid)" ng-if="s.recordingfile" data-tooltip="{{\'Download\' | translate}}" data-position="top center"> <i class="download link icon"></i> </span> <span ng-click="deleteRecording(s.uniqueid)" ng-if="s.recordingfile" data-tooltip="{{\'Delete\' | translate}}" data-position="top center"> <i class="trash link icon"></i> </span> <span ng-if="!s.recordingfile">-</span> <audio class="audio-controls" ng-if="s.inListen && s.audiosource" ng-src="{{\'data:audio/wav;base64,\' + s.audiosource | trustUrl}}" controls> {{\'Your browser does not support the audio element\' | translate}}. </audio> </td> <td ng-if="switchboardFilter.filter === \'all\'" data-title="\'Type\' | translate" sortable> <i class="arrow {{getDirections(s.type, true).icon}} icon"></i> {{getDirections(s.type, true).text | translate}} </td> <td data-title="\'Status\' | translate" sortable> <span> <i class="{{s.disposition == \'ANSWERED\' ? \'green\' : \'red\'}} call icon"></i> </span> </td> <td data-title="\'Actions\' | translate" sortable> <span data-tooltip="{{\'Add to phonebook\' | translate}}"> <i class="pointer counterclockwise add user icon" ng-click="newContactAdd(\n                  s.type === \'out\' ? s.dst : s.cnum,\n                  s.type === \'out\' ? s.dst_cnam : s.cnam,\n                  undefined,\n                  s.type === \'out\' ? s.dst_ccompany : s.ccompany\n                )"></i> </span> </td> </tr> </table> <div ng-show="!loadTableAllSwitch && tableParamsAllSwitchboard.total() > 20" class="current-page-info">{{\'Page\' | translate}}: <b>{{tableParamsAllSwitchboard.page()}}</b></div> </div> </div> \x3c!-- group calls content --\x3e <div id="groupContent" ng-init="groupInit()" class="ui tab" data-tab="group"> <form ng-submit="startSearchGroup()"> <div class="ui form"> <div class="inline fields"> <div class="field small-margin-bottom large-margin-top"> <div class="ui icon input"> <input ng-model="groupText" type="text" placeholder="{{\'Search\' | translate}}..."> </div> </div> <div class="field small-margin-bottom"> <label class="filter-responsive">{{\'From\' | translate}}:</label> <div class="ui calendar" id="rangestartGroup"> <div class="ui input left icon"> <i class="calendar icon"></i> <input required type="text" placeholder="..."> </div> </div> </div> <div class="field small-margin-bottom"> <label class="filter-responsive">{{\'To\' | translate}}:</label> <div class="ui calendar" id="rangeendGroup"> <div class="ui input left icon"> <i class="calendar icon"></i> <input required type="text" placeholder="..."> </div> </div> </div> <div class="field small-margin-bottom large-margin-top-adjust"> <button id="historySearchButton" type="submit" class="ui icon button tiny"> <i class="search icon"></i> </button> </div> </div> </div> <button ng-click="clearSearchGroup()" class="ui black compact labeled icon button clean-filters-button"> <i class="remove icon"></i> {{\'Clear filters\' | translate}} </button> </form> <div class="ui top attached tabular menu"> <a ng-repeat="f in filterAvailable" ng-click="setGroupFilter(f)" class="item {{f.filter == groupFilter.filter ? \'active\' : \'\'}}" data-tab="group-{{f.filter}}" ng-if="f.type == \'all\' || f.type == \'group\'"> <i ng-if="f.icon" class="{{f.icon}} icon icon-main-menu icon-adjust-line"></i> <span class="{{f.filter != \'all\' ? \'hide-icon-menu\' : \'\'}}">{{f.description | capitalize | translate}}</span> </a> </div> <div class="tabular-divider"> </div> <div class="ui bottom attached active tab segment" data-tab="group-a"> <div class="inline-row hide-label-filter ui small label"> {{groupFilter.description | capitalize | translate}} </div> <div class="float-right inline-row font-medium">{{\'Total\' | translate}}: <b>{{tableParamsAllGroup.total()}}</b> </div> <div ng-show="loadTableAllGroup" class="ui active centered inline loader"></div> <div ng-show="!loadTableAllGroup && tableParamsAllGroup.data.length == 0" class="ui message"> <div class="header"> {{\'No call found\' | translate}} </div> </div> <table ng-show="!loadTableAllGroup && tableParamsAllGroup.data.length > 0" ng-table="tableParamsAllGroup" class="ui sortable padded selectable table"> <tr ng-repeat="s in $data" class="{{s.disposition != \'ANSWERED\' ? \'negative\' : \'\'}}"> <td data-title="\'Date\' | translate" sortable> <span>{{ \'with_date_long\' | translate:{date:s.time * 1000} }}</span> </td> <td data-title="\'Source\' | translate" sortable> <a ng-click="s.direction === \'out\' ?\n              (isNumber(s.dst) ? call(s.dst) : undefined)\n              :\n              (isNumber(s.cnum) ? call(s.cnum) : undefined)" class="{{isNumber(s.dst) ? \'pointer\' : \'no-pointer\'}}"> <span data-tooltip="{{isNumber(s.dst) ? currentCall.accepted ? \'Transfer to\' : \'Call\' : \'Not callable\' | translate}}\n                {{s.direction === \'out\' ?\n                (isNumber(s.dst) ? s.dst : \'\')\n                :\n                (isNumber(s.cnum) ? s.cnum : \'\')}}\n                {{s.direction === \'out\' && s.dst_cnam !== \'\' ? (\' / \' + s.dst_cnam) : (s.cnam !== \'\' ? (\' / \' + s.cnam) : \'\')}}\n                {{s.direction === \'out\' && s.dst_ccompany !== \'\' ? (\' / \' + s.dst_ccompany) : (s.ccompany !== \'\' ? (\' / \' + s.ccompany) : \'\')}}"> {{s.direction === \'out\' ? (s.dst_cnam !== "" ? (s.dst_cnam) : (s.dst_ccompany !== "" ? (s.dst_ccompany) : (s.dst || \'-\'))) : (s.cnam !== "" ? (s.cnam) : (s.ccompany !== "" ? (s.ccompany) : (s.cnum || \'-\')))}} </span> </a> </td> \x3c!-- Added the destination column --\x3e <td data-title="\'Destination\' | translate" sortable> <a ng-click="isNumber(s.dst) ? call(s.dst) : undefined" class="{{isNumber(s.dst) ? \'pointer\' : \'no-pointer\'}}"> <span data-tooltip="{{isNumber(s.dst) ? currentCall.accepted ? \'Transfer to\' : \'Call\' : \'Not callable\' | translate}}\n              {{isNumber(s.dst) ? s.dst : \'\'}}\n              {{s.dst_cnam !== \'\' ? (\' / \' + s.dst_cnam) : \'\'}}\n              {{s.dst_ccompany !== \'\' ? (\' / \' + s.dst_ccompany) : \'\'}}"> {{s.dst_cnam !== "" ? s.dst_cnam : s.dst_ccompany !== "" ? s.dst_ccompany : s.dst || \'-\'}} </span> </a> </td> <td data-title="\'Duration\' | translate" sortable> {{s.duration | secondsToReadable}} </td> <td data-title="\'Recording\' | translate" sortable> <div ng-if="s.recordingfile" class="ui dropdown reg-console"> <span ng-click="listenRecording(s.uniqueid, s)" data-tooltip="{{\'Listen\' | translate}}" data-position="top center"> <i class="{{s.inListen ? \'red\' : \'\'}} announcement link icon"></i> </span> </div> <span ng-click="downloadRecording(s.uniqueid)" ng-if="s.recordingfile" data-tooltip="{{\'Download\' | translate}}" data-position="top center"> <i class="download link icon"></i> </span> <span ng-click="deleteRecording(s.uniqueid)" ng-if="s.recordingfile" data-tooltip="{{\'Delete\' | translate}}" data-position="top center"> <i class="trash link icon"></i> </span> <span ng-if="!s.recordingfile">-</span> <audio class="audio-controls" ng-if="s.inListen && s.audiosource" ng-src="{{\'data:audio/wav;base64,\' + s.audiosource | trustUrl}}" controls> {{\'Your browser does not support the audio element\' | translate}}. </audio> </td> <td ng-if="groupFilter.filter === \'all\'" data-title="\'Type\' | translate" sortable> <i class="arrow {{getDirections(s.direction).icon}} icon"></i> {{getDirections(s.direction).text | translate}} </td> <td data-title="\'Status\' | translate" sortable> <span> <i class="{{s.disposition == \'ANSWERED\' ? \'green\' : \'red\'}} call icon"></i> </span> </td> <td data-title="\'Actions\' | translate" sortable> <span data-tooltip="{{\'Add to phonebook\' | translate}}"> <i class="pointer counterclockwise add user icon" ng-click="newContactAdd(\n                  s.direction === \'out\' ? s.dst : s.cnum,\n                  s.direction === \'out\' ? s.dst_cnam : s.cnam,\n                  undefined,\n                  s.direction === \'out\' ? s.dst_ccompany : s.ccompany\n                )"></i> </span> </td> </tr> </table> <div ng-show="!loadTableAllGroup && tableParamsAllGroup.total() > 20" class="current-page-info">{{\'Page\' | translate}}: <b>{{tableParamsAllGroup.page()}}</b></div> </div> </div> \x3c!-- voicemail item content --\x3e <div ng-init="voicemailInit()" class="ui tab" data-tab="voicemail"> <div class="float-right inline-row font-medium">{{\'Total\' | translate}}: <b>{{tableParamsVoicemail.total()}}</b> </div> <div ng-show="loadTableAllVoice" class="ui active centered inline loader"></div> <div ng-show="!loadTableAllVoice && tableParamsVoicemail.data.length == 0" class="ui message"> <div class="header"> {{\'No voicemail found\' | translate}} </div> </div> <table ng-show="!loadTableAllVoice && tableParamsVoicemail.data.length > 0" ng-table="tableParamsVoicemail" class="ui sortable padded selectable table"> <tr ng-repeat="s in $data" class="{{s.type == \'inbox\' ? \'positive\' : \'\'}}"> <td data-title="\'Date\' | translate" sortable> <span>{{ \'with_date_long_noUTC\' | translate:{date:parseInt(s.origtime*1000)} }}</span> </td> <td data-title="\'Caller\' | translate" sortable> <span>{{parseCaller(s.callerid)}}</span> </td> <td data-title="\'Message\' | translate"> <div class="ui dropdown reg-console"> <span ng-click="listenVoicemail(s.id, s)" data-tooltip="{{\'Listen\' | translate}}" data-position="top center"> <i class="{{s.inListen ? \'red\' : \'\'}} announcement link icon"></i> </span> </div> <span ng-click="downloadVoicemail(s.id)" data-tooltip="{{\'Download\' | translate}}" data-position="top center"> <i class="download link icon"></i> </span> <span ng-click="deleteVoicemail(s.id)" data-tooltip="{{\'Delete\' | translate}}" data-position="top center"> <i class="trash link icon"></i> </span> <audio class="audio-controls" ng-if="s.inListen && s.audiosource" ng-src="{{\'data:audio/wav;base64,\' + s.audiosource | trustUrl}}" controls> {{\'Your browser does not support the audio element\' | translate}}. </audio> </td> <td data-title="\'Duration\' | translate"> <span title="{{s.duration}}">{{s.duration | secondsToReadable}}</span> </td> </tr> </table> <div ng-show="!loadTableAllVoice && tableParamsVoicemail.total() > 20" class="current-page-info">{{\'Page\' | translate}}: <b>{{tableParamsVoicemail.page()}}</b></div> </div> </div>'),e.put("views/lines.html",'<div class="ui segment adjust-segment-container"> <div class="ui orange header"> <div class="float-left"> <i class="orange tasks icon"></i> <div class="content"> {{\'Lines\' | translate}} </div> </div> <div class="float-right"> <span ng-if="currentUser.profile.macro_permissions.settings.permissions.parkings.value" data-tooltip="{{\'Parkings\' | translate}}" data-position="bottom right" class="adjust-title-park"> <i ng-click="goTo(\'parkings\');" class="yellow product hunt link icon no-margin-right"></i> </span> </div> <div class="float-right"> <span ng-if="currentUser.profile.macro_permissions.presence_panel.permissions.trunks.value" data-tooltip="{{\'Lines\' | translate}}" data-position="bottom right" class="adjust-title-park"> <i ng-click="goTo(\'lines\');" class="orange tasks link icon no-margin-right"></i> </span> </div> <div class="float-right"> <span ng-if="currentUser.profile.macro_permissions.presence_panel.value" data-tooltip="{{\'Operators\' | translate}}" data-position="bottom right" class="adjust-title-park"> <i ng-click="goTo(\'\');" class="blue user link icon no-margin-right"></i> </span> </div> </div> <div class="ui blue header title-header"></div> <div ng-if="(lines.data | isempty:true) && !viewLoad" class="ui icon message very-big-margin-bottom"> <i class="tasks icon"></i> <div class="content"> <div class="header"> {{\'No lines found\' | translate}} </div> <p>{{\'There are no lines available\' | translate}}</p> </div> </div> <div class="ui cards lines-cards"> <div ng-repeat="(kl, l) in lines.data" class="inverted {{100/l.maxChannels*logConversationLength(l.conversations)==100 ? \'red\' : \'green\'}} card"> <div class="content"> <div class="header link"><span class="link">{{l.name}}</span> <i ng-click="setLineCardOpened(l.name)" class="ordered list icon gray link float-right"></i> </div> <div class="meta"> {{l.chanType}} </div> <div ng-if="getLineCardOpened(l.name)" class="ui relaxed ordered divided list list-lines"> <div ng-repeat="(kc, c) in l.conversations" class="item"> <div class="float-right lines-time"> <div chrono-timer timer-name="myTimer" start-time="c.startTimestamp + clientServerTimeDiff">{{hours|zeropad}}:{{minutes|zeropad}}:{{seconds|zeropad}}</div> </div> <span class="lines-label"> <div title="{{c.internalNum}}" class="line-label-div">{{c.internalNum}} </div> <i class="chevron {{c.direction == \'out\' ? \'right\' : \'left\'}} icon lines-direction"></i> <div title="{{c.externalNum}}" class="line-label-div"> {{c.externalNum}}</div> </span> </div> <div ng-repeat="i in getNumber(l.maxChannels, logConversationLength(l.conversations)) track by $index" class="item"> <span class="lines-label"></span> </div> </div> </div> <div class="extra content"> <div id="{{l.name}}-progress" class="ui {{logConversationLength(l.conversations)>0 ? \'error red\' : \'green\'}} progress" data-percent="{{100/l.maxChannels*logConversationLength(l.conversations) == \'0\' ? \'100\' : 100/l.maxChannels*logConversationLength(l.conversations)}}"> <div class="bar" style="width:{{100/l.maxChannels*logConversationLength(l.conversations) == \'0\' ? \'100\' : 100/l.maxChannels*logConversationLength(l.conversations)}}%"></div> <div class="label">{{logConversationLength(l.conversations)}}/{{l.maxChannels}}</div> </div> </div> </div> </div> </div>'),e.put("views/login.html",'<div class="ui middle aligned center aligned grid" ng-controller="LoginCtrl"> <div class="column column-login"> <h2 class="ui blue image header margin-custom"> <img src="img/logo.png" class="image logo-image"> <div class="content"> </div> </h2> <form ng-hide="isShibboleth" class="ui large form" ng-submit="doLogin()" method="POST"> <div class="ui segment"> <div class="field"> <div class="ui left icon input"> <i class="user icon"></i> <input ng-disabled="onLoginStarted" required ng-model="login.username" type="text" name="username" placeholder="{{\'Username\' | translate}}"> </div> </div> <div class="field" ng-if="customConfig.AUTHENTICATION_ENABLED === true"> <div class="ui left icon input"> <i class="lock icon"></i> <input ng-disabled="onLoginStarted" required ng-model="login.password" type="password" name="password" placeholder="Password"> </div> </div> <div ng-if="showHostname" class="field"> <div class="ui left icon input"> <i class="disk outline icon"></i> <input ng-disabled="onLoginStarted" ng-model="login.hostname" type="text" name="hostname" placeholder="Hostname"> </div> </div> <div ng-if="onLoginStarted" class="field"> <div class="ui active centered inline small loader"></div> </div> <div ng-if="onLoginFailed" class="ui negative message"> <div class="header"> {{\'Login failed\' | translate}} </div> <p>{{\'Credentials are invalid\' | translate}}</p> </div> <div ng-if="onLoginFailedServerError" class="ui negative message"> <div class="header"> {{\'Server error\' | translate}} </div> <p>{{\'Please wait a moment and try again\' | translate}}</p> </div> <div ng-if="onLoginServerUnavailable" class="ui negative message"> <div class="header"> {{\'Server unavailable\' | translate}} </div> <p>{{\'Please wait a moment and try again\' | translate}}</p> </div> <button type="submit" class="ui fluid large blue submit button {{onLoginStarted ? \'disabled\' : \'\'}}">Login</button> </div> <div class="ui error message"></div> </form> <div ng-show="login.takeOvering" class="ui negative message"> <span class="header"> {{\'App is open in another window.\' | translate}} </span> </div> <div ng-if="onLoginFailedUserNotConfigured" ng-include="loginFailedUserNoConfigUrl" class="ui negative message"></div> </div> </div>'),e.put("views/main.html",'<div class="ui segment adjust-segment-container"> <div class="ui blue header"> <div class="float-left"> <i class="blue user icon"></i> <div class="content"> {{\'Operators\' | translate}} </div> </div> <div class="float-right"> <span ng-if="currentUser.profile.macro_permissions.settings.permissions.parkings.value" data-tooltip="{{\'Parkings\' | translate}}" data-position="bottom right" class="adjust-title-park"> <i ng-click="goTo(\'parkings\');" class="yellow product hunt link icon no-margin-right"></i> </span> </div> <div class="float-right"> <span ng-if="currentUser.profile.macro_permissions.presence_panel.permissions.trunks.value" data-tooltip="{{\'Lines\' | translate}}" data-position="bottom right" class="adjust-title-park"> <i ng-click="goTo(\'lines\');" class="orange tasks link icon no-margin-right"></i> </span> </div> <div class="float-right"> <span ng-if="currentUser.profile.macro_permissions.presence_panel.value" data-tooltip="{{\'Operators\' | translate}}" data-position="bottom right" class="adjust-title-park"> <i ng-click="goTo(\'\');" class="blue user link icon no-margin-right"></i> </span> </div> </div> <div class="ui blue header title-header"></div> <div id="opSegment" class="ui stackable grid"> <div id="leftContainer" ng-if="opPanel.show" class="{{wideop === false && mobileop !== true ? \'row h-285\' : wideop === false && mobileop === true ? \'row h-600\' : \'four wide column\'}} ui rail oppanel-left-col"> <div id="leftBar" class="{{wideop === false && mobileop !== true ? \'grid h-285\' : \'h-600\'}} ui sticky mb-15 full-width" ng-include="leftBarUrl"> </div> </div> <div id="oppanel-right-side" style="{{wideop === false ? \'width: 100% !important;\' : \'\'}}" class="{{wideop === false ? \'no-border-left\' : \'\'}} {{opPanel.show ? \'twelve wide column oppanel-right-col\' : \'sixteen wide column\'}}"> <div> <div ng-show="viewLoad" class="ui active centered inline loader"></div> <div ng-if="getObjLength(operatorsSites) > 1  && !viewLoad" class="ui pointing secondary menu"> <a ng-repeat="(ks,s) in operatorsSites" class="{{s.active ? \'active\' : \'\'}} item" data-tab="{{ks}}"> {{s.description}} </a> </div> <div ng-if="((operatorsSites | isempty:true) && !viewLoad && view.noService === false)" class="ui icon message"> <i class="user icon"></i> <div class="content"> <div class="header"> {{\'No operator groups found\' | translate}} </div> <p> {{\'There are no groups available\' | translate}} </p> </div> </div> <div ng-if="view.noService === true && !viewLoad" class="ui icon message"> <i class="user icon"></i> <div class="content"> <div class="header"> {{\'No service enabled\' | translate}} </div> </div> </div> <div ng-if="!(operatorsSites | isempty:true) && !viewLoad && currentUser.profile.macro_permissions.presence_panel.value" ng-repeat="(ks,s) in operatorsSites" class="ui {{s.active ? \'active\' : \'\'}} tab" data-tab="{{ks}}"> <form> <div class="ui form"> <div class="inline fields"> <div class="field small-margin-bottom medium-margin-top"> <div class="ui icon input"> <input ng-keyup="initGraphics()" ng-model="oppanelFilterText" type="text" placeholder="{{\'Search\' | translate}}..."> <i class="search icon"></i> </div> </div> <div class="field small-margin-bottom"> <label class="filter-responsive">{{\'Order by\' | translate}}:</label> <div class="field"> <div class="ui radio checkbox"> <input ng-change="changeFilter()" type="radio" name="oppanel-filter" ng-model="filter.type" value="name"> <label>{{\'Name\' | translate}}</label> </div> </div> <div class="field"> <div class="ui radio checkbox"> <input ng-change="changeFilter()" type="radio" name="oppanel-filter" ng-model="filter.type" value="presence"> <label>{{\'Presence\' | translate}}</label> </div> </div> </div> <div class="field small-margin-bottom"> <div class="field"> <div class="ui radio checkbox"> <input ng-change="changeFilter()" type="radio" name="oppanel-filter" ng-model="filter.type" value="exten"> <label>{{\'Extension\' | translate}}</label> </div> </div> </div> <div class="field small-margin-bottom"> <toaster-container class="toasterPosition toasterColor borderToaster" toaster-options="{\'time-out\': toasterTimeout}"></toaster-container> </div> </div> </div> </form> <div class="ui top attached tabular menu"> <a id="{{cleanOpGroupName(g.name)}}" ng-click="setTab(g.name)" ng-if="parseGroup(g.name)" ng-repeat="g in s.groups | customOrder:\'name\':false track by $index" class="item" ng-class="{ active: (tab === g.name) }"> {{g.name | cropText}} </a> </div> <div class="tabular-divider"> </div> <div ng-if="parseGroup(g.name) && (tab === g.name)" ng-repeat="g in s.groups track by $index" class="ui bottom attached tab segment" ng-class="{ active: (tab === g.name) }"> <span class="grp-hide-text"> {{g.name}} </span> <div class="ui cards"> <div ng-if="g.users | contains:u.username" id="op-card-{{u.username}}" data-mainext="{{allUsers[u.username].endpoints.mainextension[0].id}}" data-drop="opPanel.show && u.status == \'online\' ? true : false" jqyoui-droppable="{onDrop: \'opDropped()\', onOver: \'opOnOver()\', onOut: \'opDropOut()\'}" ng-repeat="(ku, u) in s.users | customFilterOperators:oppanelFilterText | customOrderOperators:filter.type:false track by u.username" class="{{appConfig.MAIN_STATUS_MAP[u.mainPresence].color || \'green\'}} card"> <div class="content"> <div title="{{u.name}}" class="header adjust-long-name-oppanel-name"> <div class="ui mini image circular image-oppanel"> <img ng-src="{{ allAvatars[u.username] || \'img/steve.6204f1d6.jpg\' }}"> </div> {{u.name}} <div class="op-exten-id"> {{u.endpoints.mainextension[0].id}} </div> </div> \x3c!-- start main presence --\x3e <div class="description op-user-descr custom-flex"> <span class="main-presence-icon"> <i class="{{appConfig.MAIN_STATUS_MAP[u.mainPresence].icon}} icon {{appConfig.MAIN_STATUS_MAP[u.mainPresence].color}}"> </i> </span> <div ng-if="allUsers[u.username].endpoints.extension.length > 0" class="ui label {{appConfig.MAIN_STATUS_MAP[u.mainPresence].color}} {{u.mainPresence == \'online\' ? \'pointer\' : \'\'}}" ng-click="u.mainPresence == \'online\' ? clickStatus($event) : \'\'" title="{{(u.mainPresence == appConfig.MAIN_STATUS_LIST.ONLINE) && !currentCall.accepted ? \'Call\' : \'\' | translate}}"> {{appConfig.MAIN_STATUS_MAP[u.mainPresence].description | translate}} </div> <span title="{{\'On hold\' | translate}}" ng-show="u.status == \'onhold\'" class="ui label orange mr-5"> <i class="pause icon no-margin-right"></i> </span> <span ng-show="u.mainPresence === appConfig.MAIN_STATUS_LIST.CALLFORWARD || u.mainPresence === appConfig.MAIN_STATUS_LIST.CELLPHONE" title="{{allExtensions[u.endpoints.mainextension[0].id].cf}}" class="vmiddle adjust-op-call-forward-to"> {{allExtensions[u.endpoints.mainextension[0].id].cf}} </span> </div> \x3c!-- end main presence --\x3e <div ng-if="u.username !== currentUser.username" class="ui icon top left pointing dropdown oppanel-actions"> <i ng-if="(currentCall.accepted && currentUser.profile.macro_permissions.presence_panel.permissions.transfer.value && u.status == \'online\') || (currentCall.accepted && currentUser.profile.macro_permissions.presence_panel.permissions.transfer.value && u.endpoints.cellphone.length > 0 && u.endpoints.cellphone[0].id) || (!currentCall.accepted && u.status == \'online\' && !currentCall.incoming && !currentCall.outcoming) || (!currentCall.accepted && u.endpoints.cellphone[0].id !== undefined  && !currentCall.incoming && !currentCall.outcoming) || (currentUser.profile.macro_permissions.settings.permissions.chat.value && view.isChatStarted)" class="ellipsis vertical icon"> </i> <div class="menu mt-10 mln-12"> <div ng-if="currentCall.accepted && currentUser.profile.macro_permissions.presence_panel.permissions.transfer.value && u.status == \'online\'" ng-click="call(u.endpoints.mainextension[0].id)" class="item"> <i class="call icon"></i> {{\'Transfer to\' | translate}} <span class="weighted"> {{u.endpoints.mainextension[0].id}} </span> </div> <div ng-if="currentCall.accepted && currentUser.profile.macro_permissions.presence_panel.permissions.transfer.value && u.endpoints.cellphone.length > 0 && u.endpoints.cellphone[0].id" ng-click="call(u.endpoints.cellphone[0].id)" class="item"> <i class="mobile icon"></i> {{\'Transfer to\' | translate}} <span class="weighted"> {{u.endpoints.cellphone[0].id}} </span> </div> <div ng-if="!currentCall.accepted && u.status == \'online\' && !currentCall.incoming && !currentCall.outcoming" ng-click="call(u.endpoints.mainextension[0].id)" class="item"> <i class="call icon"></i> {{\'Call\' | translate}} <span class="weighted"> {{u.endpoints.mainextension[0].id}} </span> </div> <div ng-if="!currentCall.accepted && u.endpoints.cellphone[0].id !== undefined  && !currentCall.incoming && !currentCall.outcoming" ng-click="call(u.endpoints.cellphone[0].id)" class="item"> <i class="call icon"></i> {{\'Call\' | translate}} <span class="weighted"> {{u.endpoints.cellphone[0].id}} </span> </div> <div ng-if="currentUser.profile.macro_permissions.settings.permissions.chat.value && view.isChatStarted" ng-click="openChat(u.endpoints.jabber[0].id)" class="item"> <i class="chat icon"></i> {{\'Chat\' | translate}} </div> </div> </div> </div> <div class="h-57 extra content extra-content"> <div ng-repeat="e in filterEndpoints(u.endpoints.extension)" ng-if="e.conversations[0] && (e.status == \'ringing\' || e.status == \'busy\' || e.status == \'onhold\')" class="left floated adjust-long-name-oppanel {{u.username != currentUser.username ? \'w-215\' : \'full-width\'}}"> <i ng-if="!e.conversations[0].inConference" ng-hide="e.conversations[0].chDest.inConference" class="{{e.conversations[0].direction == \'in\' ? \'arrow left\' : \'arrow right\'}} icon no-margin-right oppanel-direction" title="{{e.conversations[0].direction == \'in\' ?\'Incoming call\' : \'Outgoing call\' | translate}}"> </i> <i ng-if="e.conversations[0].inConference || e.conversations[0].chDest.inConference === true" class="no-rotate icons no-margin-right oppanel-direction conference-bigicon-incard"> <i class="users icon reset-right-margin grey"></i> <i class="corner microphone icon grey conference-microphone-icon-small"></i> </i> <span title="{{e.conversations[0].counterpartName.includes(\'unknown\') && (e.conversations[0].inConference || e.conversations[0].chDest.inConference === true) ? \'in conference\' : e.conversations[0].inConference || e.conversations[0].chDest.inConference === true ? \'in conference\' : e.conversations[0].counterpartName.includes(\'unknown\') ? e.conversations[0].counterpartNum : e.conversations[0].counterpartName | translate}}" class="oppanel-number w-190"> {{e.conversations[0].inConference || e.conversations[0].chDest.inConference === true ? \'in conference\' : e.conversations[0].counterpartName.includes(\'unknown\') ? e.conversations[0].counterpartNum : e.conversations[0].counterpartName || \'Unknown\' | translate}} </span> <span ng-if="e.conversations[0].counterpartNum.includes(\'unknown\') && (e.conversations[0].inConference || e.conversations[0].chDest.inConference === true)" title="{{\'in conference\' | translate}}" class="oppanel-number"> {{\'in conference\' | translate}} </span> <span ng-if="(!e.conversations[0].counterpartNum.includes(\'unknown\') && (e.conversations[0].counterpartNum !== e.conversations[0].counterpartName)) || (e.conversations[0].inConference || e.conversations[0].chDest.inConference === true)" title="{{e.conversations[0].counterpartNum.includes(\'unknown\') && (e.conversations[0].inConference || e.conversations[0].chDest.inConference == true) ? \'moderator\' : e.conversations[0].counterpartName.includes(\'unknown\') ? \' \' : e.conversations[0].counterpartNum | translate}}" class="oppanel-number custom-oppanel-number"> <i ng-if="e.conversations[0].throughQueue && !(e.conversations[0].inConference || e.conversations[0].chDest.inConference == true)" title="{{\'In queue\' | translate}}" class="{{e.conversations[0].throughQueue ? \'purple users\' : \'\'}} icon"> </i> {{e.conversations[0].counterpartNum.includes(\'unknown\') && (e.conversations[0].inConference || e.conversations[0].chDest.inConference == true) ? \'moderator\' : e.conversations[0].counterpartName.includes(\'unknown\') ? \' \' : e.conversations[0].counterpartNum | translate}} <i ng-if="e.conversations[0].recording == \'true\'" title="{{\'Recording\' | translate}}" class="{{e.conversations[0].recording == \'true\' ? \'brown selected radio\' : \'\'}} icon"> </i> </span> <span ng-if="e.conversations[0].counterpartNum.includes(\'unknown\')" class="oppanel-number"> </span> <timer ng-if="e.conversations[0].connected || (e.conversations[0].inConference || e.conversations[0].chDest.inConference == true)" start-time="e.conversations[0].startTime + clientServerTimeDiff" interval="1000" class="{{(e.conversations[0].counterpartNum !== e.conversations[0].counterpartName) || (e.conversations[0].inConference || e.conversations[0].chDest.inConference === true) ? \'large-margin-top-inverse\' : \'\'}} right-align oppanel-number float-right"> {{hhours}}:{{mminutes}}:{{sseconds}} </timer> </div> <span class="right floated oppanel-status"> \x3c!-- actions button --\x3e <div class="ui dropdown label no-margin-right clickable-label {{u.status == \'onhold\' ? \'disabled\' : \'\'}}" ng-disabled="u.status == \'onhold\'" ng-show="(u.username != currentUser.username) && ((currentUser.profile.macro_permissions.presence_panel.permissions.pickup.value && u.status == \'ringing\') || ((u.status == \'busy\' || u.status == \'onhold\') && (currentUser.profile.macro_permissions.presence_panel.permissions.hangup.value || currentUser.recallOnBusy == \'enabled\' || currentUser.profile.macro_permissions.presence_panel.permissions.spy.value || currentUser.profile.macro_permissions.presence_panel.permissions.intrude.value || currentUser.profile.macro_permissions.presence_panel.permissions.ad_recording.value)))"> <i class="bars icon no-margin-right"></i> <div class="menu mt-5 mb-5"> <div ng-if="currentUser.profile.macro_permissions.presence_panel.permissions.pickup.value && u.status == \'ringing\'" ng-click="oppanelPickup(u)" class="item"> <i class="pointing up icon"></i> {{\'Pickup\' | translate}} </div> <div ng-if="currentUser.recallOnBusy == \'enabled\' && u.status == \'busy\'" ng-click="recallBusy(u)" class="ui compact item customTooltip" data-tooltip="{{\'The user will be called as soon as he becomes available.\' | translate}}" data-position="top center"> <i class="big icons opIconDimension"> <i class="call icon"></i> <i id="refreshIcon" class="refresh icon"></i> </i> {{\'Book\' | translate}} \x3c!-- <div class="animation floating ui teal label">\n                            {{\'New\' | translate}}\n                          </div> --\x3e </div> <div ng-if="currentUser.profile.macro_permissions.presence_panel.permissions.hangup.value && u.status == \'busy\'" ng-click="oppanelHangup(u)" class="item"> <i class="call icon"></i> {{\'Hangup\' | translate}} </div> <div ng-if="currentUser.profile.macro_permissions.presence_panel.permissions.spy.value && u.status == \'busy\' && !currentCall.accepted" ng-click="oppanelSpy(u)" class="item"> <i class="spy icon"></i> {{\'Spy\' | translate}} </div> <div ng-if="currentUser.profile.macro_permissions.presence_panel.permissions.intrude.value && u.status == \'busy\' && !currentCall.accepted" ng-click="oppanelIntrude(u)" class="item"> <i class="compress icon"></i> {{\'Intrude\' | translate}} </div> <div ng-if="currentUser.profile.macro_permissions.presence_panel.permissions.ad_recording.value && u.status == \'busy\'" ng-click="oppanelRecord(u)" class="item"> <i class="selected radio icon"></i> {{hasActiveConversations(u)[0].conversations[0].recording == "true" ? \'Stop record\' : \'Record\' | translate}} </div> </div> </div> \x3c!-- call button --\x3e <div ng-if="isNotOffline() && (allUsers[u.username].endpoints.extension.length > 0) && (u.mainPresence == appConfig.MAIN_STATUS_LIST.ONLINE || u.mainPresence == appConfig.MAIN_STATUS_LIST.CELLPHONE || u.mainPresence == appConfig.MAIN_STATUS_LIST.CALLFORWARD || u.mainPresence == appConfig.MAIN_STATUS_LIST.VOICEMAIL) && (u.username != currentUser.username) && !currentCall.accepted && !currentConference.exists && !currentConference.isOwner && u.status != \'busy\' && u.status != \'onhold\'" ng-click="call(u.endpoints.mainextension[0].id)" class="ui label pointer clickable-label action"> {{\'Call\' | translate}} </div> \x3c!-- transfer button --\x3e <div class="ui dropdown top right label clickable-label action" ng-show="u.username != currentUser.username && isNotOffline() && (allUsers[u.username].endpoints.extension.length > 0) && (u.mainPresence == appConfig.MAIN_STATUS_LIST.ONLINE || u.mainPresence == appConfig.MAIN_STATUS_LIST.CELLPHONE || u.mainPresence == appConfig.MAIN_STATUS_LIST.CALLFORWARD || u.mainPresence == appConfig.MAIN_STATUS_LIST.VOICEMAIL) && (u.username != currentUser.username) && currentCall.accepted && !currentConference.exists && !currentConference.isOwner && u.status != \'busy\'"> {{\'Transfer\' | translate}} <div class="menu mt-5 mb-5"> <div ng-click="transfer(u.endpoints.mainextension[0].id, \'blind\')" class="item"> <i class="resize horizontal icon"></i> {{\'Blind\' | translate}} </div> <div ng-click="transfer(u.endpoints.mainextension[0].id)" class="item"> <i class="random horizontal icon"></i> {{\'Attended\' | translate}} </div> </div> </div> \x3c!-- invite button --\x3e <span ng-if="isNotOffline() && (allUsers[u.username].endpoints.extension.length > 0) && (u.mainPresence == appConfig.MAIN_STATUS_LIST.ONLINE || u.mainPresence == appConfig.MAIN_STATUS_LIST.CELLPHONE || u.mainPresence == appConfig.MAIN_STATUS_LIST.CALLFORWARD || u.mainPresence == appConfig.MAIN_STATUS_LIST.VOICEMAIL) && (u.username != currentUser.username) && currentConference.exists && currentConference.isOwner" class="ui label clickable-label pointer" ng-click="!currentConference.isCallingFromConf ? call(u.endpoints.mainextension[0].id, true) : \'\'"> {{\'Invite\' | translate}} </span> </span> </div> </div> </div> </div> </div> </div> </div> </div> </div>'),e.put("views/offhour.html",'<div class="ui segment adjust-segment-container"> <div ng-show="offhour.viewLoad" class="ui active centered inline loader"></div> <div ng-show="!offhour.viewLoad"> <h3 class="ui pink header title-header"> <i class="pink wait icon no-margin-right"></i> <div class="content"> {{\'Off hour\' | translate}} </div> <span data-tooltip="{{\'Operators\' | translate}}" data-position="bottom right" class="float-right adjust-title-park"> <i ng-click="goTo(\'\');" class="blue user link icon no-margin-right"></i> </span> </h3> <div class="ui top attached tabular menu offhour-tab"> <a class="item active" ng-click="setAnnounceMan(\'false\')" data-tab="first">{{\'Routes\' | translate}}</a> <a id="announceMan" ng-click="setAnnounceMan(\'true\')" class="item" data-tab="second">{{\'Announcements\' | translate}}</a> </div> <div class="tabular-divider"> </div> <div class="ui bottom attached tab segment active" data-tab="first"> <div ng-if="(offhourRoutes | isempty:true) && !offhour.viewLoad" id="hmessage" class="ui icon message"> <i class="wait icon"></i> <div class="content"> <div class="header"> {{\'No routes found\' | translate}} </div> <p> {{\'There are no routes available\' | translate}} </p> </div> </div> <div class="ui cards ng-scope lines-cards cards-offhour"> <div ng-repeat="(kr, r) in offhourRoutes" class="{{offhourCheckbox(r.calledIdNum, r.callerIdNum) ? \'pink\' : \'grey\'}} card large-card ng-scope"> <div id="offhour-header-container" class="content"> <div class="header ng-binding"> {{r.calledIdNum}}{{r.callerIdNum != \'\' ? \' / \' + r.callerIdNum : \'\'}}{{r.calledIdNum == "" && r.callerIdNum == "" ? "/" : ""}} <i ng-if="r.offhour == undefined" ng-click="openEditModal(r.calledIdNum, r.callerIdNum)" class="edit icon link grey ng-scope float-right no-margins"></i> <i ng-if="r.offhour != undefined" ng-click="setOffHourCardOpened(r.calledIdNum, r.callerIdNum)" class="{{getOffHourCardOpened(r.calledIdNum, r.callerIdNum) == true ? \'minus\' : \'plus\'}} square outline icon link ng-scope float-right no-margins"></i> </div> <div class="description capitalize-first ng-binding"> {{r.description}} </div> </div> <div ng-if="getOffHourCardOpened(r.calledIdNum, r.callerIdNum)" ng-hide="r.offhour === undefined" id="offhour-date-container" class="content dropdown-info"> <h4 class="ui sub header"> {{\'Date Time\' | translate}} </h4> <div ng-if="r.offhour.enabled === \'period\' || (r.offhour.enabled === \'never\' && r.offhour.period !== undefined)" class="ui small feed"> <div class="event"> <div class="content"> <div class="summary no-font-weight"> <span class="info-label"> {{\'From date\' | translate}}: </span> <span class="float-right {{!offhourCheckbox(r.calledIdNum, r.callerIdNum) ? \'data-disabled\' : \'\'}}"> {{momentDate(r.offhour.period.datebegin)}} </span> <br> <span class="info-label"> {{\'From hour\' | translate}}: </span> <span class="float-right {{!offhourCheckbox(r.calledIdNum, r.callerIdNum) ? \'data-disabled\' : \'\'}}"> {{momentTime(r.offhour.period.datebegin)}} </span> </div> </div> </div> <div class="event"> <div class="content"> <div class="summary no-font-weight"> <span class="info-label"> {{\'To date\' | translate}}: </span> <span class="float-right {{!offhourCheckbox(r.calledIdNum, r.callerIdNum) ? \'data-disabled\' : \'\'}}"> {{momentDate(r.offhour.period.dateend)}} </span> <br> <span class="info-label"> {{\'To hour\' | translate}}: </span> <span class="float-right {{!offhourCheckbox(r.calledIdNum, r.callerIdNum) ? \'data-disabled\' : \'\'}}"> {{momentTime(r.offhour.period.dateend)}} </span> </div> </div> </div> </div> <div ng-if="r.offhour.enabled === \'always\' || (r.offhour.enabled === \'never\' && r.offhour.period === undefined)" class="ui small feed"> <div class="event"> <div class="content"> <div class="summary no-font-weight"> <span class="info-label"> {{\'Period\' | translate}}: </span> <span class="float-right {{!offhourCheckbox(r.calledIdNum, r.callerIdNum) ? \'data-disabled\' : \'\'}}"> {{\'Always\' | translate}} </span> </div> </div> </div> </div> </div> <div ng-if="getOffHourCardOpened(r.calledIdNum, r.callerIdNum)" ng-hide="r.offhour === undefined" id="offhour-destination-container" class="content dropdown-info"> <h4 class="ui sub header"> {{\'Destination\' | translate}} </h4> <div class="ui small feed no-font-weight"> <div ng-if="r.offhour.action != \'redirect\'" class="event"> <div class="content"> <div class="summary no-font-weight"> <span class="info-label"> {{\'Announcement\' | translate}}: </span> <span class="float-right {{!offhourCheckbox(r.calledIdNum, r.callerIdNum) ? \'data-disabled\' : \'\'}}"> {{r.offhour.audiomsg.description}} </span> </div> </div> </div> <div ng-if="r.offhour.action == \'audiomsg_voicemail\'" class="event"> <div class="content"> <div class="summary no-font-weight"> <span class="info-label"> {{\'Voicemail\' | translate}}: </span> <span class="float-right {{!offhourCheckbox(r.calledIdNum, r.callerIdNum) ? \'data-disabled\' : \'\'}}"> {{r.offhour.voicemail.voicemail_id}} </span> </div> </div> </div> <div ng-if="r.offhour.action == \'redirect\'" class="event"> <div class="content"> <div class="summary no-font-weight"> <span class="info-label"> {{\'Redirection:\' | translate}} </span> <span class="float-right {{!offhourCheckbox(r.calledIdNum, r.callerIdNum) ? \'data-disabled\' : \'\'}}"> {{r.offhour.redirect.redirect_to}} </span> </div> </div> </div> </div> </div> <div ng-if="getOffHourCardOpened(r.calledIdNum, r.callerIdNum)" ng-hide="r.offhour === undefined" class="content dropdown-info"> <button ng-click="openEditModal(r.calledIdNum, r.callerIdNum)" class="ui button"> <i class="edit icon"></i> {{\'Edit\' | translate}} </button> </div> <div class="extra content extra-content"> <div class="destination-extra"> {{r.offhour.action == \'audiomsg_voicemail\' ? \'Announcement + Voicemail\' : \'\' | translate}} {{r.offhour.action == \'audiomsg\' ? \'Announcement\' : \'\' | translate}} {{r.offhour.action == \'redirect\' ? \'Redirect\' : \'\' | translate}} </div> <span class="right floated oppanel-status"> <div class="ui top right pointing dropdown" tabindex="0"> <div class="ui slider checkbox {{r.offhour == undefined ? \'disabled\' : \'\'}}"> <input ng-click="onOff(r.calledIdNum, r.callerIdNum, r.offhour.enabled, r.offhour.period.datebegin, r.offhour.period.dateend, r.offhour.action, r.offhour.redirect.redirect_to, r.offhour.audiomsg.announcement_id, r.offhour.voicemail.voicemail_id, r.offhour.period)" ng-if="r.offhour != undefined" ng-checked="r.offhour.enabled !== \'never\' ? \'true\' : \'\'" id="{{r.calledIdNum + \'-\' + r.callerIdNum}}-checkbox" class="offhour-checkbox" type="checkbox" name="always"> <input ng-if="r.offhour == undefined" disabled id="{{r.calledIdNum + \'-\' + r.callerIdNum}}-checkbox" class="offhour-checkbox" type="checkbox" name="always"> <label class="{{offhourCheckbox(r.calledIdNum, r.callerIdNum) ? \'pink-check\' : \'\'}} {{!offhourCheckbox(r.calledIdNum, r.callerIdNum) ? \'data-disabled\' : \'\'}}"> {{\'Enable\' | translate}} </label> </div> <div class="menu" tabindex="-1"></div> </div> </span> </div> </div> </div> </div> <div class="tabular-divider"> </div> <div class="ui bottom attached tab segment" data-tab="second"> <div class="field"> <div> <button id="uploadAnnuncement" ng-click="fileUploadOpen(\'uploadMsgFile\')" class="ui labeled icon button"> <i class="upload icon"></i> {{\'Upload announcement\' | translate}} </button> <button ng-click="view.onRecording ? \'\' : recordMsg()" ng-disabled="view.initRecordCall" class="ui right labeled icon button {{view.onRecording ? \'red\' : \'\'}}"> <i class="unmute icon"></i> {{view.onRecording ? \'Recording announcement\' : \'Record announcement\' | translate}} </button> </div> </div> <div ng-if="!listAnnouncement.length" class="ui icon message five-bottom"> <i class="wait icon"></i> <div class="content"> <div class="header"> {{\'No announcements\' | translate}} </div> <p> {{\'There are no announcements available\' | translate}} </p> </div> </div> <table ng-if="listAnnouncement.length > 0" class="ui single line table"> <thead> <tr> <th>{{\'Description\' | translate}}</th> <th>{{\'Author\' | translate}}</th> <th>{{\'Date\' | translate}}</th> <th>{{\'Privacy\' | translate}}</th> <th>{{\'Actions\' | translate}}</th> </tr> </thead> <tbody> <tr ng-repeat="(mgs, m) in listAnnouncement"> <td>{{m.description}}</td> <td>{{m.username}}</td> <td>{{m.date_creation + \' \' + m.time_creation}}</td> <td>{{m.privacy}}</td> <td> <button ng-click="listenMsg(m.id)" id="playMsg-{{m.id}}" data-tooltip="{{\'Play\' | translate}}" data-position="bottom right" class="play-buttons ui icon button"> <i class="play icon"></i> </button> <button ng-click="listenMsgStop()" id="stopMsg-{{m.id}}" data-tooltip="{{\'Stop\' | translate}}" data-position="bottom right" class="stop-buttons ui icon button"> <i class="stop icon"></i> </button> <button ng-click="downloadRecording(m.id)" data-tooltip="{{\'Download\' | translate}}" data-position="bottom right" class="ui icon button"> <i class="download icon"></i> </button> <button ng-hide="(currentUser.profile.macro_permissions.off_hour.permissions.ad_off_hour.value != \'true\') && (currentUser.username != m.username)" ng-click="removeMsg(m.id)" data-tooltip="{{\'Delete\' | translate}}" data-position="bottom right" class="ui icon button"> <i class="trash icon"></i> </button> <button ng-hide="(currentUser.profile.macro_permissions.off_hour.permissions.ad_off_hour.value != \'true\') && (currentUser.username != m.username)" ng-click="modifyMsgShow(m.id)" data-tooltip="{{\'Modify\' | translate}}" data-position="bottom right" class="ui icon button"> <i class="write icon"></i> </button> <audio id="audioPlayer" src=""> </td> </tr> </tbody> </table> </div> </div> </div> <div id="offHourMondal" class="ui modal small offhourModals"> <div class="header"> {{editOffhour.calledIdNum + \' / \' + editOffhour.callerIdNum}} </div> <form class="ui form" ng-submit="saveOffhour(editOffhour.calledIdNum, editOffhour.callerIdNum)"> <div class="content form-content"> <div class="description"> <div class="ui checkbox"> <input ng-model="submitOffhour.always" id="checkboxModal" tabindex="0" type="checkbox" name="checkboxModal"> <label for="checkboxModal"> {{\'Always enabled\' | translate}} </label> </div> <h4 class="ui blue dividing header"> {{\'Period\' | translate}} </h4> <div class="required field"> <label class="ng-binding"> {{\'From\' | translate}} </label> <div class="ui calendar" id="fromDateCalendar"> <div class="ui input {{submitOffhour.always ? \'disabled\' : \'\'}} left icon"> <i class="calendar icon"></i> <input type="text" name="fromDate" autocomplete="off" placeholder="{{\'Date/Time\' | translate}}" ng-required="!submitOffhour.always" class="ng-pristine ng-untouched ng-valid"> </div> </div> </div> <div class="required field left labeled"> <label class="ng-binding"> {{\'To\' | translate}} </label> <div class="ui calendar" id="toDateCalendar"> <div class="ui input {{submitOffhour.always ? \'disabled\' : \'\'}} left icon"> <i class="calendar icon"></i> <input type="text" name="toDate" autocomplete="off" placeholder="{{\'Date/Time\' | translate}}" ng-required="!submitOffhour.always" class="ng-pristine ng-untouched ng-valid"> </div> </div> </div> <h4 class="ui blue dividing header"> {{\'Destination\' | translate}} </h4> <div class="required field"> <div id="dropdown-offhour" class="ui selection dropdown"> <input type="hidden" required name="destination"> <i class="dropdown icon"></i> <div class="default text"> {{\'Destination\' | translate}} </div> <div class="menu"> <div ng-click="setDropdownOffhour(\'audiomsg\', \'dropdown-offhour\')" class="item" data-value="audiomsg"> {{\'Announcement\' | translate}} </div> <div ng-click="setDropdownOffhour(\'audiomsg_voicemail\', \'dropdown-offhour\')" class="item" data-value="audiomsg_voicemail"> {{\'Announcement\' | translate}} + {{\'Voicemail\' | translate}} </div> <div ng-click="setDropdownOffhour(\'redirect\', \'dropdown-offhour\')" class="item" data-value="redirect"> {{\'Redirection\' | translate}} </div> </div> </div> </div> <div ng-show="getOffhourValue(\'dropdown-offhour\') !== true && getOffhourValue(\'dropdown-offhour\') !== undefined || getOffhourValue(\'dropdown-offhour\') === 1" class="required field"> <label class="ng-binding"> {{\'Announcement\' | translate}} </label> <div id="dropdown-offhour-announcement" class="ui selection dropdown"> <input ng-model="editOffhour.offhour.audiomsg.announcement_id" required type="hidden" name="destination"> <i class="dropdown icon"></i> <div class="default text"> {{\'Announcements\' | translate}} </div> <div class="menu"> <div ng-repeat="(kmgs, m) in listAnnouncement" class="item" data-value="{{m.id}}"> {{m.description}} </div> <div ng-if="listAnnouncement == undefined || listAnnouncement == \'\'" ng-click="openAnnounceMan()" class="item"> {{\'Add\' | translate}}.. </div> </div> </div> </div> <div ng-show="getOffhourValue(\'dropdown-offhour\') === false"> <div class="required field"> <label class="ng-binding"> {{\'Voicemail\' | translate}} </label> <input type="text" name="voicemail_id" placeholder="Voicemail" ng-model="createOffhourObj.voicemail_id" ng-required="getOffhourValue(\'dropdown-offhour\') === false" class="ng-pristine ng-untouched ng-valid"> </div> </div> <div ng-show="getOffhourValue(\'dropdown-offhour\') === true" class="required field"> <label class="ng-binding"> {{\'Redirection\' | translate}} </label> \x3c!-- Pattern is used to check if the user input is just a number, asterisk or hash sign --\x3e <input type="text" name="redirect_id" placeholder="Redirect to" ng-model="createOffhourObj.redirect_to" ng-required="getOffhourValue(\'dropdown-offhour\') === true" class="ng-pristine ng-untouched ng-valid" pattern="^[0-9*#+]*" title="{{\'It is possible to insert only numbers or any symbols such as: *, # and +\' | translate}}"> </div> </div> </div> <div class="action-content"> <button ng-click="hideModal(\'offHourMondal\')" type="button" class="ui gray deny button"> {{\'Cancel\' | translate}} </button> <button type="submit" class="ui positive right labeled icon button"> {{\'Save\' | translate}} <i class="checkmark icon"></i> </button> </div> </form> </div> <div id="offhourRM" class="ui modal small offhourModals"> <div class="header"> {{\'Announcement Informations\' | translate}} </div> <form class="ui form" ng-submit="saveAnnounce(offhour.manageMsgModal)"> <div class="content form-content"> <div class="description"> <div ng-if="offhour.isError" class="ui negative message"> <div ng-if="offhour.errorMessage == \'fileSize\'" class="header"> {{\'File size is too large\' | translate}} </div> <div ng-if="offhour.errorMessage == \'fileExtension\'" class="header"> {{\'The selected file extension is incorrect\' | translate}} </div> <div ng-if="offhour.errorMessage == \'fileDescription\'" class="header"> {{\'The inserted description is already present\' | translate}} </div> <div ng-if="offhour.errorMessage == \'noFile\'" class="header"> {{\'No sound files have been selected\' | translate}} </div> <div ng-if="offhour.errorMessage == \'duplicateDesc\'" class="header"> {{\'The inserted description is already present\' | translate}} </div> <p ng-if="offhour.errorMessage == \'fileSize\'"> {{\'Max file size is 10 Megabyte\' | translate}} </p> <p ng-if="offhour.errorMessage == \'fileExtension\'"> {{\'Only files in mp3 or wav format are allowed\' | translate}} </p> <p ng-if="offhour.errorMessage == \'fileDescription\'"> {{\'Change description to continue\' | translate}} </p> <p ng-if="offhour.errorMessage == \'noFile\'"> {{\'Select a file to continue\' | translate}} </p> <p ng-if="offhour.errorMessage == \'duplicateDesc\'"> {{\'Change description to continue\' | translate}} </p> </div> <div id="uploadFileField" ng-show="offhour.manageMsgModal == \'upload\'" class="required field"> <label>{{\'File\' | translate}}:</label> <div id="uploadInputContainer" class="ui action input"> <input ng-click="fileUploadOpen(\'uploadMsgFile\')" name="fileText" id="uploadMsgText" ng-required="offhour.manageMsgModal == \'upload\' ? true : false" type="text" placeholder="{{\'File\' | translate}}" readonly> <input id="uploadMsgFile" name="fileInput" type="file" accept="audio/wav,audio/mp3"> <div id="inputFileIcon" class="ui icon button"> <i class="attach icon"></i> </div> <i id="fileLoading" class="search icon float-right"></i> </div> </div> <div id="msgDescriptionRM-field" class="required field"> <label class="ng-binding"> {{\'Description\' | translate}}: </label> <input id="msgDescriptionRM" placeholder="{{\'Description\' | translate}}" type="text" required ng-model="newAnnounce.description" name="description" class="ng-pristine ng-untouched ng-valid"> </div> <div class="inline fields"> <label>{{\'Privacy\' | translate}}:</label> <div class="field"> <div id="publicRadio" class="ui radio checkbox"> <input id="publicRadio-input" required type="radio" name="privacy-ann" tabindex="0" value="public"> <label>{{\'Public\' | translate}}</label> </div> </div> <div class="field"> <div id="privateRadio" class="ui radio checkbox"> <input id="privateRadio-input" required type="radio" name="privacy-ann" tabindex="0" value="private"> <label>{{\'Private\' | translate}}</label> </div> </div> </div> </div> </div> <div class="action-content"> <button ng-click="hideModalMsg()" type="button" class="ui gray deny button"> {{\'Cancel\' | translate}} </button> <button id="submitMsgModal" type="submit" class="ui positive right labeled icon button"> {{\'Save\' | translate}} <i class="checkmark icon"></i> </button> </div> </form> </div> <div id="acceptModal" class="ui tiny modal offhourModals"> <div class="header"> {{\'Delete Announcement\' | translate}} </div> <div class="content"> <p ng-hide="offhour.routeUsed">{{\'Are you sure you want to delete the selected announcement\' | translate}}?</p> <p ng-show="offhour.routeUsed"> {{\'This announcement is used by route\' | translate}}!  {{\'Are you sure you want to delete the selected announcement\' | translate}}? </p> </div> <div class="actions"> <div ng-click="hideModalDel()" class="ui negative button"> {{\'No\' | translate}} </div> <div ng-click="removeMsgPositive()" class="ui positive right labeled icon button"> {{\'Yes\' | translate}} <i class="checkmark icon"></i> </div> </div> </div>'),e.put("views/parkings.html",'<div class="ui segment adjust-segment-container"> <div class="ui yellow header"> <div class="float-left"> <i class="yellow product hunt icon"></i> <div class="content"> {{\'Parkings\' | translate}} </div> </div> <div class="float-right"> <span ng-if="currentUser.profile.macro_permissions.settings.permissions.parkings.value" data-tooltip="{{\'Parkings\' | translate}}" data-position="bottom right" class="adjust-title-park"> <i ng-click="goTo(\'parkings\');" class="yellow product hunt link icon no-margin-right"></i> </span> </div> <div class="float-right"> <span ng-if="currentUser.profile.macro_permissions.presence_panel.permissions.trunks.value" data-tooltip="{{\'Lines\' | translate}}" data-position="bottom right" class="adjust-title-park"> <i ng-click="goTo(\'lines\');" class="orange tasks link icon no-margin-right"></i> </span> </div> <div class="float-right"> <span ng-if="currentUser.profile.macro_permissions.presence_panel.value" data-tooltip="{{\'Operators\' | translate}}" data-position="bottom right" class="adjust-title-park"> <i ng-click="goTo(\'\');" class="blue user link icon no-margin-right"></i> </span> </div> </div> <div class="ui blue header title-header"></div> <div ng-if="(parkings | isempty:true) && !viewLoad" class="ui icon message very-big-margin-bottom"> <i class="users icon"></i> <div class="content"> <div class="header"> {{\'No parkings found\' | translate}} </div> <p>{{\'There are no parkings available\' | translate}}</p> </div> </div> <div class="ui cards"> <div ng-repeat="(kp, p) in parkings" class="inverted {{(p.parkedCaller | isempty:true) ? \'green\' : \'red\' }} card"> <div class="content"> <div class="header">{{\'Parking\' | translate}} {{kp}}</div> <div ng-if="!(p.parkedCaller | isempty:true)" class="meta"> {{p.parkedCaller.name}} <b>{{p.parkedCaller.num}}</b> </div> <div ng-if="(p.parkedCaller | isempty:true)" class="meta"> {{\'No call\' | translate}} </div> </div> <div class="extra content"> <timer ng-if="!(p.parkedCaller | isempty:true)" countdown="p.parkedCaller.timeout" interval="1000"> <a data-tooltip="{{\'Pick parking\' | translate}}" data-position="top center" ng-click="pickParking(p.parkedCaller.parking)" class="ui label {{progressColor}}"> <i class="product hunt icon"></i>{{hhours}}:{{mminutes}}:{{sseconds}} </a> </timer> <div ng-if="(p.parkedCaller | isempty:true)" class="ui label blue"> <i class="product hunt icon"></i> {{\'Available\' | translate}} </div> </div> </div> </div> </div>'),e.put("views/phonebook.html",'<div class="ui segment adjust-segment-container"> <h3 class="ui green header title-header"> <i class="green counterclockwise rotated calendar outline icon"></i> <div class="content"> {{\'Phonebook\' | translate}} </div> </h3> <div class="ui grid"> <div class="{{responsive.isMobile ? \'one\' : \'two\'}} column row no-padding"> <div class="left floated column no-padding"> <form ng-submit="searchOnly()"> <div class="ui form"> <div class="inline fields"> <div id="searchContainer" class="field small-margin-bottom medium-margin-top adjust-padding"> <div id="phonebook-search" class="ui action input"> \x3c!-- search input --\x3e <input id="phonebookSearchInput" type="text" ng-model="search.field" placeholder="{{\'Search\' | translate}}..."> \x3c!-- phonebook type select --\x3e <select ng-change="changeFilter()" name="phonebook-filter" ng-model="filter.type" class="ui compact selection dropdown"> <option value="all">{{\'All\' | translate}}</option> <option value="company">{{\'Company\' | translate}}</option> <option value="person">{{\'Person\' | translate}}</option> </select> <button class="ui icon button"> <i class="search icon"></i> </button> </div> </div> </div> </div> </form> </div> <div class="{{responsive.isMobile ? \'left\' : \'right\'}} floated column {{responsive.isMobile ? \'\' : \'right-align\'}}"> \x3c!-- new contact button --\x3e <button ng-if="currentUser.profile.macro_permissions.phonebook.value" ng-click="newContact()" class="ui icon button green item big tiny-margin-top" data-tooltip="{{\'New Contact\' | translate}}" data-position="bottom center"> <i class="add user icon"></i> </button> </div> </div> <div class="{{responsive.isMobile ? \'one\' : \'two\'}} column row"> <div ng-if="!responsive.isMobile" class="two wide column adjust-alphabet center-align"> <div class="ui vertical buttons compact"> <button ng-click="startSearch(\'all\', 0, true, true, true, true, false)" class="ui button"> 0 - 9 </button> <button ng-click="startSearch(l, 0, true, true, true, false, false)" ng-repeat="l in alphabet" class="ui {{currentTerm == l ? \'active\' : \'\'}} button"> {{l}} </button> </div> </div> \x3c!-- no contacts message --\x3e <div id="phonebookResultsCol" class="{{responsive.isMobile ? \'sixteen\' : \'fourteen\'}} wide column"> <div ng-show="phoneBookLoad" class="ui active centered inline loader"></div> <div ng-if="!phoneBookLoad && phoneBookResults.total == 0" class="ui icon message"> <i class="counterclockwise rotated calendar outline icon"></i> <div class="content"> <div class="header"> {{\'No contacts found\' | translate}} </div> <p>{{\'There are no contacts available\' | translate}}</p> </div> </div> \x3c!-- START COMPANY FILTER --\x3e <div ng-show="!phoneBookLoad" ng-if="filter.type == \'company\' && c.company" ng-repeat="c in phoneBookResults track by $index" class="ui horizontal segments equal width grid no-margin-top small-margin-bottom contact-repeat"> <div class="ui segment column card small-padding adjust-responsive-column-contact"> <div class="content"> <div class="header"> <span ng-if="c.type" class="float-right table-row" data-tooltip="{{c.type | translate}}" data-position="left center"> <i class="{{getIconState(c.type)}} icon item float-right"></i> </span> <i class="building grey icon"></i> {{c.company}} </div> <div class="description"> \x3c!-- workphone for company --\x3e <a ng-if="c.workphone" class="{{allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus() ? \'disabled-container\': \'\'}} adjust-phonebook-info small-margin-bottom"> <i class="call black icon fz-15-5"></i> \x3c!-- costumer card for workphone --\x3e <button ng-if="currentUser.profile.macro_permissions.customer_card.value" data-tooltip="{{\'Show customer card\' | translate}} {{c.workphone}}" data-position="top left" ng-click="goTo(\'customercard/\'+c.workphone)" class="mini ui icon button"> <i class="browser black icon"></i> </button> \x3c!-- workphone with call/transfer and tooltip --\x3e <div ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\' && currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.workphone}}" data-position="top left" ng-click="call(c.workphone)" class="ui label loader-margin"> {{\'Work phone\' | translate}} </div> <span ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\' && currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.workphone}}" data-position="top left" ng-click="call(c.workphone)"> {{c.workphone}} </span> \x3c!-- workphone without call/transfer and tooltip --\x3e <div ng-if="allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="ui label loader-margin disabled-in-container"> {{\'Work phone\' | translate}} </div> <span ng-if="allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="disabled-in-container"> {{c.workphone}} </span> </a> \x3c!-- homephone for company --\x3e <a ng-if="c.homephone" class="{{allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus() ? \'disabled-container\':\'\'}} adjust-phonebook-info small-margin-bottom"> <i class="home black icon fz-15-5"></i> <button ng-if="currentUser.profile.macro_permissions.customer_card.value" data-tooltip="{{\'Show customer card\' | translate}} {{c.homephone}}" data-position="top left" ng-click="goTo(\'customercard/\'+c.homephone)" class="mini ui icon button"> <i class="browser black icon"></i> </button> \x3c!-- homephone with call/transfer and tooltip --\x3e <div ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\' && currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.homephone}}" data-position="top left" ng-click="call(c.homephone)" class="ui label loader-margin"> {{\'Home phone\' | translate}} </div> <span ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\' && currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.homephone}}" data-position="top left" ng-click="call(c.homephone)"> {{c.homephone}} </span> \x3c!-- homephone without call/transfer and tooltip --\x3e <div ng-if="allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="disabled-in-container ui label loader-margin"> {{\'Home phone\' | translate}} </div> <span ng-if="allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="disabled-in-container"> {{c.homephone}} </span> </a> \x3c!-- cellphone for company --\x3e <a ng-if="c.cellphone" class="{{allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus() ? \'disabled-container\':\'\'}} adjust-phonebook-info small-margin-bottom"> <i class="mobile black icon fz-15-5"></i> <button ng-if="currentUser.profile.macro_permissions.customer_card.value" data-tooltip="{{\'Show customer card\' | translate}} {{c.cellphone}}" data-position="top left" ng-click="goTo(\'customercard/\'+c.cellphone)" class="mini ui icon button"> <i class="browser black icon"></i> </button> \x3c!-- cellphone with call/transfer and tooltip --\x3e <div ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\' && currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.cellphone}}" data-position="top left" ng-click="call(c.cellphone)" class="ui label loader-margin"> {{\'Cellphone\' | translate}} </div> <span ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\' && currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.cellphone}}" data-position="top left" ng-click="call(c.cellphone)"> {{c.cellphone}} </span> \x3c!-- cellphone without call/transfer and tooltip --\x3e <div ng-if="allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="disabled-in-container ui label loader-margin"> {{\'Cellphone\' | translate}} </div> <span ng-if="allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="disabled-in-container"> {{c.cellphone}} </span> </a> \x3c!-- location for company --\x3e <a href="https://www.google.it/maps/place/{{c.workstreet}} {{c.workcity}} {{c.workprovince}} {{c.workcountry}}" target="_blank" ng-if="c.workstreet || c.workcity || c.workprovince || c.workcountry" class="adjust-phonebook-info small-margin-bottom"> <i class="marker red icon"></i> <div class="ui label loader-margin"> {{\'Location\' | translate}} </div> {{c.workstreet}} {{c.workcity}} {{c.workprovince}} {{c.workcountry}} </a> \x3c!-- site for company --\x3e <a href="{{c.url}}" target="_blank" ng-if="c.url" class="adjust-phonebook-info small-margin-bottom"> <i class="world blue icon"></i> <div class="ui label loader-margin"> {{\'Site\' | translate}} </div> {{c.url}} </a> \x3c!-- title for company --\x3e <a ng-if="c.title" class="adjust-phonebook-info small-margin-bottom"> <i class="graduation cap icon black"></i> <div class="ui label loader-margin"> {{\'Job title\' | translate}} </div> {{c.title}} </a> \x3c!-- notes for company --\x3e <a ng-if="c.notes" class="adjust-phonebook-info small-margin-bottom"> <i class="file alternate icon black"></i> <div class="ui label loader-margin"> {{\'Notes\' | translate}} </div> {{c.notes}} </a> </div> </div> \x3c!-- bottom section --\x3e <div class="extra content right-align"> <span class="table-row" data-tooltip="{{(c.contacts[0] && c.contacts[0].name) || !c.contacts[0] ? \'centralized\' : \'cti\' | translate}} {{((c.contacts[0] && c.contacts[0].name) || !c.contacts[0]) && c.type !== \'\' ? \'(\' + c.type + \')\' : \'\' | translate}}" data-position="right center"> <i ng-if="c.contacts[0] && !c.contacts[0].name" class="{{appConfig.PHONEBOOK_ICON_MAP[\'cti\']}} icon item float-left"></i> <i ng-if="(c.contacts[0] && c.contacts[0].name) || !c.contacts[0]" class="{{appConfig.PHONEBOOK_ICON_MAP[\'centralized\']}} icon item float-left"></i> </span> <div ng-show="c.isLoading" class="ui active inline tiny loader loader-margin"> </div> <span ng-if="((c.contacts[0] && !c.contacts[0].name) && (c.owner_id === currentUser.username)) || ((c.contacts[0] && !c.contacts[0].name) && (c.owner_id !== currentUser.username) && (currentUser.profile.macro_permissions.phonebook.permissions.ad_phonebook.value === true))"> \x3c!-- modify --\x3e <button ng-click="modifyContact(c)" class="ui item icon button blue compact" data-tooltip="{{\'Modify\' | translate}}" data-position="bottom center"> <i class="write icon"></i> </button> \x3c!-- delete --\x3e <button ng-click="showDeleteModal(c)" class="ui right item icon button red compact" data-tooltip="{{\'Delete\' | translate}}" data-position="bottom center"> <i class="delete icon"></i> </button> </span> </div> </div> \x3c!-- start contacts --\x3e <div ng-if="c.contacts.realLength" class="ui segment column card small-padding adjust-responsive-column-contact"> <div class="content"> <h4 class="ui blue dividing header"> {{\'Contacts\' | translate}} </h4> <div ng-if="r.name && r.name.length > 0" ng-repeat="r in c.contacts | orderBy:\'name\' track by $index" class="phonebook-references"> <a ng-click="getContactInfo(r, c)" class="ui adjust-phonebook-info inline-row small-margin-bottom black-ref"> <i class="user icon"></i> {{r.name || \'Unknown\' | translate}} <span data-tooltip="{{r.source | translate}}" data-position="right center"> <i class="{{getIconState(r.source)}} icon item icon-source"></i> </span> </a> <div ng-show="r.isLoading" class="ui active inline tiny loader"></div> </div> \x3c!-- no contacts --\x3e <div ng-if="c.contacts.empty" class="ui icon mini message"> <i class="user icon"></i> <div class="content"> <div class="header"> {{\'No contacts found\' | translate}} </div> <p>{{\'There are no contacts available\' | translate}}</p> </div> </div> </div> </div> \x3c!-- selected contact --\x3e <div ng-if="c.selectedContact" class="ui segment column card small-padding no-phonebook-border"> <div class="content"> \x3c!-- name --\x3e <div class="header"> <span class="float-right table-row" data-tooltip="{{c.selectedContact.type | translate}}" data-position="left center"> <i class="{{getIconState(c.selectedContact.type)}} icon item float-right"></i> </span> <i class="user grey icon"></i> {{c.selectedContact.name || \'Unknown\' | translate}} </div> \x3c!-- owner --\x3e <div class="meta"> <span class="date">{{\'Created by\' | translate}} <b>{{c.selectedContact.owner_id || \'unknown\' | translate}}</b></span> </div> <div class="description"> \x3c!-- extension --\x3e <a ng-if="c.selectedContact.extension" class="{{allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus() ? \'disabled-container\':\'\' }} adjust-phonebook-info small-margin-bottom"> <i class="call square black icon"></i> \x3c!-- extension with call/transfer and tooltip --\x3e <div ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\' && currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.selectedContact.extension}}" data-position="top left" ng-click="call(c.selectedContact.extension)" class="ui label loader-margin"> {{\'Extension\' | translate}} </div> <span ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\' && currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.selectedContact.extension}}" data-position="top left" ng-click="call(c.selectedContact.extension)"> {{c.selectedContact.extension}} </span> \x3c!-- extension without call/transfer and tooltip --\x3e <div ng-if="allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="disabled-in-container ui label loader-margin"> {{\'Extension\' | translate}} </div> <span ng-if="allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="disabled-in-container"> {{c.selectedContact.extension}} </span> </a> \x3c!-- workphone --\x3e <a ng-if="c.selectedContact.workphone" class="{{allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus() ? \'disabled-container\':\'\' }} adjust-phonebook-info small-margin-bottom"> <i class="call black icon fz-15-5"></i> <button ng-if="currentUser.profile.macro_permissions.customer_card.value && c.selectedContact.workphone" data-tooltip="{{\'Show customer card\' | translate}} {{c.selectedContact.workphone}}" data-position="top left" ng-click="goTo(\'customercard/\'+c.selectedContact.workphone)" class="mini ui icon button"> <i class="browser black icon"></i> </button> \x3c!-- workphone with call/transfer and tooltip --\x3e <div ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\' && currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.selectedContact.workphone}}" data-position="top left" ng-click="call(c.selectedContact.workphone)" class="ui label loader-margin"> {{\'Work phone\' | translate}} </div> <span ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\' && currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.selectedContact.workphone}}" data-position="top left" ng-click="call(c.selectedContact.workphone)"> {{c.selectedContact.workphone}} </span> \x3c!-- workphone without call/transfer and tooltip --\x3e <div ng-if="allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="disabled-in-container ui label loader-margin"> {{\'Work phone\' | translate}} </div> <span ng-if="allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="disabled-in-container"> {{c.selectedContact.workphone}} </span> </a> \x3c!-- homephone --\x3e <a ng-if="c.selectedContact.homephone" class="{{allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus() ? \'disabled-container\' : \'\'}} adjust-phonebook-info small-margin-bottom"> <i class="call black icon fz-15-5"></i> <button ng-if="currentUser.profile.macro_permissions.customer_card.value && c.selectedContact.homephone" data-tooltip="{{\'Show customer card\' | translate}} {{c.selectedContact.homephone}}" data-position="top left" ng-click="goTo(\'customercard/\'+c.selectedContact.homephone)" class="mini ui icon button"> <i class="browser black icon"></i> </button> \x3c!-- homephone with call/transfer and tooltip --\x3e <div ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\' && currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.selectedContact.homephone}}" data-position="top left" ng-click="call(c.selectedContact.homephone)" class="ui label loader-margin"> {{\'Home phone\' | translate}} </div> <span ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\' && currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.selectedContact.homephone}}" data-position="top left" ng-click="call(c.selectedContact.homephone)"> {{c.selectedContact.homephone}} </span> \x3c!-- homephone without call/transfer and tooltip --\x3e <div ng-if="allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="disabled-in-container ui label loader-margin"> {{\'Home phone\' | translate}} </div> <span ng-if="allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="disabled-in-container"> {{c.selectedContact.homephone}} </span> </a> \x3c!-- cellphone --\x3e <a ng-if="c.selectedContact.cellphone" class="{{allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus() ? \'disabled-container\':\'\'}} adjust-phonebook-info small-margin-bottom"> <i class="mobile black icon fz-15-5"></i> <button ng-if="currentUser.profile.macro_permissions.customer_card.value && c.selectedContact.cellphone" data-tooltip="{{\'Show customer card\' | translate}} {{c.selectedContact.cellphone}}" data-position="top left" ng-click="goTo(\'customercard/\'+c.selectedContact.cellphone)" class="mini ui icon button"> <i class="browser black icon"></i> </button> \x3c!-- cellphone with call/transfer and tooltip --\x3e <div ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\' && currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.selectedContact.cellphone}}" data-position="top left" ng-click="call(c.selectedContact.cellphone)" class="ui label loader-margin"> {{\'Cellphone\' | translate}} </div> <span ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\' && currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.selectedContact.cellphone}}" data-position="top left" ng-click="call(c.selectedContact.cellphone)"> {{c.selectedContact.cellphone}} </span> \x3c!-- cellphone without call/transfer and tooltip --\x3e <div ng-if="allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="disabled-in-container ui label loader-margin"> {{\'Cellphone\' | translate}} </div> <span ng-if="allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="disabled-in-container"> {{c.selectedContact.cellphone}} </span> </a> \x3c!-- workstreet --\x3e <a href="https://www.google.it/maps/place/{{c.selectedContact.workstreet}} {{c.selectedContact.workcity}} {{c.selectedContact.workprovince}} {{c.selectedContact.workcountry}}" target="_blank" ng-if="c.selectedContact.workstreet || c.selectedContact.workcity || c.selectedContact.workprovince || c.selectedContact.workcountry" class="adjust-phonebook-info small-margin-bottom"> <i class="marker red icon"></i> <div class="ui label loader-margin"> {{\'Work location\' | translate}} </div> {{c.selectedContact.workstreet}} {{c.selectedContact.workcity}} {{c.selectedContact.workprovince}} {{c.selectedContact.workcountry}} </a> \x3c!-- homecountry --\x3e <a href="https://www.google.it/maps/place/{{c.selectedContact.homestreet}} {{c.selectedContact.homecity}} {{c.selectedContact.homeprovince}} {{c.selectedContact.homecountry}}" target="_blank" ng-if="c.selectedContact.homestreet || c.selectedContact.homecity || c.selectedContact.homeprovince || c.selectedContact.homecountry" class="adjust-phonebook-info small-margin-bottom"> <i class="marker blue icon"></i> <div class="ui label loader-margin"> {{\'Home location\' | translate}} </div> {{c.selectedContact.homestreet}} {{c.selectedContact.homecity}} {{c.selectedContact.homeprovince}} {{c.selectedContact.homecountry}} </a> \x3c!-- workemail --\x3e <a href="mailto:{{c.selectedContact.workemail}}" target="_blank" ng-if="c.selectedContact.workemail" class="adjust-phonebook-info small-margin-bottom"> <i class="mail black icon"></i> <div class="ui label loader-margin"> {{\'Email\' | translate}} </div> {{c.selectedContact.workemail}} </a> \x3c!-- fax --\x3e <a ng-if="c.selectedContact.fax" class="adjust-phonebook-info small-margin-bottom"> <i class="fax black icon"></i> <div class="ui label loader-margin"> {{\'Fax\' | translate}} </div> {{c.selectedContact.fax}} </a> \x3c!-- job title --\x3e <a ng-if="c.selectedContact.title" class="adjust-phonebook-info small-margin-bottom"> <i class="graduation cap icon black"></i> <div class="ui label loader-margin"> {{\'Job title\' | translate}} </div> {{c.selectedContact.title}} </a> \x3c!-- notes --\x3e <a ng-if="c.selectedContact.notes" class="adjust-phonebook-info small-margin-bottom"> <i class="file alternate icon black"></i> <div class="ui label loader-margin"> {{\'Notes\' | translate}} </div> {{c.selectedContact.notes}} </a> \x3c!-- costumer card --\x3e <a data-tooltip="{{\'Show customer card\' | translate}}" data-position="top left" ng-click="goTo(\'customercard/\'+(c.selectedContact.homephone || c.selectedContact.workphone || c.selectedContact.cellphone))" ng-if="currentUser.profile.macro_permissions.customer_card.value && (c.selectedContact.homephone || c.selectedContact.workphone || c.selectedContact.cellphone)" class="adjust-phonebook-info small-margin-bottom"> <i class="browser black icon"></i> <div class="ui label loader-margin"> {{\'Customer card\' | translate}} 2 </div> </a> </div> </div> \x3c!-- action buttons for the selected contact --\x3e <div ng-if="((c.selectedContact.source === \'cti\') && (c.owner_id === currentUser.username)) || ((c.selectedContact.source === \'cti\') && (c.owner_id !== currentUser.username) && (currentUser.profile.macro_permissions.phonebook.permissions.ad_phonebook.value === true))" class="extra content right-align"> <div ng-show="c.selectedContact.isLoading" class="ui active inline tiny loader loader-margin"></div> \x3c!-- modify button --\x3e <button ng-click="modifyContact(c.selectedContact)" class="ui item icon button blue compact" data-tooltip="{{\'Modify\' | translate}}" data-position="bottom center"> <i class="write icon"></i> </button> \x3c!-- delete button --\x3e <button ng-click="showDeleteModal(c.selectedContact)" class="ui right item icon button red compact" data-tooltip="{{\'Delete\' | translate}}" data-position="bottom center"> <i class="delete icon"></i> </button> </div> </div> </div> \x3c!-- START PERSON AND ALL FILTER --\x3e <div ng-show="!phoneBookLoad" ng-if="filter.type == \'person\' || filter.type == \'all\'" ng-repeat="c in phoneBookResults" class="ui horizontal segments equal width grid no-margin-top small-margin-bottom contact-repeat"> \x3c!-- NAME IS PRESENT --\x3e <div ng-if="c.name" class="ui segment column card small-padding"> <div class="content"> <div class="header"> <span class="float-right table-row" data-tooltip="{{c.type | translate}}" data-position="left center"> <i class="{{getIconState(c.type)}} icon item float-right"></i> </span> <i class="user grey icon"></i> {{c.name || \'Unknown\' | translate}} </div> <div class="meta"> <span class="date">{{\'Created by\' | translate}} <b>{{c.owner_id || \'unknown\' | translate}}</b></span> </div> <div class="description"> \x3c!-- extension --\x3e <a ng-if="c.extension" class="{{allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus() ? \'disabled-container\':\'\' }} adjust-phonebook-info small-margin-bottom"> <i class="call square black icon"></i> \x3c!-- extension with call/transfer and tooltip --\x3e <div ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\' && currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.extension}}" data-position="top left" ng-click="call(c.extension)" class="ui label loader-margin"> {{\'Extension\' | translate}} </div> <span ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\' && currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.extension}}" data-position="top left" ng-click="call(c.extension)"> {{c.extension}} </span> \x3c!-- extension without call/transfer and tooltip --\x3e <div ng-if="allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="disabled-in-container ui label loader-margin"> {{\'Extension\' | translate}} </div> <span ng-if="allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="disabled-in-container"> {{c.extension}} </span> </a> \x3c!-- workphone --\x3e <a ng-if="c.workphone" class="{{allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus() ? \'disabled-container\':\'\'}} adjust-phonebook-info small-margin-bottom"> <i class="call black icon fz-15-5"></i> <button ng-if="currentUser.profile.macro_permissions.customer_card.value" data-tooltip="{{\'Show customer card\' | translate}} {{c.workphone}}" data-position="top left" ng-click="goTo(\'customercard/\'+c.workphone)" class="mini ui icon button"> <i class="browser black icon"></i> </button> \x3c!-- workphone with call/transfer and tooltip --\x3e <div ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\' && currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.workphone}}" data-position="top left" ng-click="call(c.workphone)" class="ui label loader-margin"> {{\'Work phone\' | translate}} </div> <span ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\' && currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.workphone}}" data-position="top left" ng-click="call(c.workphone)"> {{c.workphone}}</span> \x3c!-- workphone without call/transfer and tooltip --\x3e <div ng-if="allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="disabled-in-container ui label loader-margin"> {{\'Work phone\' | translate}} </div> <span ng-if="allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="disabled-in-container"> {{c.workphone}} </span> </a> \x3c!-- homephone --\x3e <a ng-if="c.homephone" class="{{!allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus() ? \'disabled-container\':\'\'}} adjust-phonebook-info small-margin-bottom"> <i class="home black icon fz-15-5"></i> <button ng-if="currentUser.profile.macro_permissions.customer_card.value" data-tooltip="{{\'Show customer card\' | translate}} {{c.homephone}}" data-position="top left" ng-click="goTo(\'customercard/\'+c.homephone)" class="mini ui icon button"> <i class="browser black icon"></i> </button> \x3c!-- homephone with call/transfer and tooltip --\x3e <div ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\' && currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.homephone}}" data-position="top left" ng-click="call(c.homephone)" class="ui label loader-margin"> {{\'Home phone\' | translate}} </div> <span ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\' && currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.homephone}}" data-position="top left" ng-click="call(c.homephone)"> {{c.homephone}} </span> \x3c!-- homephone without call/transfer and tooltip --\x3e <div ng-if="c.homephone && allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="disabled-in-container ui label loader-margin"> {{\'Home phone\' | translate}} </div> <span ng-if="c.homephone && allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="disabled-in-container"> {{c.homephone}} </span> </a> \x3c!-- cellphone --\x3e <a ng-if="c.cellphone" class="{{allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus() ? \'disabled-container\':\'\'}} adjust-phonebook-info small-margin-bottom"> <i class="mobile black icon fz-15-5"></i> <button ng-if="currentUser.profile.macro_permissions.customer_card.value" data-tooltip="{{\'Show customer card\' | translate}} {{c.cellphone}}" data-position="top left" ng-click="goTo(\'customercard/\'+c.cellphone)" class="mini ui icon button"> <i class="browser black icon"></i> </button> \x3c!-- cellphone with call/transfer and tooltip --\x3e <div ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\' && currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.cellphone}}" data-position="top left" ng-click="call(c.cellphone)" class="ui label loader-margin"> {{\'Cellphone\' | translate}} </div> <span ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\'&& currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.cellphone}}" data-position="top left" ng-click="call(c.cellphone)"> {{c.cellphone}} </span> \x3c!-- cellphone without call/transfer and tooltip --\x3e <div ng-if="allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="disabled-in-container ui label loader-margin"> {{\'Cellphone\' | translate}} </div> <span ng-if="allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="disabled-in-container"> {{c.cellphone}} </span> </a> \x3c!-- workstreet --\x3e <a href="https://www.google.it/maps/place/{{c.workstreet}} {{c.workcity}} {{c.workprovince}} {{c.workcountry}}" target="_blank" ng-if="c.workstreet || c.workcity || c.workprovince || c.workcountry" class="adjust-phonebook-info small-margin-bottom"> <i class="marker red icon"></i> <div class="ui label loader-margin"> {{\'Work location\' | translate}} </div> {{c.workstreet}} {{c.workcity}} {{c.workprovince}} {{c.workcountry}} </a> \x3c!-- homestreet --\x3e <a href="https://www.google.it/maps/place/{{c.homestreet}} {{c.homecity}} {{c.homeprovince}} {{c.homecountry}}" target="_blank" ng-if="c.homestreet || c.homecity || c.homeprovince || c.homecountry" class="adjust-phonebook-info small-margin-bottom"> <i class="marker blue icon"></i> <div class="ui label loader-margin"> {{\'Home location\' | translate}} </div> {{c.homestreet}} {{c.homecity}} {{c.homeprovince}} {{c.homecountry}} </a> \x3c!-- workemail --\x3e <a href="mailto:{{c.workemail}}" target="_blank" ng-if="c.workemail" class="adjust-phonebook-info small-margin-bottom"> <i class="mail black icon"></i> <div class="ui label loader-margin"> {{\'Email\' | translate}} </div> {{c.workemail}} </a> \x3c!-- fax --\x3e <a ng-if="c.fax" class="adjust-phonebook-info small-margin-bottom"> <i class="fax black icon"></i> <div class="ui label loader-margin"> {{\'Fax\' | translate}} </div> {{c.fax}} </a> \x3c!-- job title --\x3e <a ng-if="c.title" class="adjust-phonebook-info small-margin-bottom"> <i class="graduation cap icon black"></i> <div class="ui label loader-margin"> {{\'Job title\' | translate}} </div> {{c.title}} </a> <a ng-if="c.notes" class="adjust-phonebook-info small-margin-bottom"> <i class="file alternate icon black"></i> <div class="ui label loader-margin"> {{\'Notes\' | translate}} </div> {{c.notes}} </a> </div> </div> \x3c!-- person and all actions --\x3e <div class="extra content right-align"> <span class="table-row" data-tooltip="{{c.source | translate}} {{c.source === \'centralized\' && c.type !== \'\' ? \'(\' + c.type + \')\' : \'\'}}" data-position="right center"> <i class="{{getIconState(c.source)}} icon item float-left"></i> </span> <div ng-show="c.isLoading" class="ui active inline tiny loader loader-margin"></div> <span ng-if="((c.source === \'cti\') && (c.owner_id === currentUser.username)) || ((c.source === \'cti\') && (c.owner_id !== currentUser.username) && (currentUser.profile.macro_permissions.phonebook.permissions.ad_phonebook.value === true))"> \x3c!-- modify --\x3e <button ng-click="modifyContact(c)" class="ui item icon button blue compact" data-tooltip="{{\'Modify\' | translate}}" data-position="bottom center"> <i class="write icon"></i> </button> \x3c!-- delete --\x3e <button ng-click="showDeleteModal(c)" class="ui right item icon button red compact" data-tooltip="{{\'Delete\' | translate}}" data-position="bottom center"> <i class="delete icon"></i> </button> </span> </div> </div> \x3c!-- COMPANY IS PRESENT --\x3e <div ng-if="c.company" class="ui segment column card small-padding"> <div class="content"> <div class="header"> <span ng-hide="c.company && c.name" class="float-right table-row" data-tooltip="{{c.type | translate}}" data-position="left center"> <i class="{{getIconState(c.type)}} icon item float-right"></i> </span> <i class="building grey icon"></i> {{c.company}} </div> <div class="description"> \x3c!-- COMPANY BUT NOT NAME --\x3e <span ng-if="!c.name"> \x3c!-- extension --\x3e <a data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.extension}}" data-position="top left" ng-click="call(c.extension)" ng-if="c.extension" class="adjust-phonebook-info small-margin-bottom"> <i class="call square black icon"></i> <div class="ui label loader-margin"> {{\'Extension\' | translate}} </div> {{c.extension}} </a> \x3c!-- workphone --\x3e <a ng-if="c.workphone" class="{{allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus() ? \'disabled-container\' : \'\'}} adjust-phonebook-info small-margin-bottom"> <i class="call black icon fz-15-5"></i> <button ng-if="currentUser.profile.macro_permissions.customer_card.value" data-tooltip="{{\'Show customer card\' | translate}} {{c.workphone}}" data-position="top left" ng-click="goTo(\'customercard/\'+c.workphone)" class="mini ui icon button"> <i class="browser black icon"></i> </button> <div ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\' && currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.workphone}}" data-position="top left" ng-click="call(c.workphone)" class="ui label loader-margin"> {{\'Work phone\' | translate}} </div> <span ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\' && currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.workphone}}" data-position="top left" ng-click="call(c.workphone)"> {{c.workphone}} </span> <div ng-if="allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="disabled-in-container ui label loader-margin"> {{\'Work phone\' | translate}} </div> <span ng-if="allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="disabled-in-container"> {{c.workphone}} </span> </a> \x3c!-- homephone --\x3e <a ng-if="c.homephone" class="{{!allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()? \'disabledcontainer\':\'\'}} adjust-phonebook-info small-margin-bottom"> <i class="home black icon fz-15-5"></i> <button ng-if="currentUser.profile.macro_permissions.customer_card.value" data-tooltip="{{\'Show customer card\' | translate}} {{c.homephone}}" data-position="top left" ng-click="goTo(\'customercard/\'+c.homephone)" class="mini ui icon button"> <i class="browser black icon"></i> </button> <div ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\' && currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.homephone}}" data-position="top left" ng-click="call(c.homephone)" class="ui label loader-margin"> {{\'Home phone\' | translate}} </div> <span ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\' && currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.homephone}}" data-position="top left" ng-click="call(c.homephone)"> {{c.homephone}} </span> <div ng-if="allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="disabled-in-container ui label loader-margin"> {{\'Home phone\' | translate}} </div> <span ng-if="allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="disabled-in-container"> {{c.homephone}} </span> </a> \x3c!-- cellphone --\x3e <a ng-if="c.cellphone" class="{{allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus() ? \'disabled-container\':\'\'}} adjust-phonebook-info small-margin-bottom"> <i class="mobile black icon fz-15-5"></i> <button ng-if="currentUser.profile.macro_permissions.customer_card.value" data-tooltip="{{\'Show customer card\' | translate}} {{c.cellphone}}" data-position="top left" ng-click="goTo(\'customercard/\'+c.cellphone)" class="mini ui icon button"> <i class="browser black icon"></i> </button> <div ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\' && currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.cellphone}}" data-position="top left" ng-click="call(c.cellphone)" class="ui label loader-margin"> {{\'Cellphone\' | translate}} </div> <span ng-if="allExtensions[currentUser.default_device.id].status !== \'offline\' && currentUser.endpoints.extension.length !== 0" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{c.cellphone}}" data-position="top left" ng-click="call(c.cellphone)"> {{c.cellphone}} </span> <div ng-if="allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="disabled-in-container ui label loader-margin"> {{\'Cellphone\' | translate}} </div> <span ng-if="allExtensions[currentUser.default_device.id].status === \'offline\' || currentUser.endpoints.extension.length === 0 || noDefaultDeviceStatus()" class="disabled-in-container"> {{c.cellphone}} </span> </a> \x3c!-- workemail --\x3e <a href="mailto:{{c.workemail}}" target="_blank" ng-if="c.workemail" class="adjust-phonebook-info small-margin-bottom"> <i class="mail black icon"></i> <div class="ui label loader-margin"> {{\'Email\' | translate}} </div> {{c.workemail}} </a> \x3c!-- fax --\x3e <a ng-if="c.fax" class="adjust-phonebook-info small-margin-bottom"> <i class="fax black icon"></i> <div class="ui label loader-margin"> {{\'Fax\' | translate}} </div> {{c.fax}} </a> </span> \x3c!-- location --\x3e <a ng-hide="c.company && c.name" href="https://www.google.it/maps/place/{{c.workstreet}} {{c.workcity}} {{c.workprovince}} {{c.workcountry}}" target="_blank" ng-if="c.workstreet || c.workcity || c.workprovince || c.workcountry" class="adjust-phonebook-info small-margin-bottom"> <i class="marker red icon"></i> <div class="ui label loader-margin"> {{\'Location\' | translate}} </div> {{c.workstreet}} {{c.workcity}} {{c.workprovince}} {{c.workcountry}} </a> \x3c!-- url --\x3e <a href="{{c.url}}" target="_blank" ng-if="c.url" class="adjust-phonebook-info small-margin-bottom"> <i class="world blue icon"></i> <div class="ui label loader-margin"> {{\'Site\' | translate}} </div> {{c.url}} </a> \x3c!-- job title --\x3e <a ng-hide="c.company && c.name" ng-if="c.title" class="adjust-phonebook-info small-margin-bottom"> <i class="graduation cap icon black"></i> <div class="ui label loader-margin"> {{\'Job title\' | translate}} </div> {{c.title}} </a> \x3c!-- notes --\x3e <a ng-hide="c.company && c.name" ng-if="c.notes" class="adjust-phonebook-info small-margin-bottom"> <i class="file alternate icon black"></i> <div class="ui label loader-margin"> {{\'Notes\' | translate}} </div> {{c.notes}} </a> </div> </div> \x3c!-- right actions and info --\x3e <div class="extra content right-align"> <span ng-if="!(c.company && c.name)" class="table-row" data-tooltip="{{c.source | translate}} {{c.source === \'centralized\' && c.type !== \'\' ? \'(\' + c.type + \')\' : \'\'}}" data-position="right center"> <i ng-if="c.source" class="{{getIconState(c.source)}} icon item float-left"></i> </span> <div ng-show="c.isLoading" class="ui active inline tiny loader loader-margin"></div> <span ng-hide="c.company && c.name" ng-if="((c.source === \'cti\') && (c.owner_id === currentUser.username)) || ((c.source === \'cti\') && (c.owner_id !== currentUser.username) && (currentUser.profile.macro_permissions.phonebook.permissions.ad_phonebook.value === true))"> \x3c!-- modify --\x3e <button ng-click="modifyContact(c)" class="ui item icon button blue compact" data-tooltip="{{\'Modify\' | translate}}" data-position="bottom center"> <i class="write icon"></i> </button> \x3c!-- delete --\x3e <button ng-click="showDeleteModal(c)" class="ui right item icon button red compact" data-tooltip="{{\'Delete\' | translate}}" data-position="bottom center"> <i class="delete icon"></i> </button> </span> </div> </div> </div> \x3c!-- END RESULT CONTENT--\x3e \x3c!-- START PAGINATION --\x3e <div ng-if="!phoneBookLoad && totalPages > 0" class="ui grid"> <div ng-if="totalPages > 5" class="eight column row center-align"> <div class="column">{{\'Page\' | translate}}: <b>{{currentPage + 1}}</b></div> <a ng-click="prevPage()" class="icon item column page-number"> <span class="font-large">«</span> </a> <a ng-click="startSearch(currentTerm, firstCurrentPage > 0 ? firstCurrentPage -1 : 0, true, false)" class="icon item column page-number">{{firstCurrentPage > 0 ? firstCurrentPage : 1}}</a> <a ng-click="startSearch(currentTerm, firstCurrentPage + 1, true, true)" class="icon item column page-number">{{firstCurrentPage + 2}}</a> <a class="column">...</a> <a ng-click="startSearch(currentTerm, lastCurrentPage - 1, false, false)" class="icon item column page-number">{{lastCurrentPage}}</a> <a ng-click="startSearch(currentTerm, lastCurrentPage < totalPages ? lastCurrentPage + 1 : totalPages, false, true)" class="icon item column page-number">{{!(lastCurrentPage >= totalPages) ? lastCurrentPage+2 : totalPages+1}}</a> <a ng-click="nextPage()" class="icon item column column page-number"> <span class="font-large">»</span> </a> </div> <div ng-if="totalPages <= 5 && totalPages > 0" class="eight column row center-align"> <div class="column">{{\'Page\' | translate}}: <b>{{currentPage + 1}}</b></div> <a ng-click="prevPage()" class="icon item column page-number"> <span class="font-large">«</span> </a> <a ng-repeat="p in getNumber(totalPages+1) track by $index" ng-click="startSearch(currentTerm, $index, true, false, false, lastIsDigit)" class="icon item column page-number">{{$index +1}}</a> <a ng-click="nextPage()" class="icon item column column page-number"> <span class="font-large">»</span> </a> </div> </div> \x3c!-- END PAGINATION --\x3e </div> </div> </div> </div> \x3c!-- START NEW CONTACT MODAL--\x3e <div id="new-contact" class="ui small modal"> <div class="header"> {{\'New contact\' | translate}} <i ng-click="hideModal()" class="close icon close-modal-phonebook-icon"></i> </div> <form class="ui form" ng-submit="saveContact()"> <div class="content form-content"> <div class="description"> <div class="inline fields"> <label>{{\'Privacy\' | translate}}</label> <div class="field"> <div class="ui radio checkbox {{newContactObj.favorite ? \'disabled\' : \'\'}}"> <input id="publicPrivacyRadio" type="radio" name="privacy" tabindex="0" ng-disabled="newContactObj.favorite" ng-model="newContactObj.privacy" value="public"> <label for="publicPrivacyRadio">{{\'Public\' | translate}}</label> </div> </div> <div class="field"> <div class="ui radio checkbox {{newContactObj.favorite ? \'disabled\' : \'\'}}"> <input id="privatePrivacyRadio" type="radio" name="privacy" tabindex="0" ng-disabled="newContactObj.favorite" ng-model="newContactObj.privacy" value="private"> <label for="privatePrivacyRadio">{{\'Private\' | translate}}</label> </div> </div> </div> <div ng-show="newContactObj.favorite" class="inline fields"> <label>{{\'Favorite number\' | translate}} {{newContactObj.selectPref}}</label> <div class="field"> <select ng-model="newContactObj.selectedPrefNum" class="ui dropdown"> <option value="extension">{{\'Extension\' | translate}}</option> <option value="workphone">{{\'Work phone\' | translate}}</option> <option value="homephone">{{\'Home phone\' | translate}}</option> <option value="cellphone">{{\'Cellphone\' | translate}}</option> </select> </div> </div> <h4 class="ui blue dividing header">Info</h4> <div class="{{!newContactObj.name ? \'required\' : \'\'}} field"> <label>{{\'Company\' | translate}}</label> <input ng-required="!newContactObj.name" type="text" name="company" placeholder="{{\'Company\' | translate}}" ng-model="newContactObj.company"> </div> <div class="{{!newContactObj.company ? \'required\' : \'\'}} field"> <label>{{\'Name\' | translate}}</label> <input ng-required="!newContactObj.company" type="text" name="name" placeholder="{{\'Name\' | translate}}" ng-model="newContactObj.name"> </div> <div class="{{(newContactObj.favorite && newContactObj.selectedPrefNum == \'extension\') ? \'required\' : \'\'}} field"> <label>{{\'Extension\' | translate}}</label> <input ng-required="newContactObj.favorite && newContactObj.selectedPrefNum == \'extension\'" type="tel" name="phone" placeholder="{{\'Extension\' | translate}}" ng-model="newContactObj.extension" pattern="^[0-9]*" title="{{\'It is possible to insert only numbers\' | translate}}"> </div> <div class="{{(newContactObj.favorite && newContactObj.selectedPrefNum == \'workphone\') ? \'required\' : \'\'}} field"> <label>{{\'Work phone\' | translate}}</label> <input ng-required="newContactObj.favorite && newContactObj.selectedPrefNum == \'workphone\'" type="tel" name="phone" placeholder="{{\'Work phone\' | translate}}" ng-model="newContactObj.workphone" pattern="^[0-9+]*" title="{{\'It is possible to insert only numbers or any symbols such as: +\' | translate}}"> </div> <div class="{{newContactObj.favorite && newContactObj.selectedPrefNum == \'homephone\' ? \'required\' : \'\'}} field"> <label>{{\'Home phone\' | translate}}</label> <input ng-required="newContactObj.favorite && newContactObj.selectedPrefNum == \'homephone\'" type="tel" name="phone" placeholder="{{\'Home phone\' | translate}}" ng-model="newContactObj.homephone" pattern="^[0-9+]*" title="{{\'It is possible to insert only numbers or any symbols such as: +\' | translate}}"> </div> <div class="{{newContactObj.favorite && newContactObj.selectedPrefNum == \'cellphone\' ? \'required\' : \'\'}} field"> <label>{{\'Cellphone\' | translate}}</label> <input ng-required="newContactObj.favorite && newContactObj.selectedPrefNum == \'cellphone\'" type="tel" name="cellphone" placeholder="{{\'Cellphone\' | translate}}" ng-model="newContactObj.cellphone" pattern="^[0-9+]*" title="{{\'It is possible to insert only numbers or any symbols such as: +\' | translate}}"> </div> <div class="field"> <label>{{\'Fax\' | translate}}</label> <input type="tel" name="fax" placeholder="{{\'Fax\' | translate}}" ng-model="newContactObj.fax" pattern="^[0-9+]*" title="{{\'It is possible to insert only numbers or any symbols such as: +\' | translate}}"> </div> <div class="field"> <label>{{\'Email\' | translate}}</label> <input type="email" name="email" placeholder="{{\'Email\' | translate}}" ng-model="newContactObj.workemail"> </div> <div class="field"> <label>{{\'Job\' | translate}}</label> <input type="text" name="title" placeholder="{{\'Job\' | translate}}" ng-model="newContactObj.title"> </div> <div class="field"> <label>{{\'Notes\' | translate}}</label> <textarea rows="2" name="notes" placeholder="{{\'Notes\' | translate}}" ng-model="newContactObj.notes"></textarea> </div> <h4 class="ui blue dividing header">{{"Work" | translate}}</h4> <div class="field"> <label>{{\'Address\' | translate}}</label> <input type="text" name="address" placeholder="{{\'Address\' | translate}}" ng-model="newContactObj.workstreet"> </div> <div class="field"> <label>{{\'City\' | translate}}</label> <input type="text" name="address" placeholder="{{\'City\' | translate}}" ng-model="newContactObj.workcity"> </div> <div class="field"> <label>{{\'Province\' | translate}}</label> <input type="text" name="address" placeholder="{{\'Province\' | translate}}" ng-model="newContactObj.workprovince"> </div> <div class="field"> <label>{{\'Country\' | translate}}</label> <input type="text" name="homeaddress" placeholder="{{\'Country\' | translate}}" ng-model="newContactObj.workcountry"> </div> <h4 ng-hide="newContactObj.company && !newContactObj.name" class="ui blue dividing header">{{"Home" | translate}}</h4> <div ng-hide="newContactObj.company && !newContactObj.name" class="field"> <label>{{\'Address\' | translate}}</label> <input type="text" name="homeaddress" placeholder="{{\'Address\' | translate}}" ng-model="newContactObj.homestreet"> </div> <div ng-hide="newContactObj.company && !newContactObj.name" class="field"> <label>{{\'City\' | translate}}</label> <input type="text" name="homeaddress" placeholder="{{\'City\' | translate}}" ng-model="newContactObj.homecity"> </div> <div ng-hide="newContactObj.company && !newContactObj.name" class="field"> <label>{{\'Province\' | translate}}</label> <input type="text" name="homeaddress" placeholder="{{\'Province\' | translate}}" ng-model="newContactObj.homeprovince"> </div> <div ng-hide="newContactObj.company && !newContactObj.name" class="field"> <label>{{\'Country\' | translate}}</label> <input type="text" name="homeaddress" placeholder="{{\'Country\' | translate}}" ng-model="newContactObj.homecountry"> </div> </div> </div> <div class="action-content"> <button ng-click="hideModal()" type="button" class="ui gray deny button"> {{\'Cancel\' | translate}} </button> <button type="submit" class="ui positive right labeled icon button"> {{\'Save\' | translate}} <i class="checkmark icon"></i> </button> </div> </form> </div> \x3c!-- END MODAL--\x3e \x3c!-- START DELETE CONTACT MODAL --\x3e <div id="del-contact" class="ui basic small modal"> <div class="ui icon header"> <i class="user icon"></i> {{\'Delete contact\' | translate}} </div> <div class="content"> <p class="center-align font-large">{{\'Are you sure\' | translate}}?</p> </div> <div class="actions"> <div ng-click="hideDeleteModal()" class="ui gray basic cancel inverted button"> <i class="remove icon"></i> No </div> <div ng-click="deleteContact()" class="ui red ok inverted button"> <i class="checkmark icon"></i> {{\'Yes\' | translate}} </div> </div> </div> \x3c!-- END MODAL--\x3e'),e.put("views/qmanager.html",'<div ng-show="data.viewLoad" class="ui segment adjust-segment-container"> <div class="ui active centered inline loader"></div> </div> <div ng-show="!data.viewLoad" class="ui segment adjust-segment-container"> <h3 class="ui red header title-header"> <i class="big icons qpink qpink-icon"> <i class="user icon"></i> <i class="corner users icon"></i> </i> <div class="content qpink qpink-title"> {{\'QManager\' | translate}} </div> </h3> \x3c!-- Report link  --\x3e <a ng-if="currentUser.profile.macro_permissions.qmanager.value" class="ui primary basic button" href="/pbx-report/#/queue" target="_blank"> <i class="chart bar icon"></i>{{\'Report\' | translate}} </a> <div ng-if="(queues | isempty:true) && !viewLoad" class="ui icon message"> <i class="users icon"></i> <div class="content"> <div class="header"> {{\'No queues found\' | translate}} </div> <p>{{\'There are no queues available\' | translate}}</p> </div> </div> <div id="dashboardTabsMenu" ng-hide="(queues | isempty:true) && !viewLoad" class="ui pointing secondary menu overflow-x-auto"> <a id="qmanDashboardTab" ng-click="clickedQManagerTab(\'dashboard\')" class="item {{ data.qmanagerLastTab === \'dashboard\' ? \'active\' : \'\' }}" data-tab="dashboard">{{\'Dashboard\' | translate}}</a> <a ng-click="clickedQManagerTab(\'queues\')" class="item {{ data.qmanagerLastTab === \'queues\' || data.qmanagerLastTab === \'\' ? \'active\' : \'\' }}" data-tab="queues">{{\'Queues\' | translate}}</a> <a ng-click="clickedQManagerTab(\'lostcalls\')" class="item {{ data.qmanagerLastTab === \'lostcalls\' ? \'active\' : \'\' }}">{{\'Not managed\' | translate}}</a> <a ng-click="clickedQManagerTab(\'realtime\')" class="item {{ data.qmanagerLastTab === \'realtime\' ? \'active\' : \'\' }}" data-tab="realtime">{{\'Realtime\' | translate}}</a> <a ng-click="clickedQManagerTab(\'summary\')" class="item {{ data.qmanagerLastTab === \'summary\' ? \'active\' : \'\' }}" data-tab="summary">{{\'Summary\' | translate}}</a> <a ng-click="clickedQManagerTab(\'monitor\')" class="item {{ data.qmanagerLastTab === \'monitor\' ? \'active\' : \'\' }}" data-tab="monitor">{{\'Monitor\' | translate}}</a> </div> \x3c!-- start lostcalls tab --\x3e <div id="lCQManager" ng-include="qmanagerLostcallsUrl" ng-if="data.qmanagerLastTab === \'lostcalls\'" ng-hide="queues | isempty:true" class="ui tab segment {{ data.qmanagerLastTab === \'lostcalls\' ? \'active\' : \'\' }}"> </div> \x3c!-- end lostcalls tab --\x3e \x3c!-- start dashboard tab --\x3e <div id="dashboardContainerQM" ng-if="data.qmanagerLastTab === \'dashboard\'" ng-hide="queues | isempty:true" class="ui tab segment {{ data.qmanagerLastTab === \'dashboard\' ? \'active\' : \'\' }}" data-tab="dashboard"> <div class="qm-row"> <div class="q-accordion-content"> <div class="ui grid stackable"> <div ng-if="dashboardData.alarms.status" class="stretched row"> <div class="sixteen wide tablet sixteen wide computer column"> <div class="ui segments"> <div class="ui segment no-padding-bottom pannel-title-min-dash"> <h5 class="ui left floated header ng-binding"> {{"Alarms" | translate}} </h5> <h5 class="ui right floated header"> </h5> <div class="clearfix"></div> </div> <div id="qmanAlarmsContainer" class="ui segment left aligned"> <div class="errors-queues-margins" ng-repeat="(qk, q) in dashboardData.alarms.list"> <div ng-if="type != \'ok\' && type.status != \'ok\' && queues[qk]" ng-repeat="(ktype, type) in q" class="ui red message" data-inverted="" data-tooltip="{{dashboardData.const[ktype].description | translate}}" data-position="top left"> <b>{{queues[qk].name}} ({{qk}})</b> : {{ktype | translate}} <span class="float-right"><b>{{ \'with_date_long_noUTC\' | translate:{date: type.date} }}</b></span> </div> </div> <div class="errors-queues-margins"> <div ng-if="!isAlarm()" class="ui green message"> <b>{{"No alarm present" | translate}}</b> </div> </div> </div> </div> </div> </div> <div class="row"> <div class="sixteen wide tablet four wide computer column"> <div class="ui segment left aligned"> <div class="ui statistic"> <div class="value counter">{{dashboardData.totalAll}}</div> <div class="label"> {{"Total calls" | translate}} </div> </div> <i class="phone icon chart-icon-first-color little-charts-icon"></i> </div> </div> <div class="sixteen wide tablet four wide computer column adjust-responsive-qmdashboard"> <div class="ui segment left aligned"> <div class="ui statistic"> <div class="value counter">{{dashboardData.totalAnswered}}</div> <div class="label"> {{"Answered calls" | translate}} </div> </div> <i class="microphone icon chart-icon-second-color little-charts-icon"></i> </div> </div> <div class="sixteen wide tablet four wide computer column adjust-responsive-qmdashboard"> <div class="ui segment left aligned"> <div class="ui statistic"> <div class="value"> <span class="counter">{{dashboardData.totalFailed}}</span> </div> <div class="label"> {{"Missed calls" | translate}} </div> </div> <i class="ban icon chart-icon-third-color little-charts-icon"></i> </div> </div> <div class="sixteen wide tablet four wide computer column adjust-responsive-qmdashboard"> <div class="ui segment left aligned"> <div class="ui statistic"> <div class="value counter">{{dashboardData.totalInvalid}}</div> <div class="label"> {{"Invalid calls" | translate}} </div> </div> <i class="close icon chart-icon-fourth-color little-charts-icon"></i> </div> </div> </div> <div class="row"> <div class="column"> <div class="ui segments no-padding"> <div class="ui segment basic no-padding-bottom"> <h5 class="ui left floated header"> {{"Calls hourly distribution" | translate}} </h5> </div> <div class="ui basic segment"> <div id="qmanDashLineChart1" class="britechart js-line-chart-container card--chart"></div> </div> </div> </div> </div> <div class="row"> <div class="column"> <div class="ui segments no-padding"> <div class="ui segment basic no-padding-bottom"> <h5 class="ui left floated header"> {{"Hourly distribution of call outcome" | translate}} </h5> </div> <div class="ui basic segment"> <div id="qmanStackedBar" class="britechart js-line-chart-container card--chart"></div> </div> </div> </div> </div> <div class="stretched row"> <div class="sixteen wide tablet six wide computer column"> <div class="ui segments bb-qm-dash-teal"> <div class="ui segment no-padding-bottom pannel-title-min-dash"> <h5 class="ui left floated header"> {{"Answered calls" | translate}} ({{dashboardData.orderStatusAsc[\'agentsAnswered\'] ? \'last\' : \'first\' | translate}}) </h5> <h5 class="ui right floated header"> <span data-tooltip="{{\'Show\' | translate}} {{dashboardData.orderStatusAsc[\'agentsAnswered\'] ? \'first\' : \'last\' | translate}}" data-position="top right"> <i ng-click="setOrderStatusAsc(\'agentsAnswered\')" class="arrow alternate circle {{dashboardData.orderStatusAsc[\'agentsAnswered\'] ? \'up\' : \'down\'}} icon color-qm-dash-teal pointer"></i> </span> <span data-tooltip="{{\'Ranking agents for answered calls per queue\' | translate}}" data-position="top right"> <i class="info circle icon"></i> </span> </h5> <div class="clearfix"></div> </div> <div class="ui segment left aligned"> <table class="ui very basic center aligned celled table qman-dash-tables-large"> <thead> <tr> <th>#</th> <th>{{"Name" | translate}}</th> <th>{{"Calls" | translate}}</th> </tr> </thead> <tbody> <tr ng-if="$index < 5" ng-repeat="agent in dashboardData.agentsAnswered track by $index"> <td>{{$index + 1}} <i ng-if="$index <= 2" class="icon trophy truphy-icon middle-margin-left-qmtable {{$index == 0 ? \'trophy-gold\' : $index == 1 ? \'trophy-silver\' : $index == 2 ? \'trophy-bronze\' : \'\'}}"></i></td> <td data-tooltip="{{queues[agent.queue].name}} ({{agent.queue}})" data-position="top center">{{agent.name}}</td> <td>{{agent.value}}</td> </tr> </tbody> </table> <div class="ui inverted dimmer"> <div class="ui text loader">Loading</div> </div> </div> </div> </div> <div class="sixteen wide tablet five wide computer column adjust-responsive-qmdashboard"> <div class="ui segments bb-qm-light-blue"> <div class="ui segment no-padding-bottom pannel-title-min-dash"> <h5 class="ui left floated header"> {{"Missed calls" | translate}} ({{dashboardData.orderStatusAsc[\'agentsLost\'] ? \'last\' : \'first\' | translate}}) </h5> <h5 class="ui right floated header"> <span data-tooltip="{{\'Show\' | translate}} {{dashboardData.orderStatusAsc[\'agentsLost\'] ? \'first\' : \'last\' | translate}}" data-position="top right"> <i ng-click="setOrderStatusAsc(\'agentsLost\')" class="arrow alternate circle {{dashboardData.orderStatusAsc[\'agentsLost\'] ? \'up\' : \'down\'}} icon color-qm-light-blue pointer"></i> </span> <span data-tooltip="{{\'Ranking agents for missed calls per queue\' | translate}}" data-position="top right"> <i class="info circle icon"></i> </span> </h5> <div class="clearfix"></div> </div> <div class="ui segment left aligned"> <table class="ui very basic center aligned celled table qman-dash-tables-middle"> <thead> <tr> <th>#</th> <th>{{"Name" | translate}}</th> <th>{{"Calls" | translate}}</th> </tr> </thead> <tbody> <tr ng-if="$index < 5" ng-repeat="agent in dashboardData.agentsLost track by $index"> <td>{{$index + 1}} <i ng-if="$index <= 2" class="icon trophy truphy-icon middle-margin-left-qmtable {{$index == 0 ? \'trophy-gold\' : $index == 1 ? \'trophy-silver\' : $index == 2 ? \'trophy-bronze\' : \'\'}}"></i></td> <td data-tooltip="{{queues[agent.queue].name}} ({{agent.queue}})" data-position="top center">{{agent.name}}</td> <td>{{agent.value}}</td> </tr> </tbody> </table> <div class="ui inverted dimmer"> <div class="ui text loader">Loading</div> </div> </div> </div> </div> <div class="sixteen wide tablet five wide computer column adjust-responsive-qmdashboard"> <div class="ui segments bb-qm-dash-blue"> <div class="ui segment no-padding-bottom pannel-title-min-dash"> <h5 class="ui left floated header"> {{"Pause on logon percentage" | translate}} ({{dashboardData.orderStatusAsc[\'agentsPauseOnLogon\'] ? \'last\' : \'first\' | translate}}) </h5> <h5 class="ui right floated header"> <span data-tooltip="{{\'Show\' | translate}} {{dashboardData.orderStatusAsc[\'agentsPauseOnLogon\'] ? \'first\' : \'last\' | translate}}" data-position="top right"> <i ng-click="setOrderStatusAsc(\'agentsPauseOnLogon\')" class="arrow alternate circle {{dashboardData.orderStatusAsc[\'agentsPauseOnLogon\'] ? \'up\' : \'down\'}} icon color-qm-dash-blue pointer"></i> </span> <span data-tooltip="{{\'Ranking agents for percentage of pause on logon per queue\' | translate}}" data-position="top right"> <i class="info circle icon"></i> </span> </h5> <div class="clearfix"></div> </div> <div class="ui segment left aligned"> <table class="ui very basic center aligned celled table qman-dash-tables-middle"> <thead> <tr> <th>#</th> <th>{{"Name" | translate}}</th> <th>{{"Percentage" | translate}}</th> </tr> </thead> <tbody> <tr ng-if="$index < 5" ng-repeat="agent in dashboardData.agentsPauseOnLogon track by $index"> <td>{{$index + 1}} <i ng-if="$index <= 2" class="icon trophy truphy-icon middle-margin-left-qmtable {{$index == 0 ? \'trophy-gold\' : $index == 1 ? \'trophy-silver\' : $index == 2 ? \'trophy-bronze\' : \'\'}}"></i></td> <td data-tooltip="{{queues[agent.queue].name}} ({{agent.queue}})" data-position="top center">{{agent.name}}</td> <td>{{agent.value}}%</td> </tr> </tbody> </table> <div class="ui inverted dimmer"> <div class="ui text loader">Loading</div> </div> </div> </div> </div> </div> <div class="stretched row"> <div class="sixteen wide tablet six wide computer column"> <div class="ui segments bb-qm-dash-violet"> <div class="ui segment no-padding-bottom pannel-title-min-dash"> <h5 class="ui left floated header"> {{"Login time" | translate}} ({{dashboardData.orderStatusAsc[\'agentsLoginTime\'] ? \'last\' : \'first\' | translate}}) </h5> <h5 class="ui right floated header"> <span data-tooltip="{{\'Show\' | translate}} {{dashboardData.orderStatusAsc[\'agentsLoginTime\'] ? \'first\' : \'last\' | translate}}" data-position="top right"> <i ng-click="setOrderStatusAsc(\'agentsLoginTime\')" class="arrow alternate circle {{dashboardData.orderStatusAsc[\'agentsLoginTime\'] ? \'up\' : \'down\'}} icon color-qm-dash-violet pointer"></i> </span> <span data-tooltip="{{\'Ranking agents for login time per queue\' | translate}}" data-position="top right"> <i class="info circle icon"></i> </span> </h5> <div class="clearfix"></div> </div> <div class="ui segment left aligned"> <table class="ui very basic center aligned celled table qman-dash-tables-middle"> <thead> <tr> <th>#</th> <th>{{"Name" | translate}}</th> <th>{{"Time" | translate}}</th> </tr> </thead> <tbody> <tr ng-if="$index < 5" ng-repeat="agent in dashboardData.agentsLoginTime track by $index"> <td>{{$index + 1}} <i ng-if="$index <= 2" class="icon trophy truphy-icon small-margin-left-qmtable {{$index == 0 ? \'trophy-gold\' : $index == 1 ? \'trophy-silver\' : $index == 2 ? \'trophy-bronze\' : \'\'}}"></i></td> <td data-tooltip="{{queues[agent.queue].name}} ({{agent.queue}})" data-position="top center">{{agent.name}}</td> <td>{{agent.value | secondsToReadable}}</td> </tr> </tbody> </table> <div class="ui inverted dimmer"> <div class="ui text loader">Loading</div> </div> </div> </div> </div> <div class="sixteen wide tablet five wide computer column adjust-responsive-qmdashboard"> <div class="ui segments bb-qm-dash-red"> <div class="ui segment no-padding-bottom pannel-title-min-dash"> <h5 class="ui left floated header"> {{"Pause time" | translate}} ({{dashboardData.orderStatusAsc[\'agentsPauseTime\'] ? \'last\' : \'first\' | translate}}) </h5> <h5 class="ui right floated header"> <span data-tooltip="{{\'Show\' | translate}} {{dashboardData.orderStatusAsc[\'agentsPauseTime\'] ? \'first\' : \'last\' | translate}}" data-position="top right"> <i ng-click="setOrderStatusAsc(\'agentsPauseTime\')" class="arrow alternate circle {{dashboardData.orderStatusAsc[\'agentsPauseTime\'] ? \'up\' : \'down\'}} icon color-qm-dash-red pointer"></i> </span> <span data-tooltip="{{\'Ranking agents for pause time per queue\' | translate}}" data-position="top right"> <i class="info circle icon"></i> </span> </h5> <div class="clearfix"></div> </div> <div class="ui segment left aligned"> <table class="ui very basic center aligned celled table qman-dash-tables-middle"> <thead> <tr> <th>#</th> <th>{{"Name" | translate}}</th> <th>{{"Time" | translate}}</th> </tr> </thead> <tbody> <tr ng-if="$index < 5" ng-repeat="agent in dashboardData.agentsPauseTime track by $index"> <td>{{$index + 1}} <i ng-if="$index <= 2" class="icon trophy truphy-icon small-margin-left-qmtable {{$index == 0 ? \'trophy-gold\' : $index == 1 ? \'trophy-silver\' : $index == 2 ? \'trophy-bronze\' : \'\'}}"></i></td> <td data-tooltip="{{queues[agent.queue].name}} ({{agent.queue}})" data-position="top center">{{agent.name}}</td> <td>{{agent.value | secondsToReadable}}</td> </tr> </tbody> </table> <div class="ui inverted dimmer"> <div class="ui text loader">Loading</div> </div> </div> </div> </div> <div class="sixteen wide tablet five wide computer column adjust-responsive-qmdashboard"> <div class="ui segments bb-qm-dash-orange"> <div class="ui segment no-padding-bottom pannel-title-min-dash"> <h5 class="ui left floated header"> {{"In call percentage" | translate}} ({{dashboardData.orderStatusAsc[\'inCallPercentage\'] ? \'last\' : \'first\' | translate}}) </h5> <h5 class="ui right floated header"> <span data-tooltip="{{\'Show\' | translate}} {{dashboardData.orderStatusAsc[\'inCallPercentage\'] ? \'first\' : \'last\' | translate}}" data-position="top right"> <i ng-click="setOrderStatusAsc(\'inCallPercentage\')" class="arrow alternate circle {{dashboardData.orderStatusAsc[\'inCallPercentage\'] ? \'up\' : \'down\'}} icon color-qm-dash-orange pointer"></i> </span> <span data-tooltip="{{\'Ranking agents for percentage in calls per queue\' | translate}}" data-position="top right"> <i class="info circle icon"></i> </span> </h5> <div class="clearfix"></div> </div> <div class="ui segment left aligned"> <table class="ui very basic center aligned celled table qman-dash-tables-middle"> <thead> <tr> <th>#</th> <th>{{"Name" | translate}}</th> <th>{{"Percentage" | translate}}</th> </tr> </thead> <tbody> <tr ng-if="$index < 5" ng-repeat="agent in dashboardData.inCallPercentage track by $index"> <td>{{$index + 1}} <i ng-if="$index <= 2" class="icon trophy truphy-icon middle-margin-left-qmtable {{$index == 0 ? \'trophy-gold\' : $index == 1 ? \'trophy-silver\' : $index == 2 ? \'trophy-bronze\' : \'\'}}"></i></td> <td data-tooltip="{{queues[agent.queue].name}} ({{agent.queue}})" data-position="top center">{{agent.name}}</td> <td>{{agent.value}}%</td> </tr> </tbody> </table> <div class="ui inverted dimmer"> <div class="ui text loader">Loading</div> </div> </div> </div> </div> </div> <div class="row"> <div class="sixteen wide tablet sixteen wide computer column"> <div class="ui segments"> <div class="ui segment no-padding-bottom pannel-title-min-dash"> <h5 class="ui left floated header"> {{"Answered calls hourly distribution" | translate}} </h5> <h5 class="ui right floated header"> <span data-tooltip="{{\'Show\' | translate}} {{dashboardData.orderStatusAsc[\'queuesAnswered\'] ? \'first\' : \'last\' | translate}}" data-position="top right"> <i ng-click="setOrderStatusAsc(\'queuesAnswered\')" class="arrow alternate circle {{dashboardData.orderStatusAsc[\'queuesAnswered\'] ? \'up\' : \'down\'}} icon pointer"></i> </span> <span data-tooltip="{{\'Ranking queues for answered calls\' | translate}}" data-position="top right"> <i class="info circle icon"></i> </span> </h5> <div class="clearfix"></div> </div> <div class="ui segment"> <div class="ui grid"> <div class="stretched row"> <div class="sixteen wide tablet ten wide computer column"> <div id="js-stacked-area-chart-tooltip-container" class="britechart js-stacked-area-chart-tooltip-container card--chart"></div> </div> <div class="sixteen wide tablet six wide computer column"> <div class="ui horizontal large statistic"> <div class="value counter">{{dashboardData.answeredAverage}}</div> <div class="label"> {{"Average per hour" | translate}} </div> </div> <table class="ui celled striped table qman-dash-tables-middle"> <thead> <tr> <th style="width:5%" class="center-align">#</th> <th style="width:40%" class="center-align">{{"Queue" | translate}}</th> <th style="width:25%" class="center-align">{{"Calls" | translate}}</th> </tr> </thead> <tbody> <tr ng-repeat="queue in dashboardData.queuesAnswered track by $index"> <td class="center-align">{{$index + 1}} <i ng-if="$index <= 2" class="icon trophy truphy-icon custom1-margin-left-qmtable {{$index == 0 ? \'trophy-gold\' : $index == 1 ? \'trophy-silver\' : $index == 2 ? \'trophy-bronze\' : \'\'}}"></i></td> <td class="center-align">{{queue.name}} ({{queue.queue}})</td> <td class="center-align">{{queue.value}}</td> </tr> </tbody> </table> </div> </div> </div> </div> </div> </div> </div> <div class="stretched row"> <div class="sixteen wide tablet eight wide computer column"> <div class="ui segments bb-qm-dash-blue"> <div class="ui segment no-padding-bottom pannel-title-min-dash"> <h5 class="ui left floated header"> {{"Total calls" | translate}} ({{dashboardData.orderStatusAsc[\'queuesTotalCalls\'] ? \'last\' : \'first\' | translate}}) </h5> <h5 class="ui right floated header"> <span data-tooltip="{{\'Show\' | translate}} {{dashboardData.orderStatusAsc[\'queuesTotalCalls\'] ? \'first\' : \'last\' | translate}}" data-position="top right"> <i ng-click="setOrderStatusAsc(\'queuesTotalCalls\')" class="arrow alternate circle {{dashboardData.orderStatusAsc[\'queuesTotalCalls\'] ? \'up\' : \'down\'}} color-qm-light-blue icon pointer"></i> </span> <span data-tooltip="{{\'Ranking queues for total calls\' | translate}}" data-position="top right"> <i class="info circle icon"></i> </span> </h5> <div class="clearfix"></div> </div> <div class="ui segment left aligned"> <table class="ui very basic center aligned celled table qman-dash-tables-middle"> <thead> <tr> <th>#</th> <th>{{"Queue" | translate}}</th> <th>{{"Calls" | translate}}</th> </tr> </thead> <tbody> <tr ng-repeat="queue in dashboardData.queuesTotalCalls track by $index"> <td>{{$index + 1}} <i ng-if="$index <= 2" class="icon trophy truphy-icon large-margin-left-qmtable {{$index == 0 ? \'trophy-gold\' : $index == 1 ? \'trophy-silver\' : $index == 2 ? \'trophy-bronze\' : \'\'}}"></i></td> <td>{{queue.name}} ({{queue.queue}})</td> <td>{{queue.value}}</td> </tr> </tbody> </table> <div class="ui inverted dimmer"> <div class="ui text loader">Loading</div> </div> </div> </div> </div> <div class="sixteen wide tablet eight wide computer column adjust-responsive-qmdashboard"> <div class="ui segments bb-qm-light-blue"> <div class="ui segment no-padding-bottom pannel-title-min-dash"> <h5 class="ui left floated header"> {{"Missed calls" | translate}} ({{dashboardData.orderStatusAsc[\'queuesFailedCalls\'] ? \'last\' : \'first\' | translate}}) </h5> <h5 class="ui right floated header"> <span data-tooltip="{{\'Show\' | translate}} {{dashboardData.orderStatusAsc[\'queuesFailedCalls\'] ? \'first\' : \'last\' | translate}}" data-position="top right"> <i ng-click="setOrderStatusAsc(\'queuesFailedCalls\')" class="arrow alternate circle {{dashboardData.orderStatusAsc[\'queuesFailedCalls\'] ? \'up\' : \'down\'}} color-qm-light-blue icon pointer"></i> </span> <span data-tooltip="{{\'Ranking queues for missed calls\' | translate}}" data-position="top right"> <i class="info circle icon"></i> </span> </h5> <div class="clearfix"></div> </div> <div class="ui segment left aligned"> <table class="ui very basic center aligned celled table qman-dash-tables-middle"> <thead> <tr> <th>#</th> <th>{{"Queue" | translate}}</th> <th>{{"Calls" | translate}}</th> </tr> </thead> <tbody> <tr ng-repeat="queue in dashboardData.queuesFailedCalls track by $index"> <td>{{$index + 1}} <i ng-if="$index <= 2" class="icon trophy truphy-icon middle-margin-left-qmtable {{$index == 0 ? \'trophy-gold\' : $index == 1 ? \'trophy-silver\' : $index == 2 ? \'trophy-bronze\' : \'\'}}"></i></td> <td>{{queue.name}} ({{queue.queue}})</td> <td>{{queue.value}}</td> </tr> </tbody> </table> <div class="ui inverted dimmer"> <div class="ui text loader">Loading</div> </div> </div> </div> </div> </div> <div class="stretched row"> <div class="sixteen wide tablet eight wide computer column"> <div class="ui segments bb-qm-dash-red"> <div class="ui segment no-padding-bottom pannel-title-min-dash"> <h5 class="ui left floated header"> {{"Invalid calls" | translate}} ({{dashboardData.orderStatusAsc[\'queuesInvalidCalls\'] ? \'last\' : \'first\' | translate}}) </h5> <h5 class="ui right floated header"> <span data-tooltip="{{\'Show\' | translate}} {{dashboardData.orderStatusAsc[\'queuesInvalidCalls\'] ? \'first\' : \'last\' | translate}}" data-position="top right"> <i ng-click="setOrderStatusAsc(\'queuesInvalidCalls\')" class="arrow alternate circle {{dashboardData.orderStatusAsc[\'queuesInvalidCalls\'] ? \'up\' : \'down\'}} color-qm-dash-red icon pointer"></i> </span> <span data-tooltip="{{\'Ranking queues for invalid calls\' | translate}}" data-position="top right"> <i class="info circle icon"></i> </span> </h5> <div class="clearfix"></div> </div> <div class="ui segment left aligned"> <table class="ui very basic center aligned celled table qman-dash-tables-middle"> <thead> <tr> <th>#</th> <th>{{"Queue" | translate}}</th> <th>{{"Calls" | translate}}</th> </tr> </thead> <tbody> <tr ng-repeat="queue in dashboardData.queuesInvalidCalls track by $index"> <td>{{$index + 1}} <i ng-if="$index <= 2" class="icon trophy truphy-icon middle-margin-left-qmtable {{$index == 0 ? \'trophy-gold\' : $index == 1 ? \'trophy-silver\' : $index == 2 ? \'trophy-bronze\' : \'\'}}"></i></td> <td>{{queue.name}} ({{queue.queue}})</td> <td>{{queue.value}}</td> </tr> </tbody> </table> <div class="ui inverted dimmer"> <div class="ui text loader">Loading</div> </div> </div> </div> </div> <div class="sixteen wide tablet eight wide computer column adjust-responsive-qmdashboard"> <div class="ui segments bb-qm-dash-violet"> <div class="ui segment no-padding-bottom pannel-title-min-dash"> <h5 class="ui left floated header"> {{"Queues for missed call reasons" | translate}} ({{dashboardData.orderStatusAsc[\'queuesFailures\'] ? \'last\' : \'first\' | translate}}) </h5> <h5 class="ui right floated header"> <span data-tooltip="{{\'Show\' | translate}} {{dashboardData.orderStatusAsc[\'queuesFailures\'] ? \'first\' : \'last\' | translate}}" data-position="top right"> <i ng-click="setOrderStatusAsc(\'queuesFailures\')" class="arrow alternate circle {{dashboardData.orderStatusAsc[\'queuesFailures\'] ? \'up\' : \'down\'}} color-qm-dash-violet icon pointer"></i> </span> <span data-tooltip="{{\'Ranking queues for missed call reasons\' | translate}}" data-position="top right"> <i class="info circle icon"></i> </span> </h5> <div class="clearfix"></div> </div> <div class="ui segment left aligned"> <table class="ui very basic center aligned celled table qman-dash-tables-middle"> <thead> <tr> <th>#</th> <th>{{"Queue" | translate}}</th> <th>{{"Calls" | translate}}</th> </tr> </thead> <tbody> <tr ng-if="$index < 5" ng-repeat="queue in dashboardData.queuesFailures track by $index"> <td>{{$index + 1}} <i ng-if="$index <= 2" class="icon trophy truphy-icon large-margin-left-qmtable {{$index == 0 ? \'trophy-gold\' : $index == 1 ? \'trophy-silver\' : $index == 2 ? \'trophy-bronze\' : \'\'}}"></i></td> <td data-tooltip="{{queue.note | translate}}" data-position="top center">{{queue.name}} ({{queue.queue}})</td> <td>{{queue.value}}</td> </tr> </tbody> </table> <div class="ui inverted dimmer"> <div class="ui text loader">Loading</div> </div> </div> </div> </div> </div> <div class="stretched row"> <div class="sixteen wide tablet eight wide computer column"> <div class="ui segments bb-qm-dash-green"> <div class="ui segment no-padding-bottom pannel-title-min-dash"> <h5 class="ui left floated header"> {{"Average recall time for agent" | translate}} ({{agentsRecallTimeOrder ? \'last\' : \'first\' | translate}}) </h5> <h5 class="ui right floated header"> <span data-tooltip="{{\'Show\' | translate}} {{agentsRecallTimeOrder ? \'first\' : \'last\' | translate}}" data-position="top right"> <i ng-click="orderRecallTimeAgents(agentsRecallTimeOrder ? \'asc\' : \'desc\')" class="arrow alternate circle {{agentsRecallTimeOrder ? \'down\' : \'up\'}} color-qm-dash-red icon pointer"></i> </span> <span data-tooltip="{{\'Average recall time for each agent in all queues\' | translate}}" data-position="top right"> <i class="info circle icon"></i> </span> </h5> <div class="clearfix"></div> </div> <div class="ui segment left aligned"> <table class="ui very basic center aligned celled table qman-dash-tables-middle"> <thead> <tr> <th>#</th> <th>{{"Agent" | translate}}</th> <th>{{"Average recall time" | translate}}</th> </tr> </thead> <tbody> <tr ng-repeat="(a, agent) in dashboardData.agentsRecallTime track by $index | limitTo : recallLimit"> <td>{{$index + 1}} <i ng-if="$index <= 2" class="icon trophy truphy-icon middle-margin-left-qmtable {{$index == 0 ? \'trophy-gold\' : $index == 1 ? \'trophy-silver\' : $index == 2 ? \'trophy-bronze\' : \'\'}}"></i></td> <td>{{a}}</td> <td>{{agent.allQueues.avg_recall_time | secondsToReadable}}</td> </tr> </tbody> </table> <div class="ui inverted dimmer"> <div class="ui text loader">Loading</div> </div> </div> </div> </div> <div class="sixteen wide tablet eight wide computer column adjust-responsive-qmdashboard"> <div class="ui segments bb-qm-dash-yellow"> <div class="ui segment no-padding-bottom pannel-title-min-dash"> <h5 class="ui left floated header"> {{"Average recall time for queue" | translate}} ({{queuesRecallTimeOrder ? \'last\' : \'first\' | translate}}) </h5> <h5 class="ui right floated header"> <span data-tooltip="{{\'Show\' | translate}} {{queuesRecallTimeOrder ? \'first\' : \'last\' | translate}}" data-position="top right"> <i ng-click="orderRecallTimeQueues(queuesRecallTimeOrder ? \'asc\' : \'desc\')" class="arrow alternate circle {{queuesRecallTimeOrder ? \'up\' : \'down\'}} color-qm-dash-violet icon pointer"></i> </span> <span data-tooltip="{{\'Average recall time for each queue\' | translate}}" data-position="top right"> <i class="info circle icon"></i> </span> </h5> <div class="clearfix"></div> </div> <div class="ui segment left aligned"> <table class="ui very basic center aligned celled table qman-dash-tables-middle"> <thead> <tr> <th>#</th> <th>{{"Queue" | translate}}</th> <th>{{"Average recall time" | translate}}</th> </tr> </thead> <tbody> <tr ng-repeat="(q, queue) in dashboardData.queuesRecallTime track by $index | limitTo : recallLimit"> <td>{{$index + 1}} <i ng-if="$index <= 2" class="icon trophy truphy-icon large-margin-left-qmtable {{$index == 0 ? \'trophy-gold\' : $index == 1 ? \'trophy-silver\' : $index == 2 ? \'trophy-bronze\' : \'\'}}"></i></td> <td>{{queues[queue.queue].name}} ({{queue.queue}})</td> <td>{{queue.avg_recall_time | secondsToReadable}}</td> </tr> </tbody> </table> <div class="ui inverted dimmer"> <div class="ui text loader">Loading</div> </div> </div> </div> </div> </div> <div class="row"> <div class="column"> <div class="ui segments no-padding"> <div class="ui segment basic no-padding-bottom"> <h5 class="ui left floated header"> {{"Missed calls hourly distribution" | translate}} </h5> </div> <div class="ui basic segment"> \x3c!-- <div style="width: 100%; height: 200px; padding: 0px; position: relative;" class="bar-container">\n                    </div> --\x3e <div id="qmanDashLineChart2" class="britechart js-line-chart-container card--chart"></div> </div> </div> </div> </div> </div> </div> </div> </div> \x3c!-- start monitor tab --\x3e <div ng-if="data.qmanagerLastTab === \'monitor\'" ng-hide="queues | isempty:true" class="ui tab segment {{ data.qmanagerLastTab === \'monitor\' ? \'active\' : \'\' }}" data-tab="monitor"> <div class="qm-row"> <div class="q-accordion-content"> <div id="header-summary-queues"> <div class="ui items"> <div class="item"> <div class="extra"> <div ng-repeat="(k, q) in queues" class="ui toggle checkbox qcheckqman checked"> <input name="public" type="checkbox" ng-click="setFilterMonitorQueues(k)" checked ng-model="data.hsMonitorQueues[k]"> <label>{{q.name}} ({{k}})</label> </div> </div> </div> </div> <div class="top-thirteen"> <div class="inline-block text-label"> {{"Calls to display" | translate}}: </div> <select id="monitorDropdown" ng-change="setMonitorRowsNumber(data.monitorRowsValue)" ng-model="data.monitorRowsValue" class="ui dropdown"> <option ng-repeat="n in getNumber(20)" value="{{n + 1}}">{{n + 1}}</option> </select> </div> </div> <div class="ui stackable two column grid q-accordion-content"> <div ng-show="allMonitorQsDisabled" class="ui message large-margin-top full-width"> <div class="header"> {{\'No queue enabled\' | translate}} </div> </div> <div id="queueMonitorTContainer-{{qid}}" ng-if="bol === true" ng-repeat="(qid, bol) in data.hsMonitorQueues track by qid" class="eight wide column"> <div class="ui segments"> <div class="ui segment"> <h5 class="ui header font-medium"> {{queues[qid].name}} ({{qid}}) <i ng-click="invertQueueMonitorColor(qid)" class="icon-monitor-queue-header adjust icon float-right" title="{{\'Invert\' | translate}}" aria-hidden="true"></i> </h5> </div> <div class="ui segment overflow-x-auto"> <table class="ui celled padded table font-medium"> <thead> <tr> <th class="single line col-max-width"></th> <th>{{"Caller" | translate}}</th> <th>{{"Position" | translate}}</th> <th>{{"Wait" | translate}}</th> </tr> </thead> <tbody> <tr ng-repeat="i in getNumber(data.monitorRowsValue) track by $index"> <td> <h2 class="ui center aligned header monitor-circles {{ queues[qid].waitingCallersArray[$index].name && data.monitorInverted[qid] ? \'monitor-circle-red-inverted\' : queues[qid].waitingCallersArray[$index].name && !data.monitorInverted[qid] ? \'monitor-circle-red\' : !queues[qid].waitingCallersArray[$index].name && data.monitorInverted[qid] ? \'monitor-circle-green-inverted\' : !queues[qid].waitingCallersArray[$index].name && !data.monitorInverted[qid] ? \'monitor-circle-green\' : \'\' }}"></h2> </td> <td class="single line">{{queues[qid].waitingCallersArray[$index].name}}</td> <td class="left aligned">{{queues[qid].waitingCallersArray[$index].position}}<br> </td> <td class="left aligned"> <span chrono-timer timer-name="myTimer" start-time="queues[qid].waitingCallersArray[$index].waitingTime ? queues[qid].waitingCallersArray[$index].waitingTime + clientServerTimeDiff : \'\'">{{hours|zeropad}}:{{minutes|zeropad}}:{{seconds|zeropad}}</span><br> </td> </tr> </tbody> </table> </div> </div> </div> </div> </div> </div> </div> \x3c!-- start summary tab --\x3e <div ng-if="data.qmanagerLastTab === \'summary\'" ng-hide="queues | isempty:true" class="ui tab segment {{ data.qmanagerLastTab === \'summary\' ? \'active\' : \'\' }}" data-tab="summary"> <div class="qm-row"> <div id="qm-accordion-queues-summary" class="qaccordion"> <h3 class="q-accordion-title">{{\'Queues summary\' | translate}}</h3> <div class="q-accordion-content multiple-charts-container-summary"> <div id="header-summary-queues"> <div class="ui items"> <div class="item"> <div class="extra"> <div ng-repeat="(k, q) in queues" class="ui toggle checkbox qcheckqman checked"> <input name="public" type="checkbox" ng-click="setFilterSummaryQueues(k)" checked ng-model="data.hsQueuesVal[k]"> <label>{{q.name}} ({{k}})</label> </div> </div> </div> </div> </div> <div ng-if="allQsDisabled" class="ui message extra-large-margin-top"> <div class="header"> {{\'No queue enabled\' | translate}} </div> </div> <div ng-hide="allQsDisabled" class="ui stackable three column grid"> <div class="five wide column graph-containers"> <h4 id="timingHeader" class="ui top attached header"> {{"Total calls" | translate}} <span class="info-icon float-right" data-tooltip="{{\'Number of entered calls for every queue and percentage on total calls\' | translate}}" data-position="left center"> <i class="info circle info-icon-color no-margin-right icon link"></i> </span> </h4> <div id="containerEnteredCalls" class="ui attached segment border-bottom-radius"> <div class="container-svg-chart" id="container-enteredcalls-summary-chart"></div> </div> </div> <div class="five wide column graph-containers"> <h4 id="timingHeader" class="ui top attached header"> {{"Processed calls" | translate}} <span class="info-icon float-right" data-tooltip="{{\'Number of processed calls for every queue and percentage on queue total calls\' | translate}}" data-position="left center"> <i class="info circle info-icon-color no-margin-right icon link"></i> </span> </h4> <div id="containerProcessedCalls" class="ui attached segment border-bottom-radius"> <div class="container-svg-chart container-calls-summary-charts" id="container-processed-calls-summary"></div> </div> </div> <div class="five wide column graph-containers"> <h4 id="timingHeader" class="ui top attached header"> {{"Processed calls before service level" | translate}} <span class="info-icon float-right" data-tooltip="{{\'Number of processed calls before service level for every queue and percentage on queue total entered calls\' | translate}}" data-position="left center"> <i class="info circle info-icon-color no-margin-right icon link"></i> </span> </h4> <div id="containerProcessedBsLevelCalls" class="ui attached segment border-bottom-radius"> <div class="container-svg-chart container-calls-summary-charts" id="container-processedbslevel-calls-summary"></div> </div> </div> </div> <div ng-hide="allQsDisabled" class="ui stackable three column grid"> <div class="ten wide column no-padding"> <div class="ui stackable two column grid"> <div class="eight wide column graph-containers"> <h4 id="timingHeader" class="ui top attached header"> {{"Failed calls" | translate}} <span class="info-icon float-right" data-tooltip="{{\'Number of failed calls for every queue and percentage on queue total entered calls\' | translate}}" data-position="left center"> <i class="info circle info-icon-color no-margin-right icon link"></i> </span> </h4> <div id="containerFailedCalls" class="ui attached segment border-bottom-radius"> <div class="container-svg-chart container-calls-summary-charts" id="container-failed-calls-summary"></div> </div> </div> <div class="eight wide column graph-containers"> <h4 id="timingHeader" class="ui top attached header"> {{"Invalid calls" | translate}} <span class="info-icon float-right" data-tooltip="{{\'Number of invalid calls for every queue and percentage on queue total entered calls\' | translate}}" data-position="left center"> <i class="info circle info-icon-color no-margin-right icon link"></i> </span> </h4> <div id="containerInvalidCalls" class="ui attached segment border-bottom-radius"> <div class="container-svg-chart container-calls-summary-charts" id="container-invalid-calls-summary"></div> </div> </div> </div> <div class="ui stackable two column grid"> <div class="eight wide column graph-containers"> <h4 id="timingHeader" class="ui top attached header"> {{"Waiting calls" | translate}} <span class="info-icon float-right" data-tooltip="{{\'Waiting calls minimum, average and maximum duration for every queue\' | translate}}" data-position="left center"> <i class="info circle info-icon-color no-margin-right icon link"></i> </span> </h4> <div id="containerWaitingCalls" class="ui attached segment border-bottom-radius"> <div class="container-svg-chart container-calls-summary-charts" id="container-waiting-calls-summary"></div> </div> </div> <div class="eight wide column graph-containers"> <h4 id="timingHeader" class="ui top attached header"> {{"Calls duration" | translate}} <span class="info-icon float-right" data-tooltip="{{\'Calls duration minimum, average and maximum for every queue\' | translate}}" data-position="left center"> <i class="info circle info-icon-color no-margin-right icon link"></i> </span> </h4> <div id="containerFailedCalls" class="ui attached segment border-bottom-radius"> <div class="container-svg-chart container-calls-summary-charts" id="container-duration-calls-summary"></div> </div> </div> </div> </div> <div class="five wide column graph-containers"> <div class="five wide column"> <h4 id="timingHeader" class="ui top attached header"> {{"Failed call reasons" | translate}} <span class="info-icon float-right" data-tooltip="{{\'Failed calls for reasons: abandon, full, timeout, nobody at the entrance, no agent and with ivr for every queue\' | translate}}" data-position="left center"> <i class="info circle info-icon-color no-margin-right icon link"></i> </span> </h4> <div id="containerFailedFirstCalls" class="ui attached segment border-bottom-radius"> <div ng-show="data.failedReasons" class="container-svg-chart container-calls-summary-charts" id="container-failedfirst-calls-summary"></div> <div ng-show="!data.failedReasons">{{\'No failed calls\' | translate}}</div> </div> </div> <div class="five wide column mt-42"> <h4 id="recallTimeHeader" class="ui top attached header"> {{"Recall time" | translate}} <span class="info-icon float-right" data-tooltip="{{\'Recall time\' | translate}}" data-position="left center"> <i class="info circle info-icon-color no-margin-right icon link"></i> </span> </h4> <div id="containerRecallTimeChart" class="ui attached segment border-bottom-radius"> <div ng-show="recallTimeGraphReady" class="container-svg-chart container-calls-summary-charts" id="containerRecallTimeChartInset"></div> <div ng-show="!recallTimeGraphReady">{{\'No recall time data\' | translate}}</div> </div> </div> </div> </div> </div> </div> </div> <div class="qm-row no-margin-bottom"> <div id="qm-accordion-agents-summary" class="qaccordion"> <h3 class="q-accordion-title">{{\'Agents summary\' | translate}}</h3> <div class="q-accordion-content"> <form class="left-form-padding"> <div class="ui form"> <div class="inline fields"> <div class="field small-margin-bottom medium-margin-top"> <div class="ui icon input"> <input ng-model="data.summaryAgentFilterText" type="text" placeholder="{{\'Search\' | translate}}..."> <i class="search icon"></i> </div> </div> <div class="field small-margin-bottom"> <label class="filter-responsive">{{\'Order by\' | translate}}:</label> <div class="field"> <div class="ui radio checkbox"> <input ng-change="changeFilterSummary()" type="radio" name="qmansummary-filter" ng-model="data.filterSummaryAgentsStatsType" value="name"> <label>{{\'Name\' | translate}}</label> </div> </div> <div class="field"> <div class="ui radio checkbox"> <input ng-change="changeFilterSummary()" type="radio" name="qmansummary-filter" ng-model="data.filterSummaryAgentsStatsType" value="member"> <label>{{\'Extension\' | translate}}</label> </div> </div> </div> <div class="field small-margin-bottom"> <div class="field"> <div class="ui radio checkbox"> <input ng-change="changeFilterSummary()" type="radio" name="qmanrealtime-filter" ng-model="data.filterSummaryAgentsStatsType" value="answeredcalls"> <label>{{\'Answered calls\' | translate}}</label> </div> </div> </div> </div> </div> </form> <div class="ui cards cards-graphs-container lines-cards"> <div ng-repeat="(ku, u) in summaryAgents | customFilterMultiple:\'name,member\':data.summaryAgentFilterText | customOrder:data.filterSummaryAgentsStatsType:(data.filterSummaryAgentsStatsType == \'answeredcalls\' ? true : false) track by $index" class="inverted qman-real-agents-card card large-card-stats"> <div class="content qman-read-agents-head"> <span class="right floated" data-tooltip="{{allUsers[allExtensions[u.member].username].status == \'offline\' ? \'Offline\' : allExtensions[u.member].dnd == true ? \'Do not disturb\' : allExtensions[u.member].cf != \'\' && allUsers[allExtensions[u.member].username].status != \'offline\' ? \'Callforward\' : allUsers[allExtensions[u.member].username].status == \'online\' ? \'Free\' : allUsers[allExtensions[u.member].username].status == \'ringing\' ? \'Ringing\' : \'Busy\' | translate}}" data-position="top right"> <img class="right floated mini circular ui image no-margin-bottom" ng-src="{{ allAvatars[allExtensions[u.member].username] || \'img/steve.6204f1d6.jpg\'}}"> <i ng-if="(allExtensions[u.member].cf != \'\' || allExtensions[u.member].cfVm != \'\') && allUsers[allExtensions[u.member].username].status != \'offline\'" class="big-dnd-status right floated icons qman-icon-head"> <i class="phone icon reset-right-margin yellow"></i> <i class="level up icon yellow conference-arrow-icon-small"> </i> </i> <i ng-if="allExtensions[u.member].dnd == true && allUsers[allExtensions[u.member].username].status != \'offline\'" class="big-dnd-status right floated icons qman-icon-head"> <i class="phone icon reset-right-margin red"></i> <i class="dnd-icon ban icon red conference-microphone-icon-small"> </i> </i> <i ng-if="(allUsers[allExtensions[u.member].username].status != \'ringing\' && allExtensions[u.member].dnd == false && !((allExtensions[u.member].cf != \'\' || allExtensions[u.member].cfVm != \'\') && allUsers[allExtensions[u.member].username].status != \'offline\')) || allUsers[allExtensions[u.member].username].status == \'offline\'" class="no-margin-right right floated {{allUsers[allExtensions[u.member].username].status == \'offline\' ? \'remove\' : \'phone\'}} {{allUsers[allExtensions[u.member].username].status == \'offline\' ? \'grey\' : allExtensions[u.member].dnd == true ? \'red\' : allUsers[allExtensions[u.member].username].status == \'online\' ? \'green\' : \'red\'}} qman-icon-head icon"> </i> <i ng-if="allUsers[allExtensions[u.member].username].status == \'ringing\' && allExtensions[u.member].dnd == false" class="big-icon-status right floated icons qman-icon-head"> <i class="phone icon reset-right-margin blue"></i> <i class="arrow incoming-arrow fa-rotate-45 down icon blue conference-microphone-icon-small"> </i> </i> </span> <div class="header"> {{u.name}} </div> <div class="meta"> {{u.member}} </div> </div> <div class="content not-first-content"> <span class="summaty-user-info-cotainer"> <h4 class="ui sub header qm-realtime-calls-chart-label">{{\'LOGIN\' | translate}}</h4> <table class="ui selectable compact table realtime-tables"> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Last login\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{summaryAgents[u.member].lastlogin || \'-\' | toLocaleString}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Last logout\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{summaryAgents[u.member].lastlogout || \'-\' | toLocaleString}}</strong> </td> </tr> <tr ng-show="$data.length == 0"> <td data-title="\'Label\' | translate"> <span>-</span> </td> <td data-title="\'Value\' | translate"> </td></tr> </table> <h4 class="ui sub header qm-realtime-calls-chart-label">{{\'CALLS\' | translate}}</h4> <table class="ui selectable compact table realtime-tables"> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Answered calls\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{summaryAgents[u.member].answeredcalls || \'-\'}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Outgoing calls\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{agentsSummaryStats[u.name].outgoingCalls.outgoing_calls || \'-\'}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Missed calls\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{summaryAgents[u.member].no_answer_calls || \'-\'}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'From last call\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{summaryAgents[u.member].from_last_call || \'-\'}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Time at phone\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{( (agentsSummaryStats[u.name].outgoingCalls.duration_outgoing + agentsSummaryStats[u.name].incomingCalls.duration_incoming) | secondsToReadable) || \'-\'}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Average recall time\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{(agentsSummaryStats[u.name].allQueues.avg_recall_time | secondsToReadable) || \'-\'}}</strong> </td> </tr> <tr ng-show="$data.length == 0"> <td data-title="\'Label\' | translate"> <span>-</span> </td> <td data-title="\'Value\' | translate"> </td></tr> </table> <h4 class="ui sub header qm-realtime-calls-chart-label">{{\'CALLS LENGTH\' | translate}}</h4> <table class="ui selectable compact table realtime-tables"> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Min\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{(agentsSummaryStats[u.name].allCalls.min_duration | secondsToReadable) || \'-\'}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Max\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{(agentsSummaryStats[u.name].allCalls.max_duration | secondsToReadable) || \'-\'}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Average\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{(agentsSummaryStats[u.name].allCalls.avg_duration | secondsToReadable) || \'-\'}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Total incoming\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{(agentsSummaryStats[u.name].incomingCalls.duration_incoming | secondsToReadable) || \'-\'}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Total outgoing\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{(agentsSummaryStats[u.name].outgoingCalls.duration_outgoing | secondsToReadable) || \'-\'}}</strong> </td> </tr> </table> </span> <div class="queues-container-agents-summary"> <div ng-repeat="qu in summaryAgents[u.member].queues"> <a ng-click="toggleDropUpQueue(qu.queue, u.member)" class="ui blue label label-bottom-margin cursor-default">{{qu.qname}} ({{qu.queue}})</a> <span ng-show="qu.loggedIn && !qu.paused"> <i class="green circle icon"></i> {{"Logged in" | translate}} </span> <span ng-if="qu.paused"> <i class="yellow circle icon"></i> {{"In pause" | translate}} </span> <span ng-if="!qu.loggedIn"> <i class="grey circle icon"></i> {{"Logged out" | translate}} </span> <i ng-click="toggleDropUpQueueSummary(qu.queue, u.member)" class="angle {{data.rtqdropdownsummary[qu.queue + u.member] ? \'left\' : \'down\'}} icon link float-right"></i> <table ng-show="!data.rtqdropdownsummary[qu.queue + u.member]" class="ui selectable compact table realtime-tables summary-queue-table"> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Logon\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{(agentsSummaryStats[u.name][qu.queue].time_in_logon | secondsToReadable) || \'-\'}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Pause time\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{(agentsSummaryStats[u.name][qu.queue].time_in_pause | secondsToReadable) || \'-\'}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Pause on logon\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{agentsSummaryStats[u.name][qu.queue].pause_percent ? agentsSummaryStats[u.name][qu.queue].pause_percent + \'%\' : \'-\'}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Time at phone\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{agentsSummaryStats[u.name][qu.queue].conversation_percent ? agentsSummaryStats[u.name][qu.queue].conversation_percent + \'%\' : \'-\'}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Average recall time\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{(agentsSummaryStats[u.name][qu.queue].avg_recall_time | secondsToReadable) || \'-\'}}</strong> </td> </tr> </table> </div> </div> </div> </div> </div> </div> </div> </div> </div> \x3c!-- start quques tab --\x3e <div ng-if="data.qmanagerLastTab === \'queues\'" ng-hide="queues | isempty:true" class="ui tab segment {{ data.qmanagerLastTab === \'queues\' ? \'active\' : \'\' }}" data-tab="queues"> <div class="ui top attached tabular menu"> <a ng-repeat="q in queues" id="queues/{{q.queue}}" ng-click="clickedQueueTab(q.queue)" class="item {{ data.queueLastTab === q.queue ? \'active\' : \'\' }}" data-tab="queues/{{q.queue}}"> {{q.name}} ( <b> {{q.queue}}</b>) <span class="ui blue circular label">{{tableWait[q.queue].data.length + tableConnected[q.queue].data.length}}</span> </a> </div> <div class="tabular-divider"> </div> <div ng-if="data.queueLastTab === q.queue" ng-repeat="q in queues track by q.queue" class="qmanager-content-tab ui bottom attached tab segment {{ data.queueLastTab === q.queue ? \'active\' : \'\' }}" data-tab="queues/{{q.queue}}"> <div class="ui stackable grid"> <div class="six wide column qmanager-columns"> <div class="ui two column grid"> <div class="column qmanager-container-calls"> <div class="ui segment"> <a class="ui red ribbon label">{{\'Waiting calls\' | translate}}</a> <a class="ui red circular label qmanager-right cursor-default">{{tableWait[q.queue].data.length}}</a> <div class="qman-table-container qmanager-call-scroll"> <table ng-table="tableWait[q.queue]" class="ui padding {{$data.length > 0 ? \'qman-table-less-bottom\' : \'qman-table-null-bottom\'}} selectable compact qman-table table table-dragable-items no-border"> <tr id="{{s.id}}" class="waitingCallId-{{s.num}} thumbnail vthumbnail" ng-repeat="s in $data" data-drop="true" data-drag="true" ng-model="$data" jqyoui-draggable="{index: {{$index}}, insertInline: true, direction:\'jqyouiDirection\', onStart: \'startDrag()\'}" data-jqyoui-options="{revert: \'invalid\', helper: \'clone\', classes: { \'ui-draggable\': \'qman-drag-clone\' }}" data-direction="{{s.jqyouiDirection}}"> <td data-title="\'Caller\' | translate"> <span>{{ s.name }}</span> <strong>({{ s.num }})</strong> </td> <td data-title="\'Position\' | translate" class="qman-call-position"> <span>{{ s.position }}</span> </td> <td data-title="\'Wait\' | translate"> <div chrono-timer timer-name="myTimer" start-time="s.waitingTime + clientServerTimeDiff">{{hours|zeropad}}:{{minutes|zeropad}}:{{seconds|zeropad}}</div> </td> </tr> <tr ng-show="$data.length == 0"> <td data-title="\'Caller\' | translate"> <span>-</span> </td> <td data-title="\'Position\' | translate"> </td> <td data-title="\'Wait\' | translate"> </td> </tr> </table> </div> <div class="qmanager-vspace"></div> <a class="ui blue ribbon label">{{\'Connected calls\' | translate}}</a> <a class="ui blue circular label qmanager-right cursor-default">{{tableConnected[q.queue].data.length}}</a> <div class="qman-table-container qmanager-call-scroll"> <table ng-table="tableConnected[q.queue]" class="ui selectable {{$data.length > 0 ? \'qman-table-less-bottom\' : \'qman-table-null-bottom\'}} compact table no-border qman-table"> <tr ng-repeat="s in $data"> <td data-title="\'Caller\' | translate"> <span>{{ s.conversation.counterpartName }}</span> <strong>({{ s.conversation.counterpartNum }})</strong> </td> <td data-title="\'Agent\' | translate"> <span>{{ s.member.name }} <span> <strong>({{s.member.member}})</strong> </span></span></td> <td data-title="\'Duration\' | translate"> <div chrono-timer timer-name="myTimer" start-time="s.conversation.startTime + clientServerTimeDiff">{{hours|zeropad}}:{{minutes|zeropad}}:{{seconds|zeropad}}</div> </td> <div class="divider-table"></div> </tr> <tr ng-show="$data.length == 0"> <td data-title="\'Caller\' | translate"> <span>-</span> </td> <td data-title="\'Agent\' | translate"> </td> <td data-title="\'Duration\' | translate"> </td> </tr> </table> </div> <p></p> </div> </div> </div> <div class="ui two column grid"> <div class="column qmanager-container-calls"> <h4 id="timingHeader" class="ui top attached header"> {{"Calls duration" | translate}} </h4> <div id="timingContainer-{{q.queue}}" class="ui attached segment border-bottom-radius"> <div class="container-svg-chart container-calls-summary-charts" id="container-timing-chart-{{q.queue}}"></div> </div> </div> </div> <div class="ui two column grid"> <div class="column qmanager-container-calls"> <h4 id="pieHeader" class="ui top attached header"> {{"Calls result" | translate}} </h4> <div id="pieContainer-{{q.queue}}" class="pieContainer ui attached segment border-bottom-radius"> <div id="pie-{{q.queue}}" class="container-svg-chart"></div> </div> </div> </div> </div> <div class="ten wide column agents-container"> <div class="ui cards"> <div class="qmanager-counter-space-before"></div> <div class="card qmanager-acounter-content-card"> <div class="content qmanager-acounter-content"> <div class="ui basic label large"> <a data-tooltip="{{\'Agents into the queue\' | translate}}" data-position="top left" class="ui green circular label qmanager-agent-counter" id="ag-online-counter-{{q.queue}}">{{acounters[q.queue].online || 0}}</a> {{\'online-agents\' | translate}} </div> </div> </div> <div class="card qmanager-acounter-content-card"> <div class="content qmanager-acounter-content"> <div class="ui basic label large"> <a data-tooltip="{{\'Agents outside of queue\' | translate}}" data-position="top left" class="ui gray circular label qmanager-agent-counter" id="ag-offline-counter-{{q.queue}}">{{acounters[q.queue].offline || 0}}</a> {{\'offline-agents\' | translate}} </div> </div> </div> <div class="card qmanager-acounter-content-card"> <div class="content qmanager-acounter-content"> <div class="ui basic label large"> <a data-tooltip="{{\'Agents in pause\' | translate}}" data-position="top left" class="ui yellow circular label qmanager-agent-counter" id="ag-paused-counter-{{q.queue}}">{{acounters[q.queue].paused || 0}}</a> {{\'paused-agents\' | translate}} </div> </div> </div> <div class="card qmanager-acounter-content-card"> <div class="content qmanager-acounter-content"> <div class="ui basic label large"> <a data-tooltip="{{\'Agents busy with call through the queue\' | translate}}" data-position="top left" class="ui blue circular label qmanager-agent-counter" id="ag-connected-counter-{{q.queue}}">{{acounters[q.queue].connected || 0}}</a> {{\'connected-agents\' | translate}} </div> </div> </div> <div class="card qmanager-acounter-content-card"> <div class="content qmanager-acounter-content"> <div class="ui basic label large"> <a data-tooltip="{{\'Agents free to receive calls\' | translate}}" data-position="top left" class="ui green circular label qmanager-agent-counter" id="ag-free-counter-{{q.queue}}">{{acounters[q.queue].free || 0}}</a> {{\'free-agents\' | translate}} </div> </div> </div> <div class="card qmanager-acounter-content-card"> <div class="content qmanager-acounter-content"> <div class="ui basic label large"> <a data-tooltip="{{\'Agents busy with call outside the queue\' | translate}}" data-position="top left" class="ui red circular label qmanager-agent-counter" id="ag-busy-counter-{{q.queue}}">{{acounters[q.queue].busy || 0}}</a> {{\'busy-agents\' | translate}} </div> </div> </div> <div class="qmanager-counter-space"></div> <div id="{{q.queue}}-{{u.member}}" data-qnum="{{u.member}}" ng-repeat="(ku, u) in q.members" data-drop="allUsers[allExtensions[ku].username].status == \'online\' ? true : false" ng-model="list2" jqyoui-droppable="{onDrop: \'dropped()\', onOver: \'dropOver()\', onOut: \'dropOut()\'}" class="card"> <div class="content"> <span class="right floated" data-tooltip="{{allUsers[allExtensions[ku].username].status == \'offline\' ? \'Offline\' : allExtensions[ku].dnd == true ? \'Do not disturb\' : allExtensions[ku].cf != \'\' && allUsers[allExtensions[ku].username].status != \'offline\' ? \'Callforward\' : allUsers[allExtensions[ku].username].status == \'online\' ? \'Free\' : allUsers[allExtensions[ku].username].status == \'ringing\' ? \'Ringing\' : \'Busy\' | translate}}" data-position="top right"> <img class="right floated mini circular ui image no-margin-bottom" ng-src="{{ allAvatars[allExtensions[ku].username] || \'img/steve.6204f1d6.jpg\'}}"> <i ng-if="(allUsers[allExtensions[ku].username].status != \'ringing\' && allExtensions[ku].dnd == false && !((allExtensions[ku].cf != \'\' || allExtensions[ku].cfVm != \'\') && allUsers[allExtensions[ku].username].status != \'offline\')) || allUsers[allExtensions[ku].username].status == \'offline\'" class="no-margin-right right floated {{allUsers[allExtensions[ku].username].status == \'offline\' ? \'remove\' : \'phone\'}} {{allUsers[allExtensions[ku].username].status == \'offline\' ? \'grey\' : allExtensions[ku].dnd == true ? \'red\' : allUsers[allExtensions[ku].username].status == \'online\' ? \'green\' : \'red\'}} qman-icon-head icon"></i> <i ng-if="allUsers[allExtensions[ku].username].status == \'onhold\'" class="qman-icon-head no-margin-right right floated orange pause icon"></i> <i ng-if="allUsers[allExtensions[ku].username].status == \'ringing\' && allExtensions[ku].dnd == false" class="big-icon-status right floated icons qman-icon-head"> <i class="phone icon reset-right-margin blue"></i> <i class="arrow incoming-arrow fa-rotate-45 down icon blue conference-microphone-icon-small"> </i> </i> <i ng-if="allExtensions[ku].dnd == true && allUsers[allExtensions[ku].username].status != \'offline\'" class="big-dnd-status right floated icons qman-icon-head"> <i class="phone icon reset-right-margin red"></i> <i class="dnd-icon ban icon red conference-microphone-icon-small"> </i> </i> <i ng-if="(allExtensions[ku].cf != \'\' || allExtensions[ku].cfVm != \'\') && allUsers[allExtensions[ku].username].status != \'offline\'" class="big-dnd-status right floated icons qman-icon-head"> <i class="phone icon reset-right-margin yellow"></i> <i class="level up icon yellow conference-arrow-icon-small"> </i> </i> </span> <div class="header"> {{u.name}} </div> <div class="meta"> {{u.member}} </div> </div> <div class="extra content {{(u.loggedIn && !u.paused && !(filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0].connected)) ? \'qman-card-green\' : (u.loggedIn && !u.paused && !(filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0].connected)) ? \'qman-card-grey\' : (u.paused && !(filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0].connected)) ? \'qman-card-yellow\' : (filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0].throughQueue && (q.queue == filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0].queueId) && filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0].connected) ? \'qman-card-blue\' : (filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0].throughQueue && (q.queue != filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0].queueId) && filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0].connected) ? \'qman-card-orange\' : (filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0] && !(filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0].throughQueue) && filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0].connected) ? \'qman-card-red\' : \'extra-content\'}}"> <div class="qman-status-desc description"> <p class="display-inline" ng-if="u.loggedIn && !u.paused && !(filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0].connected)"> <span class="{{allUsers[allExtensions[ku].username].status == \'offline\' ? \'opacity-icon\' : \'\'}}"> <i class="green circle icon"></i> {{"Logged in" | translate}}</span> </p> <p class="display-inline" ng-if="!u.loggedIn && !(filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0].connected)"> <span class="{{allUsers[allExtensions[ku].username].status == \'offline\' ? \'opacity-icon\' : \'\'}}"> <i class="grey circle icon"></i> {{"Logged out" | translate}}</span> </p> <p class="display-inline" ng-if="u.paused && !(filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0].connected)"> <span class="{{allUsers[allExtensions[ku].username].status == \'offline\' ? \'opacity-icon\' : \'\'}}"> <i class="yellow circle icon"></i> {{"In pause" | translate}}</span> </p> <p class="display-inline" ng-if="filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0].throughQueue && (q.queue == filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0].queueId) &&\n                  filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0].connected"> <span class="{{allUsers[allExtensions[ku].username].status == \'offline\' ? \'opacity-icon\' : \'\'}}"> <i class="blue circle icon"></i> {{"Call of the queue" | translate}} {{queues[filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0].queueId].name}}</span> </p> <p class="display-inline" ng-if="filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0].throughQueue && (q.queue != filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0].queueId) &&\n                  filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0].connected"> <span class="{{allUsers[allExtensions[ku].username].status == \'offline\' ? \'opacity-icon\' : \'\'}}"> <i class="orange circle icon"></i> {{"Call of the queue" | translate}} {{filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0].queueId.name}}</span> </p> <p class="display-inline" ng-if="filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0] && !(filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0].throughQueue) &&\n                  filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0].connected"> <span class="{{allUsers[allExtensions[ku].username].status == \'offline\' ? \'opacity-icon\' : \'\'}}"> <i class="red circle icon"></i> {{"Call not of the queue" | translate}}</span> </p> <div class="ui qman-dropdown top right pointing content dropdown adjust-responsive-padding float-right"> <div class="description no-margin-top"> <i class="purple users link icon no-margin-right"></i> </div> <div class="menu user-queues-list"> <div class="item" ng-click="gotoQueueTab(p.queue)" ng-repeat="p in filterQueues(u.member)"> <span class="description"></span> <span data-tooltip="{{p.members[u.member].loggedIn == true && p.members[u.member].paused == false ? \'Online\' :\n                        p.members[u.member].paused == true ? \'In pause\' : p.members[u.member].loggedIn == false ? \'Offline\' : \'\' | translate}}" data-position="top right"> <i class="{{p.members[u.member].loggedIn == true && p.members[u.member].paused == false ? \'green\' : p.members[u.member].paused == true ? \'yellow\' : p.members[u.member].loggedIn == false ? \'grey\' : \'\'}} circle icon"></i> </span> <span class="font-weight-f">{{p.name}} <span> <b>{{p.queue}}</b> </span></span></div> </div> </div> </div> <div ng-repeat="e in filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)" ng-if="e.conversations[0] && (e.status == \'ringing\' || e.status == \'busy\' || e.status == \'onhold\')" class="left floated adjust-long-name-oppanel"> <i ng-if="!e.conversations[0].inConference" ng-hide="e.conversations[0].chDest.inConference" class="{{e.conversations[0].direction == \'in\' ? \'arrow left\' : \'arrow right\'}} icon no-margin-right oppanel-direction"></i> <i ng-if="e.conversations[0].inConference || e.conversations[0].chDest.inConference" class="no-rotate icons no-margin-right oppanel-direction conference-bigicon-incard"> <i class="users icon reset-right-margin grey"></i> <i class="corner microphone icon grey conference-microphone-icon-small"> </i> </i> <span title="{{e.conversations[0].counterpartNum.includes(\'unknown\') && (e.conversations[0].inConference || e.conversations[0].chDest.inConference == true) ? \'in conference\' : e.conversations[0].inConference || e.conversations[0].chDest.inConference ? \'in conference\' : e.conversations[0].counterpartName | cleanName | translate}}">{{e.conversations[0].inConference || e.conversations[0].chDest.inConference ? \'in conference\' : e.conversations[0].counterpartName || \'Unknown\' | cleanName | translate}}</span> <span title="{{e.conversations[0].counterpartNum.includes(\'unknown\') && (e.conversations[0].inConference || e.conversations[0].chDest.inConference == true) ? \'moderator\' : e.conversations[0].counterpartNum | translate}}" class="oppanel-number"> {{e.conversations[0].counterpartNum.includes(\'unknown\') && (e.conversations[0].inConference || e.conversations[0].chDest.inConference == true) ? \'moderator\' : e.conversations[0].counterpartNum | translate}} <i ng-if="e.conversations[0].recording == \'true\'" title="{{\'Recording\' | translate}}" class="{{e.conversations[0].recording == \'true\' ? \'brown selected radio\' : \'\'}} icon"></i> </span> <timer ng-if="e.conversations[0].connected || e.conversations[0].chDest.inConference" start-time="e.conversations[0].startTime + clientServerTimeDiff" interval="1000" class="right-align large-margin-top-inverse oppanel-number float-right">{{hhours}}:{{mminutes}}:{{sseconds}}</timer> </div> <span class="right floated oppanel-status"> <div class="ui simple dropdown"> {{\'Actions\' | translate}} <i class="dropdown icon"></i> <div class="menu"> <div ng-if="u.type != \'static\'" ng-click="u.loggedIn ? removeMember(u.member, q.queue) : addMember(u.member, q.queue)" class="item"> <i class="{{u.loggedIn ? \'close red\' : \'play\'}} icon"></i> {{u.loggedIn ? \'Logout\' : \'Login\' | translate}}</div> <div ng-if="u.loggedIn" ng-click="u.paused ? unpauseMember(u.member, q.queue) : pauseMember(u.member, q.queue)" class="item"> <i class="pause {{u.paused ? \'yellow\' : \'\'}} icon"></i> {{u.paused ? \'Stop pause\' : \'Pause\' | translate}}</div> <div ng-if="currentUser.default_device.id != u.member && view.isChatLoaded" ng-click="openMemberChat(allUsers[allExtensions[ku].username].endpoints.jabber[0].id)" class="item"> <i class="chat icon"></i> {{"Chat" | translate}} {{allUsers[allExtensions[ku].username].endpointsjabber[0].id}}</div> <div ng-repeat="e in filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)" ng-if="e.conversations[0] && filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0].connected && (e.status == \'ringing\' || e.status == \'busy\' || e.status == \'onhold\')" ng-click="startSpy(allUsers[allExtensions[ku].username])" class="item"> <i class="spy icon"></i> {{"Spy" | translate}}</div> <div ng-repeat="e in filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)" ng-if="e.conversations[0] && filterEndpoints(allUsers[allExtensions[ku].username].endpoints.extension)[0].conversations[0].connected && (e.status == \'ringing\' || e.status == \'busy\' || e.status == \'onhold\')" ng-click="startIntrude(allUsers[allExtensions[ku].username])" class="item"> <i class="compress icon"></i>{{"Intrude" | translate}}</div> </div> </div> </span> </div> </div> </div> </div> </div> </div> </div> \x3c!-- start realtime tab --\x3e <div ng-if="data.qmanagerLastTab === \'realtime\'" ng-hide="queues | isempty:true" class="ui tab segment {{ data.qmanagerLastTab === \'realtime\' ? \'active\' : \'\' }}" data-tab="realtime"> <div class="qm-row realtime-counters-container"> <div class="ui cards"> <div class="card no-shadow realtime-counters-cards"> <div class="content qmanager-acounter-content"> <div class="ui basic label large"> <a data-position="top left" class="ui gray circular label qmanager-agent-counter" id="TODO-ag-online-counter-{{q.queue}}">{{rcounters.tot || 0}}</a> {{\'Total calls\' | translate}} </div> </div> </div> <div class="card no-shadow realtime-counters-cards"> <div class="content qmanager-acounter-content"> <div class="ui basic label large"> <a data-position="top left" class="ui red circular label qmanager-agent-counter" id="TODO-ag-online-counter-{{q.queue}}">{{rcounters.waiting || 0}}</a> {{\'Waiting calls\' | translate}} </div> </div> </div> <div class="card no-shadow realtime-counters-cards"> <div class="content qmanager-acounter-content"> <div class="ui basic label large"> <a data-position="top left" class="ui blue circular label qmanager-agent-counter" id="TODO-ag-online-counter-{{q.queue}}">{{rcounters.connected || 0}}</a> {{\'Connected calls\' | translate}} </div> </div> </div> <div class="card no-shadow realtime-counters-cards"> <div class="content qmanager-acounter-content"> <div class="ui basic label large"> <a data-position="top left" class="ui green circular label qmanager-agent-counter" id="TODO-ag-online-counter-{{q.queue}}">{{rcounters.online || 0}}</a> {{\'Online Agents\' | translate}} </div> </div> </div> <div class="card no-shadow realtime-counters-cards"> <div class="content qmanager-acounter-content"> <div class="ui basic label large"> <a data-position="top left" class="ui gray circular label qmanager-agent-counter" id="TODO-ag-online-counter-{{q.queue}}">{{rcounters.offline || 0}}</a> {{\'Offline Agents\' | translate}} </div> </div> </div> <div class="card no-shadow realtime-counters-cards"> <div class="content qmanager-acounter-content"> <div class="ui basic label large"> <a data-position="top left" class="ui yellow circular label qmanager-agent-counter" id="TODO-ag-online-counter-{{q.queue}}">{{rcounters.paused || 0}}</a> {{\'Paused Agents\' | translate}} </div> </div> </div> <div class="card no-shadow realtime-counters-cards"> <div class="content qmanager-acounter-content"> <div class="ui basic label large"> <a data-position="top left" class="ui red circular label qmanager-agent-counter" id="TODO-ag-online-counter-{{q.queue}}">{{rcounters.busy || 0}}</a> {{\'Busy Agents\' | translate}} </div> </div> </div> <div class="card no-shadow realtime-counters-cards"> <div class="content qmanager-acounter-content"> <div class="ui basic label large"> <a data-position="top left" class="ui green circular label qmanager-agent-counter" id="TODO-ag-online-counter-{{q.queue}}">{{rcounters.free || 0}}</a> {{\'Free Agents\' | translate}} </div> </div> </div> </div> </div> <div class="qm-row"> <div id="qm-accordion-queues" class="qaccordion"> <h3 class="q-accordion-title">{{\'Queues stats\' | translate}}</h3> <div class="q-accordion-content"> <div class="ui cards cards-graphs-container"> <div ng-repeat="q in queues" class="ui two column grid card large-card qm-realtime-cards"> <div class="column qmanager-container-calls"> <div class="ui segment queues-qman-cards-segment no-box-shadow"> <a class="ui blue ribbon label">{{q.name}} ({{q.queue}})</a> <div class="qmanager-vspace"></div> <h4 class="ui sub header ng-binding qm-realtime-calls-chart-label">{{\'Calls\' | translate}}</h4> <div id="qm-realtime-chart-calls-{{q.queue}}"></div> <h4 class="ui sub header ng-binding qm-realtime-calls-chart-label2">{{\'Agents\' | translate}}</h4> <div id="qm-realtime-chart-agents-{{q.queue}}"></div> </div> </div> </div> </div> </div> </div> </div> <div class="qm-row no-margin-bottom"> <div id="qm-accordion-agents" class="qaccordion"> <h3 class="q-accordion-title">{{\'Agents stats\' | translate}}</h3> <div class="q-accordion-content"> <form class="left-form-padding"> <div class="ui form"> <div class="inline fields"> <div class="field small-margin-bottom medium-margin-top"> <div class="ui icon input"> <input ng-model="data.realTimeAgentFilterText" type="text" placeholder="{{\'Search\' | translate}}..."> <i class="search icon"></i> </div> </div> <div class="field small-margin-bottom"> <label class="filter-responsive">{{\'Order by\' | translate}}:</label> <div class="field"> <div class="ui radio checkbox"> <input ng-change="changeFilter()" type="radio" name="qmanrealtime-filter" ng-model="data.filterAgentsStatsType" value="name"> <label>{{\'Name\' | translate}}</label> </div> </div> <div class="field"> <div class="ui radio checkbox"> <input ng-change="changeFilter()" type="radio" name="qmanrealtime-filter" ng-model="data.filterAgentsStatsType" value="member"> <label>{{\'Extension\' | translate}}</label> </div> </div> </div> <div class="field small-margin-bottom"> <label class="filter-responsive"></label> <div class="field"> <div class="ui radio checkbox"> <input ng-change="changeFilter()" type="radio" name="qmanrealtime-filter" ng-model="data.filterAgentsStatsType" value="answeredcalls"> <label>{{\'Answered calls\' | translate}}</label> </div> </div> <div class="field"> <div class="ui radio checkbox"> <input ng-change="changeFilter()" type="radio" name="qmanrealtime-filter" ng-model="data.filterAgentsStatsType" value="lastcall"> <label>{{\'Last call\' | translate}}</label> </div> </div> </div> </div> </div> </form> <div class="ui cards cards-users-real lines-cards"> <div ng-repeat="(ku, u) in realTimeAgents | customFilterMultiple:\'name,member\':data.realTimeAgentFilterText | customOrder:data.filterAgentsStatsType:(data.filterAgentsStatsType == \'answeredcalls\' || data.filterAgentsStatsType == \'lastcall\' ? true : false) track by $index" class="inverted qman-real-agents-card card large-card-stats"> <div class="content qman-read-agents-head"> <span class="right floated" data-tooltip="{{allUsers[allExtensions[u.member].username].status == \'offline\' ? \'Offline\' : allExtensions[u.member].dnd == true ? \'Do not disturb\' : allExtensions[u.member].cf != \'\' && allUsers[allExtensions[u.member].username].status != \'offline\' ? \'Callforward\' : allUsers[allExtensions[u.member].username].status == \'online\' ? \'Free\' : allUsers[allExtensions[u.member].username].status == \'ringing\' ? \'Ringing\' : \'Busy\' | translate}}" data-position="top right"> <img class="right floated mini circular ui image no-margin-bottom" ng-src="{{ allAvatars[allExtensions[u.member].username] || \'img/steve.6204f1d6.jpg\'}}"> <i ng-if="(allUsers[allExtensions[u.member].username].status != \'ringing\' && allExtensions[u.member].dnd == false && !((allExtensions[u.member].cf != \'\' || allExtensions[u.member].cfVm != \'\') && allUsers[allExtensions[u.member].username].status != \'offline\')) || allUsers[allExtensions[u.member].username].status == \'offline\'" class="no-margin-right right floated {{allUsers[allExtensions[u.member].username].status == \'offline\' ? \'remove\' : \'phone\'}} {{allUsers[allExtensions[u.member].username].status == \'offline\' ? \'grey\' : allExtensions[u.member].dnd == true ? \'red\' : allUsers[allExtensions[u.member].username].status == \'online\' ? \'green\' : \'red\'}} qman-icon-head icon"></i> <i ng-if="allUsers[allExtensions[u.member].username].status == \'ringing\' && allExtensions[u.member].dnd == false" class="big-icon-status right floated icons qman-icon-head"> <i class="phone icon reset-right-margin blue"></i> <i class="arrow incoming-arrow fa-rotate-45 down icon blue conference-microphone-icon-small"> </i> </i> <i ng-if="allExtensions[u.member].dnd == true && allUsers[allExtensions[u.member].username].status != \'offline\'" class="big-dnd-status right floated icons qman-icon-head"> <i class="phone icon reset-right-margin red"></i> <i class="dnd-icon ban icon red conference-microphone-icon-small"> </i> </i> <i ng-if="(allExtensions[u.member].cf != \'\' || allExtensions[u.member].cfVm != \'\') && allUsers[allExtensions[u.member].username].status != \'offline\'" class="big-dnd-status right floated icons qman-icon-head"> <i class="phone icon reset-right-margin yellow"></i> <i class="level up icon yellow conference-arrow-icon-small"> </i> </i> </span> <div class="header"> {{u.name}} <div class="ui simple dropdown actions-realtime-card"> {{\'Actions\' | translate}} <i class="dropdown icon"></i> <div class="menu"> <div ng-if="isDisconnectedQueue(realTimeAgents[u.member].queues) && isDynamicInQueue(realTimeAgents[u.member].queues)" ng-click="loginAllQueues(realTimeAgents[u.member].queues, u.member)" class="item"> <i ng-if="!data.loadingIcons[u.member].login" class="play icon"></i> <div ng-if="data.loadingIcons[u.member].login" class="ui active mini inline loader spinner-icon-dropdown"></div> {{\'Login\' | translate}} </div> <div ng-if="isConnectedQueue(realTimeAgents[u.member].queues) && isDynamicInQueue(realTimeAgents[u.member].queues)" ng-click="logoutAllQueues(realTimeAgents[u.member].queues, u.member)" class="item"> <i ng-if="!data.loadingIcons[u.member].logout" class="close red icon"></i> <div ng-if="data.loadingIcons[u.member].logout" class="ui active mini inline loader spinner-icon-dropdown"></div> {{\'Logout\' | translate}} </div> <div ng-if="isUnpausedInQueue(realTimeAgents[u.member].queues)" ng-click="pauseAllQueues(realTimeAgents[u.member].queues, u.member)" class="item"> <i ng-if="!data.loadingIcons[u.member].pause" class="pause icon"></i> <div ng-if="data.loadingIcons[u.member].pause" class="ui active mini inline loader spinner-icon-dropdown"></div> {{\'Pause\' | translate}} </div> <div ng-if="isPausedInQueue(realTimeAgents[u.member].queues)" ng-click="unpauseAllQueues(realTimeAgents[u.member].queues, u.member)" class="item"> <i ng-if="!data.loadingIcons[u.member].unpause" class="pause yellow icon"></i> <div ng-if="data.loadingIcons[u.member].unpause" class="ui active mini inline loader spinner-icon-dropdown"></div> {{\'Stop pause\' | translate}} </div> </div> </div> </div> <div class="meta"> {{u.member}} </div> </div> <div class="content not-first-content" ng-repeat="qu in realTimeAgents[u.member].queues"> <a ng-click="toggleDropUpQueue(qu.queue, u.member)" class="ui blue ribbon label">{{qu.qname}} ({{qu.queue}})</a> <i ng-click="toggleDropUpQueue(qu.queue, u.member)" class="angle {{data.rtqdropdown[qu.queue + u.member] ? \'left\' : \'down\'}} icon link float-right"></i> <span ng-show="qu.loggedIn && !qu.paused"> <i class="green circle icon"></i> {{"Logged in" | translate}} </span> <span ng-if="qu.paused"> <i class="yellow circle icon"></i> {{"In pause" | translate}} </span> <span ng-if="!qu.loggedIn"> <i class="grey circle icon"></i> {{"Logged out" | translate}} </span> <span ng-hide="data.rtqdropdown[qu.queue + u.member]" class="{{qu.queue}}-rtqdropdown"> <div class="qmanager-vspace"></div> <h4 class="ui sub header qm-realtime-calls-chart-label">{{\'LOGIN\' | translate}}</h4> <table class="ui selectable compact table realtime-tables"> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Last login\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{qu.stats.last_login_time || \'-\' | toLocaleString}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Last logout\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{qu.stats.last_logout_time || \'-\' | toLocaleString}}</strong> </td> </tr> <tr ng-show="$data.length == 0"> <td data-title="\'Label\' | translate"> <span>-</span> </td> <td data-title="\'Value\' | translate"> </td></tr> </table> <h4 class="ui sub header qm-realtime-calls-chart-label">{{\'PAUSE\' | translate}}</h4> <table class="ui selectable compact table realtime-tables"> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Last pause\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{qu.stats.last_paused_time || \'-\' | toLocaleString}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Last unpause\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{qu.stats.last_unpaused_time || \'-\' | toLocaleString}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'From last pause\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{qu.stats.from_last_pause || \'-\'}}</strong> </td> </tr> <tr ng-show="$data.length == 0"> <td data-title="\'Label\' | translate"> <span>-</span> </td> <td data-title="\'Value\' | translate"> </td></tr> </table> <h4 class="ui sub header qm-realtime-calls-chart-label">{{\'CALLS\' | translate}}</h4> <table class="ui selectable compact table realtime-tables"> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Answered calls\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{qu.stats.calls_taken || \'-\'}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Last call\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{qu.stats.last_call_time || \'-\' | toLocaleString}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'From last call\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{qu.stats.from_last_call || \'-\'}}</strong> </td> </tr> <tr ng-show="$data.length == 0"> <td data-title="\'Label\' | translate"> <span>-</span> </td> <td data-title="\'Value\' | translate"> </td></tr> </table> </span> </div> </div> </div> </div> </div> </div> </div> </div> '),e.put("views/queues.html",'<div class="ui segment adjust-segment-container"> <h3 class="ui purple header title-header"> <i class="purple users icon"></i> <div class="content ng-binding">{{\'Queues\' | translate}}</div> </h3> <div ng-show="viewLoad" class="ui active centered inline loader"></div> <div ng-if="(!viewLoad && !isAtLeastInOneQueue()) || !currentUser.profile.macro_permissions.queue_agent.value" class="ui icon message"> <i class="users icon"></i> <div class="content"> <div class="header"> {{\'No queues found\' | translate}} </div> <p>{{\'There are no queues available\' | translate}}</p> </div> </div> \x3c!-- start queuesinfo section --\x3e <div id="queuesInfoContainer" class="ui" ng-if="!viewLoad && isAtLeastInOneQueue() && currentUser.profile.macro_permissions.queue_agent.value" ng-include="queuesInfoUrl"> </div> <div ng-if="!viewLoad && isAtLeastInOneQueue() && currentUser.profile.macro_permissions.queue_agent.value" class="ui top attached tabular menu"> <div class="active item">{{"Queues management" | translate}}</div> </div> <div ng-if="!viewLoad && isAtLeastInOneQueue() && currentUser.profile.macro_permissions.queue_agent.value" class="tabular-divider"> </div> <div ng-if="!viewLoad && isAtLeastInOneQueue() && currentUser.profile.macro_permissions.queue_agent.value" class="ui bottom attached active tab segment queues-containers-padding"> <form> <div class="ui form qgraphic-container"> <div class="inline fields"> <div class="field small-margin-bottom no-margin-top full-search-queues"> <div class="ui icon input full-search-queues"> <input ng-model="queuesFilter.text" type="text" placeholder="{{\'Search\' | translate}}..."> <i class="search icon"></i> </div> </div> <div ng-if="!(queues | isempty:true) && !viewLoad" class="field small-margin-bottom no-margin-top"> <button ng-disabled="isOnlyStaticAgent()" ng-click="queuesStatus.inLoggedQueues == 0 ? queueLoginAll() : queueLogoutAll()" class="ui labeled icon button"> <i class="{{queuesStatus.inLoggedQueues == 0 ? \'green play\' : \'red remove\'}} icon"></i> {{queuesStatus.inLoggedQueues == 0 ? \'Login all queues\' : \'Logout all queues\' | translate}} </button> </div> <div ng-if="!(queues | isempty:true) && !viewLoad" class="field small-margin-bottom no-margin-top"> <div class="ui buttons"> <div ng-click="queuesStatus.inPausedQueues > 0 ? queueUnpauseAll() : queuePauseAll()" class="ui button {{queuesStatus.inPausedQueues > 0 ? \'border4\' : \'\'}} {{queuesStatus.inNumQueues == 0 ? \'disabled\' : \'\'}}"> <i class="orange pause icon"></i> {{queuesStatus.inPausedQueues > 0 ? \'Stop pause all queues\' : \'Pause all queues\' | translate}} </div> <div ng-hide="queuesStatus.inPausedQueues > 0" class="ui floating dropdown icon button {{queuesStatus.inNumQueues == 0 ? \'disabled\' : \'\'}}"> <i class="dropdown icon"></i> <div class="menu"> <div ng-click="queuePauseAll(\'Lunch break\')" class="item"><i class="coffee icon"></i> {{\'Lunch break\' | translate}}</div> <div ng-click="queuePauseAll(\'Emergency\')" class="item"> <i class="red warning icon"></i> {{\'Emergency\' | translate}}</div> <div ng-click="queuePauseAll(\'Backend\')" class="item"> <i class="pin icon"></i> {{\'Backend\' | translate}}</div> </div> </div> </div> </div> <div class="field small-margin-bottom hidden-special"> <label class="filter-responsive">{{\'Order by\' | translate}}:</label> <div class="field"> <div class="ui radio checkbox"> <input ng-change="changeFilter()" type="radio" name="oppanel-filter" ng-model="filter.type" value="name"> <label>{{\'Name\' | translate}}</label> </div> </div> <div class="field"> <div class="ui radio checkbox"> <input ng-change="changeFilter()" type="radio" name="oppanel-filter" ng-model="filter.type" value="presence"> <label>{{\'Presence\' | translate}}</label> </div> </div> </div> </div> </div> </form> <div id="queuesCardsContainer" class="ui cards qgraphic-container"> <div ng-repeat="(kq, q) in queues | customFilterMultiple:\'name,queue\':queuesFilter.text" ng-if="isUserIntoQueue(q)" class="ui bb-purple slow-shadow custom-borders inverted card large-card"> <div class="content no-flex-grow"> <div data-tooltip="{{\'Logged agents\' | translate}}" data-position="bottom center" class="right floated meta"><i class="ui icon purple user"></i> {{queues[kq].agents}}</div> <div data-tooltip="{{\'Connected calls\' | translate}}: {{tableConnected[kq].data.length}}" data-position="bottom center" class="right floated meta loader-margin"><i class="ui icon green compress"></i> {{tableConnected[kq].data.length}}</div> <div data-tooltip="{{\'Waiting calls\' | translate}}: {{tableWait[kq].data.length}}" data-position="bottom center" class="right floated meta loader-margin"><i class="ui icon orange pause"></i> {{tableWait[kq].data.length}} </div> <div data-tooltip="{{\'Total calls\' | translate}}: {{tableConnected[kq].data.length + tableWait[kq].data.length}}" data-position="bottom center" class="right floated meta loader-margin"><i class="ui icon grey tasks"></i> {{tableConnected[kq].data.length + tableWait[kq].data.length}}</div> <i class="ui icon purple users"></i> <strong>{{q.name}}</strong> {{q.queue}} </div> <div class="content no-flex-grow no-border-top"> <span data-tooltip="{{\'Max wait\' | translate}}" data-position="bottom center" class="right floated"> <div class="ui red label"> <div chrono-timer timer-name="myTimer" start-time="tableWait[kq].data[0].waitingTime ? tableWait[kq].data[0].waitingTime + clientServerTimeDiff : \'\'"> {{hours|zeropad}}:{{minutes|zeropad}}:{{seconds|zeropad}}</div> </div> </span> <span data-tooltip="{{\'Min wait\' | translate}}" data-position="bottom center"> <div class="ui label"> <div chrono-timer timer-name="myTimer" start-time="tableWait[kq].data[tableWait[kq].data.length-1].waitingTime ? tableWait[kq].data[tableWait[kq].data.length-1].waitingTime + clientServerTimeDiff : \'\'"> {{hours|zeropad}}:{{minutes|zeropad}}:{{seconds|zeropad}}</div> </div> </span> </div> <div ng-show="currentUser.profile.macro_permissions.queue_agent.value && currentUser.profile.macro_permissions.queue_agent.permissions.ad_queue_agent.value" class="content no-flex-grow border-top-dotted"> <h4 class="ui sub header mt-10">{{\'Waiting calls\' | translate}}</h4> <div id="tqcontainer-{{kq}}-1" ng-style="{\'height\': qTableContainersH[\'tqcontainer-\' + kq + \'-1\'] + \'px\', \'max-height\': qTableContainersH[\'tqcontainer-\' + kq + \'-1\'] ? \'none\' : \'200px\'}" ng-class="[\'resizer\', \'slow-border-radius\', \'mt-20\']" resizer> <table ng-table="tableWait[kq]" class="ui padding selectable compact table queue-table"> <tr ng-repeat="s in $data" class=""> <td data-title="\'Caller\' | translate"> <span>{{ s.name }}</span> <strong>{{ s.num }}</strong> </td> <td data-title="\'Position\' | translate"> <span>{{ s.position }}</span> </td> <td data-title="\'Wait\' | translate"> <div chrono-timer timer-name="myTimer" start-time="s.waitingTime + clientServerTimeDiff"> {{hours|zeropad}}:{{minutes|zeropad}}:{{seconds|zeropad}}</div> </td> </tr> <tr ng-show="$data.length == 0" class=""> <td data-title="\'Caller\' | translate"> <span>-</span> </td> <td data-title="\'Position\' | translate"> </td> <td data-title="\'Wait\' | translate"> </td> </tr> </table> </div> <h4 class="ui sub header">{{\'Connected calls\' | translate}}</h4> <div id="tqcontainer-{{kq}}-2" ng-style="{\'height\': qTableContainersH[\'tqcontainer-\' + kq + \'-2\'] + \'px\', \'max-height\': qTableContainersH[\'tqcontainer-\' + kq + \'-2\'] ? \'none\' : \'200px\'}" ng-class="[\'resizer\', \'slow-border-radius\', \'mt-20\']" resizer> <table ng-table="tableConnected[kq]" class="ui selectable compact table queue-table"> <tr ng-repeat="s in $data" class=""> <td data-title="\'Caller\' | translate"> <span>{{ s.conversation.counterpartName }}</span> <strong>{{ s.conversation.counterpartNum }}</strong> </td> <td data-title="\'Agent\' | translate"> <span>{{ s.member.name }}<span> <strong>{{s.member.member}}</strong> </span></span></td> <td data-title="\'Duration\' | translate"> <div chrono-timer timer-name="myTimer" start-time="s.conversation.startTime + clientServerTimeDiff"> {{hours|zeropad}}:{{minutes|zeropad}}:{{seconds|zeropad}}</div> </td> </tr> <tr ng-show="$data.length == 0" class=""> <td data-title="\'Caller\' | translate"> <span>-</span> </td> <td data-title="\'Agent\' | translate"> </td> <td data-title="\'Duration\' | translate"> </td> </tr> </table> </div> </div> <div class="content no-flex-grow border-top-dotted mt-12 pt-22"> <h4 class="ui sub header">{{\'Actions\' | translate}}</h4> <div ng-show="isInQueue(kq)" class="ui small feed"> <div class="event"> <div class="content"> <div class="summary queue-actions"> <span data-tooltip="{{!q.members[currentUser.endpoints.mainextension[0].id].loggedIn ? \'Not logged\' : (q.members[currentUser.endpoints.mainextension[0].id].loggedIn && !q.members[currentUser.endpoints.mainextension[0].id].paused) ? \'Logged\' : (q.members[currentUser.endpoints.mainextension[0].id].loggedIn && q.members[currentUser.endpoints.mainextension[0].id].paused) ? \'In pause\' : \'Offline\' | translate}}" data-position="top center"> <i class="{{!q.members[currentUser.endpoints.mainextension[0].id].loggedIn ? \'red remove\' : (q.members[currentUser.endpoints.mainextension[0].id].loggedIn && !q.members[currentUser.endpoints.mainextension[0].id].paused) ? \'circle green\' : (q.members[currentUser.endpoints.mainextension[0].id].loggedIn && q.members[currentUser.endpoints.mainextension[0].id].paused) ? \'pause orange\' : \'circle grey\'}} icon"></i> </span> <span data-tooltip="{{q.members[currentUser.endpoints.mainextension[0].id].member}}" data-position="right center">{{q.members[currentUser.endpoints.mainextension[0].id].name}}</span> <span data-tooltip="{{q.members[currentUser.endpoints.mainextension[0].id].type | capitalize | translate}}" data-position="top center"> <i class="{{q.members[currentUser.endpoints.mainextension[0].id].type == \'dynamic\' ? \'lightning\' : \'cube\'}} icon margin-button-right"></i> </span> <div class="float-right"> <button ng-if="q.members[currentUser.endpoints.mainextension[0].id].type == \'dynamic\'" ng-click="q.members[currentUser.endpoints.mainextension[0].id].loggedIn ? queueLogout(currentUser.endpoints.mainextension[0].id, q.queue) : queueLogin(currentUser.endpoints.mainextension[0].id, q.queue, true)" ng-if="q.members[currentUser.endpoints.mainextension[0].id].loggedIn" class="ui mini labeled icon button"> <i class="{{q.members[currentUser.endpoints.mainextension[0].id].loggedIn ? \'red remove\' : \'green play\'}} icon"></i> {{q.members[currentUser.endpoints.mainextension[0].id].loggedIn ? \'Logout\' : \'Login\'}} </button> <div ng-if="q.members[currentUser.endpoints.mainextension[0].id].loggedIn" class="ui mini buttons"> <div ng-click="q.members[currentUser.endpoints.mainextension[0].id].paused ? queueUnpause(currentUser.endpoints.mainextension[0].id, q.queue) : queuePause(currentUser.endpoints.mainextension[0].id, q.queue)" class="ui button"> <i ng-if="q.members[currentUser.endpoints.mainextension[0].id].paused && q.members[currentUser.endpoints.mainextension[0].id].lastPausedInReason" class="{{appConfig.QUEUES_PAUSE_STATE[q.members[currentUser.endpoints.mainextension[0].id].lastPausedInReason]}} icon"></i> <i class="{{q.members[currentUser.endpoints.mainextension[0].id].paused ? \'orange\' : \'\'}} pause icon"></i> {{q.members[currentUser.endpoints.mainextension[0].id].paused ? \'Stop pause\' : \'Pause\' | translate}} </div> <div ng-if="!q.members[currentUser.endpoints.mainextension[0].id].paused" class="ui floating dropdown icon button"> <i class="dropdown icon"></i> <div class="menu"> <div ng-click="queuePause(currentUser.endpoints.mainextension[0].id, q.queue, \'Lunch break\')" class="item"><i class="coffee icon"></i> {{\'Lunch break\' | translate}}</div> <div ng-click="queuePause(currentUser.endpoints.mainextension[0].id, q.queue, \'Emergency\')" class="item"><i class="red warning icon"></i> {{\'Emergency\' | translate}}</div> <div ng-click="queuePause(currentUser.endpoints.mainextension[0].id, q.queue, \'Backend\')" class="item"><i class="pin icon"></i> {{\'Backend\' | translate}}</div> </div> </div> </div> </div> </div> </div> </div> </div> <h4 ng-show="currentUser.profile.macro_permissions.queue_agent.value && currentUser.profile.macro_permissions.queue_agent.permissions.ad_queue_agent.value" class="ui sub header small-margin-bottom">{{\'Agents\' | translate}}</h4> <div ng-show="currentUser.profile.macro_permissions.queue_agent.value && currentUser.profile.macro_permissions.queue_agent.permissions.ad_queue_agent.value" class="agent-container"> <div ng-if="m.member != currentUser.endpoints.mainextension[0].id" ng-repeat="(km, m) in q.members" class="ui small feed"> <div class="event"> <div class="content"> <div class="summary"> <span data-tooltip="{{m.lastPausedInReason}}" data-position="right center"> <i ng-if="m.paused && m.lastPausedInReason" class="{{appConfig.QUEUES_PAUSE_STATE[m.lastPausedInReason]}} icon"></i> </span> <span data-tooltip="{{!m.loggedIn ? \'Not logged\' : (m.loggedIn && !m.paused) ? \'Logged\' : (m.loggedIn && m.paused) ? \'In pause\' : \'Offline\' | translate}}" data-position="right center"> <i class="{{!m.loggedIn ? \'red remove\' : (m.loggedIn && !m.paused) ? \'circle green\' : (m.loggedIn && m.paused) ? \'pause orange\' : \'circle grey\'}} icon"></i> </span> <span data-tooltip="{{m.member}}" data-position="right center">{{m.name}}</span> <span data-tooltip="{{m.type | capitalize | translate}}" data-position="right center"> <i class="{{m.type == \'dynamic\' ? \'lightning\' : \'cube\'}} icon margin-button-right"></i> </span> </div> </div> </div> </div> <div ng-if="(q.members | length) <= 1" class="ui message"> <div class="header"> {{\'No agents founds\' | translate}} </div> </div> </div> </div> </div> </div> </div> </div>'),e.put("views/settings.html",'<div class="ui segment adjust-segment-container" ng-controller="PhonesCtrl"> <div ng-show="viewLoad" class="ui active centered inline loader"></div> <div ng-show="!viewLoad"> <h3 class="ui grey header title-header"> <i class="grey settings icon"></i> <div class="content"> {{\'Settings\' | translate}} </div> </h3> <div class="ui stackable grid settings-container"> <div class="four wide column"> <div class="ui vertical fluid tabular menu"> <a ng-click="setSettingsTab(\'profile\')" class="item {{settingsTab == \'profile\' ? \'active\' : \'\'}}"> {{"Profile" | translate}} </a> <a ng-show="currentUser.profile.macro_permissions.queue_agent.value" ng-click="setSettingsTab(\'queues\')" class="item {{settingsTab == \'queues\' ? \'active\' : \'\'}}"> {{"Queues" | translate}} </a> <a ng-show="availableCards.length > 0" ng-click="setSettingsTab(\'costumercards\')" class="item {{settingsTab == \'costumercards\' ? \'active\' : \'\'}}"> {{\'Customer cards\' | translate}} </a> <a ng-show="paramUrl" ng-click="setSettingsTab(\'incomingcalls\')" class="item {{settingsTab == \'incomingcalls\' ? \'active\' : \'\'}}"> {{\'Incoming calls\' | translate}} </a> <a ng-show="!isEmpty(currentUser.endpoints.extension)" ng-click="setSettingsTab(\'devices\')" class="item {{settingsTab == \'devices\' ? \'active\' : \'\'}}" id="setDeviceBtn"> {{\'Devices\' | translate}} </a> <a ng-click="setSettingsTab(\'theme\')" class="item {{settingsTab == \'theme\' ? \'active\' : \'\'}}"> {{\'Theme\' | translate}} </a> </div> </div> \x3c!-- start profile tab --\x3e <div id="profileTabContainer" ng-if="settingsTab == \'profile\'" class="twelve wide stretched column"> <div class="ui segments no-padding"> <div class="ui segment basic no-padding-bottom"> <h4 class="ui left floated header font-medium"> {{"Profile" | translate}} </h4> </div> <div class="ui segment basic settings-intab-container"> <div class="ui two column grid stackable grid setting-intab-columns"> <div class="column"> \x3c!-- AVATAR --\x3e <div class="ui centered special cards"> <div class="card small-card border-radius-circular medium-margin-top"> <div class="blurring dimmable image background-white"> <div class="ui dimmer border-radius-circular"> <div class="content border-radius-circular"> <div class="center border-radius-circular"> <div id="avatar-box" ng-click="uploadImage()" class="ui inverted button avatar-buttons">{{"Upload" | translate}}</div> <div ng-show="avatar_image !== DEFAULT_AVATAR" ng-click="removeAvatar()" class="ui inverted button avatar-buttons avatar-second-button">{{"Remove" | translate}}</div> <div class="ui action input medium-margin-top avatar"> <input type="file"> </div> </div> </div> </div> <img class="border-radius-circular" ng-src="{{avatar_image}}"> </div> </div> </div> </div> <div class="column"> <div class="settings-zone"> <form class="ui form"> \x3c!-- DESKTOP NOTIFICATIONS --\x3e <div class="field big-margin-bottom"> <div ng-click="toggleDesktopNotifications()" class="ui checkbox"> <input ng-model="userSettings.desktop_notifications" type="checkbox" tabindex="0" class="hidden"> <label>{{\'Desktop notifications\' | translate}}</label> </div> </div> \x3c!-- CHAT NOTIFICATIONS --\x3e <div ng-if="currentUser.profile.macro_permissions.settings.permissions.chat.value === true" class="field big-margin-bottom"> <div ng-click="toggleChatNotifications()" class="ui checkbox"> <input ng-model="userSettings.chat_notifications" type="checkbox" tabindex="0" class="hidden"> <label>{{\'Chat notifications\' | translate}}</label> </div> </div> \x3c!-- CALL RINGTONE --\x3e <div class="field big-margin-bottom"> <div ng-click="toggleCallRingtone()" class="ui checkbox"> <input ng-model="userSettings.call_ringtone" type="checkbox" tabindex="0" class="hidden"> <label>{{\'Call ringtone\' | translate}}</label> </div> </div> \x3c!-- DND --\x3e <div ng-if="currentUser.profile.macro_permissions.settings.value === true &&\n                      currentUser.profile.macro_permissions.settings.permissions.dnd.value === true" class="field big-margin-bottom"> <div ng-click="toggleAutoDndOnLogout()" class="ui checkbox"> <input ng-model="userSettings.auto_dndon_logout" type="checkbox" tabindex="0" class="hidden"> <label>{{\'Auto DND ON (on exit from app)\' | translate}}</label> </div> </div> <div ng-if="currentUser.profile.macro_permissions.settings.value === true &&\n                      currentUser.profile.macro_permissions.settings.permissions.dnd.value === true" class="field big-margin-bottom"> <div ng-click="toggleAutoDndOffLogin()" class="ui checkbox"> <input ng-model="userSettings.auto_dndoff_login" type="checkbox" tabindex="0" class="hidden"> <label>{{\'Auto DND OFF (on enter into the app)\' | translate}}</label> </div> </div> <div ng-if="hasWebrtc()" class="field big-margin-bottom"> <div ng-click="toggleAudioEchoCancellation()" class="ui checkbox"> <input ng-model="userSettings.audio_echo_cancellation" type="checkbox" tabindex="0" class="hidden"> <label>{{\'Audio of integrated phone: disable echo cancellation\' | translate}}</label> </div> </div> </form> </div> </div> </div> <div class="ui vertical divider"> </div> </div> </div> </div> \x3c!-- start queues tab --\x3e <div id="queuesTabContainer" ng-if="settingsTab == \'queues\'" class="twelve wide stretched column"> <div class="ui segments no-padding"> <div class="ui segment basic no-padding-bottom"> <h4 class="ui left floated header font-medium"> {{"Queues" | translate}} </h4> </div> <div class="ui segment basic settings-intab-container"> <div class="ui two column grid stackable grid setting-intab-columns"> <div class="column"> <div ng-show="currentUser.profile.macro_permissions.queue_agent.value" class="settings-zone"> <form class="ui form"> <div class="field big-margin-bottom"> <div ng-click="toggleAutoQueueLogout()" class="ui checkbox"> <input ng-model="userSettings.queue_auto_logout" type="checkbox" tabindex="0" class="hidden"> <label>{{\'Auto EXIT from QUEUES (on exit from app)\' | translate}}</label> </div> </div> <div class="field big-margin-bottom"> <div ng-click="toggleAutoQueueLogin()" class="ui checkbox"> <input ng-model="userSettings.queue_auto_login" type="checkbox" tabindex="0" class="hidden"> <label>{{\'Auto ENTER into the QUEUES (on enter into the app)\' | translate}}</label> </div> </div> <div class="field big-margin-bottom"> <div ng-click="toggleQAutoPauseOnPresence()" class="ui checkbox"> <input ng-model="userSettings.queue_auto_pause_onpresence" type="checkbox" tabindex="0" class="hidden"> <label>{{\'Auto PAUSE on selected presence\' | translate}}</label> </div> <select name="states" class="tiny-margin-top ui selection dropdown" ng-init="initQMultiSelect()" multiple id="qMultiSelect"> <option ng-repeat="presence in qPauseAvailPresence" value="{{presence}}">{{appConfig.PRESENCE_MAP[presence].label | translate}}</option> </select> </div> </form> </div> </div> <div class="column"> <div ng-show="currentUser.profile.macro_permissions.queue_agent.value &&\n                  currentUser.profile.macro_permissions.queue_agent.permission.lost_queue_call.value" class="settings-zone"> <form class="ui form"> <div class="grouped fields"> <div><label>{{\'Update queue recall list every\' | translate}}: {{lostCallsUpdateInterval}} sec</label></div> <div class="ui blue range" ng-class="settingsTabGlobal === \'queues\' ? \'highlight\' : \'\'" id="q-auto-update-slider"></div> </div> <div class="grouped fields"> <div><label>{{\'Period of lost calls in queue\' | translate}}: <strong>{{lostCallsHoursInterval === 1 ? \'last_single_female\' : \'last_female\' | translate}} {{lostCallsHoursInterval > 1 ? lostCallsHoursInterval : \'\'}} {{lostCallsHoursInterval === 1 ? (\'hour\' | translate) : (\'hours\' | translate) }} </strong> </label></div> <div class="ui blue range" id="q-lost-call-hours-slider"></div> </div> </form> </div> </div> </div> <div class="ui vertical divider"></div> </div> </div> </div> \x3c!-- costumer cards tab --\x3e <div id="costumerCardsTabContainer" ng-if="settingsTab == \'costumercards\'" class="twelve wide stretched column"> <div class="ui segments no-padding"> <div class="ui segment basic no-padding-bottom"> <h4 class="ui left floated header font-medium"> {{"Customer cards" | translate}} </h4> </div> <div class="ui segment basic settings-intab-container"> <div class="ui two column grid stackable grid setting-intab-columns"> <div class="column"> <div ng-show="availableCards.length > 0" class="settings-zone"> <form class="ui form"> <div class="grouped fields"> <label>{{\'Show customer card\' | translate}}:</label> <div class="field"> <div ng-click="setCustomerCardView(\'disabled\')" class="ui radio checkbox"> <input type="radio" name="open_ccard" ng-model="userSettings.open_ccard" value="disabled"> <label>{{\'Never\' | translate}}</label> </div> </div> <div class="field"> <div ng-show="!emptySettings" ng-click="setCustomerCardView(\'incoming\')" class="ui radio checkbox"> <input type="radio" name="open_ccard" ng-model="userSettings.open_ccard" value="incoming"> <label>{{\'On incoming call\' | translate}}</label> </div> </div> <div class="field"> <div ng-show="!emptySettings" ng-click="setCustomerCardView(\'connected\')" class="ui radio checkbox"> <input type="radio" name="open_ccard" ng-model="userSettings.open_ccard" value="connected"> <label>{{\'On answer\' | translate}}</label> </div> </div> </div> </form> </div> </div> <div class="column"> <div ng-show="availableCards.length > 0" class="settings-zone"> <form class="ui form"> <div class="field big-margin-bottom" ng-if="currentUser.profile.macro_permissions.customer_card.value && !emptySettings"> <label>{{\'Customer cards order (drag to set your favorite order)\' | translate}}</label> <div ui-sortable ui-sortable-stop="updateCustomerCardsOrder()" ng-model="availableCards" class="ui link relaxed divided list medium-margin-top"> <div ng-repeat="c in availableCards" class="item cursor-drag"> <i class="large browser blue middle aligned icon"></i> <div class="content"> <div class="header">{{c.descr}}</div> <div class="description">{{c.key}}</div> </div> </div> </div> </div> </form> </div> </div> </div> <div class="ui vertical divider"> </div> </div> </div> </div> \x3c!-- incoming calls tab --\x3e <div id="costumerIncomingCallsTabContainer" ng-if="settingsTab == \'incomingcalls\'" class="twelve wide stretched column"> <div class="ui segments no-padding"> <div class="ui segment basic no-padding-bottom"> <h4 class="ui left floated header font-medium"> {{"Incoming calls" | translate}} </h4> </div> <div class="ui segment basic settings-intab-container"> <div class="ui two column grid stackable grid setting-intab-columns"> <div class="column"> <div ng-show="paramUrl" class="settings-zone"> <form class="ui form"> <div class="field big-margin-bottom"> <div> <label><h4>{{\'Parameterized URL\' | translate}}:</h4></label> <div class="ui left icon input medium-margin-top"> <i class="linkify icon color-disabled"></i> <input type="text" value="{{paramUrl}}" readonly class="color-disabled"> </div> </div> </div> <div class="field big-margin-bottom"> <div> <label class="fontBold">{{\'Calls only through queues\' | translate}}:</label> <label>{{paramUrlOnlyQueues === true ? (\'enabled\' | translate) : (\'disabled\' | translate)}}</label> </div> </div> </form> </div> </div> <div class="column"> <div ng-show="paramUrl" class="settings-zone"> <div class="field big-margin-bottom"> <div class="ui form"> <div class="grouped fields"> <label> <h4> {{\'You can open the above\' | translate}} <a href="{{paramUrl}}" target="_blank"> URL </a> {{\'with caller\\\'s data on\' | translate}}: </h4> </label> <div class="field medium-margin-top"> <div class="ui radio checkbox"> <input type="radio" name="paramUrlRadio" value="never" ng-checked="{{userSettings.open_param_url === \'never\' ? \'true\' : \'\'}}"> <label>{{\'never\' | translate}}</label> </div> </div> <div class="field"> <div class="ui radio checkbox"> <input type="radio" name="paramUrlRadio" value="onRinging" ng-checked="{{userSettings.open_param_url === \'onRinging\' ? \'true\' : \'\'}}"> <label>{{\'ringing call\' | translate}}</label> </div> </div> <div class="field"> <div class="ui radio checkbox"> <input type="radio" name="paramUrlRadio" value="onConnected" ng-checked="{{userSettings.open_param_url === \'onConnected\' ? \'true\' : \'\'}}"> <label>{{\'answered call\' | translate}}</label> </div> </div> <div class="field"> <div class="ui radio checkbox"> <input type="radio" name="paramUrlRadio" value="withBtn" ng-checked="{{userSettings.open_param_url === \'withBtn\' ? \'true\' : \'\'}}"> <label>{{\'clicking button on the call management box\' | translate}}</label> </div> </div> </div> <div class="ui icon message ng-scope"> <i class="counterclockwise info outline icon"></i> <div class="content"> <div class="header ng-binding"> {{\'Remember\' | translate}} </div> <p class="ng-binding">{{\'In order to open the parameterized URL, you have to enable pop-ups in your browser\' | translate}}.</p> </div> </div> </div> </div> </div> </div> </div> <div class="ui vertical divider"> </div> </div> </div> </div> \x3c!-- devices tab --\x3e <div id="costumerDevicesTabContainer" ng-if="settingsTab == \'devices\'" class="twelve wide stretched column"> <div id="settingsDevicesWarningMessage" class="ui warning message" ng-show="settingsDevicesWarningMessage.show"> <i class="close icon" ng-click="closeSettingsDevicesWarningMessage()"></i> <div class="header"> {{settingsDevicesWarningMessage.title}} </div> {{settingsDevicesWarningMessage.message}} </div> <div class="ui segments no-padding"> <div class="ui segment basic no-padding-bottom"> <h4 class="ui left floated header font-medium"> {{"Devices" | translate}} </h4> </div> <div class="ui segment basic settings-intab-container"> <div class="ui one column grid stackable grid container setting-intab-columns"> <div class="column"> <div class="settings-zone"> <div id="savedMessage" class="ui success message hide"> <p><strong>{{"PIN for the device" | translate}} <i>{{savingPin.description ? savingPin.description : savingPin.id}}</i> {{"was successfully" | translate}} {{"saved" | translate}}.</strong></p> </div> <div id="onOfMessage" class="ui success message hide"> <p><strong>{{"PIN for the device" | translate}} <i>{{savingPin.description ? savingPin.description : savingPin.id}}</i> {{"was successfully" | translate}} {{savingPin.enabled ? \'enabled\' : \'disabled\' | translate}}.</strong></p> </div> <div id="saveErrorMessage" class="ui error message hide"> <p><strong>{{"Error while saving" | translate}}.</strong></p> </div> <div class="left-align"> <div class="ui cards"> \x3c!-- if is physical --\x3e <div ng-if="d.type==\'physical\'" class="ui card" ng-repeat="d in currentUser.endpoints.extension"> <div class="content h-75 maxh-75"> <div title="{{d.model}}" class="center aligned header text-cut">{{d.model ? d.model : \'Physical Phone\' | translate}}</div> </div> <div class="extra content fontBold"> {{d.status === \'offline\' ? \'Offline\' : \'Online\' | translate}} <i ng-if="d.status !== \'offline\'" class="check circle green icon" aria-hidden="true"></i> <i ng-if="d.status === \'offline\'" class="remove grey icon" aria-hidden="true"></i> </div> <div ng-if="view.pinShow" class="extra content"> <div class="grouped fields mb-10"> <label class="ng-binding">{{\'PIN code for external calls\' | translate}}:</label> </div> <div class="center aligned author"> <div class="ui fluid action input"> <input class="" type="{{!showPin[d.id] ? \'password\' : \'text\'}}" ng-model="devicesPin[d.id].pin" placeholder="PIN"> <button ng-click="savePinConfirm(d, devicesPin[d.id].pin, devicesPin[d.id].enabled)" class="ui button">{{"Save" | translate}}</button> </div> </div> </div> <div ng-if="view.pinShow" class="extra content" style="border-top: 0px !important"> <span data-tooltip="{{showPin[d.id] ? \'Hide\' : \'Show\' | translate}}" data-position="bottom center"> <i ng-click="showPin[d.id] = !showPin[d.id]" class="eye icon pointer"></i> </span> <span data-tooltip="{{devicesPin[d.id].enabled ? \'Disable\' : \'Enable\' | translate}}" data-position="bottom center"> <i ng-click="onOfPinConfirm(d, devicesPin[d.id].pin, devicesPin[d.id].enabled)" class="{{devicesPin[d.id].enabled ? \'lock\' : \'unlock\'}} icon pointer"></i> </span> <span data-tooltip="{{\'Random PIN\' | translate}}" data-position="bottom center"> <i ng-click="createRandomPin(d.id)" class="random icon pointer"></i> </span> </div> <div class="extra content" ng-show="d.status !== \'offline\' &&\n                          parseInt(d.numLineKeys) > 0 &&\n                          currentUser.profile.macro_permissions.settings.permissions.phone_buttons.value === true &&\n                          provisioningEngine === \'tancredi\'"> <div class="grouped fields mb-10"> <label class="ng-binding">{{\'Customize physical buttons\' | translate}}:</label> </div> <div class="content"> <button class="ui button" ng-click="showDialogSetBtns(d.id)">{{"Set buttons" | translate}}</button> </div> </div> </div> \x3c!-- if is mobile --\x3e <div ng-if="d.type==\'mobile\'" class="ui card" ng-repeat="d in currentUser.endpoints.extension"> <div class="content h-75 maxh-75"> <div class="center aligned header">{{"Mobile App" | translate}} <i class="fa fa-mobile" aria-hidden="true"></i></div> </div> <div class="extra content fontBold"> {{d.status === \'offline\' ? \'Offline\' : \'Online\' | translate}} <i ng-if="d.status !== \'offline\'" class="check circle green icon" aria-hidden="true"></i> <i ng-if="d.status === \'offline\'" class="remove grey icon" aria-hidden="true"></i> </div> <div class="extra content"> <div class="grouped fields mb-10"> <label class="ng-binding">{{\'QR Code for fast login\' | translate}}:</label> </div> <div class="center aligned author"> <button ng-click="showConfirmQrCode()" class="ui button"> {{"Generate QR" | translate}} </button> </div> </div> </div> \x3c!-- if is web --\x3e <div ng-if="d.type==\'webrtc\'" class="ui card" ng-repeat="d in currentUser.endpoints.extension"> <div class="content h-75 maxh-75"> <div class="center aligned header">{{"Web Phone" | translate}} <i class="fa fa-mobile" aria-hidden="true"></i></div> </div> <div class="extra content fontBold"> {{d.status === \'offline\' ? \'Offline\' : \'Online\' | translate}} <i ng-if="d.status !== \'offline\'" class="check circle green icon" aria-hidden="true"></i> <i ng-if="d.status === \'offline\'" class="remove grey icon" aria-hidden="true"></i> </div> <div class="extra content no-padding" style="border-top: 0px !important"> </div> </div> </div> </div> </div> </div> </div> </div> </div> </div> \x3c!-- theme tab --\x3e <div id="themeTabContainer" ng-if="settingsTab == \'theme\'" class="twelve wide stretched column"> <div class="ui segments no-padding"> <div class="ui segment basic no-padding-bottom"> <h4 class="ui left floated header font-medium"> {{"Theme" | translate}} </h4> </div> <div class="ui segment basic settings-intab-container pb-0"> <div class="ui one column grid stackable grid container setting-intab-columns mb-0"> <div class="column pb-5"> <p> <label> {{"Select the color scheme to apply" | translate}}: </label> </p> <div id="colorsContainer" when-scrolled="loadMoreColors()"> <div id="resetColorContainer" class="color-container"> <div id="resetColor" class="color-card ui inverted blue menu {{selectedColor == \'\' ? \'active-color\' : \'\'}}" ng-click="resetThemeColor()"> </div> </div> <div class="color-container" ng-repeat="colorObj in colors | limitTo: colorsLimit"> <div class="color-card" ng-class="isColorSet(colorObj) ? \'active-color\' : \'\'" ng-if="colorObj.colors.length == 2" ng-click="setColor(colorObj.colors)" ng-style="{background: \'linear-gradient(to right,\' + colorObj.colors[0] + \', \' + colorObj.colors[1] + \')\'}"> </div> <div class="color-card" ng-class="isColorSet(colorObj) ? \'active-color\' : \'\'" ng-if="colorObj.colors.length == 3" ng-click="setColor(colorObj.colors)" ng-style="{background: \'linear-gradient(to right,\' + colorObj.colors[0] + \', \' + colorObj.colors[1] + \', \' + colorObj.colors[2] + \')\'}"> </div> <div class="color-card {{selectedColor == colorObj.colors ? \'active-color\' : \'\'}}" ng-class="isColorSet(colorObj) ? \'active-color\' : \'\'" ng-if="colorObj.colors.length == 4" ng-click="setColor(colorObj.colors)" ng-style="{background: \'linear-gradient(to right,\' + colorObj.colors[0] + \', \' + colorObj.colors[1] + \', \' + colorObj.colors[2] + \', \' + colorObj.colors[3] + \')\'}"> </div> <div class="color-card" ng-class="isColorSet(colorObj) ? \'active-color\' : \'\'" ng-if="colorObj.colors.length == 5" ng-click="setColor(colorObj.colors)" ng-style="{background: \'linear-gradient(to right,\' + colorObj.colors[0] + \', \' + colorObj.colors[1] + \', \' +colorObj.colors[2] + \', \' + colorObj.colors[3] + \', \' +colorObj.colors[4] + \')\'}"> </div> </div> </div> </div> </div> </div> </div> </div> </div> </div> \x3c!-- physical phone buttons --\x3e <div ng-include="settingsPhonesUrl"></div> </div> <div id="pin-save-message" class="ui basic small modal"> <div class="ui icon header"> <i class="lock icon"></i> PIN </div> <div class="content"> <p class="center-align font-large">{{\'You are going to set the PIN for the device\' | translate}} {{savingPin.description ? savingPin.description : savingPin.id}}</p> <p class="center-align font-large">{{\'Continue\' | translate}}?</p> </div> <div class="actions"> <div ng-click="hidePinModal()" class="ui gray basic cancel inverted button"> <i class="remove icon"></i> No </div> <div ng-click="savePin(\'save\')" class="ui red ok inverted button"> <i class="checkmark icon"></i> {{\'Yes\' | translate}} </div> </div> </div> <div id="QRCodeModal" class="ui tiny modal"> <div class="header"> {{"QR Code" | translate}} </div> <div class="content"> <p class="weighted font-medium"> {{"Scan the following QR Code using the mobile app for fast login" | translate}}: </p> <div id="qrCodeCanvasContainer" class="center-align"> <div ng-show="qrLoading" class="ui active centered medium loader"></div> <canvas ng-show="qrLoading === false" id="qrCodeCanvas"></canvas> </div> </div> <div class="actions"> <div class="ui cancel button">{{"Close" | translate}}</div> </div> </div> <div id="QRConfirmModal" class="ui basic small modal"> <div class="ui icon header"> <i class="qrcode icon"></i> {{\'New QR code\' | translate}} </div> <div class="content"> <p class="center-align font-large">{{\'After generating a new QR code you must login to the app\' | translate}}.</p> <p class="center-align font-large">{{\'Continue\' | translate}}?</p> </div> <div class="actions"> <div class="ui gray basic cancel inverted button"> <i class="remove icon"></i> No </div> <div class="ui red ok inverted button"> <i class="checkmark icon"></i> {{\'Yes\' | translate}} </div> </div> </div> <div id="pin-onof-message" class="ui basic small modal"> <div class="ui icon header"> <i class="{{savingPin.enabled ? \'lock\' : \'unlock\'}} icon"></i> PIN </div> <div class="content"> <p class="center-align font-large">{{\'You are going to\' | translate}} {{savingPin.enabled ? \'enable\' : \'disable\' | translate}} {{\'the PIN for the device\' | translate}} {{savingPin.description ? savingPin.description : savingPin.id}}</p> <p class="center-align font-large">{{\'Continue\' | translate}}?</p> </div> <div class="actions"> <div ng-click="hideOnOfModal()" class="ui gray basic cancel inverted button"> <i class="remove icon"></i> No </div> <div ng-click="savePin(\'onof\')" class="ui red ok inverted button"> <i class="checkmark icon"></i> {{\'Yes\' | translate}} </div> </div> </div>'),e.put("views/streaming.html",'<div class="ui segment adjust-segment-container"> <div ng-show="viewLoad" class="ui active centered inline loader"></div> <div ng-show="!viewLoad"> <h3 class="ui green header title-header"> <i class="green white record icon"></i> <div class="content"> {{\'Video sources\' | translate}} </div> <span data-tooltip="{{\'Operators\' | translate}}" data-position="left center" class="float-right adjust-title-park"> <i ng-click="goTo(\'\')" class="blue user link icon no-margin-right"></i> </span> </h3> <div class="ui cards"> <div ng-repeat="(k,s) in sources" class="inverted green card"> <div class="image"> <img class="video-source-img" ng-src="{{s.url}}"> </div> <div class="content"> <div class="header">{{s.description}}</div> </div> <div class="extra content"> <span class="right floated"> <a ng-href="{{s.url}}" download="screenshot.jpg"> <span data-tooltip="{{\'Take screenshot\' | translate}}" data-position="top center"> <i class="photo link blue icon"></i> </span> </a> <span ng-if="s.extension" ng-click="unlockSource(s)" data-tooltip="{{\'Unlock\' | translate}}" data-position="top center"> <i class="unlock alternate brown link icon"></i> </span> <span ng-if="s.extension" ng-click="speakSource(s)" data-tooltip="{{\'Speak\' | translate}}" data-position="top center"> <i class="unmute red link icon"></i> </span> </span> <span ng-if="s.extension"> <i class="call icon"></i> {{s.extension}} </span> </div> </div> </div> <div ng-show="sources | isempty:true" class="ui message large-margin-top"> <div class="header"> {{\'No video sources found\' | translate}} </div> </div> </div> </div>'),e.put("views/templates/callpopup.html",'<div id="incomingCall" class="ui item window-chat {{currentConference.exists ? \'callIncomingPopup\' : \'\'}}" ng-show="!currentCall.accepted && currentCall.incoming && !currentConference.joining"> <div class="ui segments no-margin-top"> <div class="ui secondary segment action-call-window"> <h5 class="ui header no-margin-bottom"> <div class="content"> <div ng-if="!currentCall.isSpy && !currentCall.isIntrude" title="{{currentCall.displayname}}" class="adjust-long-name-footer loader-margin">{{currentCall.displayname}}</div> <div ng-if="currentCall.isSpy" class="adjust-long-name-footer loader-margin">{{\'SPY\' | translate}} {{currentCall.actionDisplayName ? \'->\' : \'\'}} {{currentCall.actionDisplayName}}</div> <div ng-if="currentCall.isIntrude" class="adjust-long-name-footer loader-margin">{{\'INTRUDE\' | translate}} {{currentCall.actionDisplayName ? \'->\' : \'\'}} {{currentCall.actionDisplayName}}</div> </div> <a data-tooltip="{{\'Show customer card\' | translate}}" data-position="top center" ng-click="goTo(\'customercard/\' + currentCall.conversation.counterpartNum)" ng-if="!view.initRecordCall && currentUser.profile.macro_permissions.customer_card.value && currentCall.incoming && !(currentCall.isSpy || currentCall.isIntrude || currentCall.isPBX)" class="ui label blue call-hangup-detail float-right"> <i class="browser icon no-margin-right"></i> </a> </h5> <i class="call icon"></i> <span class="gray">{{\'Incoming call\' | translate}}</span> </div> <div class="ui segment no-padding center-align"> <span class="footer-span footer-span-answer"> <a ng-show="currentUser.default_device.actions.answer" ng-click="disableCallAnswer ? \'\' : answer()" class="ui label green large button"> <i class="call icon"></i> {{\'Answer\' | translate}} </a> <a ng-hide="currentCall.isSpy || currentCall.isIntrude" ng-click="decline()" class="ui label red large button"> <i class="remove icon"></i> {{\'Decline\' | translate}} </a> </span> </div> </div> </div>'),e.put("views/templates/footerbar.html",'<div class="ui item window-chat"> \x3c!-- New call from conference box--\x3e <div ng-if="currentConference.isNewUser && !currentConference.isMinimized && currentConference.exists" class="ui segments small-margin-bottom no-margin-top no-shadow"> <div class="ui segment no-padding center-align gray-back"> <div class="scrolling menu"> <div class="item item-conf"> <form ng-submit="!currentConference.isCallingFromConf ? call(currentConference.userToCall, true) : \'\'"> <div class="ui icon input full-search-head"> <div class="ui search" id="confNewUserInput"> <div class="ui icon input transfer-input-action full-search-head"> <input ng-change="conferenceDestInputChanged()" ng-attr-title="{{currentConference.destToCallTitle}}" ng-model="currentConference.userToCallDislpay" class="prompt no-radius" type="text" placeholder="{{\'Search\' | translate}}..."> <i class="{{currentConference.isCallingFromConf ? \'spinner loading\' : \'search\'}} icon"></i> </div> <div class="results top-float-results transfer-search-list"></div> </div> <i ng-click="!currentConference.isCallingFromConf ? call(currentConference.userToCall, true) : \'\'" data-content="{{\'Call\' | translate}}" data-position="bottom center" class="call link icon item"></i> </div> </form> </div> </div> </div> </div> \x3c!-- conference container--\x3e <div id="conferenceContainer" class="ui item {{currentConference.isMinimized ? \'minimized-min-width\' : \'\'}} {{currentCall.incoming && !currentCall.isVisible && !currentConference.joining ? \'conference-margin-incoming-call\' : \'\'}}" ng-show="currentConference.exists && currentConference.isOwner"> <div class="ui segments no-margin-top"> <div id="confHeader" class="ui secondary segment action-call-window users-in-conference"> <h5 class="ui header"> {{"Conference" | translate}} <span class="float-right action-call-expand item"> <span ng-click="currentConference.isMinimized = !currentConference.isMinimized"> <i class="link {{currentConference.isMinimized ? \'plus\' : \'minus\'}} icon reset-right-margin"></i> </span> </span> </h5> </div> <div ng-repeat="user in currentConference.data.users" ng-if="!currentConference.isClose && !user.owner && !currentConference.isMinimized" class="ui secondary segment action-call-window users-in-conference"> <div class="conference-element"> <div class="conf-titles"> <h5 class="ui header"> {{user.name ? user.name : user.extenId}} </h5> </div> <div class="conf-titles conf-subtitle"> {{user.name ? user.extenId : \'\'}} </div> <span class="float-right {{user.name ? \'conf-floated-container\' : \'conf-floated-container-nosub\'}}"> <button ng-click="user.mutedListenSpeak ? toggleMuteUserConf(user.id, false, user.extenId, undefined, true) : toggleMuteUserConf(user.id, true, user.extenId, \'all\')" data-tooltip="{{user.mutedListenSpeak ? \'Enable listen\' : \'Mute listen/speak\' | translate}}" data-position="top center" ng-disabled="!currentConference.joined" class="ui icon button basic tiny conference-buttons conf-actions-buttons"> <a class="pointer item icon-center"> <i class="large {{user.mutedListenSpeak ? \'deaf olive\' : \'assistive listening systems grey\'}} icon icon-header-custom"></i> </a> </button> <button ng-click="user.muted ? toggleMuteUserConf(user.id, false, user.extenId) : toggleMuteUserConf(user.id, true, user.extenId)" data-tooltip="{{user.muted ? \'Unmute\' : \'Mute\' | translate}}" ng-disabled="!currentConference.joined" data-position="top center" class="ui icon button basic tiny conference-buttons conf-actions-buttons"> <a class="pointer item icon-center"> <i class="large {{user.muted ? \'olive mute\' : \'grey unmute\'}} icon icon-header-custom"></i> </a> </button> <button ng-click="removeUserConf(user.extenId)" data-tooltip="{{\'Remove\' | translate}}" data-position="top center" class="ui icon button basic tiny conference-buttons conf-actions-buttons"> <a class="pointer item hover-red icon-center"> <i class="large photo icon window close outline red"></i> </a> </button> <span> </span></span></div> </div> <div class="ui secondary segment {{(janus.isAvailable && !janus.isConfigured) || view.noCallsAvailable ? \'\' : \'action-call-window\'}}"> <h5 class="ui header"> <div class="content full-search-head"> <div class="adjust-long-name-footer {{!currentConference.joined ? \'grey-disabled\' : \'\'}}">{{currentUser.name | cleanName}}</div> <div class="sub header right-align"> <span data-tooltip="{{\'Conference\' | translate}}" data-position="top left" class="ui label gray call-hangup-detail call-popup-margin"> <i class="icons"> <i class="users icon reset-right-margin grey"></i> <i class="corner microphone icon grey conference-microphone-icon-small"> </i> </i> </span> <button ng-click="currentConference.joined ? singOutConference() : singInConference()" ng-disabled="currentConference.joinLeaveDisabled" class="ui label {{currentConference.joined && !currentConference.joinLeaveDisabled ? \'orange\' : \'green\'}} {{currentConference.joinLeaveDisabled ? \'disabled\' : \'\'}} call-hangup-detail call-popup-margin"> <i class="{{currentConference.joined && !currentConference.joinLeaveDisabled ? \'sign out alternate\' : \'sign in alternate\'}} white icon"></i> {{currentConference.joined && !currentConference.joinLeaveDisabled ? \'Leave\' : \'Enter\' | translate}} </button> <div> <div chrono-timer timer-name="myTimer" start-time="currentConference.startTime + clientServerTimeDiff" class="call-minute-detail call-time-margin">{{hours|zeropad}}:{{minutes|zeropad}}:{{seconds|zeropad}}</div> </div> </div> </div> </h5> </div> <div ng-hide="currentConference.isMinimized" class="ui segment no-padding center-align"> <span class="footer-span"> <a ng-click="addConfUser()" class="pointer item adjust-padding" data-tooltip="{{\'Invite\' | translate}}" data-position="top left"> <i class="large {{currentConference.isNewUser ? \'blue\' : \'grey\'}} add user icon"></i> </a> <a ng-click="currentConference.isMute ? toggleMuteConf(false, \'multiple\') : toggleMuteConf(true, \'multiple\')" class="pointer item adjust-padding" ng-disabled="!currentConference.joined" data-tooltip="{{currentConference.isMute ? \'Unmute\' : \'Mute\' | translate}}" data-position="top center"> <i class="large {{currentConference.isMute ? \'olive mute\' : \'grey unmute\'}} {{ !currentConference.joined ? \'disabled nocursor\' : \'cursorPointer\' }} icon icon-header-custom plus-adjust-top"></i> </a> <a ng-click="currentConference.isClose = !currentConference.isClose" class="pointer item adjust-padding" data-tooltip="{{currentConference.isClose ? \'Show participants\' : \'Hide participants\' | translate}}" data-position="top center"> <i class="large {{currentConference.isClose ? \'eye grey\' : \'hide blue\'}} icon"></i> </a> <a ng-click="closeConfirmConf()" class="pointer item adjust-padding hover-red" data-tooltip="{{\'Close\' | translate}}" data-position="top center"> <i class="large grey photo icon window close outline"></i> </a> </span> </div> </div> </div> \x3c!-- Call container --\x3e <div id="callContainer" class="ui item {{currentConference.exists ? \'small-margin-top-down\' : \'\'}} {{currentCall.isClose ? \'minimized-min-width\' : \'\'}}" ng-show="currentCall.isVisible && \n        (currentCall.accepted || (janus.isAvailable && !janus.isConfigured) || view.noCallsAvailable) && \n        !view.initRecordCall &&\n        (\n          (currentConference.exists === true && currentConference.addingMember === true && !currentConference.joining) ||\n          (currentConference.exists === false) ||\n          (currentConference.exists === true && currentCall.accepted && currentCall.incoming && !currentConference.joining && !currentConference.joined)\n        )"> <div ng-show="currentCall.isVideo && !currentCall.isClose" class="ui segments small-margin-bottom no-shadow"> <div class="ui segment no-padding center-align black-back"> <div class="scrolling menu"> <video class="localStream" id="localStream" muted autoplay></video> <audio class="remoteStream" id="remoteStreamAudio" autoplay></audio> <video class="remoteStream" id="remoteStreamVideo" autoplay></video> </div> </div> </div> <div ng-show="currentCall.keypadShow && !currentCall.isClose" class="ui segments small-margin-bottom no-margin-top no-shadow"> <div class="ui segment no-padding center-align gray-back"> <div class="scrolling menu"> <div class="item active selected"> <div class="ui fluid buttons"> <button ng-click="DTMF(\'1\')" class="ui purple button keypad-button">1</button> <button ng-click="DTMF(\'2\')" class="ui purple button keypad-button">2</button> <button ng-click="DTMF(\'3\')" class="ui purple button keypad-button">3</button> </div> </div> <div class="item"> <div class="ui fluid buttons"> <button ng-click="DTMF(\'4\')" class="ui purple button keypad-button">4</button> <button ng-click="DTMF(\'5\')" class="ui purple button keypad-button">5</button> <button ng-click="DTMF(\'6\')" class="ui purple button keypad-button">6</button> </div> </div> <div class="item"> <div class="ui fluid buttons"> <button ng-click="DTMF(\'7\')" class="ui purple button keypad-button">7</button> <button ng-click="DTMF(\'8\')" class="ui purple button keypad-button">8</button> <button ng-click="DTMF(\'9\')" class="ui purple button keypad-button">9</button> </div> </div> <div class="item"> <div class="ui fluid buttons"> <button ng-click="DTMF(\'*\')" class="ui purple button keypad-button">*</button> <button ng-click="DTMF(\'0\')" class="ui purple button keypad-button">0</button> <button ng-click="DTMF(\'#\')" class="ui purple button keypad-button">#</button> </div> </div> </div> </div> </div> \x3c!-- screen sharing --\x3e <div ng-show="currentCall.screenSharingShow && !currentCall.isClose" class="ui segments small-margin-bottom no-margin-top no-shadow"> <div class="ui segment no-padding center-align gray-back"> <div class="scrolling menu"> <div id="screencapture"></div> </div> </div> </div> \x3c!-- Xfer destinations list --\x3e <div ng-show="currentCall.transferShow && !currentCall.isClose" class="ui segments small-margin-bottom no-margin-top no-shadow"> <div class="ui segment no-padding center-align gray-back"> <div class="scrolling menu"> <div class="item"> <form ng-submit="transfer(currentCall.destToTransfer)"> <div class="ui icon input full-search-head"> <div class="ui search" id="transferInput"> <div class="ui icon input transfer-input-action full-search-head"> <input ng-change="transferDestInputChanged()" ng-attr-title="{{currentCall.destToTransferTitle}}" ng-model="currentCall.destToTransferName" class="prompt no-radius" type="text" placeholder="{{\'Search\' | translate}}..."> <i class="search icon"></i> </div> <div class="results top-float-results transfer-search-list"></div> </div> <i ng-click="atxferAbort()" data-content="{{\'Abort Transfer\' | translate}}" data-position="bottom center" ng-show="currentCall.attendedTransfering" class="{{currentCall.attendedAborting ? \'grey spinner loading icon nocursor\' : \'user times\'}} link icon item trasfer-action-abort"></i> <i ng-click="atxferConference()" data-content="{{\'Start Conference\' | translate}}" data-position="bottom center" ng-show="currentCall.attendedTransfering" class="{{currentCall.attendedConference ? \'grey spinner loading icon nocursor\' : \'users\'}} link icon item trasfer-action-conference"></i> <i ng-click="atxferSwap()" data-content="{{\'Swap person\' | translate}}" data-position="bottom center" ng-show="currentCall.attendedTransfering" class="{{currentCall.attendedSwapping ? \'grey spinner loading icon nocursor\' : \'assistive listening systems\'}} {{currentCall.attendedSwappingColor ? \'blue\' : \'\'}} link icon item trasfer-action-swapcall"></i> <i ng-click="transfer(currentCall.destToTransfer, \'blind\')" data-content="{{\'Blind\' | translate}}" data-position="bottom center" class="resize horizontal link icon item trasfer-action-blind"></i> <i ng-click="transfer(currentCall.destToTransfer)" data-content="{{\'Attended\' | translate}}" data-position="bottom center" class="random link icon item"></i> </div> </form> </div> </div> </div> </div> \x3c!-- User\'s endpoints list --\x3e <div ng-show="currentCall.endpointsTransferShow && !currentCall.isClose" class="ui segments small-margin-bottom no-margin-top no-shadow"> <div class="ui segment no-padding center-align gray-back"> <div class="scrolling menu"> <div class="item"> <form ng-submit="transfer(currentCall.destToTransfer)"> <div class="ui icon input full-search-head"> <div class="ui fluid selection dropdown no-radius full-search-head" id="switch-to-dropdown"> <input type="hidden" name="user"> <i class="dropdown icon"></i> <div class="default text">{{\'Switch to\' | translate}}:</div> <div class="menu"> <div ng-repeat="e in currentUser.endpoints.extension" ng-hide="allExtensions[e.id].status !== \'online\'" ng-click="selectEndpoint(e.id)" class="item" data-value="{{e.id}}"> <div class="flex-container text-cut"> <i class="call icon {{e.status === \'online\' ? \'green\' : \'gray\'}}"></i> {{e.type === \'mobile\' ? \'Mobile App\' : \'\' | translate}} {{e.type === \'webrtc\' ? \'Web Phone\' : \'\' | translate}} <div title="{{e.model}}" style="display: display-block"> {{e.type === \'physical\' && e.model ? e.model : e.type === \'physical\' && !e.model ? \'Physical Phone\' : \'\' | translate}} </div> </div> </div> </div> </div> </div> </form> </div> </div> </div> </div> <div class="ui segments no-margin-top"> <div class="ui secondary segment action-call-window"> <h5 class="ui header"> <span ng-show="currentCall.accepted && (!currentCall.isSpy && !currentCall.isIntrude && !currentCall.isPBX)" class="float-right action-call-expand item"> <span ng-click="currentCall.isClose = !currentCall.isClose"> <i class="link {{currentCall.isClose ? \'plus\' : \'minus\'}} icon reset-right-margin"></i> </span> </span> <div class="content full-search-head"> <div ng-show="view.noCallsAvailable" class="ui label brown footer-person-detail"> <i class="warning circle icon"></i> {{\'No devices found for this user\' | translate}} <a ng-if="!view.noCallsAvailableEver" ng-click="showDevicesListAvailable()" class="detail">{{\'Configure\' | translate}}</a> </div> <div class="adjust-long-name-footer2" title="{{currentCall.displayname}}" ng-show="currentCall.accepted && (!currentCall.isSpy && !currentCall.isIntrude && !currentCall.isPBX)">{{currentCall.displayname}}</div> <div class="adjust-long-name-footer2" ng-show="currentCall.isSpy || currentCall.isIntrude || currentCall.isPBX"> <span ng-if="currentCall.isSpy">{{\'SPY\' | translate}} {{currentCall.actionDisplayName ? \'->\' : \'\'}} {{currentCall.actionDisplayName}}</span> <span ng-if="currentCall.isIntrude">{{\'INTRUDE\' | translate}} {{currentCall.actionDisplayName ? \'->\' : \'\'}} {{currentCall.actionDisplayName}}</span> <span ng-if="currentCall.isPBX">{{currentCall.displayname | translate}}</span> </div> <div ng-show="currentCall.accepted" class="sub header right-align"> <span ng-hide="currentCall.isSpy || currentCall.isIntrude || currentCall.isPBX" data-tooltip="{{currentConference.joined ? \'Conference\' : currentCall.incoming ? \'Incoming call\' : \'Outgoing call\' | translate}}" data-position="top left" class="ui label gray call-hangup-detail call-popup-margin"> <i ng-if="!currentConference.joined" class="{{currentCall.incoming ? \'arrow left\' : \'arrow right\'}} icon no-margin-right"></i> <i ng-if="currentConference.joined" class="icons ng-scope"> <i class="users icon reset-right-margin grey"></i> <i class="corner microphone icon grey conference-microphone-icon-small"> </i> </i> </span> <a ng-if="currentCall.isSpy" data-tooltip="{{\'Spying\' | translate}}..." data-position="top left" class="ui label gray call-hangup-detail call-popup-margin"> <i class="spy icon no-margin-right"></i> </a> <a ng-if="currentCall.isIntrude" data-tooltip="{{\'Intruding\' | translate}}..." data-position="top left" class="ui label gray call-hangup-detail call-popup-margin"> <i class="compress icon no-margin-right"></i> </a> <a ng-if="currentCall.isPBX" data-tooltip="{{\'From PBX\' | translate}}" data-position="top left" class="ui label gray call-hangup-detail call-popup-margin"> <i class="text telephone icon no-margin-right"></i> </a> <a ng-click="hangup()" class="ui label red call-hangup-detail call-popup-margin"> <i class="call icon"></i> {{\'Hangup\' | translate}} </a> <a data-tooltip="{{\'Show customer card\' | translate}}" data-position="top center" ng-click="goTo(\'customercard/\' + currentCall.conversation.counterpartNum)" ng-if="currentUser.profile.macro_permissions.customer_card.value && currentCall.incoming && !(currentCall.isSpy || currentCall.isIntrude || currentCall.isPBX)" class="ui label blue call-hangup-detail"> <i class="browser icon no-margin-right"></i> </a> <a ng-if="currentCall.isVideo" ng-click="toggleVideo()" ng-show="currentCall.isVideoEnabled" class="ui label yellow call-hangup-detail"> <i class="hide icon no-margin-right"></i> </a> <a ng-click="toggleMute()" ng-show="currentCall.isMute" class="ui label olive call-hangup-detail"> <i class="mute icon no-margin-right"></i> </a> <a ng-click="togglePause()" ng-show="currentCall.isPause" class="ui label orange call-hangup-detail"> <i class="pause icon no-margin-right"></i> </a> <a ng-click="toggleRecord()" ng-show="currentCall.isRecord" class="ui label brown call-hangup-detail"> <i class="selected radio icon no-margin-right"></i> </a> <div ng-if="currentCall.accepted"> <div chrono-timer timer-name="myTimer" start-time="currentCall.startTime + clientServerTimeDiff" class="call-minute-detail call-time-margin">{{hours|zeropad}}:{{minutes|zeropad}}:{{seconds|zeropad}}</div> </div> </div> </div> </h5> </div> <div class="ui segment no-padding center-align" ng-hide="currentCall.isClose"> <span ng-show="currentCall.accepted && (!currentCall.isSpy && !currentCall.isIntrude)" class="footer-span"> <a ng-if="!currentCall.isPBX && currentUser.profile.macro_permissions.settings.permissions.conference.value" ng-click="addToConference()" class="pointer item adjust-padding" data-tooltip="{{currentConference.onStarting ? \'Loading\' + \'...\' : currentConference.exists ? \'Add to conference\' : \'Start conference\' | translate}}" data-position="top left"> <i ng-if="currentConference.onStarting" class="large grey spinner loading icon"></i> <i ng-if="!currentConference.onStarting" class="icons"> <i class="users large icon reset-right-margin grey conference-users-icon"></i> <i ng-if="!currentConference.exists" class="corner microphone icon grey conference-microphone-icon"></i> <i ng-if="currentConference.exists" class="corner plus icon grey conference-plus-icon"></i> </i> </a> <a ng-if="!currentCall.isPBX && extensionSwitchAvailable() && !currentConference.exists" ng-click="endpointsTransferShow()" class="pointer item adjust-padding" data-tooltip="{{currentCall.inSwitching ? \'Switching\' + \'...\' : \'Switch device\' | translate}}" data-position="top left"> <i class="large {{currentCall.endpointsTransferShow ? \'blue\' : \'grey\'}} {{currentCall.inSwitching && !currentConference.onStarting ? \'spinner loading\' : \'map signs\'}} icon icon-header-custom"></i> </a> <a ng-if="!currentCall.isPBX && currentCall.device.type != \'physical\' && currentCall.isVideoAvailable" ng-click="toggleLockVideo()" class="pointer item adjust-padding" data-tooltip="{{currentCall.isVideo ? \'Disable video\' : \'Enable video\' | translate}}" data-position="top center"> <i class="large {{currentCall.isVideo ? \'pink photo\' : \'grey photo\'}} icon icon-header-custom"></i> </a> <a ng-if="currentCall.isVideo" ng-click="expandVideo()" class="pointer item adjust-padding" data-tooltip="{{!currentCall.isVideoMax ? \'Expand video\' : \'Reduce video\' | translate}}" data-position="top center"> <i class="large {{currentCall.isVideoMax ? \'teal maximize\' : \'grey maximize\'}} icon icon-header-custom"></i> </a> <a ng-if="currentCall.isVideo" ng-click="toggleVideo()" class="pointer item adjust-padding" data-tooltip="{{currentCall.isVideoEnabled ? \'Show video\' : \'Hide video\' | translate}}" data-position="top center"> <i class="large {{currentCall.isVideoEnabled ? \'yellow hide\' : \'grey unhide\'}} icon icon-header-custom"></i> </a> <a ng-if="!currentCall.isPBX" ng-click="showTransfer()" class="pointer item adjust-padding" data-tooltip="{{currentCall.inTransfer ? \'Trasfering...\' : \'Transfer\' | translate}}" data-position="top center"> <i class="large {{currentCall.transferShow ? \'blue\' : \'grey\'}} {{currentCall.inTransfer && !currentCall.inSwitching ? \'spinner loading\' : \'random\'}} icon custom-callbox-iconsize icon-header-custom"></i> </a> <a ng-if="!currentCall.isPBX" ng-click="toggleMute()" class="pointer item adjust-padding" data-tooltip="{{currentCall.isMute ? \'Unmute\' : \'Mute\' | translate}}" data-position="top center"> <i class="large {{currentCall.isMute ? \'olive mute\' : \'grey unmute\'}} icon icon-header-custom"></i> </a> <a ng-show="currentUser.default_device.actions.hold" ng-if="!currentCall.isPBX" ng-click="togglePause()" class="pointer item adjust-padding" data-tooltip="{{currentCall.isPause ? \'Stop pause\' : \'Pause\' | translate}}" data-position="top center"> <i class="large {{currentCall.isPause ? \'orange\' : \'grey\'}} pause icon icon-header-custom"></i> </a> <a ng-if="!currentCall.isPBX && currentUser.profile.macro_permissions.settings.permissions.recording.value" ng-click="toggleRecord()" class="pointer item adjust-padding" data-tooltip="{{currentCall.isRecord ? \'Stop record\' : \'Record\' | translate}} {{currentCall.isVideo ? \'audio\' : \'\'}}" data-position="top center"> <i class="large {{currentCall.isRecord ? \'brown\' : \'grey\'}} selected radio icon icon-header-custom"></i> </a> <a ng-if="!currentCall.isPBX && currentUser.profile.macro_permissions.settings.permissions.parkings.value && !currentCall.isVideo" ng-click="park()" class="pointer item adjust-padding" data-tooltip="{{\'Park\' | translate}}" data-position="top center"> <i class="large yellow product hunt icon icon-header-custom"></i> </a> <a ng-show="currentUser.default_device.actions.dtmf" ng-click="currentCall.keypadShow = !currentCall.keypadShow; currentCall.transferShow = false" class="pointer item adjust-padding" data-tooltip="{{\'Numeric Pad\' | translate}}" data-position="top center"> <i class="large purple grid layout icon icon-header-custom"></i> </a> <a ng-show="haveParamUrl && currentCall.conversation.direction === \'in\' &&\n              (\n                (haveParamUrlOnlyQueues === true && currentCall.conversation.throughQueue === true) ||\n                (haveParamUrlOnlyQueues === false && (currentCall.conversation.throughQueue === true || currentCall.conversation.throughTrunk === true))\n              )" ng-click="openParamUrl(currentCall.conversation.counterpartNum, currentCall.conversation.counterpartName, currentCall.conversation.owner, currentCall.conversation.uniqueId)" class="pointer item adjust-padding" data-tooltip="{{\'Parameterized URL\' | translate}}" data-position="top center"> <i class="large grey linkify layout icon icon-header-custom"></i> </a> <a ng-if="!currentCall.isPBX && !screenSharing.active &&\n              currentUser.profile.macro_permissions.settings.permissions.screen_sharing.value === true" ng-click="startScreenSharing()" class="pointer item adjust-padding" data-tooltip="{{\'Screen share\' | translate}}" data-position="top center"> <i class="large desktop grey icon icon-header-custom"></i> </a> <a ng-if="!currentCall.isPBX && screenSharing.active === true && currentUser.profile.macro_permissions.settings.permissions.screen_sharing.value && currentUser.profile.macro_permissions.settings.permissions.screen_sharing.value" ng-click="stopScreenSharing(true)" class="pointer item adjust-padding" data-tooltip="{{\'Stop screen sharing\' | translate}}" data-position="top center"> <i class="large desktop icon icon-header-custom"></i> </a> <a ng-if="opPanel.show" class="pointer item adjust-padding" data-tooltip="{{\'Drag to transfer\' | translate}}" data-position="top left"> <i class="icons" id="opid-dragdrop-icon" data-ch="{{currentCall.conversation.id}}" data-drag="true" jqyoui-draggable="{index: 0, insertInline: true, direction:\'jqyouiDirection\', onStart: \'startOpDragFromBox()\'}" data-jqyoui-options="{ revert: \'invalid\', helper: \'clone\', classes: { \'ui-draggable\': \'op-drag-bigger-icon\' }}" data-direction="{{s.jqyouiDirection}}"> <i class="phone large icon reset-right-margin color-red conference-users-icon"></i> <i class="move icon op-dragdrop-icon color-red"></i> </i> </a> </span>   </div> </div> </div> \x3c!-- conferenceUserContainer --\x3e <div id="conferenceUserContainer" class="ui item {{currentConference.exists ? \'small-margin-top-down\' : \'\'}} {{currentCall.isClose ? \'minimized-min-width\' : \'\'}}" ng-show="currentConference.exists && currentConference.isOwner === false"> <div ng-show="currentCall.isVideo && !currentCall.isClose" class="ui segments small-margin-bottom no-shadow"> <div class="ui segment no-padding center-align black-back"> <div class="scrolling menu"> <video class="localStream" id="localStream" muted autoplay></video> <audio class="remoteStream" id="remoteStreamAudio" autoplay></audio> <video class="remoteStream" id="remoteStreamVideo" autoplay></video> </div> </div> </div> \x3c!-- User\'s endpoints list --\x3e <div ng-show="currentCall.endpointsTransferShow && !currentCall.isClose" class="ui segments small-margin-bottom no-margin-top no-shadow"> <div class="ui segment no-padding center-align gray-back"> <div class="scrolling menu"> <div class="item"> <form ng-submit="transfer(currentCall.destToTransfer)"> <div class="ui icon input full-search-head"> <div class="ui fluid selection dropdown no-radius full-search-head" id="switch-to-dropdown"> <input type="hidden" name="user"> <i class="dropdown icon"></i> <div class="default text">{{\'Switch to\' | translate}}:</div> <div class="menu"> <div ng-repeat="e in currentUser.endpoints.extension" ng-hide="allExtensions[e.id].status !== \'online\'" ng-click="selectEndpoint(e.id)" class="item" data-value="{{e.id}}"> <i class="call icon {{e.status === \'online\' ? \'green\' : \'gray\' }}"></i> {{e.type === \'mobile\' ? \'Mobile\' : \'\'}} {{e.type === \'physical\' ? \'Telefono Fisico\' : \'\' | translate}} {{e.type === \'webrtc\' ? \'Telefono Web\' : \'\' | translate}} </div> </div> </div> </div> </form> </div> </div> </div> </div> <div class="ui segments no-margin-top"> <div ng-repeat="user in currentConference.data.users" ng-if="!currentConference.isClose && !currentCall.isClose && !user.owner && currentConference.exists" class="ui secondary segment {{(janus.isAvailable && !janus.isConfigured) || view.noCallsAvailable ? \'no-padding\' : \'action-call-window\'}} users-in-conference"> <div class="conference-element"> <div class="conf-titles"> <h5 class="ui header"> {{user.name ? user.name : user.extenId}} </h5> </div> <div class="conf-titles conf-subtitle"> {{user.name ? user.extenId : \'\'}} </div> </div> </div> <div class="ui secondary segment {{(janus.isAvailable && !janus.isConfigured) || view.noCallsAvailable ? \'no-padding\' : \'action-call-window\'}}"> <h5 class="ui header"> <span ng-show="currentCall.accepted && (!currentCall.isSpy && !currentCall.isIntrude && !currentCall.isPBX)" class="float-right action-call-expand item"> <span ng-click="currentCall.isClose = !currentCall.isClose"> <i class="link {{currentCall.isClose ? \'plus\' : \'minus\'}} icon reset-right-margin"></i> </span> </span> <div class="content full-search-head"> <div class="adjust-long-name-footer {{!currentConference.userIsOnline && currentConference.joined ? \'grey-disabled\' : \'\'}}" ng-show="currentCall.accepted && (!currentCall.isSpy && !currentCall.isIntrude && !currentCall.isPBX)">{{currentCall.displayname | cleanName}}</div> <div class="adjust-long-name-footer {{!currentConference.userIsOnline && currentConference.joined ? \'grey-disabled\' : \'\'}}" ng-show="currentCall.isSpy || currentCall.isIntrude || currentCall.isPBX">{{currentCall.displayname | translate}}</div> <div ng-show="currentCall.accepted" class="sub header right-align"> <span ng-hide="currentCall.isSpy || currentCall.isIntrude || currentCall.isPBX" data-tooltip="{{currentConference.joined ? \'Conference\' : currentCall.incoming ? \'Incoming call\' : \'Outgoing call\' | translate}}" data-position="top left" class="ui label gray call-hangup-detail call-popup-margin"> <i ng-if="!currentConference.joined" class="{{currentCall.incoming ? \'arrow left\' : \'arrow right\'}} icon no-margin-right"></i> <i ng-if="currentConference.joined" class="icons ng-scope"> <i class="users icon reset-right-margin grey"></i> <i class="corner microphone icon grey conference-microphone-icon-small"> </i> </i> </span> <a ng-if="currentCall.isSpy" data-tooltip="{{\'Spying\' | translate}}..." data-position="top left" class="ui label gray call-hangup-detail call-popup-margin"> <i class="spy icon no-margin-right"></i> </a> <a ng-if="currentCall.isIntrude" data-tooltip="{{\'Intruding\' | translate}}..." data-position="top left" class="ui label gray call-hangup-detail call-popup-margin"> <i class="compress icon no-margin-right"></i> </a> <a ng-if="currentCall.isPBX" data-tooltip="{{\'From PBX\' | translate}}" data-position="top left" class="ui label gray call-hangup-detail call-popup-margin"> <i class="text telephone icon no-margin-right"></i> </a> <a ng-click="hangup()" class="ui label red call-hangup-detail call-popup-margin"> <i class="call icon"></i> {{\'Hangup\' | translate}} </a> <a data-tooltip="{{\'Show customer card\' | translate}}" data-position="top center" ng-click="goTo(\'customercard/\' + currentCall.conversation.counterpartNum)" ng-if="currentUser.profile.macro_permissions.customer_card.value && currentCall.incoming && !(currentCall.isSpy || currentCall.isIntrude || currentCall.isPBX)" class="ui label blue call-hangup-detail"> <i class="browser icon no-margin-right"></i> </a> <a ng-if="currentCall.isVideo" ng-click="toggleVideo()" ng-show="currentCall.isVideoEnabled" class="ui label yellow call-hangup-detail"> <i class="hide icon no-margin-right"></i> </a> <a ng-click="toggleMute()" ng-show="currentCall.isMute" class="ui label olive call-hangup-detail"> <i class="mute icon no-margin-right"></i> </a> <a ng-click="togglePause()" ng-show="currentCall.isPause" class="ui label orange call-hangup-detail"> <i class="pause icon no-margin-right"></i> </a> <a ng-click="toggleRecord()" ng-show="currentCall.isRecord" class="ui label brown call-hangup-detail"> <i class="selected radio icon no-margin-right"></i> </a> <div ng-if="currentCall.accepted"> <div chrono-timer timer-name="myTimer" start-time="currentCall.startTime + clientServerTimeDiff" class="call-minute-detail call-time-margin">{{hours|zeropad}}:{{minutes|zeropad}}:{{seconds|zeropad}}</div> </div> </div> </div> </h5> </div> <div class="ui segment no-padding center-align" ng-hide="currentCall.isClose"> <span ng-show="currentCall.accepted && (!currentCall.isSpy && !currentCall.isIntrude)" class="footer-span"> <a ng-if="!currentCall.isPBX && !currentConference.joined && !currentConference.callerHasConf && currentUser.profile.macro_permissions.settings.permissions.conference.value && !currentConference.isOutgoing" ng-click="addToConference()" class="pointer item adjust-padding" data-tooltip="{{currentConference.onStarting ? \'Loading\' + \'...\' : currentConference.exists ? \'Add to conference\' : \'Start conference\' | translate}}" data-position="top left"> <i ng-if="currentConference.onStarting" class="large grey spinner loading icon"></i> <i ng-if="!currentConference.onStarting" class="icons"> <i class="users large icon reset-right-margin grey conference-users-icon"></i> <i ng-if="!currentConference.exists" class="corner microphone icon grey conference-microphone-icon"></i> <i ng-if="currentConference.exists" class="corner plus icon grey conference-plus-icon"></i> </i> </a> <a ng-if="currentConference.joined" ng-click="currentConference.isClose = !currentConference.isClose" class="pointer item adjust-padding" data-tooltip="{{currentConference.isClose ? \'Show participants\' : \'Hide participants\' | translate}}" data-position="top center"> <i class="large {{currentConference.isClose ? \'eye grey\' : \'hide blue\'}} icon"></i> </a> <a ng-if="currentConference.joined && currentUser.default_device.type === \'webrtc\'" ng-click="currentConference.isMutedSelf ? toggleMuteSelfConf(false) : toggleMuteSelfConf(true)" class="pointer item adjust-padding" data-tooltip="{{currentCall.isMute ? \'Unmute\' : \'Mute\' | translate}}" data-position="top center"> <i class="large {{currentCall.isMute ? \'olive mute\' : \'grey unmute\'}} icon icon-header-custom"></i> </a> </span>   </div> </div> </div> </div> <div id="del-conference" class="ui basic small modal"> <div class="ui icon header"> <i class="users icon"></i> {{\'Hangup conference\' | translate}} </div> <div class="content"> <p class="center-align font-large">{{\'Are you sure\' | translate}}?</p> </div> <div class="actions"> <div ng-click="hideConfModal()" class="ui gray basic cancel inverted button"> <i class="remove icon"></i> No </div> <div ng-click="endConference()" class="ui red ok inverted button"> <i class="checkmark icon"></i> {{\'Yes\' | translate}} </div> </div> </div> <div id="call-inconference" class="ui basic small modal"> <div class="ui icon header"> <i class="call icon"></i> {{\'Calling in conference\' | translate}} </div> <div class="content"> <p class="center-align font-large">{{\'Yow are going to leave conference and call\' | translate}} {{currentConference.numberToCall}}</p> <p class="center-align font-large">{{\'Continue\' | translate}}?</p> </div> <div class="actions"> <div ng-click="hideCallModal()" class="ui gray basic cancel inverted button"> <i class="remove icon"></i> No </div> <div ng-click="callContinue(currentConference.numberToCall)" class="ui red ok inverted button"> <i class="checkmark icon"></i> {{\'Yes\' | translate}} </div> </div> </div> <div id="no-mic-warn-dialog" class="ui basic small modal"> <div class="ui icon header"> <i class="microphone slash icon"></i> {{\'It seems that no microphone is present. Please add one to make phone calls.\' | translate}} </div> <div class="content"> <p class="center-align font-large"> <span ng-if="speeddialToDelete.company" class="row-del-speeddial-confirm">{{\'Company\' | translate}}: {{speeddialToDelete.company}}</span> <span ng-if="speeddialToDelete.name" class="row-del-speeddial-confirm">{{\'Name\' | translate}}: {{speeddialToDelete.name}}</span> </p> </div> <div class="actions"> <div ng-click="hideNoMicWarnDialog()" class="ui red basic cancel button"> <i class="remove icon"></i> Ok </div> </div> </div>'),e.put("views/templates/leftbar.html",'\x3c!-- INCOMING CALLS --\x3e <div id="incomingContainer" class="{{wideop === false ? \'eight wide column h-285\' : \'\'}}"> <div class="oppanel-calls-height overflow-hidden ui left-sidebar-up oppanel-list-calls theme-radius mh-200"> <div class="overflow-hidden full-height"> <div class="ui top right pointing content dropdown adjust-responsive-padding speed-dropdown"> <h4 class="ui blue dividing header nocursor mb-0"> <span>{{\'Incoming calls\' | translate}}</span> <span class="setting icon float-right speed-settings nocursor">{{opPanel.numInCalls}}</span> </h4> </div> \x3c!-- INCOMING CALLS --\x3e <div class="oppanel-incall-buttons mt-10 mb-10"> <button ng-if="opPanel.data[opPanel.data.inQueue].members[currentUser.endpoints.mainextension[0].id].type === \'dynamic\' &&\n          opPanel.data[opPanel.data.inQueue].members[currentUser.endpoints.mainextension[0].id].loggedIn === false" ng-click="queueLogin(currentUser.endpoints.mainextension[0].id, opPanel.data.inQueue)" class="ui mini labeled icon button ng-binding ng-scope"> <i class="green play icon"></i> {{\'Login\' | translate}} </button> <button ng-if="opPanel.data[opPanel.data.inQueue].members[currentUser.endpoints.mainextension[0].id].type === \'dynamic\' && opPanel.data[opPanel.data.inQueue].members[currentUser.endpoints.mainextension[0].id].loggedIn === true" ng-click="queueLogout(currentUser.endpoints.mainextension[0].id, opPanel.data.inQueue)" class="ui mini labeled icon button"> <i class="red remove icon"></i> {{\'Logout\' | translate}} </button> <div ng-if="opPanel.data[opPanel.data.inQueue].members[currentUser.endpoints.mainextension[0].id].loggedIn === true" class="ui mini buttons"> <div ng-click="opPanel.data[opPanel.data.inQueue].members[currentUser.endpoints.mainextension[0].id].paused === true ? queueUnpauseOpp(currentUser.endpoints.mainextension[0].id, opPanel.data.inQueue) : queuePauseOpp(currentUser.endpoints.mainextension[0].id, opPanel.data.inQueue)" class="ui button"> <i ng-if="opPanel.data[opPanel.data.inQueue].members[currentUser.endpoints.mainextension[0].id].paused && opPanel.data[opPanel.data.inQueue].members[currentUser.endpoints.mainextension[0].id].lastPausedInReason" class="{{appConfig.QUEUES_PAUSE_STATE[opPanel.data[opPanel.data.inQueue].members[currentUser.endpoints.mainextension[0].id].lastPausedInReason]}} icon"></i> <i class="{{opPanel.data[opPanel.data.inQueue].members[currentUser.endpoints.mainextension[0].id].paused ? \'orange\' : \'\'}} pause icon"></i> {{opPanel.data[opPanel.data.inQueue].members[currentUser.endpoints.mainextension[0].id].paused ? \'Stop pause\' : \'Pause\' | translate}} </div> <div ng-if="!opPanel.data[opPanel.data.inQueue].members[currentUser.endpoints.mainextension[0].id].paused" class="ui floating dropdown icon button"> <i class="dropdown icon"></i> <div class="right menu"> <div ng-click="queuePauseOpp(currentUser.endpoints.mainextension[0].id, opPanel.data.inQueue, \'Lunch break\')" class="item"><i class="coffee icon"></i> {{\'Lunch break\' | translate}}</div> <div ng-click="queuePauseOpp(currentUser.endpoints.mainextension[0].id, opPanel.data.inQueue, \'Emergency\')" class="item"><i class="red warning icon"></i> {{\'Emergency\' | translate}}</div> <div ng-click="queuePauseOpp(currentUser.endpoints.mainextension[0].id, opPanel.data.inQueue, \'Backend\')" class="item"><i class="pin icon"></i> {{\'Backend\' | translate}}</div> </div> </div> </div> </div> <div class="oppanel-incall-scroll op-incoming-call op-call-scroll" id="oppanel-in-list"> <div ng-if="opPanel.showInCalls" class="opPannelTContainer"> <table ng-table="opPanel.incomingTable" class="ui padding selectable compact table table-dragable-items no-border"> <tr data-ch="{{s.id}}" class="opWaitingCallId-{{s.num}} thumbnail vthumbnail" ng-repeat="s in $data" data-drag="true" ng-model="$data" jqyoui-draggable="{index: {{$index}}, insertInline: true, direction:\'jqyouiDirection\', onStart: \'startOpDrag()\'}" data-jqyoui-options="{ appendTo: \'body\', revert: \'invalid\', helper: \'clone\', classes: { \'ui-draggable\': \'op-drag-clone\' }}" data-direction="{{s.jqyouiDirection}}" title="{{s.name ? s.name + \' - \' + s.num : s.num}}"> <td data-title="\'Caller\' | translate" class="overflowTitle"> <span>{{ s.name ? s.name : s.num }}</span> </td> <td data-title="\'Pos\' | translate" class="op-call-position"> <span>{{ s.position }}</span> </td> <td data-title="\'Wait\' | translate"> <div chrono-timer timer-name="myTimer" start-time="s.waitingTime + clientServerTimeDiff">{{hours|zeropad}}:{{minutes|zeropad}}:{{seconds|zeropad}}</div> </td> </tr> <tr ng-show="$data.length == 0"> <td data-title="\'Caller\' | translate"> <span>-</span> </td> <td data-title="\'Position\' | translate"> </td> <td data-title="\'Wait\' | translate"> </td> </tr> </table> </div> </div> </div> </div> </div> \x3c!-- WAITING CALLS --\x3e <div id="waitingContainer" class="{{wideop === false && mobileop !== true ? \'eight wide column mt-0 h-285\' : wideop === false && mobileop === true ? \'eight wide column mt-0 mt-15\' : \'\'}}"> <div id="opWaitTable" class="{{wideop === false ? \'mt-0\' : \'\'}} ui oppanel-calls-height oppanel-list-calls theme-radius mh-200" data-drop="opPanel.dragFromCallBox === true ? true : false" jqyoui-droppable="{onDrop: \'opDropped()\', onOver: \'opOnOverWaiting()\', onOut: \'opDropOut()\'}"> <h4 class="ui blue dividing header no-margin-top nocursor mb-10">{{\'Waiting calls\' | translate}} <span class="setting icon float-right speed-settings nocursor">{{opPanel.numWaitingCalls}}</span> </h4> <div id="oppanel-wait-container" class="ui relaxed divided list selection mt-0"> <div id="oppanel-wait-list" class="oppanel-waitingcall-scroll h100" data-mainext="{{opPanel.data.waitingQueue}}"> <div ng-if="opPanel.showWaitCalls" class="opPannelTContainer"> <table ng-table="opPanel.waitingTable" class="ui padding selectable compact table table-dragable-items no-border"> <tr data-ch="{{s.id}}" class="opWaitingCallId-{{s.num}} thumbnail vthumbnail" ng-repeat="s in $data" data-waitingcall="true" data-drag="true" ng-model="$data" jqyoui-draggable="{index: {{$index}}, insertInline: true, direction:\'jqyouiDirection\', onStart: \'startOpDrag()\'}" data-jqyoui-options="{ appendTo: \'body\', revert: \'invalid\', helper: \'clone\', classes: { \'ui-draggable\': \'op-drag-clone\' }}" data-direction="{{s.jqyouiDirection}}" title="{{s.name ? s.name + \' - \' + s.num : s.num}}"> <td data-title="\'Caller\' | translate" class="vmiddle text-cut overflowTitle"> <span>{{ s.name ? s.name : s.num }}</span> </td> <td data-title="\'Wait\' | translate" class="vmiddle"> <div chrono-timer timer-name="myTimer" start-time="s.waitingTime + clientServerTimeDiff">{{hours|zeropad}}:{{minutes|zeropad}}:{{seconds|zeropad}}</div> </td> <td data-title="\'Pickup\' | translate" ng-click="opPickupWaitingCall(s)" class="vmiddle pointer op-call-position text-cut text-center"> <button class="ui button" id="op-pickup-button"> <i class="icons" id="op-pickup-icon"> <i class="phone large icon grey"></i> <i class="rss right icon grey" id="op-pickup-icon2"></i> </i> </button> </td> </tr> <tr ng-show="$data.length == 0"> <td data-title="\'Caller\' | translate"> <span>-</span> </td> <td data-title="\'Position\' | translate"> </td> <td data-title="\'Wait\' | translate"> </td> </tr> </table> </div> </div> </div> </div> </div>'),e.put("views/templates/newpbcontact.html",'\x3c!--\n  Modal Dialog:\n  the interface to add a new contact into the phonebook\n--\x3e <div id="add-new-pb-contact" class="ui small modal"> <div class="header"> {{\'New Speed Dial\' | translate}} <i ng-click="hideModalNewPbContact()" class="close icon close-modal-phonebook-icon"></i> </div> <form class="ui form" ng-submit="saveNewPbContact()"> <div class="content form-content"> <div class="description"> <h4 class="dividing header">{{\'Search the phonebook or enter name and number\' | translate}}</h4> <div class="ui search" id="speedDialSearchForm"> <div class="ui icon input full-search-head"> <input ng-attr-title="{{newContactObj.setInput}}" ng-model="newContactObj.name" class="prompt no-radius" type="text" placeholder="{{\'Search\' | translate}}..."> <i class="search icon"></i> </div> <div class="results top-float-results transfer-search-list"></div> </div> <div class="inline fields spaceLabelSpeedDial"> <div class="required field"> <label>{{\'Name\' | translate}}</label> <input ng-required="!newContactObj.number" type="text" name="user" placeholder="{{\'Name\' | translate}}" ng-model="newContactObj.name"> </div> <div class="required field numberLabelPosition"> <label>{{\'Number\' | translate}}</label> <input ng-required="!newContactObj.name" type="text" name="Number" placeholder="{{\'Number\' | translate}}" ng-model="newContactObj.number" pattern="^[0-9*#+]*" title="{{\'It is possible to insert only numbers or any symbols such as: *, # and +\' | translate}}"> </div> </div> </div> </div> <div class="action-content"> <button ng-click="hideModalNewPbContact()" type="button" class="ui gray deny button"> {{\'Cancel\' | translate}} </button> <button type="submit" class="ui positive right labeled icon button"> {{\'Save\' | translate}} <i class="checkmark icon"></i> </button> </div> </form> </div> \x3c!-- edit modal --\x3e <div id="edit-existing-modal" class="ui small modal"> <div class="header"> {{\'Edit Speed Dial\' | translate}}: {{newContactObj.name}} <i ng-click="hideModalEditSpeedDialContact()" class="close icon close-modal-phonebook-icon"></i> </div> <form class="ui form" ng-submit="saveEditSpeed()"> <div class="content form-content"> <div class="description"> <div class="inline fields spaceLabelSpeedDial"> <div class="required field"> <label>{{\'Name\' | translate}}</label> <input ng-required="!newContactObj.speeddial_num" type="text" name="user" placeholder="{{\'Name\' | translate}}" ng-model="newContactObj.name"> </div> <div class="required field numberLabelPosition"> <label>{{\'Number\' | translate}}</label> <input ng-required="!newContactObj.name" type="text" name="Number" placeholder="{{\'Number\' | translate}}" ng-model="newContactObj.speeddial_num" pattern="^[0-9*#+]*" title="{{\'It is possible to insert only numbers or any symbols such as: *, # and +\' | translate}}"> </div> </div> </div> </div> <div class="action-content"> <button ng-click="hideModalEditSpeedDialContact()" type="button" class="ui gray deny button"> {{\'Cancel\' | translate}} </button> <button type="submit" class="ui positive right labeled icon button"> {{\'Save\' | translate}} <i class="checkmark icon"></i> </button> </div> </form> </div>'),e.put("views/templates/offhourrec.html",'<div class="ui item window-chat" ng-show="view.wkaroundRecOffhour"> <div class="ui segments no-margin-top"> <div class="ui secondary segment {{(janus.isAvailable && !janus.isConfigured) || view.noCallsAvailable ? \'no-padding\' : \'action-call-window\'}}"> <h5 class="ui header"> <span ng-show="currentCall.accepted && (!currentCall.isSpy && !currentCall.isIntrude && !currentCall.isPBX)" class="float-right action-call-expand item"> <span ng-click="currentCall.isClose = !currentCall.isClose"> <i class="link {{currentCall.isClose ? \'plus\' : \'minus\'}} icon reset-right-margin"></i> </span> </span> <div class="content full-search-head"> <div ng-show="(janus.isAvailable && !janus.isConfigured)" class="ui label red footer-person-detail"> <i class="warning circle icon"></i> {{\'WebRTC gateway is down\' | translate}} <a ng-click="initializeJanusService()" class="detail">{{\'Retry\' | translate}}</a> </div> <div ng-show="view.noCallsAvailable" class="ui label brown footer-person-detail"> <i class="warning circle icon"></i> {{\'No devices found for this user\' | translate}} <a ng-if="!view.noCallsAvailableEver" ng-click="showDevicesListAvailable()" class="detail">{{\'Configure\' | translate}}</a> </div> <div class="adjust-long-name-footer" ng-show="currentCall.accepted && (!currentCall.isSpy && !currentCall.isIntrude && !currentCall.isPBX)">{{currentCall.displayname | cleanName}}</div> <div class="adjust-long-name-footer" ng-show="currentCall.isSpy || currentCall.isIntrude || currentCall.isPBX">{{currentCall.displayname | translate}}</div> <div class="sub header right-align"> <a ng-click="hangup()" class="ui label red call-hangup-detail call-popup-margin"> <i class="call icon"></i> {{\'Hangup\' | translate}} </a> </div> </div> </h5> </div> </div> </div>'),e.put("views/templates/qmanager/lostcalls.html",'<div id="qmLcContainer" class="qm-row" ng-controller="QManagerLostCallsCtrl"> <div id="qaccordion" class="mb-20"> <h3 class="q-accordion-title noselect">{{\'Settings\' | translate}}</h3> <div class="q-accordion-content queues-containers-padding"> <div id="queuesTabContainer" class="ui two column grid stackable grid ca-column no-padding"> <div class="column"> <div class="settings-zone"> <form class="ui form"> <div class="grouped fields"> <div><label>{{\'Update queue recall list every\' | translate}}: <strong>{{lcQmUpdate}} {{"seconds" | translate}}</strong></label></div> <div class="ui red range" id="lc-range1"></div> </div> <div class="grouped fields mb-10"> <div> <label>{{\'Period of lost calls in queue\' | translate}}: <strong>{{lcHInterval === 1 ? \'last_single_female\' : \'last_female\' | translate}} {{lcHInterval > 1 ? lcHInterval : \'\'}} {{lcHInterval === 1 ? (\'hour\' | translate) : (\'hours\' | translate) }}</strong> </label> </div> <div class="ui red range" id="lc-range2"></div> </div> </form> </div> </div> <div class="column"> </div> </div> </div> </div> <div class="ui visible message mt-25"> <span>{{\'Last update\' | translate}}: {{ \'with_time\' | translate:{date:lostcalls.lostCallsLastUpdateDate} }}</span> <span class="q-update-interval-info">({{\'updated every\' | translate}} <b class="pointer">{{lcQmUpdate}} sec</b>) </span> </div> <div class="ui items"> <div class="item"> <div class="extra"> <select id="searchSelect" multiple class="ui fluid search dropdown"> <option value="">{{\'Enable queues\' | translate}}</option> <option ng-repeat="(k, q) in queues" value="{{k}}">{{q.name}} ({{k}}) </option> </select> </div> </div> </div> <div class="h-20"> <button ng-click="getDataToExportCSV()" class="ui basic button float-right"> <i class="icon download"></i> {{"Export all" | translate}} </button> </div> <div class="ui pointing secondary menu large-margin-top"> <a ng-click="updateLCTab(\'notmanaged\')" class="item" ng-class="{ active: (lostcalls.lostCallsTab === \'notmanaged\') }">{{\'Not managed\' | translate}}</a> <a ng-click="updateLCTab(\'managed\')" class="item" ng-class="{ active: (lostcalls.lostCallsTab === \'managed\') }">{{\'Managed\' | translate}}</a> <a ng-click="updateLCTab(\'total\')" class="item" ng-class="{ active: (lostcalls.lostCallsTab === \'total\') }">{{\'All\' | translate}}</a> </div> \x3c!-- notmanaged tab --\x3e <div ng-show="lostcalls.lostCallsTab === \'notmanaged\'" class="ui bottom attached tab segment" ng-class="{ active: (lostcalls.lostCallsTab === \'notmanaged\') }"> <div class="qTableRecall"> <div class="h-16"> <div class="float-right inline-row font-medium">{{\'Total\' | translate}}: <b>{{notManagedTP.total() || 0}}</b> </div> </div> <div ng-show="notManagedLoader" class="ui active centered inline mt-20 loader"></div> <div ng-show="(notManagedTP.total() == 0 && !notManagedLoader) || isEmpty(selectedRecallQueues)" class="ui message"> <div class="header"> {{\'No call found\' | translate}} </div> </div> \x3c!-- notmanaged table --\x3e <table ng-show="notManagedTP.total() > 0 && !notManagedLoader" ng-table="notManagedTP" class="ui selectable red table mtb-14"> <tr ng-repeat="s in $data track by $index" on-finish-render="ngRepeatFinished" ng-if="s.action !== \'DONE\'" class="{{s.action !== \'DONE\' ? \'negative\' : \'\'}}"> <td data-title="\'Time\' | translate"> <span>{{ \'with_date_long_noUTC\' | translate:{date:s.time * 1000} }}</span> </td> <td data-title="\'Queue\' | translate" filter="{ queueman: \'select\'}"> <span>{{queues[s.queuename].name}} (<b>{{s.queuename}}</b>)</span> </td> <td class="maxw-180" data-title="\'Company\' | translate"> <span>{{s.company}}</span> </td> <td class="maxw-180" data-title="\'Name\' | translate"> <span>{{s.name}}</span> </td> <td data-title="\'Caller\' | translate"> <b>{{s.cid}}</b> </td> <td data-title="\'Info\' | translate" class="left aligned pointer" ng-click="getNMDetails(s.cid, s.queuename)"> <i class="large info circle icon"></i> </td> <td data-title="\'Status\' | translate"> <i ng-if="s.action !== \'DONE\'" class="red large window close icon"></i> <i ng-if="s.action === \'DONE\'" class="large check icon"></i> <span>{{s.direction}}</span> </td> <td data-title="\'Result\' | translate"> <span>{{s.event | translate}}</span> </td> <td data-title="\'Actions\' | translate"> <div class="ui right top pointing dropdown actions-lost-dropdown"> <div ng-click="checkLoggedUsers(s.queuename, s)" class="ui labeled icon button {{view.isChatLoaded ? \'\' : \'disabled\'}}"> <i class="chat icon"></i> {{\'Send to\' | translate}} </div> <div class="menu right label-bottom-margin minimized-min-width users-select-menu-qm"> <div class="ui icon search input"> <i class="search icon"></i> <input type="text" placeholder="{{\'Cerca\' | translate}}..."> </div> <div class="divider"></div> <div class="header"> {{"Agents" | translate}} </div> <div class="scrolling menu"> <div ng-click="sendCallInMessage(allExtensions[u.member].username)" ng-if="u.chatLogged && (currentUser.username !== allExtensions[u.member].username) && view.isChatLoaded" ng-repeat="u in queues[s.queuename].members" class="item"> <img class="ui avatar image" ng-src="{{allAvatars[allExtensions[u.member].username] || \'img/steve.6204f1d6.jpg\'}}"> {{u.name}} </div> </div> </div> </div> </td> </tr> </table> <div ng-show="notManagedTP.total() > appConfig.LOSTCALLS_RESULT_LIMIT && !notManagedLoader" class="current-page-info">{{\'Page\' | translate}}: <b>{{notManagedTP.page()}}</b></div> </div> </div> \x3c!-- managed tab --\x3e <div ng-show="lostcalls.lostCallsTab === \'managed\'" class="ui bottom attached tab segment" ng-class="{ active: (lostcalls.lostCallsTab === \'managed\') }"> <div class="qTableRecall"> <div class="h-16"> <div class="float-right inline-row font-medium">{{\'Total\' | translate}}: <b>{{managedTP.total() || 0}}</b> </div> </div> <div ng-show="managedLoader" class="ui active centered inline mt-20 loader"></div> <div ng-show="(managedTP.total() == 0 && !managedLoader) || isEmpty(selectedRecallQueues)" class="ui message"> <div class="header"> {{\'No call found\' | translate}} </div> </div> \x3c!-- managed table --\x3e <table ng-show="managedTP.total() > 0 && !managedLoader" ng-table="managedTP" class="ui selectable red table mtb-14"> <tr ng-repeat="s in $data track by $index" on-finish-render="ngRepeatFinished" ng-if="s.action === \'DONE\'" class="{{s.action !== \'DONE\' ? \'negative\' : \'\'}}"> <td data-title="\'Time\' | translate"> <span>{{ \'with_date_long_noUTC\' | translate:{date:s.time * 1000} }}</span> </td> <td data-title="\'Queue\' | translate" filter="{ queueman: \'select\'}"> <span>{{queues[s.queuename].name}} (<b>{{s.queuename}}</b>)</span> </td> <td class="maxw-180" data-title="\'Company\' | translate"> <span>{{s.company}}</span> </td> <td class="maxw-180" data-title="\'Name\' | translate"> <span>{{s.name}}</span> </td> <td data-title="\'Caller\' | translate"> <b>{{s.cid}}</b> </td> <td data-title="\'Info\' | translate" class="left aligned pointer" ng-click="getNMDetails(s.cid, s.queuename)"> <i class="large info circle icon"></i> </td> <td data-title="\'Status\' | translate"> <i ng-if="s.action !== \'DONE\'" class="red large window close icon"></i> <i ng-if="s.action === \'DONE\'" class="large check icon"></i> <span>{{s.direction}}</span> </td> <td data-title="\'Result\' | translate"> <span>{{s.event | translate}}</span> </td> </tr> </table> <div ng-show="managedTP.total() > appConfig.LOSTCALLS_RESULT_LIMIT && !managedLoader" class="current-page-info">{{\'Page\' | translate}}: <b>{{managedTP.page()}}</b></div> </div> </div> \x3c!-- total tab --\x3e <div ng-show="lostcalls.lostCallsTab === \'total\'" class="ui bottom attached tab segment" ng-class="{ active: (lostcalls.lostCallsTab === \'total\') }"> <div class="qTableRecall"> <div class="h-16"> <div class="float-right inline-row font-medium">{{\'Total\' | translate}}: <b>{{totalTP.total() || 0}}</b> </div> </div> <div ng-show="totalLoader" class="ui active centered inline mt-20 loader"></div> <div ng-show="(totalTP.total() == 0 && !totalLoader) || isEmpty(selectedRecallQueues)" class="ui message"> <div class="header"> {{\'No call found\' | translate}} </div> </div> \x3c!-- total table --\x3e <table ng-show="totalTP.total() > 0 && !totalLoader" ng-table="totalTP" class="ui selectable red table mtb-14"> <tr ng-repeat="s in $data track by $index" on-finish-render="ngRepeatFinished" class="{{s.action !== \'DONE\' ? \'negative\' : \'\'}}"> <td data-title="\'Time\' | translate"> <span>{{ \'with_date_long_noUTC\' | translate:{date:s.time * 1000} }}</span> </td> <td data-title="\'Queue\' | translate" filter="{ queueman: \'select\'}"> <span>{{queues[s.queuename].name}} (<b>{{s.queuename}}</b>)</span> </td> <td class="maxw-180" data-title="\'Company\' | translate"> <span>{{s.company}}</span> </td> <td class="maxw-180" data-title="\'Name\' | translate"> <span>{{s.name}}</span> </td> <td data-title="\'Caller\' | translate"> <b>{{s.cid}}</b> </td> <td data-title="\'Info\' | translate" class="left aligned pointer" ng-click="getNMDetails(s.cid, s.queuename)"> <i class="large info circle icon"></i> </td> <td data-title="\'Status\' | translate"> <i ng-if="s.action !== \'DONE\'" class="red large window close icon"></i> <i ng-if="s.action === \'DONE\'" class="large check icon"></i> <span>{{s.direction}}</span> </td> <td data-title="\'Result\' | translate"> <span>{{s.event | translate}}</span> </td> <td data-title="\'Actions\' | translate"> <div ng-if="s.action !== \'DONE\'" class="ui right top pointing dropdown actions-lost-dropdown"> <div ng-click="checkLoggedUsers()" class="ui labeled icon button {{view.isChatLoaded ? \'\' : \'disabled\'}}"> <i class="chat icon"></i> {{\'Send to\' | translate}} </div> <div class="menu right label-bottom-margin minimized-min-width users-select-menu-qm"> <div class="ui icon search input"> <i class="search icon"></i> <input type="text" placeholder="{{\'Cerca\' | translate}}..."> </div> <div class="divider"></div> <div class="header"> {{"Agents" | translate}} </div> <div class="scrolling menu"> <div ng-click="sendCallInMessage(allExtensions[u.member].username, s)" ng-if="u.chatLogged && (currentUser.username !== allExtensions[u.member].username) && view.isChatLoaded" data-tooltip="{{u.member}}" data-position="top center" ng-repeat="u in queues[s.queuename].members" class="item"> <img class="ui avatar image" ng-src="{{allAvatars[allExtensions[u.member].username] || \'img/steve.6204f1d6.jpg\'}}"> {{u.name}} </div> </div> </div> </div> </td> </tr> </table> <div ng-show="totalTP.total() > appConfig.LOSTCALLS_RESULT_LIMIT && !totalLoader" class="current-page-info">{{\'Page\' | translate}}: <b>{{totalTP.page()}}</b></div> </div> </div> \x3c!-- RECALL DETAILS DIALOG--\x3e <div id="details-dialog" class="ui modal"> <div class="header"> {{\'Call details\' | translate}}: {{lostcalls.detailsCid}} </div> <div class="qTableRecallDetails"> <div ng-show="detailsTP.total() == 0" class="ui message"> <div class="header"> {{\'No call found\' | translate}} </div> </div> <table ng-show="detailsTP.total() > 0" ng-table="detailsTP" class="ui selectable red table"> <tr ng-repeat="s in $data" on-finish-render="ngRepeatFinished" class="{{s.action !== \'DONE\' ? \'negative\' : \'\'}}"> <td data-title="\'Time\' | translate"> <span>{{ \'with_date_long_noUTC\' | translate:{date:s.time * 1000} }}</span> </td> <td data-title="\'Queue\' | translate"> <span>{{s.queuename}}</span> </td> <td data-title="\'Status\' | translate"> <i ng-if="s.action !== \'DONE\'" class="red large window close icon"></i> <i ng-if="s.action === \'DONE\'" class="large check icon"></i> <span>{{s.direction}}</span> </td> <td data-title="\'Duration\' | translate"> <span>{{s.duration}}</span> </td> <td data-title="\'Hold\' | translate"> <span>{{s.hold}}</span> </td> <td data-title="\'Agent\' | translate"> <span>{{s.agent}}</span> </td> <td data-title="\'Result\' | translate"> <span>{{s.event | translate}}</span> </td> </tr> </table> </div> <div class="action-content"> <div class="ui active inline loader small inverted loader-margin"></div> <div ng-click="hideNMDetails()" class="ui gray deny button"> {{\'Close\' | translate}} </div> </div> </div> </div>'),e.put("views/templates/queues/queuesinfo.html",'<div ng-controller="QueuesInfoCtrl" ng-show="showTopAccordion" id="qaccordion"> <h3 class="q-accordion-title noselect">{{\'Queues info\' | translate}}</h3> <div class="q-accordion-content queues-containers-padding overflow-visible"> <div id="queuesTabsMenu" ng-hide="false" class="ui pointing secondary menu"> <a ng-click="clickQInfoTab(\'lostQueueCalls\')" class="item" ng-class="{ active: (queuesLastTab === \'lostQueueCalls\') }" ng-if="currentUser.profile.macro_permissions.queue_agent.value === true &&\n        currentUser.profile.macro_permissions.queue_agent.permissions.lost_queue_call.value === true"> {{\'Lost calls\' | translate}} </a> <a ng-click="clickQInfoTab(\'statistics\')" class="item" ng-class="{ active: (queuesLastTab === \'statistics\') }"> {{\'Statistics\' | translate}} </a> </div> <div ng-if="currentUser.profile.macro_permissions.queue_agent.value === true &&\n      currentUser.profile.macro_permissions.queue_agent.permissions.lost_queue_call.value === true" class="q-box-menu-content ui tab segment {{ queuesLastTab === \'lostQueueCalls\' ? \'active\' : \'\' }}"> <div id="qAccordionContent" class="q-accordion-content mb-30"> <div class="ui visible message mt-30"> <span>{{\'Last update\' | translate}}: {{ \'with_time\' | translate:{date:lostCallsLastUpdateDate} }}</span> <span class="q-update-interval-info">({{\'updated every\' | translate}} <a class="pointer" ng-click="goToQueuesSettings()">{{lostCallsUpdateInterval}} sec</a>) </span> </div> <div class="ui items"> <div class="item"> <div class="extra"> <select id="searchSelect" multiple class="ui fluid search dropdown maxw-400"> <option value="">{{\'Enable queues\' | translate}}</option> <option ng-repeat="(k, q) in queues" ng-if="isUserIntoQueue(q)" value="{{k}}">{{q.name}} ({{k}}) </option> </select> </div> </div> </div> <div class="ui pointing secondary menu"> <a ng-click="updateLCQTab(\'notmanaged\')" class="item" ng-class="{ active: (lostCallsQTab === \'notmanaged\') }">{{\'Not managed\' | translate}}</a> <a ng-click="updateLCQTab(\'managed\')" class="item" ng-class="{ active: (lostCallsQTab === \'managed\') }">{{\'Managed\' | translate}}</a> <a ng-click="updateLCQTab(\'total\')" class="item" ng-class="{ active: (lostCallsQTab === \'total\') }">{{\'All\' | translate}}</a> </div> \x3c!-- notmanaged tab --\x3e <div ng-show="lostCallsQTab === \'notmanaged\'" class="ui bottom attached tab segment" ng-class="{ active: (lostCallsQTab === \'notmanaged\') }"> <div class="qTableRecall"> <div class="h-16"> <div ng-show="!notManagedLoader" class="float-right inline-row font-medium">{{\'Total\' | translate}}: <b>{{notManagedTP.total() || 0}}</b> </div> </div> <div ng-show="notManagedLoader" class="ui active centered inline mt-20 loader"></div> <div ng-show="(notManagedTP.total() == 0 && !notManagedLoader) || isEmpty(selectedRecallQueues)" class="ui message"> <div class="header"> {{\'No call found\' | translate}} </div> </div> \x3c!-- notmanaged table --\x3e <table id="notManagedTable" ng-show="(notManagedTP.total() > 0 && !notManagedLoader) && !isEmpty(selectedRecallQueues)" ng-table="notManagedTP" class="ui selectable purple table mtb-14 slow-shadow"> <tr ng-repeat="s in $data track by $index" ng-if="s.action !== \'DONE\'" class="{{s.action !== \'DONE\' ? \'negative\' : \'\'}}"> <td data-title="\'Time\' | translate"> <span>{{ \'with_date_long_noUTC\' | translate:{date:s.time * 1000} }}</span> </td> <td data-title="\'Queue\' | translate" filter="{ queueman: \'select\'}"> <span>{{queues[s.queuename].name}} (<b>{{s.queuename}}</b>)</span> </td> <td class="maxw-180" data-title="\'Company\' | translate"> <span>{{s.company}}</span> </td> <td class="maxw-180" data-title="\'Name\' | translate"> <span>{{s.name}}</span> </td> <td data-title="\'Caller\' | translate"> <b><a ng-show="allExtensions[currentUser.default_device.id].status === \'online\'" class="underline pointer" ng-click="recall(s.cid)">{{s.cid}}</a></b> <b><a ng-if="allExtensions[currentUser.default_device.id].status !== \'online\'" class="disable-clicks">{{s.cid}}</a></b> </td> <td data-title="\'Info\' | translate" class="left aligned pointer" ng-click="getRecallDetails(s.cid, s.queuename)"> <i class="large info circle icon"></i> </td> <td data-title="\'Status\' | translate"> <i ng-if="s.action !== \'DONE\'" class="red large window close icon"></i> <i ng-if="s.action === \'DONE\'" class="large check icon"></i> <span>{{s.direction}}</span> </td> <td data-title="\'Result\' | translate"> <span>{{s.event | translate}}</span> </td> </tr> </table> <div ng-show="notManagedTP.total() > appConfig.LOSTCALLS_RESULT_LIMIT && !notManagedLoader" class="current-page-info"> {{\'Page\' | translate}}: <b>{{notManagedTP.page()}}</b></div> </div> </div> \x3c!-- managed tab --\x3e <div ng-show="lostCallsQTab === \'managed\'" class="ui bottom attached tab segment" ng-class="{ active: (lostCallsQTab === \'managed\') }"> <div class="qTableRecall"> <div class="h-16"> <div ng-show="!managedLoader" class="float-right inline-row font-medium">{{\'Total\' | translate}}: <b>{{managedTP.total() || 0}}</b> </div> </div> <div ng-show="managedLoader" class="ui active centered inline mt-20 loader"></div> <div ng-show="(managedTP.total() == 0 && !managedLoader) || isEmpty(selectedRecallQueues)" class="ui message"> <div class="header"> {{\'No call found\' | translate}} </div> </div> \x3c!-- managed table --\x3e <table id="managedTable" ng-show="(managedTP.total() > 0 && !managedLoader) && !isEmpty(selectedRecallQueues)" ng-table="managedTP" class="ui selectable purple table mtb-14 slow-shadow"> <tr ng-repeat="s in $data track by $index" ng-if="s.action === \'DONE\'" class="{{s.action !== \'DONE\' ? \'negative\' : \'\'}}"> <td data-title="\'Time\' | translate"> <span>{{ \'with_date_long_noUTC\' | translate:{date:s.time * 1000} }}</span> </td> <td data-title="\'Queue\' | translate" filter="{ queueman: \'select\'}"> <span>{{queues[s.queuename].name}} (<b>{{s.queuename}}</b>)</span> </td> <td class="maxw-180" data-title="\'Company\' | translate"> <span>{{s.company}}</span> </td> <td class="maxw-180" data-title="\'Name\' | translate"> <span>{{s.name}}</span> </td> <td data-title="\'Caller\' | translate"> <b>{{s.cid}}</b> </td> <td data-title="\'Info\' | translate" class="left aligned pointer" ng-click="getRecallDetails(s.cid, s.queuename)"> <i class="large info circle icon"></i> </td> <td data-title="\'Status\' | translate"> <i ng-if="s.action !== \'DONE\'" class="red large window close icon"></i> <i ng-if="s.action === \'DONE\'" class="large check icon"></i> <span>{{s.direction}}</span> </td> <td data-title="\'Result\' | translate"> <span>{{s.event | translate}}</span> </td> </tr> </table> <div ng-show="managedTP.total() > appConfig.LOSTCALLS_RESULT_LIMIT && !managedLoader" class="current-page-info"> {{\'Page\' | translate}}: <b>{{managedTP.page()}}</b></div> </div> </div> \x3c!-- total tab --\x3e <div ng-show="lostCallsQTab === \'total\'" class="ui bottom attached tab segment" ng-class="{ active: (lostCallsQTab === \'total\') }"> <div class="qTableRecall"> <div class="h-16"> <div ng-show="!totalLoader" class="float-right inline-row font-medium">{{\'Total\' | translate}}: <b>{{totalTP.total() || 0}}</b> </div> </div> <div ng-show="totalLoader" class="ui active centered inline mt-20 loader"></div> <div ng-show="(totalTP.total() == 0 && !totalLoader) || isEmpty(selectedRecallQueues)" class="ui message"> <div class="header"> {{\'No call found\' | translate}} </div> </div> \x3c!-- total table --\x3e <table id="totalTable" ng-show="(totalTP.total() > 0 && !totalLoader) && !isEmpty(selectedRecallQueues)" ng-table="totalTP" class="ui selectable purple table mtb-14 slow-shadow"> <tr ng-repeat="s in $data track by $index" class="{{s.action !== \'DONE\' ? \'negative\' : \'\'}}"> <td data-title="\'Time\' | translate"> <span>{{ \'with_date_long_noUTC\' | translate:{date:s.time * 1000} }}</span> </td> <td data-title="\'Queue\' | translate" filter="{ queueman: \'select\'}"> <span>{{queues[s.queuename].name}} (<b>{{s.queuename}}</b>)</span> </td> <td class="maxw-180" data-title="\'Company\' | translate"> <span>{{s.company}}</span> </td> <td class="maxw-180" data-title="\'Name\' | translate"> <span>{{s.name}}</span> </td> <td data-title="\'Caller\' | translate"> <b ng-if="s.action !== \'DONE\'"> <a ng-show="allExtensions[currentUser.default_device.id].status === \'online\'" class="underline pointer" ng-click="recall(s.cid)">{{s.cid}}</a> <a ng-if="allExtensions[currentUser.default_device.id].status !== \'online\'" class="disable-clicks">{{s.cid}}</a> </b> <b ng-if="s.action === \'DONE\'">{{s.cid}}</b> </td> <td data-title="\'Info\' | translate" class="left aligned pointer" ng-click="getRecallDetails(s.cid, s.queuename)"> <i class="large info circle icon"></i> </td> <td data-title="\'Status\' | translate"> <i ng-if="s.action !== \'DONE\'" class="red large window close icon"></i> <i ng-if="s.action === \'DONE\'" class="large check icon"></i> <span>{{s.direction}}</span> </td> <td data-title="\'Result\' | translate"> <span>{{s.event | translate}}</span> </td> </tr> </table> <div ng-show="totalTP.total() > appConfig.LOSTCALLS_RESULT_LIMIT && !totalLoader" class="current-page-info"> {{\'Page\' | translate}}: <b>{{totalTP.page()}}</b></div> </div> </div> </div> </div> <div ng-if="queuesLastTab === \'statistics\'" class="q-box-menu-content ui tab segment {{ queuesLastTab === \'statistics\' ? \'active\' : \'\' }}"> <div class="ui visible message mt-25 mb-30"> <span>{{\'Last update\' | translate}}: {{ \'with_time\' | translate:{date:summaryAgentLastUpdateDate} }}</span> <span class="q-update-interval-info">({{\'updated every\' | translate}} {{UPDATE_AGENT_SUMMARY_INTERVAL/1000}} sec)</span> </div> <div class="ui cards cards-users-real lines-cards no-padding no-margins"> <div class="inverted card q-agent-stats-box"> <div class="content not-first-content no-padding-bottom"> <span class="summaty-user-info-cotainer"> <div class="ui stackable three column grid"> <div class="column"> <h4 class="ui sub header qm-realtime-calls-chart-label mb-27 fz-13">{{\'LOGIN\' | translate}}</h4> <table class="ui compact table realtime-tables slow-shadow"> <tr class="q-agent-login-table-hover"> <td data-title="\'Label\' | translate"> <span>{{\'Last login\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{summaryAgent.lastlogin || \'-\' | toLocaleString}}</strong> </td> </tr> <tr class="q-agent-login-table-hover"> <td data-title="\'Label\' | translate"> <span>{{\'Last logout\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{summaryAgent.lastlogout || \'-\' | toLocaleString}}</strong> </td> </tr> <tr ng-show="$data.length == 0"> <td data-title="\'Label\' | translate"> <span>-</span> </td> <td data-title="\'Value\' | translate"> </td></tr> </table> </div> <div class="column"> <h4 class="ui sub header qm-realtime-calls-chart-label mb-27 fz-13">{{\'CALLS\' | translate}}</h4> <table class="ui selectable compact table realtime-tables slow-shadow"> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Answered calls\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{summaryAgent.answeredcalls || \'-\'}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Outgoing calls\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{summaryAgent.outgoingCalls.outgoing_calls || \'-\'}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Missed calls\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{summaryAgent.no_answer_calls || \'-\'}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'From last call\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{summaryAgent.fromLastCall || \'-\'}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Time at phone\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{( (summaryAgent.outgoingCalls.duration_outgoing + summaryAgent.incomingCalls.duration_incoming) | secondsToReadable) || \'-\'}}</strong> </td> </tr> <tr ng-show="$data.length == 0"> <td data-title="\'Label\' | translate"> <span>-</span> </td> <td data-title="\'Value\' | translate"> </td></tr> </table> </div> <div class="column"> <h4 class="ui sub header qm-realtime-calls-chart-label mb-27 fz-13"> {{\'CALLS LENGTH\' | translate}} </h4> <table class="ui selectable compact table realtime-tables slow-shadow"> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Min\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{(summaryAgent.allCalls.min_duration | secondsToReadable) || \'-\'}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Max\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{(summaryAgent.allCalls.max_duration | secondsToReadable) || \'-\'}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Average\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{(summaryAgent.allCalls.avg_duration | secondsToReadable) || \'-\'}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Total incoming\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{(summaryAgent.incomingCalls.duration_incoming | secondsToReadable) || \'-\'}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Total outgoing\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{(summaryAgent.outgoingCalls.duration_outgoing | secondsToReadable) || \'-\'}}</strong> </td> </tr> </table> </div> </div> </span> </div> <div class="ui horizontal divider h-0 ml-30 mr-30 mt-15 fz-13"> {{"Queues" | translate}} </div> <div class="content no-border pb-0"> <div class="ui stackable three column grid"> <div ng-repeat="qu in summaryAgent.queues" class="column"> <div class="ui segments"> <div class="ui segment"> <strong class="mr-5"> {{qu.qname}} ({{qu.queue}}) </strong> <span ng-show="qu.loggedIn && !qu.paused"> <i class="green circle icon"></i> {{"Logged in" | translate}} </span> <span ng-if="qu.paused"> <i class="yellow circle icon"></i> {{"In pause" | translate}} </span> <span ng-if="!qu.loggedIn"> <i class="grey circle icon"></i> {{"Logged out" | translate}} </span> </div> <div class="ui segment"> <table class="ui selectable compact table realtime-tables summary-queue-table mt-15"> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Logon\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{(summaryAgent[qu.queue].time_in_logon | secondsToReadable) || \'-\'}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Pause time\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{(summaryAgent[qu.queue].time_in_pause | secondsToReadable) || \'-\'}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Pause on logon\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{summaryAgent[qu.queue].pause_percent ? summaryAgent[qu.queue].pause_percent + \'%\' : \'-\'}}</strong> </td> </tr> <tr> <td data-title="\'Label\' | translate"> <span>{{\'Time at phone\' | translate}}:</span> </td> <td data-title="\'Value\' | translate"> <strong>{{summaryAgent[qu.queue].conversation_percent ? summaryAgent[qu.queue].conversation_percent + \'%\' : \'-\'}}</strong> </td> </tr> </table> </div> </div> </div> </div> </div> </div> </div> </div> \x3c!-- RECALL DETAILS DIALOG--\x3e <div id="recallDetailsDialog" class="ui small modal"> <div class="header"> {{\'Call details\' | translate}}: {{recallDetailsCid}} </div> <div class="qTableRecallDetails"> <div ng-show="tableParamsRecallDetails.data.length === 0" class="ui message"> <div class="header"> {{\'No call found\' | translate}} </div> </div> <table ng-show="tableParamsRecallDetails.data.length > 0" ng-show="!viewLoad && currentUser.profile.macro_permissions.queue_agent.value && currentUser.profile.macro_permissions.queue_agent.permissions.lost_queue_call.value" ng-table="tableParamsRecallDetails" class="ui selectable purple table"> <tr ng-repeat="s in $data" on-finish-render="ngRepeatFinished" class="{{s.action !== \'DONE\' ? \'negative\' : \'\'}}"> <td data-title="\'Time\' | translate"> <span>{{ \'with_date_long_noUTC\' | translate:{date:s.time * 1000} }}</span> </td> <td data-title="\'Queue\' | translate"> <span>{{s.queuename}}</span> </td> <td data-title="\'Status\' | translate"> <i ng-if="s.action !== \'DONE\'" class="red large window close icon"></i> <i ng-if="s.action === \'DONE\'" class="large check icon"></i> <span>{{s.direction}}</span> </td> <td data-title="\'Duration\' | translate"> <span>{{s.duration}}</span> </td> <td data-title="\'Hold\' | translate"> <span>{{s.hold}}</span> </td> <td data-title="\'Agent\' | translate"> <span>{{s.agent}}</span> </td> <td data-title="\'Result\' | translate"> <span>{{s.event | translate}}</span> </td> </tr> </table> </div> <div class="action-content"> <div class="ui active inline loader small inverted loader-margin"></div> <button ng-click="hideModal()" type="button" class="ui gray deny button"> {{\'Cancel\' | translate}} </button> </div> </div> \x3c!-- CONFIRM RECALL DIALOG--\x3e <div id="recall-confirm-dialog" class="ui mini modal transition"> <div class="header"> {{\'Warning\' | translate}} </div> <div class="content"> <p>{{cidRecallConfirm}} {{\'is already in conversation: force the call\' | translate}} ?</p> </div> <div class="actions"> <div class="ui negative button" ng-click="hideModalRecallConfirm()">Cancel</div> <div class="ui positive button right labeled icon" ng-click="call(cidRecallConfirm)"> {{\'Call\' | translate}}<i class="checkmark icon"></i></div> </div> </div> </div> </div>'),e.put("views/templates/rightbar.html",'<div ng-if="responsive.isRightBarTouch" class="button-right-bar"> <button ng-click="setToggleBar()" class="ui icon mini button margin-button-right"> <i class="{{rightSidebarToggle ? \'arrow right\' : \'arrow left\'}} no-rotate icon"></i> </button> </div> <div id="importSpeeddialConfirm" class="ui mini modal"> <div class="header"> {{\'CSV Speed Dial import\' | translate}} </div> <div class="content"> <p>{{\'Start importing Speed Dial from csv file ?\' | translate}}</p> </div> <div class="actions"> <div class="ui negative button"> No </div> <div ng-click="importCsvSpeddial()" class="ui positive right labeled icon button"> Yes <i class="checkmark icon"></i> </div> </div> </div> <div id="del-all-speeddial" class="ui basic small modal"> <div class="ui icon header"> <i class="user icon"></i> {{\'Delete all Speed Dial contacts\' | translate}} </div> <div class="content"> <p class="center-align font-large">{{\'Are you sure\' | translate}}?</p> </div> <div class="actions"> <div class="ui gray basic cancel inverted button"> <i class="remove icon"></i> No </div> <div ng-click="deleteAllSpeedDial()" class="ui red ok inverted button"> <i class="checkmark icon"></i> {{\'Yes\' | translate}} </div> </div> </div> <div id="del-speeddial-contact" class="ui basic small modal"> <div class="ui icon header"> <i class="user icon"></i> {{\'Delete Speed Dial contact\' | translate}} {{speeddialToDelete.name}} </div> <div class="content"> <p class="center-align font-large"> <span ng-if="speeddialToDelete.company" class="row-del-speeddial-confirm">{{\'Company\' | translate}}: {{speeddialToDelete.company}}</span> <span ng-if="speeddialToDelete.name" class="row-del-speeddial-confirm">{{\'Name\' | translate}}: {{speeddialToDelete.name}}</span> </p> <p class="center-align font-large">{{\'Are you sure\' | translate}}?</p> </div> <div class="actions"> <div ng-click="hideDeleteModal()" class="ui gray basic cancel inverted button"> <i class="remove icon"></i> No </div> <div ng-click="deleteSpeedDial()" class="ui red ok inverted button"> <i class="checkmark icon"></i> {{\'Yes\' | translate}} </div> </div> </div> <div ng-disabled="!rightSidebarToggle" class="ui segment right-sidebar-up {{!rightSidebarToggle && responsive.isRightBarTouch ? \'opacity-blur\' : \'\'}}"> <div class="margin-speeddial"> <div class="ui top right pointing content dropdown adjust-responsive-padding speed-dropdown"> <h4 ng-style="borderTextGradient" class="ui {{borderTextGradient == null ? \'blue\' : \'\'}} dividing header"> {{\'Speed Dial\' | translate}} <span ng-if="speedDials.length > 0" class="adjust-speeddial-counter"> - {{speedDials.length}}</span> <i id="speedDialSettingsIcon" ng-style="textGradient" class="{{textGradient == null ? \'blue\' : \'\'}} setting icon float-right speed-settings"></i> </h4> <div class="menu speed-menu"> <input type="file" accept=".csv" id="importInput" class="hide"> <div ng-click="importSpeedDial()" class="item"> <i class="download icon"></i>{{\'Import\' | translate}} </div> <div ng-click="exportSpeedDial()" class="item {{ speedDials.length === 0 ? \'disabled\' : \'\' }}"> <i class="upload icon"></i>{{\'Export\' | translate}} </div> <div class="divider"></div> <div ng-click="confirmDeleteAllSpeedDial()" class="item {{ speedDials.length === 0 ? \'disabled\' : \'\' }}"> <i class="trash alternate icon"></i>{{\'Delete all\' | translate}} </div> </div> </div> <div ng-if="view.loadSpeedDials" class="ui active centered inline loader"></div> <a ng-repeat="s in speedDials" class="ui basic brown image label contact-speedial"> <div class="inline-row" data-tooltip="{{appConfig.STATUS_MAP[speedExtenStatus[s.speeddial_num].status || \'\'].description | translate}}" data-position="top left"> <i class="{{appConfig.STATUS_MAP[speedExtenStatus[s.speeddial_num].status || \'\'].icon}} {{appConfig.STATUS_MAP[speedExtenStatus[s.speeddial_num].status || \'\'].color}} icon"></i> <span class="speedidial-name-long">{{s.name ? s.name : s.company}}</span> </div> <div ng-click="editSpeed(s)" class="detail tooltip-call" data-tooltip="{{\'Edit\' | translate}}" data-position="left center"><i class="write icon"></i></div> <div ng-click="call(s.speeddial_num)" class="detail tooltip-call" data-tooltip="{{currentCall.accepted ? \'Transfer to\' : \'Call\' | translate}} {{s.speeddial_num}}" data-position="left center"><i class="{{currentCall.accepted ? \'random\' : \'call\'}} icon"></i></div> <div ng-click="delSpeedDialConfirm(s)" class="detail tooltip-call" data-tooltip="{{\'Delete\' | translate}}" data-position="left center"><i class="trash icon"></i></div> </a> <button ng-if="!view.loadSpeedDials && speedDials.length > 0" data-tooltip="{{\'Add speed dial\' | translate}}" data-position="right center" ng-click="addPbContact(\'\',\'\',true)" class="ui icon button green buttonBolt"> <img src="img/thunder.516e5a3e.svg" class="bolt"> </button> <div ng-if="!view.loadSpeedDials && speedDials.length == 0 && currentUser.profile.macro_permissions.phonebook.value" class="ui mini message increaseFontSize"> <div class="header"> {{\'No Speed Dial founds\' | translate}} </div> <p class="increaseSpace">{{\'Click to create a new speed dial\' | translate}}</p> <button data-tooltip="{{\'Add speed dial\' | translate}}" data-position="right center" ng-click="addPbContact(\'\',\'\',true)" class="ui icon button green buttonBolt"> <img src="img/thunder.516e5a3e.svg" class="bolt"> </button> </div> <div ng-if="!view.loadSpeedDials && speedDials.length == 0 && !currentUser.profile.macro_permissions.phonebook.value" class="ui message"> <div class="header"> {{\'No Speed Dial founds\' | translate}} </div> </div> </div> \x3c!-- <button ng-if="view.isChatAvailable" id="show-chat" data-tooltip="{{view.isChatLoaded ? \'Open chat\' : \'Login chat\' | translate}}" data-position="left center"\n'+"    ng-click=\"view.isChatLoaded ? openChat() : initChat()\" class=\"ui icon button {{view.isChatLoaded ? 'chat-icon-green' : 'chat-icon-red'}} tiny\"> --\x3e <button ng-if=\"view.isChatAvailable\" id=\"show-chat\" data-tooltip=\"{{view.isChatLoaded ? 'Open chat' : 'Login chat' | translate}}\" data-position=\"left center\" ng-click=\"view.isChatLoaded ? openChat() : connectChat()\" class=\"ui icon button {{view.isChatLoaded ? 'chat-icon-green' : 'chat-icon-red'}} tiny\"> <i class=\"comments icon\"></i> </button> </div> <div ng-disabled=\"!rightSidebarToggle\" id=\"lastCallsBox\" class=\"ui segment right-sidebar-down {{!rightSidebarToggle && responsive.isRightBarTouch ? 'opacity-blur' : ''}}\"> <i ng-click=\"getLastCalls()\" ng-style=\"textGradient\" class=\"{{textGradient == null ? 'blue' : ''}} refresh middle aligned icon float-right pointer\"></i> <h4 ng-style=\"borderTextGradient\" class=\"ui {{borderTextGradient == null ? 'blue' : ''}} dividing header no-margin-top\">{{'Last calls' | translate}}</h4> <div ng-if=\"view.loadLastCalls\" class=\"ui active centered inline loader\"></div> <div id=\"last-calls\" ng-if=\"!view.loadLastCalls && lastCalls.length > 0\" class=\"{{allExtensions[currentUser.default_device.id].status !== 'online' ? 'disable-clicks':''}} ui relaxed divided list selection\"> <div ng-repeat=\"s in lastCalls\" class=\"{{allExtensions[currentUser.default_device.id].status !== 'online' ? 'disable-clicks':''}} item {{s.disposition != 'ANSWERED' ? 'no-aswer-calls' : ''}}\"> <i class=\"{{s.disposition == 'ANSWERED' ? getDirections(s.direction).icon : 'red ban'}} middle aligned icon\"></i> <div class=\"content full-search-head\"> <a ng-show=\"allExtensions[currentUser.default_device.id].status === 'online'\" data-html=\"<span class='fontBold'>{{isNumber(s.direction == 'in' ? s.src : s.dst) ? (currentCall.accepted ? 'Transfer to' : 'Call') : 'Not callable' | translate}}\n        {{isNumber(s.direction == 'in' ? s.src : s.dst) ?\n          (s.direction == 'in' ?\n            s.src + '<\\span><br>' + (s.cnam && s.ccompany ? '<span class=\\'fontNormal\\'>' + s.cnam + '<br>' + s.ccompany + '<\\span>' : s.cnam ? '<span class=\\'fontNormal\\'>' + s.cnam + '<\\span>' : s.ccompany ? '<span class=\\'fontNormal\\'>' + s.ccompany + '<\\span>' : '') :\n            s.dst + '<\\span><br>' + (s.dst_cnam && s.dst_ccompany ?\n            '<span class=\\'fontNormal\\'>' + s.dst_cnam + '<br>' + s.dst_ccompany + '<\\span>' :\n              s.dst_cnam ?\n                '<span class=\\'fontNormal\\'>' + s.dst_cnam + '<\\span>' :\n                s.dst_ccompany ?\n                  '<span class=\\'fontNormal\\'>' + s.dst_ccompany + '<\\span>' : ''\n            )\n          ) :\n          ''}}\" data-variation=\"wide\" ng-click=\"isNumber(s.direction == 'in' ? s.src : s.dst) ? call(s.direction == 'in' ? s.src : s.dst) : undefined\" class=\"header lastCallsPopup\"> <span class=\"adjust-long-name-last-call\"> {{s.direction == 'in' ? (s.cnam ? s.cnam : s.ccompany ? s.ccompany : s.src) : (s.dst_cnam !== \"\" ? s.dst_cnam : (s.dst_ccompany ? s.dst_ccompany : s.dst) ) }} </span> </a> \x3c!-- if the dispositive is offline --\x3e <a ng-if=\"allExtensions[currentUser.default_device.id].status !== 'online'\" class=\"disable-clicks\"> <span class=\"adjust-long-name-last-call\"> {{s.direction == 'in' ? (s.cnam ? s.cnam : s.ccompany ? s.ccompany : s.src) : (s.dst_cnam !== \"\" ? s.dst_cnam : (s.dst_ccompany ? s.dst_ccompany : s.dst) ) }} </span> </a> <div class=\"description\"> <span class=\"float-right last-call-minute\">{{s.time | timeparse}}</span> <span class=\"adjust-long-name-last-number\">{{s.direction == 'in' ? s.src : s.dst || 'Unknown'}}</span> </div> <button ng-if=\"isNumber(s.direction == 'in' ? s.src : s.dst)\" ng-click=\"newContactAdd(\n            isNumber(s.direction == 'in' ? s.src : s.dst) ?\n              (s.direction == 'in' ? s.src : s.dst) :\n              '',\n              s.direction == 'in' ? s.cnam : s.dst_cnam,\n              undefined,\n              s.direction == 'in' ? s.ccompany : s.dst_ccompany)\" data-tooltip=\"{{'Add contact' | translate}}\" data-position=\"left center\" class=\"ui icon button basic tiny button-last-calls\"> <i class=\"add user icon\"></i> </button> </div> </div> </div> <div ng-if=\"!view.loadLastCalls && lastCalls.length == 0\" class=\"ui message\"> <div class=\"header\"> {{'No call founds' | translate}} </div> </div> </div>"),e.put("views/templates/screenshare.html",'<div id="screenshareInDialog" class="ui first coupled modal"> <i class="close icon"></i> <div class="header"> {{\'Screen Sharing from\' | translate}} {{allUsers[screenSharing.callUser].name}} </div> <div class="image content"> <div class="ui small image"> <img ng-src="{{ allAvatars[screenSharing.callUser] || \'img/steve.6204f1d6.jpg\' }}"> </div> <div class="description"> <div class="ui header">{{allUsers[screenSharing.callUser].name}} {{\'would like to share his screen with you\' | translate}}.</div> <p> {{\'If you accept the request, you will see the screen of \' | translate}} {{allUsers[screenSharing.callUser].name}}, {{\'otherwise you can simply reject\' | translate}}. </p> </div> </div> <div class="actions"> <div class="ui black deny button"> {{\'Reject\' | translate}} </div> <div class="ui positive right labeled icon button"> {{\'Show\' | translate}} <i class="checkmark icon"></i> </div> </div> </div> <div id="remoteScreenSharing" class="ui fullscreen second coupled modal transition hidden"> <i id="remoteScreenSharingCloseBtn" class="close icon"></i> <div class="header"> {{\'Screen of\' | translate}} {{allUsers[screenSharing.callUser].name}} </div> <div class="content" id="screenShareRemoteVideo"> <div id="screencaptureIn"></div> </div> </div> <div id="screenSharingClosedDialog" class="ui basic modal"> <div class="ui icon header"> <i class="desktop icon"></i> {{\'Screen sharing closed by\' | translate}} {{allUsers[screenSharing.closedBy].name}} </div> <div class="actions"> <div class="ui green ok inverted button"> <i class="checkmark icon"></i> Ok </div> </div> </div>'),e.put("views/templates/settings/phones.html",'\x3c!-- modal dialog to customize the configuration of buttons of physical phones --\x3e <div class="ui modal set-physical-buttons"> <i class="close icon"></i> <div class="header"> {{getPhoneModel(currentCustomBtnPhone)}} - {{"Customize physical buttons" | translate}} </div> <div class="ui tiny menu set-phys-btn-menu"> <a class="item" ng-click="emptyAllBtnsConfig()"> <i class="trash alternate outline icon"></i> {{"Empty all" | translate}} </a> <div class="ui dropdown item setting" ng-show="checkShowCopyBtnFrom()"> <i class="copy icon"></i> {{"Copy from" | translate}} <i class="dropdown icon"></i> <div class="menu"> <a class="item" ng-repeat="e in currentUser.endpoints.extension" ng-show="e.type === \'physical\' && e.status !== \'offline\' && e.id !== currentCustomBtnPhone.toString()" ng-click="copyBtnConfig(e.id)"><i class="text telephone icon"></i> {{e.model}} </a> </div> </div> </div> <div class="ui tiny set-phys-btn-menu" style="margin-bottom: 10px"> <div class="ui top attached tabular menu" id="dialog-set-additional-buttons"> <a class="active item" data-tab="first">{{\'Physical buttons\' | translate}}</a> <a ng-show="showAdditionalButtons" id="temporary" class="item" data-tab="second"> {{\'Additional buttons\' | translate}} </a> </div> <div class="ui bottom attached active tab segment" data-tab="first"> \x3c!-- Physical buttons configuration --\x3e <div class="image content set-btn-config-table"> <div class="description"> <table ng-table="customBtnTable" class="ui small table"> <tr ng-repeat="s in $data"> <td data-title=""> <span>{{s.name}}</span> </td> <td data-position="left center" data-title="\'Type\' | translate"> <select class="ui dropdown setting setting-btn-custom-width" ng-model="btnType[s.id]" ng-change="btnTypeChanged(s.id)"> <option value="empty">{{"Empty" | translate}}</option> <option value="blf">{{"Presence Status LED" | translate}}</option> <option value="speed_dial">{{"Speed Dial" | translate}}</option> <option value="line">{{"Line" | translate}}</option> <option value="dnd">{{"Don\'t disturb" | translate}}</option> <option value="queuetoggle">{{"Toggle queue login/logout" | translate}}</option> </select> </td> <td data-position="left center" data-title="\'Value\' | translate"> <div ng-show="btnType[s.id] === \'blf\'" class="ui search setting-phone-user-list"> <div class="ui icon input setting-btn-custom-width"> <input name="linekey-value-{{s.id}}" ng-focus="valueFocused(s.id)" class="prompt" ng-disabled="btnType[s.id] !== \'blf\' && btnType[s.id] !== \'speed_dial\'" type="text" placeholder="{{\'Name or custom number\' | translate}}" ng-model="btnValue[s.id]" id="setting-phone-value-{{s.id}}" ng-change="btnValueChanged(\'blf\', s.id)"> <i class="search icon"></i> </div> <div class="results"></div> </div> <div ng-show="btnType[s.id] === \'speed_dial\'" class="ui search setting-phone-speeddial-list"> <div class="ui icon input setting-btn-custom-width"> <input ng-focus="valueFocused(s.id)" class="prompt" ng-disabled="btnType[s.id] !== \'blf\' && btnType[s.id] !== \'speed_dial\'" type="text" placeholder="{{\'Phonebook search or custom number\' | translate}}" ng-model="btnValueSpeeddial[s.id]" id="setting-phone-speeddial-value-{{s.id}}" ng-change="btnValueChanged(\'speeddial\', s.id)"> <i class="search icon"></i> </div> <div class="results"></div> </div> <div ng-show="btnType[s.id] !== \'speed_dial\' && btnType[s.id] !== \'blf\'" class="ui search setting-phone-speeddial-list"> <div class="ui icon input setting-btn-custom-width"> <input ng-disabled="true" type="text"> </div> </div> </td> <td data-position="left center" data-title="\'Label\' | translate"> <span class="ui input setting setting-btn-custom-width"> <input type="text" id="input-label-{{s.id}}" autocomplete="off" ng-model="btnValueLabel[s.id]"> </span> </td> </tr> </table> </div> </div> </div> <div class="ui bottom attached tab segment" data-tab="second"> \x3c!-- Additional buttons configuration --\x3e <div style="float: right; margin-bottom: 10px"> <i class="info circle icon blue" id="info-additional-buttons" style="margin-left: 5px" data-title="{{\'Additional buttons\' | translate}}" data-content="{{\'Use this panel only if you have an expansion module attached to your physical device. In this case you can customize all the additional buttons of your physical phone. Otherwise, this panel is useless\' | translate}}."></i> </div> <div class="image content set-btn-config-table"> <div class="description"> <table ng-table="customAdditionalBtnTable" class="ui small table"> <tr ng-repeat="s in $data"> <td data-title=""> <span>{{\'Line\' | translate}} {{s.id.split(\'expkey_type_\')[1]}}</span> </td> <td data-position="left center" data-title="\'Type\' | translate"> <select class="ui dropdown setting setting-btn-custom-width" ng-model="addBtnType[s.id]" ng-change="addBtnTypeChanged(s.id)"> <option value="empty">{{"Empty" | translate}}</option> <option value="blf">{{"Presence Status LED" | translate}}</option> <option value="speed_dial">{{"Speed Dial" | translate}}</option> <option value="line">{{"Line" | translate}}</option> <option value="dnd">{{"Don\'t disturb" | translate}}</option> <option value="queuetoggle">{{"Toggle queue login/logout" | translate}}</option> </select> </td> <td data-position="left center" data-title="\'Value\' | translate"> <div ng-show="addBtnType[s.id] === \'blf\'" class="ui search add-setting-phone-user-list"> <div class="ui icon input setting-btn-custom-width"> <input name="add-linekey-value-{{s.id}}" ng-focus="addValueFocused(s.id)" class="prompt" ng-disabled="addBtnType[s.id] !== \'blf\' && addBtnType[s.id] !== \'speed_dial\'" type="text" placeholder="{{\'Name or custom number\' | translate}}" ng-model="addBtnValue[s.id]" id="add-setting-phone-value-{{s.id}}" ng-change="addBtnValueChanged(\'blf\', s.id)"> <i class="search icon"></i> </div> <div class="results"></div> </div> <div ng-show="addBtnType[s.id] === \'speed_dial\'" class="ui search add-setting-phone-speeddial-list"> <div class="ui icon input setting-btn-custom-width"> <input ng-focus="addValueFocused(s.id)" class="prompt" ng-disabled="addBtnType[s.id] !== \'blf\' && addBtnType[s.id] !== \'speed_dial\'" type="text" placeholder="{{\'Phonebook search or custom number\' | translate}}" ng-model="addBtnValueSpeeddial[s.id]" id="add-setting-phone-speeddial-value-{{s.id}}" ng-change="addBtnValueChanged(\'speeddial\', s.id)"> <i class="search icon"></i> </div> <div class="results"></div> </div> <div ng-show="addBtnType[s.id] !== \'speed_dial\' && addBtnType[s.id] !== \'blf\'" class="ui search add-setting-phone-speeddial-list"> <div class="ui icon input setting-btn-custom-width"> <input ng-disabled="true" type="text"> </div> </div> </td> <td data-position="left center" data-title="\'Label\' | translate"> <span class="ui input setting setting-btn-custom-width"> <input type="text" id="input-label-{{s.id}}" autocomplete="off" ng-model="addBtnValueLabel[s.id]"> </span> </td> </tr> </table> </div> </div> </div> </div> <div class="actions"> <div class="ui black deny button"> {{"Cancel" | translate}} </div> <div class="ui positive right labeled icon button" ng-click="saveBtnsConfig(currentCustomBtnPhone)"> {{"Save" | translate}} <i class="checkmark icon"></i> </div> </div> </div> \x3c!-- dialog to show successfull confirmation of the configurations buttons saved into the server --\x3e <div class="ui modal set-physical-buttons-confirm"> <i class="close icon"></i> <div class="header"> {{allExtensions[currentCustomBtnPhone].model}} </div> <div class="image content"> <div class="description setting-btn-custom-width"> <h4 class="ui header green"><i class="check icon"></i>{{"All the configuration of physical buttons have been activated" | translate}}!</h4> </div> </div> <div class="actions"> <div class="ui black deny button"> {{"Close" | translate}} </div> </div> </div> \x3c!-- dialog to show error on configurations buttons saving --\x3e <div class="ui modal set-physical-buttons-confirm-error"> <i class="close icon"></i> <div class="header"> {{allExtensions[currentCustomBtnPhone].model}} </div> <div class="image content"> <div class="description setting-btn-custom-width"> <div class="ui negative message"> <div class="header"> {{"Warning" | translate}} </div> <p>{{"Sorry, some error occurred while saving the physical button configuration" | translate}}. </p></div> </div> </div> <div class="actions"> <div class="ui black deny button"> {{"Close" | translate}} </div> </div> </div>'),e.put("views/templates/topbar.html",'<div class="menu"> <a ng-click="goTo(\'\')" class="header item no-border adjust-responsive-logo"> <img class="logo" src="img/logo.png"> </a> <a ng-if="currentUser.profile.macro_permissions.streaming.value" ng-click="goTo(\'streaming\')" class="item adjust-padding adjust-responsive-functions-hide"> <span data-tooltip="{{\'Video sources\' | translate}}" data-position="bottom left" class="tooltip-adjust"> <i class="big icons"> <i class="white record icon mt-2 mr-0"></i> </i> </span> </a> \x3c!--<a href="#/" class="item adjust-padding adjust-responsive-functions-hide">\n      <span data-tooltip="{{\'Calendar\' | translate}}" data-position="bottom left">\n        <i class="big icons">\n          <i class="calendar icon"></i>\n        </i>\n      </span>\n    </a>--\x3e <a ng-if="currentUser.profile.macro_permissions.off_hour.value" ng-click="goTo(\'offhour\')" class="item adjust-padding adjust-responsive-functions-hide"> <span data-tooltip="{{\'Off hour\' | translate}}" data-position="bottom left" class="tooltip-adjust"> <i class="big icons"> <i class="wait icon mt-2 mr-0"></i> </i> </span> </a> <a ng-if="currentUser.profile.macro_permissions.qmanager && currentUser.profile.macro_permissions.qmanager.value" ng-click="goTo(\'qmanager\')" class="item adjust-padding adjust-responsive-functions-hide"> <span data-tooltip="{{\'QManager\' | translate}}" data-position="bottom left" class="qmanager-topbar-icon-span tooltip-adjust"> <img id="qmanager-topbar-icon" src="img/queue-users.f8594145.svg" alt="QManager"> </span> </a> <a ng-if="currentUser.profile.macro_permissions.settings.permissions.video_conference.value" ng-click="goTo(\'videoconf\')" class="item adjust-padding adjust-responsive-functions-hide"> <span data-tooltip="{{\'Videoconference\' | translate}}" data-position="bottom left"> <i class="big icons"> <i class="object group outline icon"></i> </i> </span> </a> <div class="item ui top left pointing dropdown adjust-padding adjust-responsive-functions-show"> <i class="large puzzle icon reset-right-margin"></i> <div class="menu"> <div ng-click="goTo(\'streaming\')" ng-if="currentUser.profile.macro_permissions.streaming.value" class="item"><i class="grey camera retro icon"></i> {{\'Video sources\' | translate}}</div> \x3c!--<div class="item"><i class="grey calendar icon"></i> {{\'Calendar\' | translate}}</div>--\x3e <div ng-click="goTo(\'offhour\')" ng-if="currentUser.profile.macro_permissions.off_hour.value" class="item"><i class="grey wait icon"></i> {{\'Off hour\' | translate}}</div> <div ng-click="goTo(\'qmanager\')" ng-if="currentUser.profile.macro_permissions.qmanager && currentUser.profile.macro_permissions.qmanager.value" class="item"><i class="grey users icon"></i> {{\'QManager\' | translate}}</div> <div ng-click="goTo(\'videoconf\')" ng-if="currentUser.profile.macro_permissions.settings.permissions.video_conference.value" class="item"><i class="grey file video outline icon"></i> {{\'Videoconference\' | translate}}</div> </div> </div> <div class="item adjust-responsive-search-hide"> <form ng-submit="currentUser.endpoints.extension.length == 0 ? searchOnly() : startSearchGlobal()"> <div class="ui icon input"> <input id="searchBarInput" ng-keyup="recognizeNumber()" type="text" ng-model="search.field" placeholder="{{\'Search or Compose\' | translate}}..."> <i ng-click="searchOnly()" class="search link icon"></i> </div> </form> </div> \x3c!-- call action buttons --\x3e <div id="topPhoneActions" ng-if="currentUser.default_device" class="ui actions-container adjust-responsive-actions-show"> <a ng-hide="janus.isAvailable && !janus.isConfigured" ng-show="!currentCall.incoming && !currentCall.outcoming && !currentCall.accepted" ng-click="currentCall.available ? call(search.field) : \'\'" class="ui label green topbar-action-detail {{!currentCall.available ? \'disabled\' : \'\'}}"> <i class="call icon hide-icon-button"></i> <span class="hide-label-button">{{\'Call\' | translate}}</span> </a> <a ng-show="currentCall.accepted && currentCall.available" ng-click="transfer(search.field)" class="ui label blue topbar-action-detail"> <i class="random icon hide-icon-button"></i> <span class="hide-label-button">{{\'Transfer\' | translate}}</span> </a> <a ng-show="!currentCall.accepted && currentCall.outcoming && !(currentCall.device.type !== \'mobile\' && view.isMobilePlatform)" ng-click="hangup()" class="ui label red topbar-action-detail"> <i class="call icon hide-icon-button"></i> <span class="hide-label-button">{{\'Hangup\' | translate}}</span> </a> <span ng-show="!currentCall.accepted && currentCall.outcoming" class="withDots withDots-top"></span> </div> <div ng-if="currentUser.default_device" class="item ui top left pointing dropdown adjust-padding adjust-responsive-actions-hide"> <i class="large block layout icon reset-right-margin"></i> <div class="menu"> <div ng-hide="janus.isAvailable && !janus.isConfigured" ng-show="!currentCall.incoming && !currentCall.outcoming && !currentCall.accepted" ng-click="currentCall.available ? call(search.field) : \'\'" class="item {{!currentCall.available ? \'disabled\' : \'\'}}"><i class="green call icon"></i> {{\'Call\' | translate}}</div> <div ng-show="currentCall.accepted && currentCall.available" ng-click="transfer(search.field)" class="item"><i class="blue random icon"></i> {{\'Transfer\' | translate}}</div> <div ng-show="!currentCall.accepted && currentCall.outcoming  && !(currentCall.device.type !== \'mobile\' && view.isMobilePlatform)" ng-click="hangup()" class="item"><i class="red call icon"></i> {{\'Hangup\' | translate}}</div> </div> </div> </div> <div class="right menu"> <div ng-click="showNotifications()" class="w-47 item ui top left pointing dropdown adjust-padding adjust-responsive-profiles-hide"> <span data-tooltip="{{\'Notifications\' | translate}}" data-position="bottom left" class="tooltip-adjust"> <i class="big icons"> <i class="large alarm icon reset-right-margin fz-25 mt-2 mr-0"></i> </i> </span> <span ng-show="notifications[\'clientUpdate\'].count+notifications[\'voicemail\'].count+notifications[\'last_call\'].count > 0" class="floating ui circular red label">{{notifications[\'voicemail\'].count+notifications[\'last_call\'].count+notifications[\'clientUpdate\'].count}}</span> </div> <a ng-click="settingsProfiles()" class="item adjust-padding adjust-responsive-profiles-hide mr-10"> <span data-tooltip="{{\'Settings\' | translate}}" data-position="bottom left" class="tooltip-adjust"> <i class="big icons"> <i class="white setting icon mt-2 mr-0"></i> </i> </span> </a> <div ng-show="qrCondition()" class="item ui top left pointing adjust-padding mr-7 w-47 dropdownStyle"> <span> <i class="big icons"> <a ng-click="settingsQrCode()" data-tooltip="{{\'Click to generate QR code\' | translate}}" data-position="bottom left" id="bottonQrCode" class="tooltip-adjust"> <i id="QrCode" class="qrcode icon"></i> </a> </i> </span> </div> <div ng-show="currentUser.endpoints.extension.length > 0 && !qrCondition()" id="devicesAvailableList" class="item ui top left pointing dropdown adjust-padding mr-7 w-47 {{currentCall.accepted ? \'disabled\' : \'\'}}"> <span> <i class="big icons"> \x3c!-- icon to be showed when the default device is webrtc --\x3e <div ng-if="currentUser.default_device.type === \'webrtc\'"> \x3c!-- webphone main icon --\x3e <i class="volume control phone icon reset-right-margin {{allExtensions[currentUser.default_device.id].status === \'busy\' ? \'red webphone-icon\' : webphone.isRegistered === true ? \'green webphone-icon\' : \'blue webphone-icon\'}}"></i> \x3c!-- webphone loader --\x3e <i ng-show="webphone.isRegistered === false && webphone.warnPopup.showLoader" class="ui inverted active centered inline loader webphone-loader"></i> \x3c!-- webphone second icon --\x3e <i id="webphoneHeadphonesIcon" class="{{allExtensions[currentUser.default_device.id].status === \'busy\' ? \'red\' : webphone.isRegistered === true ? \'green\' : \'blue\'}} corner corner-bottom {{currentUser.default_device.type === \'webrtc\' || currentUser.default_device.type === \'webrtc_mobile\' ? \'sound\' : currentUser.endpoints.extension.length === 0 ? \'remove\' : \'text telephone\'}} icon" ng-init="initWebphonePopupWarning()"> </i> \x3c!-- warning message for webphone --\x3e <div id="webphonePopupWarning" class="ui negative message popup"> <i class="close icon" ng-click="closeWebphonePopupWarningByUser(); $event.stopPropagation();"></i> <div class="header"> {{\'Web Phone not available\' | translate}} ! </div> <p ng-show="webphone.warnPopup.showInitInProgress">{{\'Re-initialization in progress\' | translate}}...</p> <p ng-show="webphone.warnPopup.showRegFailed">{{\'Registration failed! Please contact the administrator\' | translate}}.</p> </div> </div> \x3c!-- icon to be showed when the default device is physical --\x3e <div ng-if="currentUser.default_device.type === \'physical\'"> \x3c!-- phone main icon --\x3e <i class="volume control phone icon reset-right-margin {{allExtensions[currentUser.default_device.id].status === \'busy\' ? \'red webphone-icon\' : allExtensions[currentUser.default_device.id].status === \'offline\' ? \'blue webphone-icon\' : \'green webphone-icon\'}}"></i> \x3c!-- phone second icon --\x3e <i class="{{allExtensions[currentUser.default_device.id].status === \'busy\' ? \'red\' : allExtensions[currentUser.default_device.id].status === \'offline\' ? \'blue\' : \'green\'}} corner corner-bottom {{currentUser.default_device.type === \'webrtc\' || currentUser.default_device.type === \'webrtc_mobile\' ? \'sound\' : currentUser.endpoints.extension.length === 0 ? \'remove\' : \'text telephone\'}} icon" ng-init="initWebphonePopupWarning()"> </i> </div> </i> </span> <div ng-if="!view.isMobilePlatform" class="menu with-border"> <div class="large-padding"> <h4 class="ui blue dividing header">{{\'Devices\' | translate}} - {{currentUser.endpoints.mainextension[0].id}}</h4> </div> <div ng-hide="!view.isMobilePlatform && d.type == \'mobile\'" ng-click="setDevice(d)" ng-repeat="d in currentUser.endpoints.extension | orderBy:\'-type\'" class="item {{d.id == currentUser.default_device.id ? \'active\' : \'\'}} {{d.status == \'offline\' && d.type == \'physical\' ? \'disabled\' : \'\'}}"> <i class="{{d.status === \'online\' ? \'green\' : \'gray\'}} {{d.type == \'webrtc\' || d.type == \'mobile\' ? \'sound\' : \'text telephone\'}} icon"></i> <span class="adjust-long-device-name"> {{ d.type==\'webrtc\' || d.type == \'mobile\' ? (\'Web Phone\' | translate) : (d.model ? d.model : (\'Physical Phone\' | translate)) }} </span> </div> </div> </div> <div class="ui items user-custom"> <div class="item"> <div class="ui mini image circular image-custom-logo adjust-responsive-profile"> <img ng-src="{{ currentUser.settings.avatar || \'img/steve.6204f1d6.jpg\' }}"> </div> <div class="ui top right pointing content dropdown adjust-responsive-padding"> <div class="header color-white adjust-long-name">{{currentUser.name}}</div> <div class="description no-margin-top"> <p class="color-white"><i class="{{appConfig.PRESENCE_MAP[currentUser.presence].color}} circle icon"></i> {{appConfig.PRESENCE_MAP[currentUser.presence].label | translate}}</p> <i class="dropdown icon dropdown-icon-custom"></i> </div> <div class="menu"> <div ng-click="p == \'callforward\' ? showModalPresence(p) : setPresence(p)" class="item {{currentUser.presence == p ? \'active\' : \'\'}}" ng-repeat="p in availablePresence"> <span class="description">{{appConfig.PRESENCE_MAP[p].description | translate}}</span> <i class="{{appConfig.PRESENCE_MAP[p].color}} circle icon"></i> {{appConfig.PRESENCE_MAP[p].label | translate}} </div> <div class="divider"></div> <div ng-click="showNotifications()" class="item adjust-responsive-profiles-show"> <span ng-show="notifications[\'voicemail\'].count+notifications[\'last_call\'].count > 0" class="description"> {{notifications[\'voicemail\'].count+notifications[\'last_call\'].count}} </span> <i class="grey alarm icon"></i> {{\'Notifications\' | translate}} </div> <div class="divider adjust-responsive-profiles-show"></div> <div ng-click="goTo(\'settings\')" class="item adjust-responsive-profiles-show"> <i class="grey setting icon"></i> {{\'Settings\' | translate}} </div> <div class="item"> <a target="blank" href="{{customConfig.BRAND_DOCS}}" class="fluid ui gray left labeled icon button"> <i class="file icon reset-right-margin"></i> {{\'Docs\' | translate}} </a> </div> <div ng-hide="isShibboleth" class="divider adjust-responsive-profiles-show"></div> <div ng-hide="isShibboleth" class="item"> <button ng-click="logout()" class="fluid ui red right labeled icon button"> <i class="power icon reset-right-margin"></i> {{\'Logout\' | translate}} </button> </div> </div> </div> </div> </div> </div> <div id="presenceSet" class="ui modal"> <div class="header"> {{\'Settings for\' | translate}} {{currentPresence | capitalize}} </div> <form class="ui form" ng-submit="setPresence(currentPresence, presenceNumber)"> <div class="content form-content"> <div class="field"> <label>{{\'Number\' | translate}}</label> <input required ng-model="presenceNumber" type="text" pattern="[0-9]*" name="first-name" placeholder="{{\'Number\' | translate}}"> </div> </div> <div class="action-content"> <button ng-click="hidePresenceSetModal()" type="button" class="ui deny button"> {{\'Close\' | translate}} </button> <button type="submit" class="ui positive right labeled icon button"> {{\'Save\' | translate}} <i class="checkmark icon"></i> </button> </div></form> </div>  <div id="notifications" class="ui modal"> <div class="header"> {{\'Notifications\' | translate}} </div> <div class="content"> <div ng-show="notifications[\'clientUpdate\'].count + notifications[\'voicemail\'].count + notifications[\'last_call\'].count == 0" class="ui message"> <div class="header"> {{\'No notifications found\' | translate}} </div> </div> <div ng-repeat="l in notifications[\'lost_call\']" class="ui icon message action-call-window personal-message"> <i class="blue mail icon font-large notification-icon"></i> <div class="content"> <div class="header inline-row"> {{\'Lost call\' | translate}} </div> <div class="header float-right notification-date"> {{ \'with_date_long_noUTC\' | translate:{date:parseInt(l.origtime*1000)} }} </div> <p class="small-margin-bottom">{{\'Lost call from\' | translate}} <strong>{{parseCaller(l.callerid) | cleanName}}</strong></p> <div class="float-right"> <div ng-click="call(l.number)" class="ui label green"> {{currentCall.accepted ? \'Transfer\' : \'Call\' | translate}} </div> </div> </div> </div> <div ng-repeat="v in notifications[\'voicemail\'].data" class="ui icon message action-call-window personal-message"> <i class="blue mail icon font-large notification-icon"></i> <div class="content"> <div class="header inline-row"> {{\'Voicemail\' | translate}} </div> <div class="header float-right notification-date"> {{ \'with_date_long_noUTC\' | translate:{date:parseInt(v.origtime*1000)} }} </div> <p class="small-margin-bottom">{{\'Voicemail message from\' | translate}} <strong>{{parseCaller(v.callerid) | cleanName}}</strong></p> <div class="float-right"> <div class="ui dropdown reg-console"> <span ng-click="listenVoicemail(v.id, v)" data-tooltip="{{\'Listen\' | translate}}" data-position="top center"> <i class="{{v.inListen ? \'red\' : \'\'}} announcement link icon"></i> </span> </div> <span ng-click="downloadVoicemail(v.id)" data-tooltip="{{\'Download\' | translate}}" data-position="top center"> <i class="download link icon"></i> </span> <span ng-click="deleteVoicemail(v.id)" data-tooltip="{{\'Delete\' | translate}}" data-position="top center"> <i class="trash link icon"></i> </span> <audio class="audio-controls" ng-if="v.inListen && v.audiosource" ng-src="{{\'data:audio/wav;base64,\' + v.audiosource | trustUrl}}" controls> {{\'Your browser does not support the audio element\' | translate}}. </audio> </div> </div> </div> <div ng-repeat="v in notifications[\'clientUpdate\'].data" class="ui icon message action-call-window personal-message"> <i class="blue undo icon font-large notification-icon"></i> <div class="content"> <div class="header inline-row"> {{\'Software Update\' | translate}} </div> <p class="small-margin-bottom">{{\'A new software update is available\' | translate}}.<br>{{\'If you don\\\'t have any active call, click the refresh button to start using it\' | translate}}. </p> <p> <button class="ui primary button" ng-click="reloadNoCache()">{{\'Refresh\' | translate}}</button> </p> </div> </div> </div> <div class="actions"> <div ng-click="retrieveNotifications()" class="ui deny button"> {{\'Close\' | translate}} </div> </div> </div> <div id="warn-queue-login-ondnd" class="ui basic small modal"> <div class="ui icon header"> <i class="purple users icon"></i> {{\'Warning\' | translate}} </div> <div class="content"> <p class="center-align font-large">{{\'You joined the queue, but you are on\' | translate }} <a class="ui red label">DND</a> </p> <p class="center-align font-large">{{\'You cannot receive any calls\' | translate}}!</p> </div> <div class="actions"> <div ng-click="hideWarnOnDnd()" class="ui gray basic cancel inverted button"> <i class="remove icon"></i> OK </div> </div> </div>'),e.put("views/videoconf.html",'<div class="ui segment adjust-segment-container"> <div class="ui brown header"> <div class="float-left"> <i class="brown object group outline icon"></i> <div class="content"> {{\'Videoconference\' | translate}} </div> </div> </div> <div class="ui blue header title-header"></div> <div class="ui cards"> <div class="brown card videoconf-card"> <div class="content"> <div class="header"> ID: <a href="{{data.vcRoomUrl}}" target="_blank" id="vcCopyUrlPopup" data-title="{{\'Successfully copied to clipboard\' | translate}}" data-content="{{\'Share this link with the participants of the videoconference\' | translate}}"> {{data.vcRoomUrlDisplay}} </a> <span data-tooltip="{{\'New videoconference\'|translate}}"> <i class="small refresh icon vc-gray pointer" ng-click="showNewRoomConfirmation()"></i> </span> <span data-tooltip="{{\'Copy invite\'|translate}}" ng-show="!data.showNotConfigured && !data.showGenericError"> <i class="small clipboard icon vc-gray pointer" ng-click="copyVCUrl()"></i> </span> </div> <p> <div class="meta"> <div class="ui labeled input"> <div class="ui label" style="margin-right: 0px"> {{\'Room name\' | translate}}: </div> <input type="text" ng-model="data.vcRoomTitle" ng-change="roomTitleChanged()" maxlength="60"> </div> </div> </p> </div> <div class="extra content" id="div-invited-participants-list"> <h4> {{\'Participants list\'|translate}} <span data-tooltip="{{\'Add participants\'|translate}}"> <i class="large plus circle icon vc-black pointer" ng-click="addParticipants()" ng-show="!data.showNotConfigured && !data.showGenericError"></i> </span> </h4> <div class="ui label" ng-show="keyLength(data.invitedParticipants) === 0">{{\'Empty\'|translate}}</div> <div class="ui middle aligned divided list" id="vc-invited-participants-list" ng-show="!data.showNotConfigured && !data.showGenericError"> <p ng-show="keyLength(data.invitedParticipants) > 0">{{\'The following participants has been invited by email\'|translate}}</p> <div class="item" ng-repeat="p in data.invitedParticipants"> <div class="right floated content"> <div class="tiny ui active inline loader" style="vertical-align: middle" ng-show="data.reinviteLoader_{{idFromEmail(p.email)}}"></div> <i class="ui icon green check circle large" ng-show="data.reinviteSuccess_{{idFromEmail(p.email)}}"></i> <i class="ui icon red close circle large" ng-show="data.reinviteError_{{idFromEmail(p.email)}}"></i> <div class="ui label vcInvitedParticipantsLang" style="vertical-align: middle">{{p.lang.toUpperCase()}}</div> <div class="ui button" ng-click="inviteAgain(p)" style="vertical-align: middle"> <i class="mail black icon"></i> {{\'Invite again\'|translate}} </div> </div> <i class="user large icon"></i> <div class="content"> <div class="header">{{p.name}}</div> {{p.email}} </div> </div> </div> \x3c!-- warning messages --\x3e <div ng-show="data.showNotConfigured" class="ui warning message"> <div class="header"> {{\'Videoconference has not been configured on the server\' | translate}}. </div> {{\'Please contact the administrator\' | translate}}. </div> <div ng-show="data.showGenericError" class="ui warning message"> <div class="header"> {{\'Some error trying to contact the server\' | translate}}! </div> </div> </div> <div class="extra content"> <button class="massive ui button primary" ng-disabled="!data.vcRoomUrl" ng-click="startRoom()"> <i class="object group outline icon"></i> {{\'Start\'|translate}} </button> </div> </div> </div> </div> \x3c!-- Modal to add participants to the videoconference --\x3e <div class="ui modal" id="vc-modal-add-participants"> <i class="close icon"></i> <div class="header"> {{\'Invite participants to the videoconference\'|translate}} </div> <div class="image content"> <div style="width: 100%; text-align: center" ng-show="data.showInvitationResult"> <i class="ui icon green check circle massive" ng-show="data.addParticipantsSuccess"></i> <i class="ui icon red close circle massive" ng-show="data.addParticipantsError"></i> </div> <div style="width: 100%" ng-show="!data.showInvitationResult"> <p>{{\'Only contacts with an associated email address will be displayed\'|translate}}</p> <div class="ui search" id="vc-participants-search"> <div class="ui icon input cv-participant-input-action full-search-head"> <input ng-model="data.insertedParticipant" class="prompt no-radius" type="text" placeholder="{{\'Search or insert\' | translate}}..."> <i class="search icon"></i> </div> <div class="results top-float-results vc-member-search-list"></div> </div> <h4> {{\'Default language for email invitations\'|translate}}: <div class="ui inline dropdown" id="vcDropdownGlobLang"> <i class="ui world icon"></i> <div class="text"> {{\'\'|translate}} </div> <i class="dropdown icon"></i> <div class="menu"> <div class="item" ng-repeat="lang in data.invitationSupportedLang" data-value="{{lang.value}}"> {{lang.name}} </div> </div> </div> </h4> <div class="ui middle aligned divided list" id="vc-participants-list"> <div class="ui label" ng-show="keyLength(data.participants) === 0">{{\'No participant selected\'|translate}}</div> <div class="item" ng-repeat="p in data.participants"> <div class="right floated content"> <div class="ui inline scrolling dropdown vcDropdownCustomLang" id="vcCustomDropdownLang-{{idFromEmail(p.email)}}"> <i class="ui world icon"></i> <div class="text"> {{\'\'|translate}} </div> <i class="dropdown icon"></i> <div class="menu"> <div class="item" ng-repeat="lang in data.invitationSupportedLang" data-value="{{lang.value}}" data-email="{{p.email}}"> {{lang.abbrev}} </div> </div> </div> <div class="ui button" ng-click="removeParticipant(p.email)">{{\'Remove\'|translate}}</div> </div> <i class="user large icon"></i> <div class="content"> <div class="header">{{p.name}}</div> {{p.email}} </div> </div> </div> </div> </div> <div class="actions" ng-show="!data.showInvitationResult"> <div class="ui black deny button"> {{\'Cancel\'|translate}} </div> <div class="ui positive right labeled icon button {{keyLength(data.participants) === 0 ? \'disabled\' : \'\'}}" ng-click="sendInvitationEmails()"> {{\'Send email invitations\'|translate}} <i class="checkmark icon"></i> </div> </div> </div> \x3c!-- Confirmation modal dialog to create a new room id --\x3e <div class="ui modal" id="vc-modal-confirm-new-room"> <i class="close icon"></i> <div class="header"> {{\'Do you want to create a new videoconference identifier?\' | translate}} </div> <div class="content"> <div class="description"> <p> {{\'The videoconference identifier already present\' | translate}} <a href="{{data.vcRoomUrl}}" target="_blank" id="vcCopyUrlPopupConfirmation" data-title="{{\'Successfully copied to clipboard\' | translate}}"> {{data.vcRoomUrlDisplay}} </a> <span data-tooltip="{{\'Copy invite\'|translate}}" ng-show="!data.showNotConfigured && !data.showGenericError"> <i class="small clipboard icon vc-gray pointer" ng-click="copyVCUrlConfirmation()"></i> </span> {{\'will disappear. If it has already been shared with other people and it will be needed for future videoconferences, it is recommended to copy it before proceeding\' | translate}}.</p> <p>{{\'After the creation of the new identifier, you will need to invite new participants\' | translate}}.</p> </div> </div> <div class="actions"> <div class="ui black deny button"> No </div> <div class="ui positive right labeled icon button" ng-click="newRoom()"> {{\'Continue\' | translate}} <i class="checkmark icon"></i> </div> </div> </div>')}]);